/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var __webpack_modules__={1983:(t,e,i)=>{"use strict";i(6266),i(990),i(911),i(4160),i(6197),i(6728),i(4039),i(3568),i(8051),i(8250),i(5434),i(4952),i(6337),i(5666)},6266:(t,e,i)=>{i(5767),i(8132),i(8388),i(7470),i(4882),i(1520),i(7476),i(9622),i(9375),i(3533),i(4672),i(4157),i(5095),i(9892),i(5115),i(9176),i(8838),i(6253),i(9730),i(6059),i(8377),i(1084),i(4299),i(1246),i(726),i(1901),i(5972),i(3403),i(2516),i(9371),i(6479),i(1736),i(1889),i(5177),i(6943),i(6503),i(6786),i(932),i(7526),i(1591),i(9073),i(347),i(579),i(4669),i(7710),i(5789),i(3514),i(9978),i(8472),i(6946),i(5068),i(413),i(191),i(8306),i(4564),i(9115),i(9539),i(6620),i(2850),i(823),i(7732),i(856),i(703),i(1539),i(5292),i(6629),i(3694),i(7648),i(7795),i(4531),i(3605),i(6780),i(9937),i(511),i(1822),i(9977),i(1031),i(6331),i(1560),i(774),i(522),i(8295),i(7842),i(110),i(75),i(4336),i(1802),i(8837),i(6773),i(5745),i(3057),i(3750),i(3369),i(9564),i(2e3),i(8977),i(2310),i(4899),i(1842),i(6997),i(3946),i(8269),i(6108),i(6774),i(1466),i(9357),i(6142),i(1876),i(851),i(8416),i(8184),i(147),i(9192),i(142),i(1786),i(5368),i(6964),i(2152),i(4821),i(9103),i(1303),i(3318),i(162),i(3834),i(1572),i(2139),i(685),i(5535),i(7347),i(3049),i(6633),i(8989),i(8270),i(4510),i(3984),i(5769),i(55),i(6014),t.exports=i(5645)},911:(t,e,i)=>{i(1268),t.exports=i(5645).Array.flatMap},990:(t,e,i)=>{i(2773),t.exports=i(5645).Array.includes},5434:(t,e,i)=>{i(3276),t.exports=i(5645).Object.entries},8051:(t,e,i)=>{i(8351),t.exports=i(5645).Object.getOwnPropertyDescriptors},8250:(t,e,i)=>{i(6409),t.exports=i(5645).Object.values},4952:(t,e,i)=>{"use strict";i(851),i(9865),t.exports=i(5645).Promise.finally},6197:(t,e,i)=>{i(2770),t.exports=i(5645).String.padEnd},4160:(t,e,i)=>{i(1784),t.exports=i(5645).String.padStart},4039:(t,e,i)=>{i(4325),t.exports=i(5645).String.trimRight},6728:(t,e,i)=>{i(5869),t.exports=i(5645).String.trimLeft},3568:(t,e,i)=>{i(9665),t.exports=i(8787).f("asyncIterator")},115:(t,e,i)=>{i(4579),t.exports=i(1327).global},5663:t=>{t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},2159:(t,e,i)=>{var r=i(6727);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},1327:t=>{var e=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=e)},9216:(t,e,i)=>{var r=i(5663);t.exports=function(t,e,i){if(r(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)}}return function(){return t.apply(e,arguments)}}},9666:(t,e,i)=>{t.exports=!i(7929)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},7467:(t,e,i)=>{var r=i(6727),n=i(3938).document,s=r(n)&&r(n.createElement);t.exports=function(t){return s?n.createElement(t):{}}},3856:(t,e,i)=>{var r=i(3938),n=i(1327),s=i(9216),o=i(1818),a=i(7069),h=function(t,e,i){var l,u,c,d=t&h.F,p=t&h.G,f=t&h.S,g=t&h.P,v=t&h.B,m=t&h.W,y=p?n:n[e]||(n[e]={}),_=y.prototype,x=p?r:f?r[e]:(r[e]||{}).prototype;for(l in p&&(i=e),i)(u=!d&&x&&void 0!==x[l])&&a(y,l)||(c=u?x[l]:i[l],y[l]=p&&"function"!=typeof x[l]?i[l]:v&&u?s(c,r):m&&x[l]==c?function(t){var e=function(e,i,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,i)}return new t(e,i,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(c):g&&"function"==typeof c?s(Function.call,c):c,g&&((y.virtual||(y.virtual={}))[l]=c,t&h.R&&_&&!_[l]&&o(_,l,c)))};h.F=1,h.G=2,h.S=4,h.P=8,h.B=16,h.W=32,h.U=64,h.R=128,t.exports=h},7929:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},3938:t=>{var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},7069:t=>{var e={}.hasOwnProperty;t.exports=function(t,i){return e.call(t,i)}},1818:(t,e,i)=>{var r=i(4743),n=i(3101);t.exports=i(9666)?function(t,e,i){return r.f(t,e,n(1,i))}:function(t,e,i){return t[e]=i,t}},3758:(t,e,i)=>{t.exports=!i(9666)&&!i(7929)((function(){return 7!=Object.defineProperty(i(7467)("div"),"a",{get:function(){return 7}}).a}))},6727:t=>{t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},4743:(t,e,i)=>{var r=i(2159),n=i(3758),s=i(3206),o=Object.defineProperty;e.f=i(9666)?Object.defineProperty:function(t,e,i){if(r(t),e=s(e,!0),r(i),n)try{return o(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},3101:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},3206:(t,e,i)=>{var r=i(6727);t.exports=function(t,e){if(!r(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!r(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")}},4579:(t,e,i)=>{var r=i(3856);r(r.G,{global:i(3938)})},4963:t=>{t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},3365:(t,e,i)=>{var r=i(2032);t.exports=function(t,e){if("number"!=typeof t&&"Number"!=r(t))throw TypeError(e);return+t}},7722:(t,e,i)=>{var r=i(6314)("unscopables"),n=Array.prototype;null==n[r]&&i(7728)(n,r,{}),t.exports=function(t){n[r][t]=!0}},6793:(t,e,i)=>{"use strict";var r=i(4496)(!0);t.exports=function(t,e,i){return e+(i?r(t,e).length:1)}},3328:t=>{t.exports=function(t,e,i,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(i+": incorrect invocation!");return t}},7007:(t,e,i)=>{var r=i(5286);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},5216:(t,e,i)=>{"use strict";var r=i(508),n=i(2337),s=i(875);t.exports=[].copyWithin||function(t,e){var i=r(this),o=s(i.length),a=n(t,o),h=n(e,o),l=arguments.length>2?arguments[2]:void 0,u=Math.min((void 0===l?o:n(l,o))-h,o-a),c=1;for(h<a&&a<h+u&&(c=-1,h+=u-1,a+=u-1);u-- >0;)h in i?i[a]=i[h]:delete i[a],a+=c,h+=c;return i}},6852:(t,e,i)=>{"use strict";var r=i(508),n=i(2337),s=i(875);t.exports=function(t){for(var e=r(this),i=s(e.length),o=arguments.length,a=n(o>1?arguments[1]:void 0,i),h=o>2?arguments[2]:void 0,l=void 0===h?i:n(h,i);l>a;)e[a++]=t;return e}},9315:(t,e,i)=>{var r=i(2110),n=i(875),s=i(2337);t.exports=function(t){return function(e,i,o){var a,h=r(e),l=n(h.length),u=s(o,l);if(t&&i!=i){for(;l>u;)if((a=h[u++])!=a)return!0}else for(;l>u;u++)if((t||u in h)&&h[u]===i)return t||u||0;return!t&&-1}}},50:(t,e,i)=>{var r=i(741),n=i(9797),s=i(508),o=i(875),a=i(6886);t.exports=function(t,e){var i=1==t,h=2==t,l=3==t,u=4==t,c=6==t,d=5==t||c,p=e||a;return function(e,a,f){for(var g,v,m=s(e),y=n(m),_=r(a,f,3),x=o(y.length),w=0,b=i?p(e,x):h?p(e,0):void 0;x>w;w++)if((d||w in y)&&(v=_(g=y[w],w,m),t))if(i)b[w]=v;else if(v)switch(t){case 3:return!0;case 5:return g;case 6:return w;case 2:b.push(g)}else if(u)return!1;return c?-1:l||u?u:b}}},7628:(t,e,i)=>{var r=i(4963),n=i(508),s=i(9797),o=i(875);t.exports=function(t,e,i,a,h){r(e);var l=n(t),u=s(l),c=o(l.length),d=h?c-1:0,p=h?-1:1;if(i<2)for(;;){if(d in u){a=u[d],d+=p;break}if(d+=p,h?d<0:c<=d)throw TypeError("Reduce of empty array with no initial value")}for(;h?d>=0:c>d;d+=p)d in u&&(a=e(a,u[d],d,l));return a}},2736:(t,e,i)=>{var r=i(5286),n=i(4302),s=i(6314)("species");t.exports=function(t){var e;return n(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!n(e.prototype)||(e=void 0),r(e)&&null===(e=e[s])&&(e=void 0)),void 0===e?Array:e}},6886:(t,e,i)=>{var r=i(2736);t.exports=function(t,e){return new(r(t))(e)}},4398:(t,e,i)=>{"use strict";var r=i(4963),n=i(5286),s=i(7242),o=[].slice,a={},h=function(t,e,i){if(!(e in a)){for(var r=[],n=0;n<e;n++)r[n]="a["+n+"]";a[e]=Function("F,a","return new F("+r.join(",")+")")}return a[e](t,i)};t.exports=Function.bind||function(t){var e=r(this),i=o.call(arguments,1),a=function(){var r=i.concat(o.call(arguments));return this instanceof a?h(e,r.length,r):s(e,r,t)};return n(e.prototype)&&(a.prototype=e.prototype),a}},1488:(t,e,i)=>{var r=i(2032),n=i(6314)("toStringTag"),s="Arguments"==r(function(){return arguments}());t.exports=function(t){var e,i,o;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),n))?i:s?r(e):"Object"==(o=r(e))&&"function"==typeof e.callee?"Arguments":o}},2032:t=>{var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)}},9824:(t,e,i)=>{"use strict";var r=i(9275).f,n=i(2503),s=i(4408),o=i(741),a=i(3328),h=i(3531),l=i(2923),u=i(5436),c=i(2974),d=i(7057),p=i(4728).fastKey,f=i(1616),g=d?"_s":"size",v=function(t,e){var i,r=p(e);if("F"!==r)return t._i[r];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,l){var u=t((function(t,r){a(t,u,e,"_i"),t._t=e,t._i=n(null),t._f=void 0,t._l=void 0,t[g]=0,null!=r&&h(r,i,t[l],t)}));return s(u.prototype,{clear:function(){for(var t=f(this,e),i=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete i[r.i];t._f=t._l=void 0,t[g]=0},delete:function(t){var i=f(this,e),r=v(i,t);if(r){var n=r.n,s=r.p;delete i._i[r.i],r.r=!0,s&&(s.n=n),n&&(n.p=s),i._f==r&&(i._f=n),i._l==r&&(i._l=s),i[g]--}return!!r},forEach:function(t){f(this,e);for(var i,r=o(t,arguments.length>1?arguments[1]:void 0,3);i=i?i.n:this._f;)for(r(i.v,i.k,this);i&&i.r;)i=i.p},has:function(t){return!!v(f(this,e),t)}}),d&&r(u.prototype,"size",{get:function(){return f(this,e)[g]}}),u},def:function(t,e,i){var r,n,s=v(t,e);return s?s.v=i:(t._l=s={i:n=p(e,!0),k:e,v:i,p:r=t._l,n:void 0,r:!1},t._f||(t._f=s),r&&(r.n=s),t[g]++,"F"!==n&&(t._i[n]=s)),t},getEntry:v,setStrong:function(t,e,i){l(t,e,(function(t,i){this._t=f(t,e),this._k=i,this._l=void 0}),(function(){for(var t=this,e=t._k,i=t._l;i&&i.r;)i=i.p;return t._t&&(t._l=i=i?i.n:t._t._f)?u(0,"keys"==e?i.k:"values"==e?i.v:[i.k,i.v]):(t._t=void 0,u(1))}),i?"entries":"values",!i,!0),c(e)}}},3657:(t,e,i)=>{"use strict";var r=i(4408),n=i(4728).getWeak,s=i(7007),o=i(5286),a=i(3328),h=i(3531),l=i(50),u=i(9181),c=i(1616),d=l(5),p=l(6),f=0,g=function(t){return t._l||(t._l=new v)},v=function(){this.a=[]},m=function(t,e){return d(t.a,(function(t){return t[0]===e}))};v.prototype={get:function(t){var e=m(this,t);if(e)return e[1]},has:function(t){return!!m(this,t)},set:function(t,e){var i=m(this,t);i?i[1]=e:this.a.push([t,e])},delete:function(t){var e=p(this.a,(function(e){return e[0]===t}));return~e&&this.a.splice(e,1),!!~e}},t.exports={getConstructor:function(t,e,i,s){var l=t((function(t,r){a(t,l,e,"_i"),t._t=e,t._i=f++,t._l=void 0,null!=r&&h(r,i,t[s],t)}));return r(l.prototype,{delete:function(t){if(!o(t))return!1;var i=n(t);return!0===i?g(c(this,e)).delete(t):i&&u(i,this._i)&&delete i[this._i]},has:function(t){if(!o(t))return!1;var i=n(t);return!0===i?g(c(this,e)).has(t):i&&u(i,this._i)}}),l},def:function(t,e,i){var r=n(s(e),!0);return!0===r?g(t).set(e,i):r[t._i]=i,t},ufstore:g}},5795:(t,e,i)=>{"use strict";var r=i(3816),n=i(2985),s=i(7234),o=i(4408),a=i(4728),h=i(3531),l=i(3328),u=i(5286),c=i(4253),d=i(7462),p=i(2943),f=i(266);t.exports=function(t,e,i,g,v,m){var y=r[t],_=y,x=v?"set":"add",w=_&&_.prototype,b={},E=function(t){var e=w[t];s(w,t,"delete"==t||"has"==t?function(t){return!(m&&!u(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return m&&!u(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,i){return e.call(this,0===t?0:t,i),this})};if("function"==typeof _&&(m||w.forEach&&!c((function(){(new _).entries().next()})))){var T=new _,S=T[x](m?{}:-0,1)!=T,A=c((function(){T.has(1)})),P=d((function(t){new _(t)})),O=!m&&c((function(){for(var t=new _,e=5;e--;)t[x](e,e);return!t.has(-0)}));P||((_=e((function(e,i){l(e,_,t);var r=f(new y,e,_);return null!=i&&h(i,v,r[x],r),r}))).prototype=w,w.constructor=_),(A||O)&&(E("delete"),E("has"),v&&E("get")),(O||S)&&E(x),m&&w.clear&&delete w.clear}else _=g.getConstructor(e,t,v,x),o(_.prototype,i),a.NEED=!0;return p(_,t),b[t]=_,n(n.G+n.W+n.F*(_!=y),b),m||g.setStrong(_,t,v),_}},5645:t=>{var e=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=e)},2811:(t,e,i)=>{"use strict";var r=i(9275),n=i(681);t.exports=function(t,e,i){e in t?r.f(t,e,n(0,i)):t[e]=i}},741:(t,e,i)=>{var r=i(4963);t.exports=function(t,e,i){if(r(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,r){return t.call(e,i,r)};case 3:return function(i,r,n){return t.call(e,i,r,n)}}return function(){return t.apply(e,arguments)}}},3537:(t,e,i)=>{"use strict";var r=i(4253),n=Date.prototype.getTime,s=Date.prototype.toISOString,o=function(t){return t>9?t:"0"+t};t.exports=r((function(){return"0385-07-25T07:06:39.999Z"!=s.call(new Date(-50000000000001))}))||!r((function(){s.call(new Date(NaN))}))?function(){if(!isFinite(n.call(this)))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),i=t.getUTCMilliseconds(),r=e<0?"-":e>9999?"+":"";return r+("00000"+Math.abs(e)).slice(r?-6:-4)+"-"+o(t.getUTCMonth()+1)+"-"+o(t.getUTCDate())+"T"+o(t.getUTCHours())+":"+o(t.getUTCMinutes())+":"+o(t.getUTCSeconds())+"."+(i>99?i:"0"+o(i))+"Z"}:s},870:(t,e,i)=>{"use strict";var r=i(7007),n=i(1689),s="number";t.exports=function(t){if("string"!==t&&t!==s&&"default"!==t)throw TypeError("Incorrect hint");return n(r(this),t!=s)}},1355:t=>{t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},7057:(t,e,i)=>{t.exports=!i(4253)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},2457:(t,e,i)=>{var r=i(5286),n=i(3816).document,s=r(n)&&r(n.createElement);t.exports=function(t){return s?n.createElement(t):{}}},4430:t=>{t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},5541:(t,e,i)=>{var r=i(7184),n=i(4548),s=i(4682);t.exports=function(t){var e=r(t),i=n.f;if(i)for(var o,a=i(t),h=s.f,l=0;a.length>l;)h.call(t,o=a[l++])&&e.push(o);return e}},2985:(t,e,i)=>{var r=i(3816),n=i(5645),s=i(7728),o=i(7234),a=i(741),h=function(t,e,i){var l,u,c,d,p=t&h.F,f=t&h.G,g=t&h.S,v=t&h.P,m=t&h.B,y=f?r:g?r[e]||(r[e]={}):(r[e]||{}).prototype,_=f?n:n[e]||(n[e]={}),x=_.prototype||(_.prototype={});for(l in f&&(i=e),i)c=((u=!p&&y&&void 0!==y[l])?y:i)[l],d=m&&u?a(c,r):v&&"function"==typeof c?a(Function.call,c):c,y&&o(y,l,c,t&h.U),_[l]!=c&&s(_,l,d),v&&x[l]!=c&&(x[l]=c)};r.core=n,h.F=1,h.G=2,h.S=4,h.P=8,h.B=16,h.W=32,h.U=64,h.R=128,t.exports=h},8852:(t,e,i)=>{var r=i(6314)("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(i){try{return e[r]=!1,!"/./"[t](e)}catch(t){}}return!0}},4253:t=>{t.exports=function(t){try{return!!t()}catch(t){return!0}}},8082:(t,e,i)=>{"use strict";i(8269);var r=i(7234),n=i(7728),s=i(4253),o=i(1355),a=i(6314),h=i(1165),l=a("species"),u=!s((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),c=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var i="ab".split(t);return 2===i.length&&"a"===i[0]&&"b"===i[1]}();t.exports=function(t,e,i){var d=a(t),p=!s((function(){var e={};return e[d]=function(){return 7},7!=""[t](e)})),f=p?!s((function(){var e=!1,i=/a/;return i.exec=function(){return e=!0,null},"split"===t&&(i.constructor={},i.constructor[l]=function(){return i}),i[d](""),!e})):void 0;if(!p||!f||"replace"===t&&!u||"split"===t&&!c){var g=/./[d],v=i(o,d,""[t],(function(t,e,i,r,n){return e.exec===h?p&&!n?{done:!0,value:g.call(e,i,r)}:{done:!0,value:t.call(i,e,r)}:{done:!1}})),m=v[0],y=v[1];r(String.prototype,t,m),n(RegExp.prototype,d,2==e?function(t,e){return y.call(t,this,e)}:function(t){return y.call(t,this)})}}},3218:(t,e,i)=>{"use strict";var r=i(7007);t.exports=function(){var t=r(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},3325:(t,e,i)=>{"use strict";var r=i(4302),n=i(5286),s=i(875),o=i(741),a=i(6314)("isConcatSpreadable");t.exports=function t(e,i,h,l,u,c,d,p){for(var f,g,v=u,m=0,y=!!d&&o(d,p,3);m<l;){if(m in h){if(f=y?y(h[m],m,i):h[m],g=!1,n(f)&&(g=void 0!==(g=f[a])?!!g:r(f)),g&&c>0)v=t(e,i,f,s(f.length),v,c-1)-1;else{if(v>=9007199254740991)throw TypeError();e[v]=f}v++}m++}return v}},3531:(t,e,i)=>{var r=i(741),n=i(8851),s=i(6555),o=i(7007),a=i(875),h=i(9002),l={},u={},c=t.exports=function(t,e,i,c,d){var p,f,g,v,m=d?function(){return t}:h(t),y=r(i,c,e?2:1),_=0;if("function"!=typeof m)throw TypeError(t+" is not iterable!");if(s(m)){for(p=a(t.length);p>_;_++)if((v=e?y(o(f=t[_])[0],f[1]):y(t[_]))===l||v===u)return v}else for(g=m.call(t);!(f=g.next()).done;)if((v=n(g,y,f.value,e))===l||v===u)return v};c.BREAK=l,c.RETURN=u},18:(t,e,i)=>{t.exports=i(3825)("native-function-to-string",Function.toString)},3816:t=>{var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)},9181:t=>{var e={}.hasOwnProperty;t.exports=function(t,i){return e.call(t,i)}},7728:(t,e,i)=>{var r=i(9275),n=i(681);t.exports=i(7057)?function(t,e,i){return r.f(t,e,n(1,i))}:function(t,e,i){return t[e]=i,t}},639:(t,e,i)=>{var r=i(3816).document;t.exports=r&&r.documentElement},1734:(t,e,i)=>{t.exports=!i(7057)&&!i(4253)((function(){return 7!=Object.defineProperty(i(2457)("div"),"a",{get:function(){return 7}}).a}))},266:(t,e,i)=>{var r=i(5286),n=i(7375).set;t.exports=function(t,e,i){var s,o=e.constructor;return o!==i&&"function"==typeof o&&(s=o.prototype)!==i.prototype&&r(s)&&n&&n(t,s),t}},7242:t=>{t.exports=function(t,e,i){var r=void 0===i;switch(e.length){case 0:return r?t():t.call(i);case 1:return r?t(e[0]):t.call(i,e[0]);case 2:return r?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},9797:(t,e,i)=>{var r=i(2032);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==r(t)?t.split(""):Object(t)}},6555:(t,e,i)=>{var r=i(2803),n=i(6314)("iterator"),s=Array.prototype;t.exports=function(t){return void 0!==t&&(r.Array===t||s[n]===t)}},4302:(t,e,i)=>{var r=i(2032);t.exports=Array.isArray||function(t){return"Array"==r(t)}},8367:(t,e,i)=>{var r=i(5286),n=Math.floor;t.exports=function(t){return!r(t)&&isFinite(t)&&n(t)===t}},5286:t=>{t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},5364:(t,e,i)=>{var r=i(5286),n=i(2032),s=i(6314)("match");t.exports=function(t){var e;return r(t)&&(void 0!==(e=t[s])?!!e:"RegExp"==n(t))}},8851:(t,e,i)=>{var r=i(7007);t.exports=function(t,e,i,n){try{return n?e(r(i)[0],i[1]):e(i)}catch(e){var s=t.return;throw void 0!==s&&r(s.call(t)),e}}},9988:(t,e,i)=>{"use strict";var r=i(2503),n=i(681),s=i(2943),o={};i(7728)(o,i(6314)("iterator"),(function(){return this})),t.exports=function(t,e,i){t.prototype=r(o,{next:n(1,i)}),s(t,e+" Iterator")}},2923:(t,e,i)=>{"use strict";var r=i(4461),n=i(2985),s=i(7234),o=i(7728),a=i(2803),h=i(9988),l=i(2943),u=i(468),c=i(6314)("iterator"),d=!([].keys&&"next"in[].keys()),p="keys",f="values",g=function(){return this};t.exports=function(t,e,i,v,m,y,_){h(i,e,v);var x,w,b,E=function(t){if(!d&&t in P)return P[t];switch(t){case p:case f:return function(){return new i(this,t)}}return function(){return new i(this,t)}},T=e+" Iterator",S=m==f,A=!1,P=t.prototype,O=P[c]||P["@@iterator"]||m&&P[m],R=O||E(m),C=m?S?E("entries"):R:void 0,M="Array"==e&&P.entries||O;if(M&&(b=u(M.call(new t)))!==Object.prototype&&b.next&&(l(b,T,!0),r||"function"==typeof b[c]||o(b,c,g)),S&&O&&O.name!==f&&(A=!0,R=function(){return O.call(this)}),r&&!_||!d&&!A&&P[c]||o(P,c,R),a[e]=R,a[T]=g,m)if(x={values:S?R:E(f),keys:y?R:E(p),entries:C},_)for(w in x)w in P||s(P,w,x[w]);else n(n.P+n.F*(d||A),e,x);return x}},7462:(t,e,i)=>{var r=i(6314)("iterator"),n=!1;try{var s=[7][r]();s.return=function(){n=!0},Array.from(s,(function(){throw 2}))}catch(t){}t.exports=function(t,e){if(!e&&!n)return!1;var i=!1;try{var s=[7],o=s[r]();o.next=function(){return{done:i=!0}},s[r]=function(){return o},t(s)}catch(t){}return i}},5436:t=>{t.exports=function(t,e){return{value:e,done:!!t}}},2803:t=>{t.exports={}},4461:t=>{t.exports=!1},3086:t=>{var e=Math.expm1;t.exports=!e||e(10)>22025.465794806718||e(10)<22025.465794806718||-2e-17!=e(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:e},4934:(t,e,i)=>{var r=i(1801),n=Math.pow,s=n(2,-52),o=n(2,-23),a=n(2,127)*(2-o),h=n(2,-126);t.exports=Math.fround||function(t){var e,i,n=Math.abs(t),l=r(t);return n<h?l*(n/h/o+1/s-1/s)*h*o:(i=(e=(1+o/s)*n)-(e-n))>a||i!=i?l*(1/0):l*i}},6206:t=>{t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},1801:t=>{t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},4728:(t,e,i)=>{var r=i(3953)("meta"),n=i(5286),s=i(9181),o=i(9275).f,a=0,h=Object.isExtensible||function(){return!0},l=!i(4253)((function(){return h(Object.preventExtensions({}))})),u=function(t){o(t,r,{value:{i:"O"+ ++a,w:{}}})},c=t.exports={KEY:r,NEED:!1,fastKey:function(t,e){if(!n(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!s(t,r)){if(!h(t))return"F";if(!e)return"E";u(t)}return t[r].i},getWeak:function(t,e){if(!s(t,r)){if(!h(t))return!0;if(!e)return!1;u(t)}return t[r].w},onFreeze:function(t){return l&&c.NEED&&h(t)&&!s(t,r)&&u(t),t}}},4351:(t,e,i)=>{var r=i(3816),n=i(4193).set,s=r.MutationObserver||r.WebKitMutationObserver,o=r.process,a=r.Promise,h="process"==i(2032)(o);t.exports=function(){var t,e,i,l=function(){var r,n;for(h&&(r=o.domain)&&r.exit();t;){n=t.fn,t=t.next;try{n()}catch(r){throw t?i():e=void 0,r}}e=void 0,r&&r.enter()};if(h)i=function(){o.nextTick(l)};else if(!s||r.navigator&&r.navigator.standalone)if(a&&a.resolve){var u=a.resolve(void 0);i=function(){u.then(l)}}else i=function(){n.call(r,l)};else{var c=!0,d=document.createTextNode("");new s(l).observe(d,{characterData:!0}),i=function(){d.data=c=!c}}return function(r){var n={fn:r,next:void 0};e&&(e.next=n),t||(t=n,i()),e=n}}},3499:(t,e,i)=>{"use strict";var r=i(4963);function n(t){var e,i;this.promise=new t((function(t,r){if(void 0!==e||void 0!==i)throw TypeError("Bad Promise constructor");e=t,i=r})),this.resolve=r(e),this.reject=r(i)}t.exports.f=function(t){return new n(t)}},5345:(t,e,i)=>{"use strict";var r=i(7057),n=i(7184),s=i(4548),o=i(4682),a=i(508),h=i(9797),l=Object.assign;t.exports=!l||i(4253)((function(){var t={},e={},i=Symbol(),r="abcdefghijklmnopqrst";return t[i]=7,r.split("").forEach((function(t){e[t]=t})),7!=l({},t)[i]||Object.keys(l({},e)).join("")!=r}))?function(t,e){for(var i=a(t),l=arguments.length,u=1,c=s.f,d=o.f;l>u;)for(var p,f=h(arguments[u++]),g=c?n(f).concat(c(f)):n(f),v=g.length,m=0;v>m;)p=g[m++],r&&!d.call(f,p)||(i[p]=f[p]);return i}:l},2503:(t,e,i)=>{var r=i(7007),n=i(5588),s=i(4430),o=i(9335)("IE_PROTO"),a=function(){},h=function(){var t,e=i(2457)("iframe"),r=s.length;for(e.style.display="none",i(639).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),h=t.F;r--;)delete h.prototype[s[r]];return h()};t.exports=Object.create||function(t,e){var i;return null!==t?(a.prototype=r(t),i=new a,a.prototype=null,i[o]=t):i=h(),void 0===e?i:n(i,e)}},9275:(t,e,i)=>{var r=i(7007),n=i(1734),s=i(1689),o=Object.defineProperty;e.f=i(7057)?Object.defineProperty:function(t,e,i){if(r(t),e=s(e,!0),r(i),n)try{return o(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},5588:(t,e,i)=>{var r=i(9275),n=i(7007),s=i(7184);t.exports=i(7057)?Object.defineProperties:function(t,e){n(t);for(var i,o=s(e),a=o.length,h=0;a>h;)r.f(t,i=o[h++],e[i]);return t}},8693:(t,e,i)=>{var r=i(4682),n=i(681),s=i(2110),o=i(1689),a=i(9181),h=i(1734),l=Object.getOwnPropertyDescriptor;e.f=i(7057)?l:function(t,e){if(t=s(t),e=o(e,!0),h)try{return l(t,e)}catch(t){}if(a(t,e))return n(!r.f.call(t,e),t[e])}},9327:(t,e,i)=>{var r=i(2110),n=i(616).f,s={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return o&&"[object Window]"==s.call(t)?function(t){try{return n(t)}catch(t){return o.slice()}}(t):n(r(t))}},616:(t,e,i)=>{var r=i(189),n=i(4430).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,n)}},4548:(t,e)=>{e.f=Object.getOwnPropertySymbols},468:(t,e,i)=>{var r=i(9181),n=i(508),s=i(9335)("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=n(t),r(t,s)?t[s]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?o:null}},189:(t,e,i)=>{var r=i(9181),n=i(2110),s=i(9315)(!1),o=i(9335)("IE_PROTO");t.exports=function(t,e){var i,a=n(t),h=0,l=[];for(i in a)i!=o&&r(a,i)&&l.push(i);for(;e.length>h;)r(a,i=e[h++])&&(~s(l,i)||l.push(i));return l}},7184:(t,e,i)=>{var r=i(189),n=i(4430);t.exports=Object.keys||function(t){return r(t,n)}},4682:(t,e)=>{e.f={}.propertyIsEnumerable},3160:(t,e,i)=>{var r=i(2985),n=i(5645),s=i(4253);t.exports=function(t,e){var i=(n.Object||{})[t]||Object[t],o={};o[t]=e(i),r(r.S+r.F*s((function(){i(1)})),"Object",o)}},1131:(t,e,i)=>{var r=i(7057),n=i(7184),s=i(2110),o=i(4682).f;t.exports=function(t){return function(e){for(var i,a=s(e),h=n(a),l=h.length,u=0,c=[];l>u;)i=h[u++],r&&!o.call(a,i)||c.push(t?[i,a[i]]:a[i]);return c}}},7643:(t,e,i)=>{var r=i(616),n=i(4548),s=i(7007),o=i(3816).Reflect;t.exports=o&&o.ownKeys||function(t){var e=r.f(s(t)),i=n.f;return i?e.concat(i(t)):e}},7743:(t,e,i)=>{var r=i(3816).parseFloat,n=i(9599).trim;t.exports=1/r(i(4644)+"-0")!=-1/0?function(t){var e=n(String(t),3),i=r(e);return 0===i&&"-"==e.charAt(0)?-0:i}:r},5960:(t,e,i)=>{var r=i(3816).parseInt,n=i(9599).trim,s=i(4644),o=/^[-+]?0[xX]/;t.exports=8!==r(s+"08")||22!==r(s+"0x16")?function(t,e){var i=n(String(t),3);return r(i,e>>>0||(o.test(i)?16:10))}:r},188:t=>{t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},94:(t,e,i)=>{var r=i(7007),n=i(5286),s=i(3499);t.exports=function(t,e){if(r(t),n(e)&&e.constructor===t)return e;var i=s.f(t);return(0,i.resolve)(e),i.promise}},681:t=>{t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},4408:(t,e,i)=>{var r=i(7234);t.exports=function(t,e,i){for(var n in e)r(t,n,e[n],i);return t}},7234:(t,e,i)=>{var r=i(3816),n=i(7728),s=i(9181),o=i(3953)("src"),a=i(18),h="toString",l=(""+a).split(h);i(5645).inspectSource=function(t){return a.call(t)},(t.exports=function(t,e,i,a){var h="function"==typeof i;h&&(s(i,"name")||n(i,"name",e)),t[e]!==i&&(h&&(s(i,o)||n(i,o,t[e]?""+t[e]:l.join(String(e)))),t===r?t[e]=i:a?t[e]?t[e]=i:n(t,e,i):(delete t[e],n(t,e,i)))})(Function.prototype,h,(function(){return"function"==typeof this&&this[o]||a.call(this)}))},7787:(t,e,i)=>{"use strict";var r=i(1488),n=RegExp.prototype.exec;t.exports=function(t,e){var i=t.exec;if("function"==typeof i){var s=i.call(t,e);if("object"!=typeof s)throw new TypeError("RegExp exec method returned something other than an Object or null");return s}if("RegExp"!==r(t))throw new TypeError("RegExp#exec called on incompatible receiver");return n.call(t,e)}},1165:(t,e,i)=>{"use strict";var r,n,s=i(3218),o=RegExp.prototype.exec,a=String.prototype.replace,h=o,l=(r=/a/,n=/b*/g,o.call(r,"a"),o.call(n,"a"),0!==r.lastIndex||0!==n.lastIndex),u=void 0!==/()??/.exec("")[1];(l||u)&&(h=function(t){var e,i,r,n,h=this;return u&&(i=new RegExp("^"+h.source+"$(?!\\s)",s.call(h))),l&&(e=h.lastIndex),r=o.call(h,t),l&&r&&(h.lastIndex=h.global?r.index+r[0].length:e),u&&r&&r.length>1&&a.call(r[0],i,(function(){for(n=1;n<arguments.length-2;n++)void 0===arguments[n]&&(r[n]=void 0)})),r}),t.exports=h},7195:t=>{t.exports=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}},7375:(t,e,i)=>{var r=i(5286),n=i(7007),s=function(t,e){if(n(t),!r(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,r){try{(r=i(741)(Function.call,i(8693).f(Object.prototype,"__proto__").set,2))(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return s(t,i),e?t.__proto__=i:r(t,i),t}}({},!1):void 0),check:s}},2974:(t,e,i)=>{"use strict";var r=i(3816),n=i(9275),s=i(7057),o=i(6314)("species");t.exports=function(t){var e=r[t];s&&e&&!e[o]&&n.f(e,o,{configurable:!0,get:function(){return this}})}},2943:(t,e,i)=>{var r=i(9275).f,n=i(9181),s=i(6314)("toStringTag");t.exports=function(t,e,i){t&&!n(t=i?t:t.prototype,s)&&r(t,s,{configurable:!0,value:e})}},9335:(t,e,i)=>{var r=i(3825)("keys"),n=i(3953);t.exports=function(t){return r[t]||(r[t]=n(t))}},3825:(t,e,i)=>{var r=i(5645),n=i(3816),s="__core-js_shared__",o=n[s]||(n[s]={});(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:r.version,mode:i(4461)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},8364:(t,e,i)=>{var r=i(7007),n=i(4963),s=i(6314)("species");t.exports=function(t,e){var i,o=r(t).constructor;return void 0===o||null==(i=r(o)[s])?e:n(i)}},7717:(t,e,i)=>{"use strict";var r=i(4253);t.exports=function(t,e){return!!t&&r((function(){e?t.call(null,(function(){}),1):t.call(null)}))}},4496:(t,e,i)=>{var r=i(1467),n=i(1355);t.exports=function(t){return function(e,i){var s,o,a=String(n(e)),h=r(i),l=a.length;return h<0||h>=l?t?"":void 0:(s=a.charCodeAt(h))<55296||s>56319||h+1===l||(o=a.charCodeAt(h+1))<56320||o>57343?t?a.charAt(h):s:t?a.slice(h,h+2):o-56320+(s-55296<<10)+65536}}},2094:(t,e,i)=>{var r=i(5364),n=i(1355);t.exports=function(t,e,i){if(r(e))throw TypeError("String#"+i+" doesn't accept regex!");return String(n(t))}},9395:(t,e,i)=>{var r=i(2985),n=i(4253),s=i(1355),o=/"/g,a=function(t,e,i,r){var n=String(s(t)),a="<"+e;return""!==i&&(a+=" "+i+'="'+String(r).replace(o,"&quot;")+'"'),a+">"+n+"</"+e+">"};t.exports=function(t,e){var i={};i[t]=e(a),r(r.P+r.F*n((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3})),"String",i)}},5442:(t,e,i)=>{var r=i(875),n=i(8595),s=i(1355);t.exports=function(t,e,i,o){var a=String(s(t)),h=a.length,l=void 0===i?" ":String(i),u=r(e);if(u<=h||""==l)return a;var c=u-h,d=n.call(l,Math.ceil(c/l.length));return d.length>c&&(d=d.slice(0,c)),o?d+a:a+d}},8595:(t,e,i)=>{"use strict";var r=i(1467),n=i(1355);t.exports=function(t){var e=String(n(this)),i="",s=r(t);if(s<0||s==1/0)throw RangeError("Count can't be negative");for(;s>0;(s>>>=1)&&(e+=e))1&s&&(i+=e);return i}},9599:(t,e,i)=>{var r=i(2985),n=i(1355),s=i(4253),o=i(4644),a="["+o+"]",h=RegExp("^"+a+a+"*"),l=RegExp(a+a+"*$"),u=function(t,e,i){var n={},a=s((function(){return!!o[t]()||"​"!="​"[t]()})),h=n[t]=a?e(c):o[t];i&&(n[i]=h),r(r.P+r.F*a,"String",n)},c=u.trim=function(t,e){return t=String(n(t)),1&e&&(t=t.replace(h,"")),2&e&&(t=t.replace(l,"")),t};t.exports=u},4644:t=>{t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},4193:(t,e,i)=>{var r,n,s,o=i(741),a=i(7242),h=i(639),l=i(2457),u=i(3816),c=u.process,d=u.setImmediate,p=u.clearImmediate,f=u.MessageChannel,g=u.Dispatch,v=0,m={},y=function(){var t=+this;if(m.hasOwnProperty(t)){var e=m[t];delete m[t],e()}},_=function(t){y.call(t.data)};d&&p||(d=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return m[++v]=function(){a("function"==typeof t?t:Function(t),e)},r(v),v},p=function(t){delete m[t]},"process"==i(2032)(c)?r=function(t){c.nextTick(o(y,t,1))}:g&&g.now?r=function(t){g.now(o(y,t,1))}:f?(s=(n=new f).port2,n.port1.onmessage=_,r=o(s.postMessage,s,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(r=function(t){u.postMessage(t+"","*")},u.addEventListener("message",_,!1)):r="onreadystatechange"in l("script")?function(t){h.appendChild(l("script")).onreadystatechange=function(){h.removeChild(this),y.call(t)}}:function(t){setTimeout(o(y,t,1),0)}),t.exports={set:d,clear:p}},2337:(t,e,i)=>{var r=i(1467),n=Math.max,s=Math.min;t.exports=function(t,e){return(t=r(t))<0?n(t+e,0):s(t,e)}},4843:(t,e,i)=>{var r=i(1467),n=i(875);t.exports=function(t){if(void 0===t)return 0;var e=r(t),i=n(e);if(e!==i)throw RangeError("Wrong length!");return i}},1467:t=>{var e=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?i:e)(t)}},2110:(t,e,i)=>{var r=i(9797),n=i(1355);t.exports=function(t){return r(n(t))}},875:(t,e,i)=>{var r=i(1467),n=Math.min;t.exports=function(t){return t>0?n(r(t),9007199254740991):0}},508:(t,e,i)=>{var r=i(1355);t.exports=function(t){return Object(r(t))}},1689:(t,e,i)=>{var r=i(5286);t.exports=function(t,e){if(!r(t))return t;var i,n;if(e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;if("function"==typeof(i=t.valueOf)&&!r(n=i.call(t)))return n;if(!e&&"function"==typeof(i=t.toString)&&!r(n=i.call(t)))return n;throw TypeError("Can't convert object to primitive value")}},8440:(t,e,i)=>{"use strict";if(i(7057)){var r=i(4461),n=i(3816),s=i(4253),o=i(2985),a=i(9383),h=i(1125),l=i(741),u=i(3328),c=i(681),d=i(7728),p=i(4408),f=i(1467),g=i(875),v=i(4843),m=i(2337),y=i(1689),_=i(9181),x=i(1488),w=i(5286),b=i(508),E=i(6555),T=i(2503),S=i(468),A=i(616).f,P=i(9002),O=i(3953),R=i(6314),C=i(50),M=i(9315),I=i(8364),L=i(6997),k=i(2803),N=i(7462),D=i(2974),B=i(6852),F=i(5216),V=i(9275),z=i(8693),j=V.f,G=z.f,q=n.RangeError,U=n.TypeError,$=n.Uint8Array,H="ArrayBuffer",X="SharedArrayBuffer",W="BYTES_PER_ELEMENT",Y=Array.prototype,Z=h.ArrayBuffer,K=h.DataView,J=C(0),Q=C(2),tt=C(3),et=C(4),it=C(5),rt=C(6),nt=M(!0),st=M(!1),ot=L.values,at=L.keys,ht=L.entries,lt=Y.lastIndexOf,ut=Y.reduce,ct=Y.reduceRight,dt=Y.join,pt=Y.sort,ft=Y.slice,gt=Y.toString,vt=Y.toLocaleString,mt=R("iterator"),yt=R("toStringTag"),_t=O("typed_constructor"),xt=O("def_constructor"),wt=a.CONSTR,bt=a.TYPED,Et=a.VIEW,Tt="Wrong length!",St=C(1,(function(t,e){return Ct(I(t,t[xt]),e)})),At=s((function(){return 1===new $(new Uint16Array([1]).buffer)[0]})),Pt=!!$&&!!$.prototype.set&&s((function(){new $(1).set({})})),Ot=function(t,e){var i=f(t);if(i<0||i%e)throw q("Wrong offset!");return i},Rt=function(t){if(w(t)&&bt in t)return t;throw U(t+" is not a typed array!")},Ct=function(t,e){if(!w(t)||!(_t in t))throw U("It is not a typed array constructor!");return new t(e)},Mt=function(t,e){return It(I(t,t[xt]),e)},It=function(t,e){for(var i=0,r=e.length,n=Ct(t,r);r>i;)n[i]=e[i++];return n},Lt=function(t,e,i){j(t,e,{get:function(){return this._d[i]}})},kt=function(t){var e,i,r,n,s,o,a=b(t),h=arguments.length,u=h>1?arguments[1]:void 0,c=void 0!==u,d=P(a);if(null!=d&&!E(d)){for(o=d.call(a),r=[],e=0;!(s=o.next()).done;e++)r.push(s.value);a=r}for(c&&h>2&&(u=l(u,arguments[2],2)),e=0,i=g(a.length),n=Ct(this,i);i>e;e++)n[e]=c?u(a[e],e):a[e];return n},Nt=function(){for(var t=0,e=arguments.length,i=Ct(this,e);e>t;)i[t]=arguments[t++];return i},Dt=!!$&&s((function(){vt.call(new $(1))})),Bt=function(){return vt.apply(Dt?ft.call(Rt(this)):Rt(this),arguments)},Ft={copyWithin:function(t,e){return F.call(Rt(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return et(Rt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return B.apply(Rt(this),arguments)},filter:function(t){return Mt(this,Q(Rt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return it(Rt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return rt(Rt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){J(Rt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return st(Rt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return nt(Rt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return dt.apply(Rt(this),arguments)},lastIndexOf:function(t){return lt.apply(Rt(this),arguments)},map:function(t){return St(Rt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return ut.apply(Rt(this),arguments)},reduceRight:function(t){return ct.apply(Rt(this),arguments)},reverse:function(){for(var t,e=this,i=Rt(e).length,r=Math.floor(i/2),n=0;n<r;)t=e[n],e[n++]=e[--i],e[i]=t;return e},some:function(t){return tt(Rt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Rt(this),t)},subarray:function(t,e){var i=Rt(this),r=i.length,n=m(t,r);return new(I(i,i[xt]))(i.buffer,i.byteOffset+n*i.BYTES_PER_ELEMENT,g((void 0===e?r:m(e,r))-n))}},Vt=function(t,e){return Mt(this,ft.call(Rt(this),t,e))},zt=function(t){Rt(this);var e=Ot(arguments[1],1),i=this.length,r=b(t),n=g(r.length),s=0;if(n+e>i)throw q(Tt);for(;s<n;)this[e+s]=r[s++]},jt={entries:function(){return ht.call(Rt(this))},keys:function(){return at.call(Rt(this))},values:function(){return ot.call(Rt(this))}},Gt=function(t,e){return w(t)&&t[bt]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},qt=function(t,e){return Gt(t,e=y(e,!0))?c(2,t[e]):G(t,e)},Ut=function(t,e,i){return!(Gt(t,e=y(e,!0))&&w(i)&&_(i,"value"))||_(i,"get")||_(i,"set")||i.configurable||_(i,"writable")&&!i.writable||_(i,"enumerable")&&!i.enumerable?j(t,e,i):(t[e]=i.value,t)};wt||(z.f=qt,V.f=Ut),o(o.S+o.F*!wt,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Ut}),s((function(){gt.call({})}))&&(gt=vt=function(){return dt.call(this)});var $t=p({},Ft);p($t,jt),d($t,mt,jt.values),p($t,{slice:Vt,set:zt,constructor:function(){},toString:gt,toLocaleString:Bt}),Lt($t,"buffer","b"),Lt($t,"byteOffset","o"),Lt($t,"byteLength","l"),Lt($t,"length","e"),j($t,yt,{get:function(){return this[bt]}}),t.exports=function(t,e,i,h){var l=t+((h=!!h)?"Clamped":"")+"Array",c="get"+t,p="set"+t,f=n[l],m=f||{},y=f&&S(f),_=!f||!a.ABV,b={},E=f&&f.prototype,P=function(t,i){j(t,i,{get:function(){return function(t,i){var r=t._d;return r.v[c](i*e+r.o,At)}(this,i)},set:function(t){return function(t,i,r){var n=t._d;h&&(r=(r=Math.round(r))<0?0:r>255?255:255&r),n.v[p](i*e+n.o,r,At)}(this,i,t)},enumerable:!0})};_?(f=i((function(t,i,r,n){u(t,f,l,"_d");var s,o,a,h,c=0,p=0;if(w(i)){if(!(i instanceof Z||(h=x(i))==H||h==X))return bt in i?It(f,i):kt.call(f,i);s=i,p=Ot(r,e);var m=i.byteLength;if(void 0===n){if(m%e)throw q(Tt);if((o=m-p)<0)throw q(Tt)}else if((o=g(n)*e)+p>m)throw q(Tt);a=o/e}else a=v(i),s=new Z(o=a*e);for(d(t,"_d",{b:s,o:p,l:o,e:a,v:new K(s)});c<a;)P(t,c++)})),E=f.prototype=T($t),d(E,"constructor",f)):s((function(){f(1)}))&&s((function(){new f(-1)}))&&N((function(t){new f,new f(null),new f(1.5),new f(t)}),!0)||(f=i((function(t,i,r,n){var s;return u(t,f,l),w(i)?i instanceof Z||(s=x(i))==H||s==X?void 0!==n?new m(i,Ot(r,e),n):void 0!==r?new m(i,Ot(r,e)):new m(i):bt in i?It(f,i):kt.call(f,i):new m(v(i))})),J(y!==Function.prototype?A(m).concat(A(y)):A(m),(function(t){t in f||d(f,t,m[t])})),f.prototype=E,r||(E.constructor=f));var O=E[mt],R=!!O&&("values"==O.name||null==O.name),C=jt.values;d(f,_t,!0),d(E,bt,l),d(E,Et,!0),d(E,xt,f),(h?new f(1)[yt]==l:yt in E)||j(E,yt,{get:function(){return l}}),b[l]=f,o(o.G+o.W+o.F*(f!=m),b),o(o.S,l,{BYTES_PER_ELEMENT:e}),o(o.S+o.F*s((function(){m.of.call(f,1)})),l,{from:kt,of:Nt}),W in E||d(E,W,e),o(o.P,l,Ft),D(l),o(o.P+o.F*Pt,l,{set:zt}),o(o.P+o.F*!R,l,jt),r||E.toString==gt||(E.toString=gt),o(o.P+o.F*s((function(){new f(1).slice()})),l,{slice:Vt}),o(o.P+o.F*(s((function(){return[1,2].toLocaleString()!=new f([1,2]).toLocaleString()}))||!s((function(){E.toLocaleString.call([1,2])}))),l,{toLocaleString:Bt}),k[l]=R?O:C,r||R||d(E,mt,C)}}else t.exports=function(){}},1125:(t,e,i)=>{"use strict";var r=i(3816),n=i(7057),s=i(4461),o=i(9383),a=i(7728),h=i(4408),l=i(4253),u=i(3328),c=i(1467),d=i(875),p=i(4843),f=i(616).f,g=i(9275).f,v=i(6852),m=i(2943),y="ArrayBuffer",_="DataView",x="Wrong index!",w=r.ArrayBuffer,b=r.DataView,E=r.Math,T=r.RangeError,S=r.Infinity,A=w,P=E.abs,O=E.pow,R=E.floor,C=E.log,M=E.LN2,I="buffer",L="byteLength",k="byteOffset",N=n?"_b":I,D=n?"_l":L,B=n?"_o":k;function F(t,e,i){var r,n,s,o=new Array(i),a=8*i-e-1,h=(1<<a)-1,l=h>>1,u=23===e?O(2,-24)-O(2,-77):0,c=0,d=t<0||0===t&&1/t<0?1:0;for((t=P(t))!=t||t===S?(n=t!=t?1:0,r=h):(r=R(C(t)/M),t*(s=O(2,-r))<1&&(r--,s*=2),(t+=r+l>=1?u/s:u*O(2,1-l))*s>=2&&(r++,s/=2),r+l>=h?(n=0,r=h):r+l>=1?(n=(t*s-1)*O(2,e),r+=l):(n=t*O(2,l-1)*O(2,e),r=0));e>=8;o[c++]=255&n,n/=256,e-=8);for(r=r<<e|n,a+=e;a>0;o[c++]=255&r,r/=256,a-=8);return o[--c]|=128*d,o}function V(t,e,i){var r,n=8*i-e-1,s=(1<<n)-1,o=s>>1,a=n-7,h=i-1,l=t[h--],u=127&l;for(l>>=7;a>0;u=256*u+t[h],h--,a-=8);for(r=u&(1<<-a)-1,u>>=-a,a+=e;a>0;r=256*r+t[h],h--,a-=8);if(0===u)u=1-o;else{if(u===s)return r?NaN:l?-S:S;r+=O(2,e),u-=o}return(l?-1:1)*r*O(2,u-e)}function z(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function j(t){return[255&t]}function G(t){return[255&t,t>>8&255]}function q(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function U(t){return F(t,52,8)}function $(t){return F(t,23,4)}function H(t,e,i){g(t.prototype,e,{get:function(){return this[i]}})}function X(t,e,i,r){var n=p(+i);if(n+e>t[D])throw T(x);var s=t[N]._b,o=n+t[B],a=s.slice(o,o+e);return r?a:a.reverse()}function W(t,e,i,r,n,s){var o=p(+i);if(o+e>t[D])throw T(x);for(var a=t[N]._b,h=o+t[B],l=r(+n),u=0;u<e;u++)a[h+u]=l[s?u:e-u-1]}if(o.ABV){if(!l((function(){w(1)}))||!l((function(){new w(-1)}))||l((function(){return new w,new w(1.5),new w(NaN),w.name!=y}))){for(var Y,Z=(w=function(t){return u(this,w),new A(p(t))}).prototype=A.prototype,K=f(A),J=0;K.length>J;)(Y=K[J++])in w||a(w,Y,A[Y]);s||(Z.constructor=w)}var Q=new b(new w(2)),tt=b.prototype.setInt8;Q.setInt8(0,2147483648),Q.setInt8(1,2147483649),!Q.getInt8(0)&&Q.getInt8(1)||h(b.prototype,{setInt8:function(t,e){tt.call(this,t,e<<24>>24)},setUint8:function(t,e){tt.call(this,t,e<<24>>24)}},!0)}else w=function(t){u(this,w,y);var e=p(t);this._b=v.call(new Array(e),0),this[D]=e},b=function(t,e,i){u(this,b,_),u(t,w,_);var r=t[D],n=c(e);if(n<0||n>r)throw T("Wrong offset!");if(n+(i=void 0===i?r-n:d(i))>r)throw T("Wrong length!");this[N]=t,this[B]=n,this[D]=i},n&&(H(w,L,"_l"),H(b,I,"_b"),H(b,L,"_l"),H(b,k,"_o")),h(b.prototype,{getInt8:function(t){return X(this,1,t)[0]<<24>>24},getUint8:function(t){return X(this,1,t)[0]},getInt16:function(t){var e=X(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=X(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return z(X(this,4,t,arguments[1]))},getUint32:function(t){return z(X(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return V(X(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return V(X(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){W(this,1,t,j,e)},setUint8:function(t,e){W(this,1,t,j,e)},setInt16:function(t,e){W(this,2,t,G,e,arguments[2])},setUint16:function(t,e){W(this,2,t,G,e,arguments[2])},setInt32:function(t,e){W(this,4,t,q,e,arguments[2])},setUint32:function(t,e){W(this,4,t,q,e,arguments[2])},setFloat32:function(t,e){W(this,4,t,$,e,arguments[2])},setFloat64:function(t,e){W(this,8,t,U,e,arguments[2])}});m(w,y),m(b,_),a(b.prototype,o.VIEW,!0),e.ArrayBuffer=w,e.DataView=b},9383:(t,e,i)=>{for(var r,n=i(3816),s=i(7728),o=i(3953),a=o("typed_array"),h=o("view"),l=!(!n.ArrayBuffer||!n.DataView),u=l,c=0,d="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");c<9;)(r=n[d[c++]])?(s(r.prototype,a,!0),s(r.prototype,h,!0)):u=!1;t.exports={ABV:l,CONSTR:u,TYPED:a,VIEW:h}},3953:t=>{var e=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++e+i).toString(36))}},575:(t,e,i)=>{var r=i(3816).navigator;t.exports=r&&r.userAgent||""},1616:(t,e,i)=>{var r=i(5286);t.exports=function(t,e){if(!r(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},6074:(t,e,i)=>{var r=i(3816),n=i(5645),s=i(4461),o=i(8787),a=i(9275).f;t.exports=function(t){var e=n.Symbol||(n.Symbol=s?{}:r.Symbol||{});"_"==t.charAt(0)||t in e||a(e,t,{value:o.f(t)})}},8787:(t,e,i)=>{e.f=i(6314)},6314:(t,e,i)=>{var r=i(3825)("wks"),n=i(3953),s=i(3816).Symbol,o="function"==typeof s;(t.exports=function(t){return r[t]||(r[t]=o&&s[t]||(o?s:n)("Symbol."+t))}).store=r},9002:(t,e,i)=>{var r=i(1488),n=i(6314)("iterator"),s=i(2803);t.exports=i(5645).getIteratorMethod=function(t){if(null!=t)return t[n]||t["@@iterator"]||s[r(t)]}},2e3:(t,e,i)=>{var r=i(2985);r(r.P,"Array",{copyWithin:i(5216)}),i(7722)("copyWithin")},5745:(t,e,i)=>{"use strict";var r=i(2985),n=i(50)(4);r(r.P+r.F*!i(7717)([].every,!0),"Array",{every:function(t){return n(this,t,arguments[1])}})},8977:(t,e,i)=>{var r=i(2985);r(r.P,"Array",{fill:i(6852)}),i(7722)("fill")},8837:(t,e,i)=>{"use strict";var r=i(2985),n=i(50)(2);r(r.P+r.F*!i(7717)([].filter,!0),"Array",{filter:function(t){return n(this,t,arguments[1])}})},4899:(t,e,i)=>{"use strict";var r=i(2985),n=i(50)(6),s="findIndex",o=!0;s in[]&&Array(1)[s]((function(){o=!1})),r(r.P+r.F*o,"Array",{findIndex:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),i(7722)(s)},2310:(t,e,i)=>{"use strict";var r=i(2985),n=i(50)(5),s="find",o=!0;s in[]&&Array(1).find((function(){o=!1})),r(r.P+r.F*o,"Array",{find:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),i(7722)(s)},4336:(t,e,i)=>{"use strict";var r=i(2985),n=i(50)(0),s=i(7717)([].forEach,!0);r(r.P+r.F*!s,"Array",{forEach:function(t){return n(this,t,arguments[1])}})},522:(t,e,i)=>{"use strict";var r=i(741),n=i(2985),s=i(508),o=i(8851),a=i(6555),h=i(875),l=i(2811),u=i(9002);n(n.S+n.F*!i(7462)((function(t){Array.from(t)})),"Array",{from:function(t){var e,i,n,c,d=s(t),p="function"==typeof this?this:Array,f=arguments.length,g=f>1?arguments[1]:void 0,v=void 0!==g,m=0,y=u(d);if(v&&(g=r(g,f>2?arguments[2]:void 0,2)),null==y||p==Array&&a(y))for(i=new p(e=h(d.length));e>m;m++)l(i,m,v?g(d[m],m):d[m]);else for(c=y.call(d),i=new p;!(n=c.next()).done;m++)l(i,m,v?o(c,g,[n.value,m],!0):n.value);return i.length=m,i}})},3369:(t,e,i)=>{"use strict";var r=i(2985),n=i(9315)(!1),s=[].indexOf,o=!!s&&1/[1].indexOf(1,-0)<0;r(r.P+r.F*(o||!i(7717)(s)),"Array",{indexOf:function(t){return o?s.apply(this,arguments)||0:n(this,t,arguments[1])}})},774:(t,e,i)=>{var r=i(2985);r(r.S,"Array",{isArray:i(4302)})},6997:(t,e,i)=>{"use strict";var r=i(7722),n=i(5436),s=i(2803),o=i(2110);t.exports=i(2923)(Array,"Array",(function(t,e){this._t=o(t),this._i=0,this._k=e}),(function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,n(1)):n(0,"keys"==e?i:"values"==e?t[i]:[i,t[i]])}),"values"),s.Arguments=s.Array,r("keys"),r("values"),r("entries")},7842:(t,e,i)=>{"use strict";var r=i(2985),n=i(2110),s=[].join;r(r.P+r.F*(i(9797)!=Object||!i(7717)(s)),"Array",{join:function(t){return s.call(n(this),void 0===t?",":t)}})},9564:(t,e,i)=>{"use strict";var r=i(2985),n=i(2110),s=i(1467),o=i(875),a=[].lastIndexOf,h=!!a&&1/[1].lastIndexOf(1,-0)<0;r(r.P+r.F*(h||!i(7717)(a)),"Array",{lastIndexOf:function(t){if(h)return a.apply(this,arguments)||0;var e=n(this),i=o(e.length),r=i-1;for(arguments.length>1&&(r=Math.min(r,s(arguments[1]))),r<0&&(r=i+r);r>=0;r--)if(r in e&&e[r]===t)return r||0;return-1}})},1802:(t,e,i)=>{"use strict";var r=i(2985),n=i(50)(1);r(r.P+r.F*!i(7717)([].map,!0),"Array",{map:function(t){return n(this,t,arguments[1])}})},8295:(t,e,i)=>{"use strict";var r=i(2985),n=i(2811);r(r.S+r.F*i(4253)((function(){function t(){}return!(Array.of.call(t)instanceof t)})),"Array",{of:function(){for(var t=0,e=arguments.length,i=new("function"==typeof this?this:Array)(e);e>t;)n(i,t,arguments[t++]);return i.length=e,i}})},3750:(t,e,i)=>{"use strict";var r=i(2985),n=i(7628);r(r.P+r.F*!i(7717)([].reduceRight,!0),"Array",{reduceRight:function(t){return n(this,t,arguments.length,arguments[1],!0)}})},3057:(t,e,i)=>{"use strict";var r=i(2985),n=i(7628);r(r.P+r.F*!i(7717)([].reduce,!0),"Array",{reduce:function(t){return n(this,t,arguments.length,arguments[1],!1)}})},110:(t,e,i)=>{"use strict";var r=i(2985),n=i(639),s=i(2032),o=i(2337),a=i(875),h=[].slice;r(r.P+r.F*i(4253)((function(){n&&h.call(n)})),"Array",{slice:function(t,e){var i=a(this.length),r=s(this);if(e=void 0===e?i:e,"Array"==r)return h.call(this,t,e);for(var n=o(t,i),l=o(e,i),u=a(l-n),c=new Array(u),d=0;d<u;d++)c[d]="String"==r?this.charAt(n+d):this[n+d];return c}})},6773:(t,e,i)=>{"use strict";var r=i(2985),n=i(50)(3);r(r.P+r.F*!i(7717)([].some,!0),"Array",{some:function(t){return n(this,t,arguments[1])}})},75:(t,e,i)=>{"use strict";var r=i(2985),n=i(4963),s=i(508),o=i(4253),a=[].sort,h=[1,2,3];r(r.P+r.F*(o((function(){h.sort(void 0)}))||!o((function(){h.sort(null)}))||!i(7717)(a)),"Array",{sort:function(t){return void 0===t?a.call(s(this)):a.call(s(this),n(t))}})},1842:(t,e,i)=>{i(2974)("Array")},1822:(t,e,i)=>{var r=i(2985);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},1031:(t,e,i)=>{var r=i(2985),n=i(3537);r(r.P+r.F*(Date.prototype.toISOString!==n),"Date",{toISOString:n})},9977:(t,e,i)=>{"use strict";var r=i(2985),n=i(508),s=i(1689);r(r.P+r.F*i(4253)((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})})),"Date",{toJSON:function(t){var e=n(this),i=s(e);return"number"!=typeof i||isFinite(i)?e.toISOString():null}})},1560:(t,e,i)=>{var r=i(6314)("toPrimitive"),n=Date.prototype;r in n||i(7728)(n,r,i(870))},6331:(t,e,i)=>{var r=Date.prototype,n="Invalid Date",s=r.toString,o=r.getTime;new Date(NaN)+""!=n&&i(7234)(r,"toString",(function(){var t=o.call(this);return t==t?s.call(this):n}))},9730:(t,e,i)=>{var r=i(2985);r(r.P,"Function",{bind:i(4398)})},8377:(t,e,i)=>{"use strict";var r=i(5286),n=i(468),s=i(6314)("hasInstance"),o=Function.prototype;s in o||i(9275).f(o,s,{value:function(t){if("function"!=typeof this||!r(t))return!1;if(!r(this.prototype))return t instanceof this;for(;t=n(t);)if(this.prototype===t)return!0;return!1}})},6059:(t,e,i)=>{var r=i(9275).f,n=Function.prototype,s=/^\s*function ([^ (]*)/,o="name";o in n||i(7057)&&r(n,o,{configurable:!0,get:function(){try{return(""+this).match(s)[1]}catch(t){return""}}})},8416:(t,e,i)=>{"use strict";var r=i(9824),n=i(1616),s="Map";t.exports=i(5795)(s,(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(t){var e=r.getEntry(n(this,s),t);return e&&e.v},set:function(t,e){return r.def(n(this,s),0===t?0:t,e)}},r,!0)},6503:(t,e,i)=>{var r=i(2985),n=i(6206),s=Math.sqrt,o=Math.acosh;r(r.S+r.F*!(o&&710==Math.floor(o(Number.MAX_VALUE))&&o(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:n(t-1+s(t-1)*s(t+1))}})},6786:(t,e,i)=>{var r=i(2985),n=Math.asinh;r(r.S+r.F*!(n&&1/n(0)>0),"Math",{asinh:function t(e){return isFinite(e=+e)&&0!=e?e<0?-t(-e):Math.log(e+Math.sqrt(e*e+1)):e}})},932:(t,e,i)=>{var r=i(2985),n=Math.atanh;r(r.S+r.F*!(n&&1/n(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},7526:(t,e,i)=>{var r=i(2985),n=i(1801);r(r.S,"Math",{cbrt:function(t){return n(t=+t)*Math.pow(Math.abs(t),1/3)}})},1591:(t,e,i)=>{var r=i(2985);r(r.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},9073:(t,e,i)=>{var r=i(2985),n=Math.exp;r(r.S,"Math",{cosh:function(t){return(n(t=+t)+n(-t))/2}})},347:(t,e,i)=>{var r=i(2985),n=i(3086);r(r.S+r.F*(n!=Math.expm1),"Math",{expm1:n})},579:(t,e,i)=>{var r=i(2985);r(r.S,"Math",{fround:i(4934)})},4669:(t,e,i)=>{var r=i(2985),n=Math.abs;r(r.S,"Math",{hypot:function(t,e){for(var i,r,s=0,o=0,a=arguments.length,h=0;o<a;)h<(i=n(arguments[o++]))?(s=s*(r=h/i)*r+1,h=i):s+=i>0?(r=i/h)*r:i;return h===1/0?1/0:h*Math.sqrt(s)}})},7710:(t,e,i)=>{var r=i(2985),n=Math.imul;r(r.S+r.F*i(4253)((function(){return-5!=n(4294967295,5)||2!=n.length})),"Math",{imul:function(t,e){var i=65535,r=+t,n=+e,s=i&r,o=i&n;return 0|s*o+((i&r>>>16)*o+s*(i&n>>>16)<<16>>>0)}})},5789:(t,e,i)=>{var r=i(2985);r(r.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},3514:(t,e,i)=>{var r=i(2985);r(r.S,"Math",{log1p:i(6206)})},9978:(t,e,i)=>{var r=i(2985);r(r.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},8472:(t,e,i)=>{var r=i(2985);r(r.S,"Math",{sign:i(1801)})},6946:(t,e,i)=>{var r=i(2985),n=i(3086),s=Math.exp;r(r.S+r.F*i(4253)((function(){return-2e-17!=!Math.sinh(-2e-17)})),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(n(t)-n(-t))/2:(s(t-1)-s(-t-1))*(Math.E/2)}})},5068:(t,e,i)=>{var r=i(2985),n=i(3086),s=Math.exp;r(r.S,"Math",{tanh:function(t){var e=n(t=+t),i=n(-t);return e==1/0?1:i==1/0?-1:(e-i)/(s(t)+s(-t))}})},413:(t,e,i)=>{var r=i(2985);r(r.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},1246:(t,e,i)=>{"use strict";var r=i(3816),n=i(9181),s=i(2032),o=i(266),a=i(1689),h=i(4253),l=i(616).f,u=i(8693).f,c=i(9275).f,d=i(9599).trim,p="Number",f=r.Number,g=f,v=f.prototype,m=s(i(2503)(v))==p,y="trim"in String.prototype,_=function(t){var e=a(t,!1);if("string"==typeof e&&e.length>2){var i,r,n,s=(e=y?e.trim():d(e,3)).charCodeAt(0);if(43===s||45===s){if(88===(i=e.charCodeAt(2))||120===i)return NaN}else if(48===s){switch(e.charCodeAt(1)){case 66:case 98:r=2,n=49;break;case 79:case 111:r=8,n=55;break;default:return+e}for(var o,h=e.slice(2),l=0,u=h.length;l<u;l++)if((o=h.charCodeAt(l))<48||o>n)return NaN;return parseInt(h,r)}}return+e};if(!f(" 0o1")||!f("0b1")||f("+0x1")){f=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof f&&(m?h((function(){v.valueOf.call(i)})):s(i)!=p)?o(new g(_(e)),i,f):_(e)};for(var x,w=i(7057)?l(g):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),b=0;w.length>b;b++)n(g,x=w[b])&&!n(f,x)&&c(f,x,u(g,x));f.prototype=v,v.constructor=f,i(7234)(r,p,f)}},5972:(t,e,i)=>{var r=i(2985);r(r.S,"Number",{EPSILON:Math.pow(2,-52)})},3403:(t,e,i)=>{var r=i(2985),n=i(3816).isFinite;r(r.S,"Number",{isFinite:function(t){return"number"==typeof t&&n(t)}})},2516:(t,e,i)=>{var r=i(2985);r(r.S,"Number",{isInteger:i(8367)})},9371:(t,e,i)=>{var r=i(2985);r(r.S,"Number",{isNaN:function(t){return t!=t}})},6479:(t,e,i)=>{var r=i(2985),n=i(8367),s=Math.abs;r(r.S,"Number",{isSafeInteger:function(t){return n(t)&&s(t)<=9007199254740991}})},1736:(t,e,i)=>{var r=i(2985);r(r.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},1889:(t,e,i)=>{var r=i(2985);r(r.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},5177:(t,e,i)=>{var r=i(2985),n=i(7743);r(r.S+r.F*(Number.parseFloat!=n),"Number",{parseFloat:n})},6943:(t,e,i)=>{var r=i(2985),n=i(5960);r(r.S+r.F*(Number.parseInt!=n),"Number",{parseInt:n})},726:(t,e,i)=>{"use strict";var r=i(2985),n=i(1467),s=i(3365),o=i(8595),a=1..toFixed,h=Math.floor,l=[0,0,0,0,0,0],u="Number.toFixed: incorrect invocation!",c="0",d=function(t,e){for(var i=-1,r=e;++i<6;)r+=t*l[i],l[i]=r%1e7,r=h(r/1e7)},p=function(t){for(var e=6,i=0;--e>=0;)i+=l[e],l[e]=h(i/t),i=i%t*1e7},f=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==l[t]){var i=String(l[t]);e=""===e?i:e+o.call(c,7-i.length)+i}return e},g=function(t,e,i){return 0===e?i:e%2==1?g(t,e-1,i*t):g(t*t,e/2,i)};r(r.P+r.F*(!!a&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!i(4253)((function(){a.call({})}))),"Number",{toFixed:function(t){var e,i,r,a,h=s(this,u),l=n(t),v="",m=c;if(l<0||l>20)throw RangeError(u);if(h!=h)return"NaN";if(h<=-1e21||h>=1e21)return String(h);if(h<0&&(v="-",h=-h),h>1e-21)if(e=function(t){for(var e=0,i=t;i>=4096;)e+=12,i/=4096;for(;i>=2;)e+=1,i/=2;return e}(h*g(2,69,1))-69,i=e<0?h*g(2,-e,1):h/g(2,e,1),i*=4503599627370496,(e=52-e)>0){for(d(0,i),r=l;r>=7;)d(1e7,0),r-=7;for(d(g(10,r,1),0),r=e-1;r>=23;)p(1<<23),r-=23;p(1<<r),d(1,1),p(2),m=f()}else d(0,i),d(1<<-e,0),m=f()+o.call(c,l);return l>0?v+((a=m.length)<=l?"0."+o.call(c,l-a)+m:m.slice(0,a-l)+"."+m.slice(a-l)):v+m}})},1901:(t,e,i)=>{"use strict";var r=i(2985),n=i(4253),s=i(3365),o=1..toPrecision;r(r.P+r.F*(n((function(){return"1"!==o.call(1,void 0)}))||!n((function(){o.call({})}))),"Number",{toPrecision:function(t){var e=s(this,"Number#toPrecision: incorrect invocation!");return void 0===t?o.call(e):o.call(e,t)}})},5115:(t,e,i)=>{var r=i(2985);r(r.S+r.F,"Object",{assign:i(5345)})},8132:(t,e,i)=>{var r=i(2985);r(r.S,"Object",{create:i(2503)})},7470:(t,e,i)=>{var r=i(2985);r(r.S+r.F*!i(7057),"Object",{defineProperties:i(5588)})},8388:(t,e,i)=>{var r=i(2985);r(r.S+r.F*!i(7057),"Object",{defineProperty:i(9275).f})},9375:(t,e,i)=>{var r=i(5286),n=i(4728).onFreeze;i(3160)("freeze",(function(t){return function(e){return t&&r(e)?t(n(e)):e}}))},4882:(t,e,i)=>{var r=i(2110),n=i(8693).f;i(3160)("getOwnPropertyDescriptor",(function(){return function(t,e){return n(r(t),e)}}))},9622:(t,e,i)=>{i(3160)("getOwnPropertyNames",(function(){return i(9327).f}))},1520:(t,e,i)=>{var r=i(508),n=i(468);i(3160)("getPrototypeOf",(function(){return function(t){return n(r(t))}}))},9892:(t,e,i)=>{var r=i(5286);i(3160)("isExtensible",(function(t){return function(e){return!!r(e)&&(!t||t(e))}}))},4157:(t,e,i)=>{var r=i(5286);i(3160)("isFrozen",(function(t){return function(e){return!r(e)||!!t&&t(e)}}))},5095:(t,e,i)=>{var r=i(5286);i(3160)("isSealed",(function(t){return function(e){return!r(e)||!!t&&t(e)}}))},9176:(t,e,i)=>{var r=i(2985);r(r.S,"Object",{is:i(7195)})},7476:(t,e,i)=>{var r=i(508),n=i(7184);i(3160)("keys",(function(){return function(t){return n(r(t))}}))},4672:(t,e,i)=>{var r=i(5286),n=i(4728).onFreeze;i(3160)("preventExtensions",(function(t){return function(e){return t&&r(e)?t(n(e)):e}}))},3533:(t,e,i)=>{var r=i(5286),n=i(4728).onFreeze;i(3160)("seal",(function(t){return function(e){return t&&r(e)?t(n(e)):e}}))},8838:(t,e,i)=>{var r=i(2985);r(r.S,"Object",{setPrototypeOf:i(7375).set})},6253:(t,e,i)=>{"use strict";var r=i(1488),n={};n[i(6314)("toStringTag")]="z",n+""!="[object z]"&&i(7234)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},4299:(t,e,i)=>{var r=i(2985),n=i(7743);r(r.G+r.F*(parseFloat!=n),{parseFloat:n})},1084:(t,e,i)=>{var r=i(2985),n=i(5960);r(r.G+r.F*(parseInt!=n),{parseInt:n})},851:(t,e,i)=>{"use strict";var r,n,s,o,a=i(4461),h=i(3816),l=i(741),u=i(1488),c=i(2985),d=i(5286),p=i(4963),f=i(3328),g=i(3531),v=i(8364),m=i(4193).set,y=i(4351)(),_=i(3499),x=i(188),w=i(575),b=i(94),E="Promise",T=h.TypeError,S=h.process,A=S&&S.versions,P=A&&A.v8||"",O=h.Promise,R="process"==u(S),C=function(){},M=n=_.f,I=!!function(){try{var t=O.resolve(1),e=(t.constructor={})[i(6314)("species")]=function(t){t(C,C)};return(R||"function"==typeof PromiseRejectionEvent)&&t.then(C)instanceof e&&0!==P.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(t){}}(),L=function(t){var e;return!(!d(t)||"function"!=typeof(e=t.then))&&e},k=function(t,e){if(!t._n){t._n=!0;var i=t._c;y((function(){for(var r=t._v,n=1==t._s,s=0,o=function(e){var i,s,o,a=n?e.ok:e.fail,h=e.resolve,l=e.reject,u=e.domain;try{a?(n||(2==t._h&&B(t),t._h=1),!0===a?i=r:(u&&u.enter(),i=a(r),u&&(u.exit(),o=!0)),i===e.promise?l(T("Promise-chain cycle")):(s=L(i))?s.call(i,h,l):h(i)):l(r)}catch(t){u&&!o&&u.exit(),l(t)}};i.length>s;)o(i[s++]);t._c=[],t._n=!1,e&&!t._h&&N(t)}))}},N=function(t){m.call(h,(function(){var e,i,r,n=t._v,s=D(t);if(s&&(e=x((function(){R?S.emit("unhandledRejection",n,t):(i=h.onunhandledrejection)?i({promise:t,reason:n}):(r=h.console)&&r.error&&r.error("Unhandled promise rejection",n)})),t._h=R||D(t)?2:1),t._a=void 0,s&&e.e)throw e.v}))},D=function(t){return 1!==t._h&&0===(t._a||t._c).length},B=function(t){m.call(h,(function(){var e;R?S.emit("rejectionHandled",t):(e=h.onrejectionhandled)&&e({promise:t,reason:t._v})}))},F=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),k(e,!0))},V=function(t){var e,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===t)throw T("Promise can't be resolved itself");(e=L(t))?y((function(){var r={_w:i,_d:!1};try{e.call(t,l(V,r,1),l(F,r,1))}catch(t){F.call(r,t)}})):(i._v=t,i._s=1,k(i,!1))}catch(t){F.call({_w:i,_d:!1},t)}}};I||(O=function(t){f(this,O,E,"_h"),p(t),r.call(this);try{t(l(V,this,1),l(F,this,1))}catch(t){F.call(this,t)}},(r=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=i(4408)(O.prototype,{then:function(t,e){var i=M(v(this,O));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=R?S.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&k(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),s=function(){var t=new r;this.promise=t,this.resolve=l(V,t,1),this.reject=l(F,t,1)},_.f=M=function(t){return t===O||t===o?new s(t):n(t)}),c(c.G+c.W+c.F*!I,{Promise:O}),i(2943)(O,E),i(2974)(E),o=i(5645).Promise,c(c.S+c.F*!I,E,{reject:function(t){var e=M(this);return(0,e.reject)(t),e.promise}}),c(c.S+c.F*(a||!I),E,{resolve:function(t){return b(a&&this===o?O:this,t)}}),c(c.S+c.F*!(I&&i(7462)((function(t){O.all(t).catch(C)}))),E,{all:function(t){var e=this,i=M(e),r=i.resolve,n=i.reject,s=x((function(){var i=[],s=0,o=1;g(t,!1,(function(t){var a=s++,h=!1;i.push(void 0),o++,e.resolve(t).then((function(t){h||(h=!0,i[a]=t,--o||r(i))}),n)})),--o||r(i)}));return s.e&&n(s.v),i.promise},race:function(t){var e=this,i=M(e),r=i.reject,n=x((function(){g(t,!1,(function(t){e.resolve(t).then(i.resolve,r)}))}));return n.e&&r(n.v),i.promise}})},1572:(t,e,i)=>{var r=i(2985),n=i(4963),s=i(7007),o=(i(3816).Reflect||{}).apply,a=Function.apply;r(r.S+r.F*!i(4253)((function(){o((function(){}))})),"Reflect",{apply:function(t,e,i){var r=n(t),h=s(i);return o?o(r,e,h):a.call(r,e,h)}})},2139:(t,e,i)=>{var r=i(2985),n=i(2503),s=i(4963),o=i(7007),a=i(5286),h=i(4253),l=i(4398),u=(i(3816).Reflect||{}).construct,c=h((function(){function t(){}return!(u((function(){}),[],t)instanceof t)})),d=!h((function(){u((function(){}))}));r(r.S+r.F*(c||d),"Reflect",{construct:function(t,e){s(t),o(e);var i=arguments.length<3?t:s(arguments[2]);if(d&&!c)return u(t,e,i);if(t==i){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var r=[null];return r.push.apply(r,e),new(l.apply(t,r))}var h=i.prototype,p=n(a(h)?h:Object.prototype),f=Function.apply.call(t,p,e);return a(f)?f:p}})},685:(t,e,i)=>{var r=i(9275),n=i(2985),s=i(7007),o=i(1689);n(n.S+n.F*i(4253)((function(){Reflect.defineProperty(r.f({},1,{value:1}),1,{value:2})})),"Reflect",{defineProperty:function(t,e,i){s(t),e=o(e,!0),s(i);try{return r.f(t,e,i),!0}catch(t){return!1}}})},5535:(t,e,i)=>{var r=i(2985),n=i(8693).f,s=i(7007);r(r.S,"Reflect",{deleteProperty:function(t,e){var i=n(s(t),e);return!(i&&!i.configurable)&&delete t[e]}})},7347:(t,e,i)=>{"use strict";var r=i(2985),n=i(7007),s=function(t){this._t=n(t),this._i=0;var e,i=this._k=[];for(e in t)i.push(e)};i(9988)(s,"Object",(function(){var t,e=this,i=e._k;do{if(e._i>=i.length)return{value:void 0,done:!0}}while(!((t=i[e._i++])in e._t));return{value:t,done:!1}})),r(r.S,"Reflect",{enumerate:function(t){return new s(t)}})},6633:(t,e,i)=>{var r=i(8693),n=i(2985),s=i(7007);n(n.S,"Reflect",{getOwnPropertyDescriptor:function(t,e){return r.f(s(t),e)}})},8989:(t,e,i)=>{var r=i(2985),n=i(468),s=i(7007);r(r.S,"Reflect",{getPrototypeOf:function(t){return n(s(t))}})},3049:(t,e,i)=>{var r=i(8693),n=i(468),s=i(9181),o=i(2985),a=i(5286),h=i(7007);o(o.S,"Reflect",{get:function t(e,i){var o,l,u=arguments.length<3?e:arguments[2];return h(e)===u?e[i]:(o=r.f(e,i))?s(o,"value")?o.value:void 0!==o.get?o.get.call(u):void 0:a(l=n(e))?t(l,i,u):void 0}})},8270:(t,e,i)=>{var r=i(2985);r(r.S,"Reflect",{has:function(t,e){return e in t}})},4510:(t,e,i)=>{var r=i(2985),n=i(7007),s=Object.isExtensible;r(r.S,"Reflect",{isExtensible:function(t){return n(t),!s||s(t)}})},3984:(t,e,i)=>{var r=i(2985);r(r.S,"Reflect",{ownKeys:i(7643)})},5769:(t,e,i)=>{var r=i(2985),n=i(7007),s=Object.preventExtensions;r(r.S,"Reflect",{preventExtensions:function(t){n(t);try{return s&&s(t),!0}catch(t){return!1}}})},6014:(t,e,i)=>{var r=i(2985),n=i(7375);n&&r(r.S,"Reflect",{setPrototypeOf:function(t,e){n.check(t,e);try{return n.set(t,e),!0}catch(t){return!1}}})},55:(t,e,i)=>{var r=i(9275),n=i(8693),s=i(468),o=i(9181),a=i(2985),h=i(681),l=i(7007),u=i(5286);a(a.S,"Reflect",{set:function t(e,i,a){var c,d,p=arguments.length<4?e:arguments[3],f=n.f(l(e),i);if(!f){if(u(d=s(e)))return t(d,i,a,p);f=h(0)}if(o(f,"value")){if(!1===f.writable||!u(p))return!1;if(c=n.f(p,i)){if(c.get||c.set||!1===c.writable)return!1;c.value=a,r.f(p,i,c)}else r.f(p,i,h(0,a));return!0}return void 0!==f.set&&(f.set.call(p,a),!0)}})},3946:(t,e,i)=>{var r=i(3816),n=i(266),s=i(9275).f,o=i(616).f,a=i(5364),h=i(3218),l=r.RegExp,u=l,c=l.prototype,d=/a/g,p=/a/g,f=new l(d)!==d;if(i(7057)&&(!f||i(4253)((function(){return p[i(6314)("match")]=!1,l(d)!=d||l(p)==p||"/a/i"!=l(d,"i")})))){l=function(t,e){var i=this instanceof l,r=a(t),s=void 0===e;return!i&&r&&t.constructor===l&&s?t:n(f?new u(r&&!s?t.source:t,e):u((r=t instanceof l)?t.source:t,r&&s?h.call(t):e),i?this:c,l)};for(var g=function(t){t in l||s(l,t,{configurable:!0,get:function(){return u[t]},set:function(e){u[t]=e}})},v=o(u),m=0;v.length>m;)g(v[m++]);c.constructor=l,l.prototype=c,i(7234)(r,"RegExp",l)}i(2974)("RegExp")},8269:(t,e,i)=>{"use strict";var r=i(1165);i(2985)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},6774:(t,e,i)=>{i(7057)&&"g"!=/./g.flags&&i(9275).f(RegExp.prototype,"flags",{configurable:!0,get:i(3218)})},1466:(t,e,i)=>{"use strict";var r=i(7007),n=i(875),s=i(6793),o=i(7787);i(8082)("match",1,(function(t,e,i,a){return[function(i){var r=t(this),n=null==i?void 0:i[e];return void 0!==n?n.call(i,r):new RegExp(i)[e](String(r))},function(t){var e=a(i,t,this);if(e.done)return e.value;var h=r(t),l=String(this);if(!h.global)return o(h,l);var u=h.unicode;h.lastIndex=0;for(var c,d=[],p=0;null!==(c=o(h,l));){var f=String(c[0]);d[p]=f,""===f&&(h.lastIndex=s(l,n(h.lastIndex),u)),p++}return 0===p?null:d}]}))},9357:(t,e,i)=>{"use strict";var r=i(7007),n=i(508),s=i(875),o=i(1467),a=i(6793),h=i(7787),l=Math.max,u=Math.min,c=Math.floor,d=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;i(8082)("replace",2,(function(t,e,i,f){return[function(r,n){var s=t(this),o=null==r?void 0:r[e];return void 0!==o?o.call(r,s,n):i.call(String(s),r,n)},function(t,e){var n=f(i,t,this,e);if(n.done)return n.value;var c=r(t),d=String(this),p="function"==typeof e;p||(e=String(e));var v=c.global;if(v){var m=c.unicode;c.lastIndex=0}for(var y=[];;){var _=h(c,d);if(null===_)break;if(y.push(_),!v)break;""===String(_[0])&&(c.lastIndex=a(d,s(c.lastIndex),m))}for(var x,w="",b=0,E=0;E<y.length;E++){_=y[E];for(var T=String(_[0]),S=l(u(o(_.index),d.length),0),A=[],P=1;P<_.length;P++)A.push(void 0===(x=_[P])?x:String(x));var O=_.groups;if(p){var R=[T].concat(A,S,d);void 0!==O&&R.push(O);var C=String(e.apply(void 0,R))}else C=g(T,d,S,A,O,e);S>=b&&(w+=d.slice(b,S)+C,b=S+T.length)}return w+d.slice(b)}];function g(t,e,r,s,o,a){var h=r+t.length,l=s.length,u=p;return void 0!==o&&(o=n(o),u=d),i.call(a,u,(function(i,n){var a;switch(n.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(h);case"<":a=o[n.slice(1,-1)];break;default:var u=+n;if(0===u)return i;if(u>l){var d=c(u/10);return 0===d?i:d<=l?void 0===s[d-1]?n.charAt(1):s[d-1]+n.charAt(1):i}a=s[u-1]}return void 0===a?"":a}))}}))},6142:(t,e,i)=>{"use strict";var r=i(7007),n=i(7195),s=i(7787);i(8082)("search",1,(function(t,e,i,o){return[function(i){var r=t(this),n=null==i?void 0:i[e];return void 0!==n?n.call(i,r):new RegExp(i)[e](String(r))},function(t){var e=o(i,t,this);if(e.done)return e.value;var a=r(t),h=String(this),l=a.lastIndex;n(l,0)||(a.lastIndex=0);var u=s(a,h);return n(a.lastIndex,l)||(a.lastIndex=l),null===u?-1:u.index}]}))},1876:(t,e,i)=>{"use strict";var r=i(5364),n=i(7007),s=i(8364),o=i(6793),a=i(875),h=i(7787),l=i(1165),u=i(4253),c=Math.min,d=[].push,p=4294967295,f=!u((function(){RegExp(p,"y")}));i(8082)("split",2,(function(t,e,i,u){var g;return g="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(t,e){var n=String(this);if(void 0===t&&0===e)return[];if(!r(t))return i.call(n,t,e);for(var s,o,a,h=[],u=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),c=0,f=void 0===e?p:e>>>0,g=new RegExp(t.source,u+"g");(s=l.call(g,n))&&!((o=g.lastIndex)>c&&(h.push(n.slice(c,s.index)),s.length>1&&s.index<n.length&&d.apply(h,s.slice(1)),a=s[0].length,c=o,h.length>=f));)g.lastIndex===s.index&&g.lastIndex++;return c===n.length?!a&&g.test("")||h.push(""):h.push(n.slice(c)),h.length>f?h.slice(0,f):h}:"0".split(void 0,0).length?function(t,e){return void 0===t&&0===e?[]:i.call(this,t,e)}:i,[function(i,r){var n=t(this),s=null==i?void 0:i[e];return void 0!==s?s.call(i,n,r):g.call(String(n),i,r)},function(t,e){var r=u(g,t,this,e,g!==i);if(r.done)return r.value;var l=n(t),d=String(this),v=s(l,RegExp),m=l.unicode,y=(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.unicode?"u":"")+(f?"y":"g"),_=new v(f?l:"^(?:"+l.source+")",y),x=void 0===e?p:e>>>0;if(0===x)return[];if(0===d.length)return null===h(_,d)?[d]:[];for(var w=0,b=0,E=[];b<d.length;){_.lastIndex=f?b:0;var T,S=h(_,f?d:d.slice(b));if(null===S||(T=c(a(_.lastIndex+(f?0:b)),d.length))===w)b=o(d,b,m);else{if(E.push(d.slice(w,b)),E.length===x)return E;for(var A=1;A<=S.length-1;A++)if(E.push(S[A]),E.length===x)return E;b=w=T}}return E.push(d.slice(w)),E}]}))},6108:(t,e,i)=>{"use strict";i(6774);var r=i(7007),n=i(3218),s=i(7057),o="toString",a=/./.toString,h=function(t){i(7234)(RegExp.prototype,o,t,!0)};i(4253)((function(){return"/a/b"!=a.call({source:"a",flags:"b"})}))?h((function(){var t=r(this);return"/".concat(t.source,"/","flags"in t?t.flags:!s&&t instanceof RegExp?n.call(t):void 0)})):a.name!=o&&h((function(){return a.call(this)}))},8184:(t,e,i)=>{"use strict";var r=i(9824),n=i(1616);t.exports=i(5795)("Set",(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(t){return r.def(n(this,"Set"),t=0===t?0:t,t)}},r)},856:(t,e,i)=>{"use strict";i(9395)("anchor",(function(t){return function(e){return t(this,"a","name",e)}}))},703:(t,e,i)=>{"use strict";i(9395)("big",(function(t){return function(){return t(this,"big","","")}}))},1539:(t,e,i)=>{"use strict";i(9395)("blink",(function(t){return function(){return t(this,"blink","","")}}))},5292:(t,e,i)=>{"use strict";i(9395)("bold",(function(t){return function(){return t(this,"b","","")}}))},9539:(t,e,i)=>{"use strict";var r=i(2985),n=i(4496)(!1);r(r.P,"String",{codePointAt:function(t){return n(this,t)}})},6620:(t,e,i)=>{"use strict";var r=i(2985),n=i(875),s=i(2094),o="endsWith",a="".endsWith;r(r.P+r.F*i(8852)(o),"String",{endsWith:function(t){var e=s(this,t,o),i=arguments.length>1?arguments[1]:void 0,r=n(e.length),h=void 0===i?r:Math.min(n(i),r),l=String(t);return a?a.call(e,l,h):e.slice(h-l.length,h)===l}})},6629:(t,e,i)=>{"use strict";i(9395)("fixed",(function(t){return function(){return t(this,"tt","","")}}))},3694:(t,e,i)=>{"use strict";i(9395)("fontcolor",(function(t){return function(e){return t(this,"font","color",e)}}))},7648:(t,e,i)=>{"use strict";i(9395)("fontsize",(function(t){return function(e){return t(this,"font","size",e)}}))},191:(t,e,i)=>{var r=i(2985),n=i(2337),s=String.fromCharCode,o=String.fromCodePoint;r(r.S+r.F*(!!o&&1!=o.length),"String",{fromCodePoint:function(t){for(var e,i=[],r=arguments.length,o=0;r>o;){if(e=+arguments[o++],n(e,1114111)!==e)throw RangeError(e+" is not a valid code point");i.push(e<65536?s(e):s(55296+((e-=65536)>>10),e%1024+56320))}return i.join("")}})},2850:(t,e,i)=>{"use strict";var r=i(2985),n=i(2094),s="includes";r(r.P+r.F*i(8852)(s),"String",{includes:function(t){return!!~n(this,t,s).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},7795:(t,e,i)=>{"use strict";i(9395)("italics",(function(t){return function(){return t(this,"i","","")}}))},9115:(t,e,i)=>{"use strict";var r=i(4496)(!0);i(2923)(String,"String",(function(t){this._t=String(t),this._i=0}),(function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=r(e,i),this._i+=t.length,{value:t,done:!1})}))},4531:(t,e,i)=>{"use strict";i(9395)("link",(function(t){return function(e){return t(this,"a","href",e)}}))},8306:(t,e,i)=>{var r=i(2985),n=i(2110),s=i(875);r(r.S,"String",{raw:function(t){for(var e=n(t.raw),i=s(e.length),r=arguments.length,o=[],a=0;i>a;)o.push(String(e[a++])),a<r&&o.push(String(arguments[a]));return o.join("")}})},823:(t,e,i)=>{var r=i(2985);r(r.P,"String",{repeat:i(8595)})},3605:(t,e,i)=>{"use strict";i(9395)("small",(function(t){return function(){return t(this,"small","","")}}))},7732:(t,e,i)=>{"use strict";var r=i(2985),n=i(875),s=i(2094),o="startsWith",a="".startsWith;r(r.P+r.F*i(8852)(o),"String",{startsWith:function(t){var e=s(this,t,o),i=n(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return a?a.call(e,r,i):e.slice(i,i+r.length)===r}})},6780:(t,e,i)=>{"use strict";i(9395)("strike",(function(t){return function(){return t(this,"strike","","")}}))},9937:(t,e,i)=>{"use strict";i(9395)("sub",(function(t){return function(){return t(this,"sub","","")}}))},511:(t,e,i)=>{"use strict";i(9395)("sup",(function(t){return function(){return t(this,"sup","","")}}))},4564:(t,e,i)=>{"use strict";i(9599)("trim",(function(t){return function(){return t(this,3)}}))},5767:(t,e,i)=>{"use strict";var r=i(3816),n=i(9181),s=i(7057),o=i(2985),a=i(7234),h=i(4728).KEY,l=i(4253),u=i(3825),c=i(2943),d=i(3953),p=i(6314),f=i(8787),g=i(6074),v=i(5541),m=i(4302),y=i(7007),_=i(5286),x=i(508),w=i(2110),b=i(1689),E=i(681),T=i(2503),S=i(9327),A=i(8693),P=i(4548),O=i(9275),R=i(7184),C=A.f,M=O.f,I=S.f,L=r.Symbol,k=r.JSON,N=k&&k.stringify,D=p("_hidden"),B=p("toPrimitive"),F={}.propertyIsEnumerable,V=u("symbol-registry"),z=u("symbols"),j=u("op-symbols"),G=Object.prototype,q="function"==typeof L&&!!P.f,U=r.QObject,$=!U||!U.prototype||!U.prototype.findChild,H=s&&l((function(){return 7!=T(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a}))?function(t,e,i){var r=C(G,e);r&&delete G[e],M(t,e,i),r&&t!==G&&M(G,e,r)}:M,X=function(t){var e=z[t]=T(L.prototype);return e._k=t,e},W=q&&"symbol"==typeof L.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof L},Y=function(t,e,i){return t===G&&Y(j,e,i),y(t),e=b(e,!0),y(i),n(z,e)?(i.enumerable?(n(t,D)&&t[D][e]&&(t[D][e]=!1),i=T(i,{enumerable:E(0,!1)})):(n(t,D)||M(t,D,E(1,{})),t[D][e]=!0),H(t,e,i)):M(t,e,i)},Z=function(t,e){y(t);for(var i,r=v(e=w(e)),n=0,s=r.length;s>n;)Y(t,i=r[n++],e[i]);return t},K=function(t){var e=F.call(this,t=b(t,!0));return!(this===G&&n(z,t)&&!n(j,t))&&(!(e||!n(this,t)||!n(z,t)||n(this,D)&&this[D][t])||e)},J=function(t,e){if(t=w(t),e=b(e,!0),t!==G||!n(z,e)||n(j,e)){var i=C(t,e);return!i||!n(z,e)||n(t,D)&&t[D][e]||(i.enumerable=!0),i}},Q=function(t){for(var e,i=I(w(t)),r=[],s=0;i.length>s;)n(z,e=i[s++])||e==D||e==h||r.push(e);return r},tt=function(t){for(var e,i=t===G,r=I(i?j:w(t)),s=[],o=0;r.length>o;)!n(z,e=r[o++])||i&&!n(G,e)||s.push(z[e]);return s};q||(a((L=function(){if(this instanceof L)throw TypeError("Symbol is not a constructor!");var t=d(arguments.length>0?arguments[0]:void 0),e=function(i){this===G&&e.call(j,i),n(this,D)&&n(this[D],t)&&(this[D][t]=!1),H(this,t,E(1,i))};return s&&$&&H(G,t,{configurable:!0,set:e}),X(t)}).prototype,"toString",(function(){return this._k})),A.f=J,O.f=Y,i(616).f=S.f=Q,i(4682).f=K,P.f=tt,s&&!i(4461)&&a(G,"propertyIsEnumerable",K,!0),f.f=function(t){return X(p(t))}),o(o.G+o.W+o.F*!q,{Symbol:L});for(var et="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),it=0;et.length>it;)p(et[it++]);for(var rt=R(p.store),nt=0;rt.length>nt;)g(rt[nt++]);o(o.S+o.F*!q,"Symbol",{for:function(t){return n(V,t+="")?V[t]:V[t]=L(t)},keyFor:function(t){if(!W(t))throw TypeError(t+" is not a symbol!");for(var e in V)if(V[e]===t)return e},useSetter:function(){$=!0},useSimple:function(){$=!1}}),o(o.S+o.F*!q,"Object",{create:function(t,e){return void 0===e?T(t):Z(T(t),e)},defineProperty:Y,defineProperties:Z,getOwnPropertyDescriptor:J,getOwnPropertyNames:Q,getOwnPropertySymbols:tt});var st=l((function(){P.f(1)}));o(o.S+o.F*st,"Object",{getOwnPropertySymbols:function(t){return P.f(x(t))}}),k&&o(o.S+o.F*(!q||l((function(){var t=L();return"[null]"!=N([t])||"{}"!=N({a:t})||"{}"!=N(Object(t))}))),"JSON",{stringify:function(t){for(var e,i,r=[t],n=1;arguments.length>n;)r.push(arguments[n++]);if(i=e=r[1],(_(e)||void 0!==t)&&!W(t))return m(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!W(e))return e}),r[1]=e,N.apply(k,r)}}),L.prototype[B]||i(7728)(L.prototype,B,L.prototype.valueOf),c(L,"Symbol"),c(Math,"Math",!0),c(r.JSON,"JSON",!0)},142:(t,e,i)=>{"use strict";var r=i(2985),n=i(9383),s=i(1125),o=i(7007),a=i(2337),h=i(875),l=i(5286),u=i(3816).ArrayBuffer,c=i(8364),d=s.ArrayBuffer,p=s.DataView,f=n.ABV&&u.isView,g=d.prototype.slice,v=n.VIEW,m="ArrayBuffer";r(r.G+r.W+r.F*(u!==d),{ArrayBuffer:d}),r(r.S+r.F*!n.CONSTR,m,{isView:function(t){return f&&f(t)||l(t)&&v in t}}),r(r.P+r.U+r.F*i(4253)((function(){return!new d(2).slice(1,void 0).byteLength})),m,{slice:function(t,e){if(void 0!==g&&void 0===e)return g.call(o(this),t);for(var i=o(this).byteLength,r=a(t,i),n=a(void 0===e?i:e,i),s=new(c(this,d))(h(n-r)),l=new p(this),u=new p(s),f=0;r<n;)u.setUint8(f++,l.getUint8(r++));return s}}),i(2974)(m)},1786:(t,e,i)=>{var r=i(2985);r(r.G+r.W+r.F*!i(9383).ABV,{DataView:i(1125).DataView})},162:(t,e,i)=>{i(8440)("Float32",4,(function(t){return function(e,i,r){return t(this,e,i,r)}}))},3834:(t,e,i)=>{i(8440)("Float64",8,(function(t){return function(e,i,r){return t(this,e,i,r)}}))},4821:(t,e,i)=>{i(8440)("Int16",2,(function(t){return function(e,i,r){return t(this,e,i,r)}}))},1303:(t,e,i)=>{i(8440)("Int32",4,(function(t){return function(e,i,r){return t(this,e,i,r)}}))},5368:(t,e,i)=>{i(8440)("Int8",1,(function(t){return function(e,i,r){return t(this,e,i,r)}}))},9103:(t,e,i)=>{i(8440)("Uint16",2,(function(t){return function(e,i,r){return t(this,e,i,r)}}))},3318:(t,e,i)=>{i(8440)("Uint32",4,(function(t){return function(e,i,r){return t(this,e,i,r)}}))},6964:(t,e,i)=>{i(8440)("Uint8",1,(function(t){return function(e,i,r){return t(this,e,i,r)}}))},2152:(t,e,i)=>{i(8440)("Uint8",1,(function(t){return function(e,i,r){return t(this,e,i,r)}}),!0)},147:(t,e,i)=>{"use strict";var r,n=i(3816),s=i(50)(0),o=i(7234),a=i(4728),h=i(5345),l=i(3657),u=i(5286),c=i(1616),d=i(1616),p=!n.ActiveXObject&&"ActiveXObject"in n,f="WeakMap",g=a.getWeak,v=Object.isExtensible,m=l.ufstore,y=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},_={get:function(t){if(u(t)){var e=g(t);return!0===e?m(c(this,f)).get(t):e?e[this._i]:void 0}},set:function(t,e){return l.def(c(this,f),t,e)}},x=t.exports=i(5795)(f,y,_,l,!0,!0);d&&p&&(h((r=l.getConstructor(y,f)).prototype,_),a.NEED=!0,s(["delete","has","get","set"],(function(t){var e=x.prototype,i=e[t];o(e,t,(function(e,n){if(u(e)&&!v(e)){this._f||(this._f=new r);var s=this._f[t](e,n);return"set"==t?this:s}return i.call(this,e,n)}))})))},9192:(t,e,i)=>{"use strict";var r=i(3657),n=i(1616),s="WeakSet";i(5795)(s,(function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(t){return r.def(n(this,s),t,!0)}},r,!1,!0)},1268:(t,e,i)=>{"use strict";var r=i(2985),n=i(3325),s=i(508),o=i(875),a=i(4963),h=i(6886);r(r.P,"Array",{flatMap:function(t){var e,i,r=s(this);return a(t),e=o(r.length),i=h(r,0),n(i,r,r,e,0,1,t,arguments[1]),i}}),i(7722)("flatMap")},2773:(t,e,i)=>{"use strict";var r=i(2985),n=i(9315)(!0);r(r.P,"Array",{includes:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),i(7722)("includes")},3276:(t,e,i)=>{var r=i(2985),n=i(1131)(!0);r(r.S,"Object",{entries:function(t){return n(t)}})},8351:(t,e,i)=>{var r=i(2985),n=i(7643),s=i(2110),o=i(8693),a=i(2811);r(r.S,"Object",{getOwnPropertyDescriptors:function(t){for(var e,i,r=s(t),h=o.f,l=n(r),u={},c=0;l.length>c;)void 0!==(i=h(r,e=l[c++]))&&a(u,e,i);return u}})},6409:(t,e,i)=>{var r=i(2985),n=i(1131)(!1);r(r.S,"Object",{values:function(t){return n(t)}})},9865:(t,e,i)=>{"use strict";var r=i(2985),n=i(5645),s=i(3816),o=i(8364),a=i(94);r(r.P+r.R,"Promise",{finally:function(t){var e=o(this,n.Promise||s.Promise),i="function"==typeof t;return this.then(i?function(i){return a(e,t()).then((function(){return i}))}:t,i?function(i){return a(e,t()).then((function(){throw i}))}:t)}})},2770:(t,e,i)=>{"use strict";var r=i(2985),n=i(5442),s=i(575),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(s);r(r.P+r.F*o,"String",{padEnd:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},1784:(t,e,i)=>{"use strict";var r=i(2985),n=i(5442),s=i(575),o=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(s);r(r.P+r.F*o,"String",{padStart:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},5869:(t,e,i)=>{"use strict";i(9599)("trimLeft",(function(t){return function(){return t(this,1)}}),"trimStart")},4325:(t,e,i)=>{"use strict";i(9599)("trimRight",(function(t){return function(){return t(this,2)}}),"trimEnd")},9665:(t,e,i)=>{i(6074)("asyncIterator")},1181:(t,e,i)=>{for(var r=i(6997),n=i(7184),s=i(7234),o=i(3816),a=i(7728),h=i(2803),l=i(6314),u=l("iterator"),c=l("toStringTag"),d=h.Array,p={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=n(p),g=0;g<f.length;g++){var v,m=f[g],y=p[m],_=o[m],x=_&&_.prototype;if(x&&(x[u]||a(x,u,d),x[c]||a(x,c,m),h[m]=d,y))for(v in r)x[v]||s(x,v,r[v],!0)}},4633:(t,e,i)=>{var r=i(2985),n=i(4193);r(r.G+r.B,{setImmediate:n.set,clearImmediate:n.clear})},2564:(t,e,i)=>{var r=i(3816),n=i(2985),s=i(575),o=[].slice,a=/MSIE .\./.test(s),h=function(t){return function(e,i){var r=arguments.length>2,n=!!r&&o.call(arguments,2);return t(r?function(){("function"==typeof e?e:Function(e)).apply(this,n)}:e,i)}};n(n.G+n.B+n.F*a,{setTimeout:h(r.setTimeout),setInterval:h(r.setInterval)})},6337:(t,e,i)=>{i(2564),i(4633),i(1181),t.exports=i(5645)},1424:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var r=i(8081),n=i.n(r),s=i(3645),o=i.n(s)()(n());o.push([t.id,"body {\r\n\r\n  min-height: 100vh;\r\n  background-color: black;\r\n  color: white;\r\n\r\n  /* Allow mouse dragging. */\r\n  -moz-user-select: none;\r\n  -ms-user-select: none;\r\n  -o-user-select: none;\r\n  -webkit-user-select: none;\r\n  user-select: none;\r\n\r\n  /* disable touch panning/zooming */\r\n  -ms-touch-action: none;\r\n  touch-action: none;\r\n\r\n  /* Allow canvas to hit the edges of the browser viewport. */\r\n  margin: 0;\r\n}\r\n\r\n.main {\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n}\r\n",""]);const a=o},3645:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var i="",r=void 0!==e[5];return e[4]&&(i+="@supports (".concat(e[4],") {")),e[2]&&(i+="@media ".concat(e[2]," {")),r&&(i+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),i+=t(e),r&&(i+="}"),e[2]&&(i+="}"),e[4]&&(i+="}"),i})).join("")},e.i=function(t,i,r,n,s){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var h=this[a][0];null!=h&&(o[h]=!0)}for(var l=0;l<t.length;l++){var u=[].concat(t[l]);r&&o[u[0]]||(void 0!==s&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=s),i&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=i):u[2]=i),n&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=n):u[4]="".concat(n)),e.push(u))}},e}},8081:t=>{"use strict";t.exports=function(t){return t[1]}},8402:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function capitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)}function trimLeft(t){return t.replace(/^\s+/,"")}function trimRight(t){return t.replace(/\s+$/,"")}function isNumeric(t){return"string"==typeof t&&(t=t.trim()),!isNaN(t)&&/[+-]?([0-9]*[.])?[0-9]+/.test(t)}function isBoolean(t){var e=t.trim();return"true"===e||"false"===e}function toHex$1(t){for(var e="",i=0;i<t.length;)e+=t.charCodeAt(i++).toString(16);return e}__webpack_require__.d(__webpack_exports__,{Tg:()=>ColorLayer,Z:()=>DraggableEntity,JH:()=>Entity,Hf:()=>Stage,n0:()=>audio$1,Uh:()=>device$1,B:()=>event,H6:()=>game$1,qH:()=>input,_m:()=>loader$1,d_:()=>pool,SB:()=>state$1,Rk:()=>video$1}),"undefined"==typeof console&&(console={log:function(){},info:function(){},error:function(){alert(Array.prototype.slice.call(arguments).join(", "))}});var stringUtils=Object.freeze({__proto__:null,capitalize,trimLeft,trimRight,isNumeric,isBoolean,toHex:toHex$1}),vendors$1=["ms","MS","moz","webkit","o"];function prefixed(t,e){if(t in(e=e||window))return e[t];var i,r=capitalize(t);return vendors$1.some((function(t){var n=t+r;return i=n in e?e[n]:void 0})),i}function setPrefixed(t,e,i){if(t in(i=i||window))i[t]=e;else{var r=capitalize(t);vendors$1.some((function(t){var n=t+r;return n in i&&(i[n]=e,!0)}))}}var agentUtils=Object.freeze({__proto__:null,prefixed,setPrefixed});const DEG_TO_RAD=Math.PI/180,RAD_TO_DEG=180/Math.PI,TAU=2*Math.PI,ETA=.5*Math.PI,EPSILON=1e-6;function isPowerOfTwo(t){return 0==(t&t-1)}function nextPowerOfTwo(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function degToRad(t){return t*DEG_TO_RAD}function radToDeg(t){return t*RAD_TO_DEG}function clamp(t,e,i){return t<e?e:t>i?i:+t}function random$1(t,e){return~~(Math.random()*(e-t))+t}function randomFloat(t,e){return Math.random()*(e-t)+t}function weightedRandom$1(t,e){return~~(Math.pow(Math.random(),2)*(e-t))+t}function round(t,e=0){var i=Math.pow(10,e);return~~(.5+t*i)/i}function toBeCloseTo(t,e,i=2){return Math.abs(t-e)<Math.pow(10,-i)/2}var math=Object.freeze({__proto__:null,DEG_TO_RAD,RAD_TO_DEG,TAU,ETA,EPSILON,isPowerOfTwo,nextPowerOfTwo,degToRad,radToDeg,clamp,random:random$1,randomFloat,weightedRandom:weightedRandom$1,round,toBeCloseTo});function remove(t,e){var i=Array.prototype.indexOf.call(t,e);return-1!==i&&Array.prototype.splice.call(t,i,1),t}function random(t){return t[random$1(0,t.length)]}function weightedRandom(t){return t[weightedRandom$1(0,t.length)]}var arrayUtils=Object.freeze({__proto__:null,remove,random,weightedRandom});const REMOVE_PATH=/^.*(\\|\/|\:)/,REMOVE_EXT=/\.[^\.]*$/;function getBasename(t){return t.replace(REMOVE_PATH,"").replace(REMOVE_EXT,"")}function getExtension(t){return t.substring(t.lastIndexOf(".")+1,t.length)}var fileUtils=Object.freeze({__proto__:null,getBasename,getExtension});function defer(t,e){var i=Array.prototype.slice.call(arguments,1);return setTimeout(t.bind.apply(t,i),.01)}function throttle(t,e,i){var r,n=window.performance.now();return"boolean"!=typeof i&&(i=!1),function(){var s=window.performance.now(),o=s-n,a=arguments;if(!(o<e))return n=s,t.apply(null,a);!1===i&&(clearTimeout(r),r=setTimeout((function(){return n=s,t.apply(null,a)}),o))}}var fnUtils=Object.freeze({__proto__:null,defer,throttle}),objectClass={},instance_counter=0,pool={register(t,e,i){if(void 0===e)throw new Error("Cannot register object '"+t+"', invalid class");objectClass[t]={class:e,pool:i?[]:void 0}},pull(t){for(var e=new Array(arguments.length),i=0;i<arguments.length;i++)e[i]=arguments[i];var r=objectClass[t];if(r){var n,s=r.class,o=r.pool;return o&&(n=o.pop())?(e.shift(),"function"==typeof n.onResetEvent?n.onResetEvent.apply(n,e):"function"==typeof n.init&&n.init.apply(n,e),instance_counter--):(e[0]=s,n=new(s.bind.apply(s,e)),o&&(n.className=t)),n}throw new Error("Cannot instantiate object of type '"+t+"'")},purge(){for(var t in objectClass)objectClass[t]&&(objectClass[t].pool=[]);instance_counter=0},push(t){var e=t.className;void 0!==e&&objectClass[e]&&(objectClass[e].pool.push(t),instance_counter++)},exists:t=>t in objectClass,getInstanceCount:t=>instance_counter};class Vector2d{constructor(...t){this.onResetEvent(...t)}onResetEvent(t=0,e=0){return this.x=t,this.y=e,this}_set(t,e){return this.x=t,this.y=e,this}set(t,e){if(t!==+t||e!==+e)throw new Error("invalid x,y parameters (not a number)");return this._set(t,e)}setZero(){return this.set(0,0)}setV(t){return this._set(t.x,t.y)}add(t){return this._set(this.x+t.x,this.y+t.y)}sub(t){return this._set(this.x-t.x,this.y-t.y)}scale(t,e){return this._set(this.x*t,this.y*(void 0!==e?e:t))}toIso(){return this._set(this.x-this.y,.5*(this.x+this.y))}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2)}scaleV(t){return this._set(this.x*t.x,this.y*t.y)}div(t){return this._set(this.x/t,this.y/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y)}clamp(t,e){return new Vector2d(clamp(this.x,t,e),clamp(this.y,t,e))}clampSelf(t,e){return this._set(clamp(this.x,t,e),clamp(this.y,t,e))}minV(t){return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y)}maxV(t){return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y)}floor(){return new Vector2d(Math.floor(this.x),Math.floor(this.y))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y))}ceil(){return new Vector2d(Math.ceil(this.x),Math.ceil(this.y))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y))}negate(){return new Vector2d(-this.x,-this.y)}negateSelf(){return this._set(-this.x,-this.y)}copy(t){return this._set(t.x,t.y)}equals(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.x===t&&this.y===e}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x)}rotate(t,e){var i=0,r=0;"object"==typeof e&&(i=e.x,r=e.y);var n=this.x-i,s=this.y-r,o=Math.cos(t),a=Math.sin(t);return this._set(n*o-s*a+i,n*a+s*o+r)}dotProduct(t){return this.x*t.x+this.y*t.y}length2(){return this.dotProduct(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}distance(t){var e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}angle(t){return Math.acos(clamp(this.dotProduct(t)/(this.length()*t.length()),-1,1))}project(t){return this.scale(this.dotProduct(t)/t.length2())}projectN(t){return this.scale(this.dotProduct(t))}clone(){return pool.pull("Vector2d",this.x,this.y)}toString(){return"x:"+this.x+",y:"+this.y}}function warning(t,e,i){var r="melonJS: %s is deprecated since version %s, please use %s",n=(new Error).stack;console.groupCollapsed?console.groupCollapsed("%c"+r,"font-weight:normal;color:yellow;",t,i,e):console.warn(r,t,i,e),void 0!==n&&console.warn(n),console.groupCollapsed&&console.groupEnd()}function apply(){me.device.getPixelRatio=function(){return warning("me.device.getPixelRatio()","me.device.devicePixelRatio","5.1.0"),me.device.devicePixelRatio},me.Font=me.Text.extend({init:function(t,e,i,r){var n={font:t,size:e,fillStyle:i,textAlign:r};this._super(me.Text,"init",[0,0,n]),warning("me.Font","me.Text","6.1.0")},setFont:function(t,e,i,r){return void 0!==i&&this.fillStyle.copy(i),void 0!==r&&(this.textAlign=r),this._super(me.Text,"setFont",[t,e])}}),me.BitmapFontData=me.BitmapTextData,me.BitmapFont=me.BitmapText.extend({init:function(t,e,i,r,n){var s={font:e,fontData:t,size:i,textAlign:r,textBaseline:n};this._super(me.BitmapText,"init",[0,0,s]),warning("me.BitmapFont","me.BitmapText","6.1.0")}}),me.ScreenObject=me.Stage.extend({init:function(t){this._super(me.Stage,"init",[t]),warning("me.ScreenObject","me.Stage","6.2.0")}}),me.Renderer.prototype.drawShape=function(){warning("drawShape()","the stroke() or fill()","6.3.0"),me.Renderer.prototype.stroke.apply(this,arguments)},me.video.getPos=function(){return warning("me.video.getPos()","me.device.getElementBounds(me.video.renderer.getScreenCanvas());","7.0.0"),me.device.getElementBounds(me.video.renderer.getScreenCanvas())},me.Error=function(t){var e=new Error;return e.name="me.Error",e.message=t,e},me.sys=me.sys||{},me.sys.checkVersion=function(t,e){return warning("me.sys.checkVersion()","me.utils.checkVersion()","7.1.0"),me.utils.checkVersion(t,e)},Object.defineProperty(me.game,"HASH",{get:function(){return warning("me.game.HASH","me.utils.getUriFragment()","7.1.0"),me.utils.getUriFragment()},configurable:!1}),me.video.updateDisplaySize=function(t,e){return warning("me.video.updateDisplaySize()","me.video.scale()","7.1.0"),me.video.scale(t,e)},me.Renderer.prototype.scaleCanvas=function(t,e){return warning("scaleCanvas()","me.video.scale()","7.1.0"),me.video.scale(t,e)},me.Entity.prototype.distanceToPoint=function(t){return warning("distanceToPoint()","me.Renderable.distanceTo()","7.1.0"),this.distanceTo(t)},me.Entity.prototype.angleToPoint=function(t){return warning("angleToPoint()","me.Renderable.angleTo()","7.1.0"),this.angleTo(t)},Object.defineProperty(me.sys,"gravity",{get:function(){return warning("me.sys.gravity","me.game.world.gravity","8.0.0"),me.game.world?me.game.world.gravity.y:void 0},set:function(t){warning("me.sys.gravity","me.game.world.gravity","8.0.0"),me.game.world&&(me.game.world.gravity.y=t)},configurable:!1}),me.WebGLRenderer.Compositor=me.WebGLCompositor,me.WebGLRenderer.Compositor.prototype.drawTriangle=function(t,e,i){var r=this.gl;this.drawVertices(!0===i?r.TRIANGLE_STRIP:r.TRIANGLES,t,e),warning("drawTriangle()","drawVertices()","8.0.0")},me.WebGLRenderer.Compositor.prototype.drawLine=function(t,e,i){var r=this.gl;this.drawVertices(!0===i?r.LINE_STRIP:r.LINE_LOOP,t,e),warning("drawLine()","drawVertices()","8.0.0")},Object.defineProperty(me.sys,"scale",{get:function(){return warning("me.sys.scale","me.video.scaleRatio","8.0.0"),me.video.scaleRatio},configurable:!1}),me.video.getWrapper=function(){return warning("me.video.getWrapper()","me.device.getParent()","8.0.0"),me.video.getParent()},Object.defineProperty(me.sys,"fps",{get:function(){return warning("me.sys.fps","me.timer.maxfps","8.0.0"),me.timer.maxfps},set:function(t){warning("me.sys.fps","me.timer.maxfps","8.0.0"),me.timer.maxfps=t},configurable:!1}),Object.defineProperty(me.sys,"updatesPerSecond",{get:function(){return warning("me.sys.updatesPerSecond","me.game.world.fps","8.0.0"),me.game.world.fps},set:function(t){warning("me.sys.updatesPerSecond","me.game.world.fps","8.0.0"),me.game.world.fps=t},configurable:!1}),Object.defineProperty(me.sys,"interpolation",{get:function(){return warning("me.sys.interpolation","me.timer.interpolation","8.0.0"),me.timer.interpolation},set:function(t){warning("me.sys.interpolation","me.timer.interpolation","8.0.0"),me.timer.interpolation=t},configurable:!1}),me.Body.prototype.addShapesFromJSON=function(t,e){return warning("addShapesFromJSON()","fromJSON()","8.0.0"),this.fromJSON(t,e)},Object.defineProperty(me.sys,"stopOnAudioError",{get:function(){return warning("me.sys.stopOnAudioError","me.audio.stopOnAudioError","9.0.0"),me.audio.stopOnAudioError},set:function(t){warning("me.sys.stopOnAudioError","me.audio.stopOnAudioError","9.0.0"),me.audio.stopOnAudioError=t},configurable:!1}),Object.defineProperty(me.sys,"pauseOnBlur",{get:function(){return warning("me.sys.pauseOnBlur","me.device.pauseOnBlur","9.0.0"),me.audio.pauseOnBlur},set:function(t){warning("me.sys.pauseOnBlur","me.device.pauseOnBlur","9.0.0"),me.device.pauseOnBlur=t},configurable:!1}),Object.defineProperty(me.sys,"resumeOnFocus",{get:function(){return warning("me.sys.pauseOnBlur","me.device.resumeOnFocus","9.0.0"),me.device.resumeOnFocus},set:function(t){warning("me.sys.pauseOnBlur","me.device.resumeOnFocus","9.0.0"),me.device.resumeOnFocus=t},configurable:!1}),Object.defineProperty(me.sys,"autoFocus",{get:function(){return warning("me.sys.autoFocus","me.device.autoFocus","9.0.0"),me.device.autoFocus},set:function(t){warning("me.sys.autoFocus","me.device.autoFocus","9.0.0"),me.device.autoFocus=t},configurable:!1}),Object.defineProperty(me.sys,"stopOnBlur",{get:function(){return warning("me.sys.pauseOnBlur","me.device.stopOnBlur","9.0.0"),me.device.stopOnBlur},set:function(t){warning("me.sys.pauseOnBlur","me.device.stopOnBlur","9.0.0"),me.device.stopOnBlur=t},configurable:!1}),Object.defineProperty(me.sys,"preRender",{get:function(){return warning("me.sys.preRender","me.game.world.preRender","9.0.0"),me.game.world.stopOnBlur},set:function(t){warning("me.sys.preRender","me.game.world.preRender","9.0.0"),me.game.world.stopOnBlur=t},configurable:!1}),me.levelDirector=me.levelDirector||{},me.levelDirector.loadLevel=function(t,e){return warning("me.levelDirector.loadLevel()","me.level.load()","9.0.0"),me.level.load(t,e)},me.levelDirector.getCurrentLevelId=function(){return warning("me.levelDirector.getCurrentLevelId()","me.level.getCurrentLevelId()","9.0.0"),me.level.getCurrentLevelId()},me.levelDirector.getCurrentLevel=function(){return warning("me.levelDirector.getCurrentLevel()","me.level.getCurrentLevel()","9.0.0"),me.level.getCurrentLevel()},me.levelDirector.reloadLevel=function(t){return warning("me.levelDirector.reloadLevel()","me.level.reload()","9.0.0"),me.level.reload(t)},me.levelDirector.nextLevel=function(t){return warning("me.levelDirector.nextLevel()","me.level.next()","9.0.0"),me.level.next(t)},me.levelDirector.previousLevel=function(t){return warning("me.levelDirector.previousLevel()","me.level.previous()","9.0.0"),me.level.previous(t)},me.levelDirector.levelCount=function(){return warning("me.levelDirector.levelCount()","me.level.levelCount()","9.0.0"),me.level.levelCount()},me.Rect.prototype.translateV=function(t){return warning("translateV()","translate()","9.0.0"),this.translate(t)},me.Rect.prototype.containsPoint=function(t,e){return warning("containsPoint()","contains()","9.0.0"),this.contains(t,e)},me.Polygon.prototype.translateV=function(t){return warning("translateV()","translate()","9.0.0"),this.translate(t)},me.Polygon.prototype.containsPointV=function(t){return warning("containsPointV()","contains()","9.0.0"),this.contains(t)},me.Polygon.prototype.containsPoint=function(t,e){return warning("containsPoint()","contains()","9.0.0"),this.contains(t,e)},me.Line.prototype.containsPointV=function(t){return warning("containsPointV()","contains()","9.0.0"),this.contains(t)},me.Line.prototype.containsPoint=function(t,e){return warning("containsPoint()","contains()","9.0.0"),this.contains(t,e)},me.Ellipse.prototype.translateV=function(t){return warning("translateV()","translate()","9.0.0"),this.translate(t)},me.Ellipse.prototype.containsPointV=function(t){return warning("containsPointV()","contains()","9.0.0"),this.contains(t)},me.Ellipse.prototype.containsPoint=function(t,e){return warning("containsPoint()","contains()","9.0.0"),this.contains(t,e)},me.Matrix2d.prototype.translateV=function(t){return warning("translateV()","translate()","9.0.0"),this.translate(t)},me.Matrix3d.prototype.translateV=function(t){return warning("translateV()","translate()","9.0.0"),this.translate(t)},Object.defineProperty(me.Container.prototype,"childBounds",{get:function(){return warning("childBounds","getBounds()","9.0.0"),this.getBounds()},configurable:!1}),me.CollectableEntity=me.Collectable.extend({init:function(t,e,i){this._super(me.Collectable,"init",[t,e,i]),warning("me.CollectableEntity","me.Collectable","9.0.0")}}),me.LevelEntity=me.Trigger.extend({init:function(t,e,i){this._super(me.Trigger,"init",[t,e,i]),warning("me.LevelEntity","me.Trigger","9.0.0")}}),me.pool.register("me.CollectableEntity",me.CollectableEntity),me.pool.register("me.LevelEntity",me.LevelEntity)}var deprecated=Object.freeze({__proto__:null,warning,apply}),toHex=function(t){return"0123456789ABCDEF".charAt(t-t%16>>4)+"0123456789ABCDEF".charAt(t%16)},rgbaRx=/^rgba?\((\d+), ?(\d+), ?(\d+)(, ?([\d\.]+))?\)$/,hex3Rx=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,hex4Rx=/^#([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,hex6Rx=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,hex8Rx=/^#([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})([\da-fA-F]{2})$/,cssToRGB=new Map;[["black",[0,0,0]],["silver",[192,192,129]],["gray",[128,128,128]],["white",[255,255,255]],["maroon",[128,0,0]],["red",[255,0,0]],["purple",[128,0,128]],["fuchsia",[255,0,255]],["green",[0,128,0]],["lime",[0,255,0]],["olive",[128,128,0]],["yellow",[255,255,0]],["navy",[0,0,128]],["blue",[0,0,255]],["teal",[0,128,128]],["aqua",[0,255,255]],["orange",[255,165,0]],["aliceblue",[240,248,245]],["antiquewhite",[250,235,215]],["aquamarine",[127,255,212]],["azure",[240,255,255]],["beige",[245,245,220]],["bisque",[255,228,196]],["blanchedalmond",[255,235,205]],["blueviolet",[138,43,226]],["brown",[165,42,42]],["burlywood",[222,184,35]],["cadetblue",[95,158,160]],["chartreuse",[127,255,0]],["chocolate",[210,105,30]],["coral",[255,127,80]],["cornflowerblue",[100,149,237]],["cornsilk",[255,248,220]],["crimson",[220,20,60]],["darkblue",[0,0,139]],["darkcyan",[0,139,139]],["darkgoldenrod",[184,134,11]],["darkgray[*]",[169,169,169]],["darkgreen",[0,100,0]],["darkgrey[*]",[169,169,169]],["darkkhaki",[189,183,107]],["darkmagenta",[139,0,139]],["darkolivegreen",[85,107,47]],["darkorange",[255,140,0]],["darkorchid",[153,50,204]],["darkred",[139,0,0]],["darksalmon",[233,150,122]],["darkseagreen",[143,188,143]],["darkslateblue",[72,61,139]],["darkslategray",[47,79,79]],["darkslategrey",[47,79,79]],["darkturquoise",[0,206,209]],["darkviolet",[148,0,211]],["deeppink",[255,20,147]],["deepskyblue",[0,191,255]],["dimgray",[105,105,105]],["dimgrey",[105,105,105]],["dodgerblue",[30,144,255]],["firebrick",[178,34,34]],["floralwhite",[255,250,240]],["forestgreen",[34,139,34]],["gainsboro",[220,220,220]],["ghostwhite",[248,248,255]],["gold",[255,215,0]],["goldenrod",[218,165,32]],["greenyellow",[173,255,47]],["grey",[128,128,128]],["honeydew",[240,255,240]],["hotpink",[255,105,180]],["indianred",[205,92,92]],["indigo",[75,0,130]],["ivory",[255,255,240]],["khaki",[240,230,140]],["lavender",[230,230,250]],["lavenderblush",[255,240,245]],["lawngreen",[124,252,0]],["lemonchiffon",[255,250,205]],["lightblue",[173,216,230]],["lightcoral",[240,128,128]],["lightcyan",[224,255,255]],["lightgoldenrodyellow",[250,250,210]],["lightgray",[211,211,211]],["lightgreen",[144,238,144]],["lightgrey",[211,211,211]],["lightpink",[255,182,193]],["lightsalmon",[255,160,122]],["lightseagreen",[32,178,170]],["lightskyblue",[135,206,250]],["lightslategray",[119,136,153]],["lightslategrey",[119,136,153]],["lightsteelblue",[176,196,222]],["lightyellow",[255,255,224]],["limegreen",[50,205,50]],["linen",[250,240,230]],["mediumaquamarine",[102,205,170]],["mediumblue",[0,0,205]],["mediumorchid",[186,85,211]],["mediumpurple",[147,112,219]],["mediumseagreen",[60,179,113]],["mediumslateblue",[123,104,238]],["mediumspringgreen",[0,250,154]],["mediumturquoise",[72,209,204]],["mediumvioletred",[199,21,133]],["midnightblue",[25,25,112]],["mintcream",[245,255,250]],["mistyrose",[255,228,225]],["moccasin",[255,228,181]],["navajowhite",[255,222,173]],["oldlace",[253,245,230]],["olivedrab",[107,142,35]],["orangered",[255,69,0]],["orchid",[218,112,214]],["palegoldenrod",[238,232,170]],["palegreen",[152,251,152]],["paleturquoise",[175,238,238]],["palevioletred",[219,112,147]],["papayawhip",[255,239,213]],["peachpuff",[255,218,185]],["peru",[205,133,63]],["pink",[255,192,203]],["plum",[221,160,221]],["powderblue",[176,224,230]],["rosybrown",[188,143,143]],["royalblue",[65,105,225]],["saddlebrown",[139,69,19]],["salmon",[250,128,114]],["sandybrown",[244,164,96]],["seagreen",[46,139,87]],["seashell",[255,245,238]],["sienna",[160,82,45]],["skyblue",[135,206,235]],["slateblue",[106,90,205]],["slategray",[112,128,144]],["slategrey",[112,128,144]],["snow",[255,250,250]],["springgreen",[0,255,127]],["steelblue",[70,130,180]],["tan",[210,180,140]],["thistle",[216,191,216]],["tomato",[255,99,71]],["turquoise",[64,224,208]],["violet",[238,130,238]],["wheat",[245,222,179]],["whitesmoke",[245,245,245]],["yellowgreen",[154,205,50]]].forEach((function(t){cssToRGB.set(t[0],t[1])}));class Color{constructor(...t){this.onResetEvent(...t)}onResetEvent(t=0,e=0,i=0,r=1){return void 0===this.glArray&&(this.glArray=new Float32Array([0,0,0,1])),this.setColor(t,e,i,r)}get r(){return~~(255*this.glArray[0])}set r(t){this.glArray[0]=clamp(~~t||0,0,255)/255}get g(){return~~(255*this.glArray[1])}set g(t){this.glArray[1]=clamp(~~t||0,0,255)/255}get b(){return~~(255*this.glArray[2])}set b(t){this.glArray[2]=clamp(~~t||0,0,255)/255}get alpha(){return this.glArray[3]}set alpha(t){this.glArray[3]=void 0===t?1:clamp(+t,0,1)}setColor(t,e,i,r=1){return t instanceof Color?(this.glArray.set(t.glArray),t):(this.r=t,this.g=e,this.b=i,this.alpha=r,this)}clone(){return pool.pull("Color",this)}copy(t){return t instanceof Color?(this.glArray.set(t.glArray),this):this.parseCSS(t)}add(t){return this.glArray[0]=clamp(this.glArray[0]+t.glArray[0],0,1),this.glArray[1]=clamp(this.glArray[1]+t.glArray[1],0,1),this.glArray[2]=clamp(this.glArray[2]+t.glArray[2],0,1),this.glArray[3]=(this.glArray[3]+t.glArray[3])/2,this}darken(t){return t=clamp(t,0,1),this.glArray[0]*=t,this.glArray[1]*=t,this.glArray[2]*=t,this}lerp(t,e){return e=clamp(e,0,1),this.glArray[0]+=(t.glArray[0]-this.glArray[0])*e,this.glArray[1]+=(t.glArray[1]-this.glArray[1])*e,this.glArray[2]+=(t.glArray[2]-this.glArray[2])*e,this}lighten(t){return t=clamp(t,0,1),this.glArray[0]=clamp(this.glArray[0]+(1-this.glArray[0])*t,0,1),this.glArray[1]=clamp(this.glArray[1]+(1-this.glArray[1])*t,0,1),this.glArray[2]=clamp(this.glArray[2]+(1-this.glArray[2])*t,0,1),this}random(t=0,e=255){return t<0&&(t=0),e>255&&(e=255),this.setColor(random$1(t,e),random$1(t,e),random$1(t,e),this.alpha)}equals(t){return this.glArray[0]===t.glArray[0]&&this.glArray[1]===t.glArray[1]&&this.glArray[2]===t.glArray[2]&&this.glArray[3]===t.glArray[3]}parseCSS(t){return cssToRGB.has(t)?this.setColor.apply(this,cssToRGB.get(t)):this.parseRGB(t)}parseRGB(t){var e=rgbaRx.exec(t);return e?this.setColor(+e[1],+e[2],+e[3],+e[5]):this.parseHex(t)}parseHex(t,e=!1){var i;if(i=hex8Rx.exec(t))return this.setColor(parseInt(i[!1===e?1:2],16),parseInt(i[!1===e?2:3],16),parseInt(i[!1===e?3:4],16),(clamp(parseInt(i[!1===e?4:1],16),0,255)/255).toFixed(1));if(i=hex6Rx.exec(t))return this.setColor(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16));if(i=hex4Rx.exec(t)){var r=i[!1===e?1:2],n=i[!1===e?2:3],s=i[!1===e?3:4],o=i[!1===e?4:1];return this.setColor(parseInt(r+r,16),parseInt(n+n,16),parseInt(s+s,16),(clamp(parseInt(o+o,16),0,255)/255).toFixed(1))}if(i=hex3Rx.exec(t))return this.setColor(parseInt(i[1]+i[1],16),parseInt(i[2]+i[2],16),parseInt(i[3]+i[3],16));throw new Error("invalid parameter: "+t)}toArray(){return this.glArray}toHex(){return"#"+toHex(this.r)+toHex(this.g)+toHex(this.b)}toHex8(){return"#"+toHex(this.r)+toHex(this.g)+toHex(this.b)+toHex(255*this.alpha)}toRGB(){return"rgb("+this.r+","+this.g+","+this.b+")"}toRGBA(){return"rgba("+this.r+","+this.g+","+this.b+","+this.alpha+")"}}class Matrix3d{constructor(...t){this.onResetEvent(...t)}onResetEvent(){void 0===this.val&&(this.val=new Float32Array(16)),arguments.length&&arguments[0]instanceof Matrix3d?this.copy(arguments[0]):16===arguments.length?this.setTransform.apply(this,arguments):this.identity()}get tx(){return this.val[12]}get ty(){return this.val[13]}get tz(){return this.val[14]}identity(){return this.setTransform(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}setTransform(t,e,i,r,n,s,o,a,h,l,u,c,d,p,f,g){var v=this.val;return v[0]=t,v[1]=e,v[2]=i,v[3]=r,v[4]=n,v[5]=s,v[6]=o,v[7]=a,v[8]=h,v[9]=l,v[10]=u,v[11]=c,v[12]=d,v[13]=p,v[14]=f,v[15]=g,this}copy(t){return this.val.set(t.val),this}fromMat2d(t){var e=t.val;return this.setTransform(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1)}multiply(t){var e=this.val,i=t.val,r=e[0],n=e[1],s=e[2],o=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],d=e[9],p=e[10],f=e[11],g=e[12],v=e[13],m=e[14],y=e[15],_=i[0],x=i[1],w=i[2],b=i[3];return e[0]=_*r+x*a+w*c+b*g,e[1]=_*n+x*h+w*d+b*v,e[2]=_*s+x*l+w*p+b*m,e[3]=_*o+x*u+w*f+b*y,_=i[4],x=i[5],w=i[6],b=i[7],e[4]=_*r+x*a+w*c+b*g,e[5]=_*n+x*h+w*d+b*v,e[6]=_*s+x*l+w*p+b*m,e[7]=_*o+x*u+w*f+b*y,_=i[8],x=i[9],w=i[10],b=i[11],e[8]=_*r+x*a+w*c+b*g,e[9]=_*n+x*h+w*d+b*v,e[10]=_*s+x*l+w*p+b*m,e[11]=_*o+x*u+w*f+b*y,_=i[12],x=i[13],w=i[14],b=i[15],e[12]=_*r+x*a+w*c+b*g,e[13]=_*n+x*h+w*d+b*v,e[14]=_*s+x*l+w*p+b*m,e[15]=_*o+x*u+w*f+b*y,this}transpose(){var t=this.val,e=t[1],i=t[2],r=t[3],n=t[6],s=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=e,t[6]=t[9],t[7]=t[13],t[8]=i,t[9]=n,t[11]=t[14],t[12]=r,t[13]=s,t[14]=o,this}invert(){var t=this.val,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],h=t[7],l=t[8],u=t[9],c=t[10],d=t[11],p=t[12],f=t[13],g=t[14],v=t[15],m=e*o-i*s,y=e*a-r*s,_=e*h-n*s,x=i*a-r*o,w=i*h-n*o,b=r*h-n*a,E=l*f-u*p,T=l*g-c*p,S=l*v-d*p,A=u*g-c*f,P=u*v-d*f,O=c*v-d*g,R=m*O-y*P+_*A+x*S-w*T+b*E;return R?(R=1/R,t[0]=(o*O-a*P+h*A)*R,t[1]=(r*P-i*O-n*A)*R,t[2]=(f*b-g*w+v*x)*R,t[3]=(c*w-u*b-d*x)*R,t[4]=(a*S-s*O-h*T)*R,t[5]=(e*O-r*S+n*T)*R,t[6]=(g*_-p*b-v*y)*R,t[7]=(l*b-c*_+d*y)*R,t[8]=(s*P-o*S+h*E)*R,t[9]=(i*S-e*P-n*E)*R,t[10]=(p*w-f*_+v*m)*R,t[11]=(u*_-l*w-d*m)*R,t[12]=(o*T-s*A-a*E)*R,t[13]=(e*A-i*T+r*E)*R,t[14]=(f*y-p*x-g*m)*R,t[15]=(l*x-u*y+c*m)*R,this):null}apply(t){var e=this.val,i=t.x,r=t.y,n=void 0!==t.z?t.z:1,s=e[3]*i+e[7]*r+e[11]*n+e[15]||1;return t.x=(e[0]*i+e[4]*r+e[8]*n+e[12])/s,t.y=(e[1]*i+e[5]*r+e[9]*n+e[13])/s,void 0!==t.z&&(t.z=(e[2]*i+e[6]*r+e[10]*n+e[14])/s),t}applyInverse(t){var e=pool.pull("Matrix3d",this).invert();return e.apply(t),pool.push(e),t}ortho(t,e,i,r,n,s){var o=this.val,a=1/(t-e),h=1/(i-r),l=1/(n-s);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*h,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*l,o[11]=0,o[12]=(t+e)*a,o[13]=(r+i)*h,o[14]=(s+n)*l,o[15]=1,this}scale(t,e,i){var r=this.val,n=t,s=void 0===e?n:e,o=void 0===i?0:i;return r[0]=r[0]*n,r[1]=r[1]*n,r[2]=r[2]*n,r[3]=r[3]*n,r[4]=r[4]*s,r[5]=r[5]*s,r[6]=r[6]*s,r[7]=r[7]*s,r[8]=r[8]*o,r[9]=r[9]*o,r[10]=r[10]*o,r[11]=r[11]*o,this}scaleV(t){return this.scale(t.x,t.y,t.z)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t,e){var i,r,n,s,o,a,h,l,u,c,d,p,f,g,v,m,y,_,x,w,b,E,T,S,A=this.val,P=e.x,O=e.y,R=e.z,C=Math.sqrt(P*P+O*O+R*R);return C<EPSILON?null:(P*=C=1/C,O*=C,R*=C,i=Math.sin(t),n=1-(r=Math.cos(t)),s=A[0],o=A[1],a=A[2],h=A[3],l=A[4],u=A[5],c=A[6],d=A[7],p=A[8],f=A[9],g=A[10],v=A[11],m=P*P*n+r,y=O*P*n+R*i,_=R*P*n-O*i,x=P*O*n-R*i,w=O*O*n+r,b=R*O*n+P*i,E=P*R*n+O*i,T=O*R*n-P*i,S=R*R*n+r,A[0]=s*m+l*y+p*_,A[1]=o*m+u*y+f*_,A[2]=a*m+c*y+g*_,A[3]=h*m+d*y+v*_,A[4]=s*x+l*w+p*b,A[5]=o*x+u*w+f*b,A[6]=a*x+c*w+g*b,A[7]=h*x+d*w+v*b,A[8]=s*E+l*T+p*S,A[9]=o*E+u*T+f*S,A[10]=a*E+c*T+g*S,A[11]=h*E+d*T+v*S,this)}translate(t,e,i){var r,n,s,o=this.val;return arguments.length>1?(r=arguments[0],n=arguments[1],s=void 0===arguments[2]?0:arguments[2]):(r=arguments[0].x,n=arguments[0].y,s=void 0===arguments[0].z?0:arguments[0].z),o[12]=o[0]*r+o[4]*n+o[8]*s+o[12],o[13]=o[1]*r+o[5]*n+o[9]*s+o[13],o[14]=o[2]*r+o[6]*n+o[10]*s+o[14],o[15]=o[3]*r+o[7]*n+o[11]*s+o[15],this}isIdentity(){var t=this.val;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}equals(t){var e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]}clone(){return pool.pull("Matrix3d",this)}toArray(){return this.val}toString(){var t=this.val;return"me.Matrix3d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}}class Matrix2d{constructor(...t){this.onResetEvent(...t)}onResetEvent(){return void 0===this.val&&(this.val=new Float32Array(9)),arguments.length&&arguments[0]instanceof Matrix2d?this.copy(arguments[0]):arguments.length&&arguments[0]instanceof Matrix3d?this.fromMat3d(arguments[0]):arguments.length>=6?this.setTransform.apply(this,arguments):this.identity(),this}get tx(){return this.val[6]}get ty(){return this.val[7]}identity(){return this.setTransform(1,0,0,0,1,0,0,0,1),this}setTransform(){var t=this.val;return 9===arguments.length?(t[0]=arguments[0],t[1]=arguments[1],t[2]=arguments[2],t[3]=arguments[3],t[4]=arguments[4],t[5]=arguments[5],t[6]=arguments[6],t[7]=arguments[7],t[8]=arguments[8]):6===arguments.length&&(t[0]=arguments[0],t[1]=arguments[2],t[2]=arguments[4],t[3]=arguments[1],t[4]=arguments[3],t[5]=arguments[5],t[6]=0,t[7]=0,t[8]=1),this}copy(t){return this.val.set(t.val),this}fromMat3d(t){var e=t.val,i=this.val;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],this}multiply(t){var e=t.val,i=this.val,r=i[0],n=i[1],s=i[3],o=i[4],a=e[0],h=e[1],l=e[3],u=e[4],c=e[6],d=e[7];return i[0]=r*a+s*h,i[1]=n*a+o*h,i[3]=r*l+s*u,i[4]=n*l+o*u,i[6]+=r*c+s*d,i[7]+=n*c+o*d,this}transpose(){var t=this.val,e=t[1],i=t[2],r=t[5];return t[1]=t[3],t[2]=t[6],t[3]=e,t[5]=t[7],t[6]=i,t[7]=r,this}invert(){var t=this.val,e=t[0],i=t[1],r=t[2],n=t[3],s=t[4],o=t[5],a=t[6],h=t[7],l=t[8],u=l*s-o*h,c=o*a-l*n,d=h*n-s*a,p=e*u+i*c+r*d;return t[0]=u/p,t[1]=(r*h-l*i)/p,t[2]=(o*i-r*s)/p,t[3]=c/p,t[4]=(l*e-r*a)/p,t[5]=(r*n-o*e)/p,t[6]=d/p,t[7]=(i*a-h*e)/p,t[8]=(s*e-i*n)/p,this}apply(t){var e=this.val,i=t.x,r=t.y;return t.x=i*e[0]+r*e[3]+e[6],t.y=i*e[1]+r*e[4]+e[7],t}applyInverse(t){var e=this.val,i=t.x,r=t.y,n=1/(e[0]*e[4]+e[3]*-e[1]);return t.x=e[4]*n*i+-e[3]*n*r+(e[7]*e[3]-e[6]*e[4])*n,t.y=e[0]*n*r+-e[1]*n*i+(-e[7]*e[0]+e[6]*e[1])*n,t}scale(t,e){var i=this.val,r=t,n=void 0===e?r:e;return i[0]*=r,i[1]*=r,i[3]*=n,i[4]*=n,this}scaleV(t){return this.scale(t.x,t.y)}scaleX(t){return this.scale(t,1)}scaleY(t){return this.scale(1,t)}rotate(t){if(0!==t){var e=this.val,i=e[0],r=e[1],n=e[2],s=e[3],o=e[4],a=e[5],h=Math.sin(t),l=Math.cos(t);e[0]=l*i+h*s,e[1]=l*r+h*o,e[2]=l*n+h*a,e[3]=l*s-h*i,e[4]=l*o-h*r,e[5]=l*a-h*n}return this}translate(){var t,e,i=this.val;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),i[6]+=i[0]*t+i[3]*e,i[7]+=i[1]*t+i[4]*e,this}isIdentity(){var t=this.val;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]}equals(t){var e=t.val,i=this.val;return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]}clone(){return pool.pull("Matrix2d",this)}toArray(){return this.val}toString(){var t=this.val;return"me.Matrix2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}}var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==__webpack_require__.g?__webpack_require__.g:"undefined"!=typeof self?self:{},minpubsub_src={exports:{}},module;module=minpubsub_src,function(t){var e={},i=t.c_||{};e.publish=function(e,r){for(var n=i[e],s=n?n.length:0;s--;)n[s].apply(t,r||[])},e.subscribe=function(t,e){return i[t]||(i[t]=[]),i[t].push(e),[t,e]},e.unsubscribe=function(t,e){for(var r=i[e?t:t[0]],n=(e=e||t[1],r?r.length:0);n--;)r[n]===e&&r.splice(n,1)},module.exports?module.exports=e:"object"==typeof t&&(t.publish=e.publish,t.subscribe=e.subscribe,t.unsubscribe=e.unsubscribe)}(commonjsGlobal.window);var MinPubSub=minpubsub_src.exports,event={STATE_PAUSE:"me.state.onPause",STATE_RESUME:"me.state.onResume",STATE_STOP:"me.state.onStop",STATE_RESTART:"me.state.onRestart",VIDEO_INIT:"me.video.onInit",GAME_INIT:"me.game.onInit",GAME_RESET:"me.game.onReset",GAME_UPDATE:"me.game.onUpdate",LEVEL_LOADED:"me.game.onLevelLoaded",LOADER_COMPLETE:"me.loader.onload",LOADER_PROGRESS:"me.loader.onProgress",KEYDOWN:"me.input.keydown",KEYUP:"me.input.keyup",GAMEPAD_CONNECTED:"gamepad.connected",GAMEPAD_DISCONNECTED:"gamepad.disconnected",GAMEPAD_UPDATE:"gamepad.update",POINTERMOVE:"me.event.pointermove",DRAGSTART:"me.game.dragstart",DRAGEND:"me.game.dragend",WINDOW_ONRESIZE:"window.onresize",CANVAS_ONRESIZE:"canvas.onresize",VIEWPORT_ONRESIZE:"viewport.onresize",WINDOW_ONORIENTATION_CHANGE:"window.orientationchange",WINDOW_ONSCROLL:"window.onscroll",VIEWPORT_ONCHANGE:"viewport.onchange",WEBGL_ONCONTEXT_LOST:"renderer.webglcontextlost",WEBGL_ONCONTEXT_RESTORED:"renderer.webglcontextrestored",publish:MinPubSub.publish,subscribe:MinPubSub.subscribe,unsubscribe:MinPubSub.unsubscribe},howler={},exports;exports=howler,function(){var t=function(){this.init()};t.prototype={init:function(){var t=this||e;return t._counter=1e3,t._html5AudioPool=[],t.html5PoolSize=10,t._codecs={},t._howls=[],t._muted=!1,t._volume=1,t._canPlayEvent="canplaythrough",t._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,t.masterGain=null,t.noAudio=!1,t.usingWebAudio=!0,t.autoSuspend=!0,t.ctx=null,t.autoUnlock=!0,t._setup(),t},volume:function(t){var i=this||e;if(t=parseFloat(t),i.ctx||l(),void 0!==t&&t>=0&&t<=1){if(i._volume=t,i._muted)return i;i.usingWebAudio&&i.masterGain.gain.setValueAtTime(t,e.ctx.currentTime);for(var r=0;r<i._howls.length;r++)if(!i._howls[r]._webAudio)for(var n=i._howls[r]._getSoundIds(),s=0;s<n.length;s++){var o=i._howls[r]._soundById(n[s]);o&&o._node&&(o._node.volume=o._volume*t)}return i}return i._volume},mute:function(t){var i=this||e;i.ctx||l(),i._muted=t,i.usingWebAudio&&i.masterGain.gain.setValueAtTime(t?0:i._volume,e.ctx.currentTime);for(var r=0;r<i._howls.length;r++)if(!i._howls[r]._webAudio)for(var n=i._howls[r]._getSoundIds(),s=0;s<n.length;s++){var o=i._howls[r]._soundById(n[s]);o&&o._node&&(o._node.muted=!!t||o._muted)}return i},stop:function(){for(var t=this||e,i=0;i<t._howls.length;i++)t._howls[i].stop();return t},unload:function(){for(var t=this||e,i=t._howls.length-1;i>=0;i--)t._howls[i].unload();return t.usingWebAudio&&t.ctx&&void 0!==t.ctx.close&&(t.ctx.close(),t.ctx=null,l()),t},codecs:function(t){return(this||e)._codecs[t.replace(/^x-/,"")]},_setup:function(){var t=this||e;if(t.state=t.ctx&&t.ctx.state||"suspended",t._autoSuspend(),!t.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(new Audio).oncanplaythrough&&(t._canPlayEvent="canplay")}catch(e){t.noAudio=!0}else t.noAudio=!0;try{(new Audio).muted&&(t.noAudio=!0)}catch(t){}return t.noAudio||t._setupCodecs(),t},_setupCodecs:function(){var t=this||e,i=null;try{i="undefined"!=typeof Audio?new Audio:null}catch(e){return t}if(!i||"function"!=typeof i.canPlayType)return t;var r=i.canPlayType("audio/mpeg;").replace(/^no$/,""),n=t._navigator?t._navigator.userAgent:"",s=n.match(/OPR\/([0-6].)/g),o=s&&parseInt(s[0].split("/")[1],10)<33,a=-1!==n.indexOf("Safari")&&-1===n.indexOf("Chrome"),h=n.match(/Version\/(.*?) /),l=a&&h&&parseInt(h[1],10)<15;return t._codecs={mp3:!(o||!r&&!i.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!r,opus:!!i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(i.canPlayType('audio/wav; codecs="1"')||i.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!i.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!i.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(i.canPlayType("audio/x-m4b;")||i.canPlayType("audio/m4b;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(i.canPlayType("audio/x-mp4;")||i.canPlayType("audio/mp4;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!(l||!i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!(l||!i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!i.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(i.canPlayType("audio/x-flac;")||i.canPlayType("audio/flac;")).replace(/^no$/,"")},t},_unlockAudio:function(){var t=this||e;if(!t._audioUnlocked&&t.ctx){t._audioUnlocked=!1,t.autoUnlock=!1,t._mobileUnloaded||44100===t.ctx.sampleRate||(t._mobileUnloaded=!0,t.unload()),t._scratchBuffer=t.ctx.createBuffer(1,1,22050);var i=function(e){for(;t._html5AudioPool.length<t.html5PoolSize;)try{var r=new Audio;r._unlocked=!0,t._releaseHtml5Audio(r)}catch(e){t.noAudio=!0;break}for(var n=0;n<t._howls.length;n++)if(!t._howls[n]._webAudio)for(var s=t._howls[n]._getSoundIds(),o=0;o<s.length;o++){var a=t._howls[n]._soundById(s[o]);a&&a._node&&!a._node._unlocked&&(a._node._unlocked=!0,a._node.load())}t._autoResume();var h=t.ctx.createBufferSource();h.buffer=t._scratchBuffer,h.connect(t.ctx.destination),void 0===h.start?h.noteOn(0):h.start(0),"function"==typeof t.ctx.resume&&t.ctx.resume(),h.onended=function(){h.disconnect(0),t._audioUnlocked=!0,document.removeEventListener("touchstart",i,!0),document.removeEventListener("touchend",i,!0),document.removeEventListener("click",i,!0),document.removeEventListener("keydown",i,!0);for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("unlock")}};return document.addEventListener("touchstart",i,!0),document.addEventListener("touchend",i,!0),document.addEventListener("click",i,!0),document.addEventListener("keydown",i,!0),t}},_obtainHtml5Audio:function(){var t=this||e;if(t._html5AudioPool.length)return t._html5AudioPool.pop();var i=(new Audio).play();return i&&"undefined"!=typeof Promise&&(i instanceof Promise||"function"==typeof i.then)&&i.catch((function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")})),new Audio},_releaseHtml5Audio:function(t){var i=this||e;return t._unlocked&&i._html5AudioPool.push(t),i},_autoSuspend:function(){var t=this;if(t.autoSuspend&&t.ctx&&void 0!==t.ctx.suspend&&e.usingWebAudio){for(var i=0;i<t._howls.length;i++)if(t._howls[i]._webAudio)for(var r=0;r<t._howls[i]._sounds.length;r++)if(!t._howls[i]._sounds[r]._paused)return t;return t._suspendTimer&&clearTimeout(t._suspendTimer),t._suspendTimer=setTimeout((function(){if(t.autoSuspend){t._suspendTimer=null,t.state="suspending";var e=function(){t.state="suspended",t._resumeAfterSuspend&&(delete t._resumeAfterSuspend,t._autoResume())};t.ctx.suspend().then(e,e)}}),3e4),t}},_autoResume:function(){var t=this;if(t.ctx&&void 0!==t.ctx.resume&&e.usingWebAudio)return"running"===t.state&&"interrupted"!==t.ctx.state&&t._suspendTimer?(clearTimeout(t._suspendTimer),t._suspendTimer=null):"suspended"===t.state||"running"===t.state&&"interrupted"===t.ctx.state?(t.ctx.resume().then((function(){t.state="running";for(var e=0;e<t._howls.length;e++)t._howls[e]._emit("resume")})),t._suspendTimer&&(clearTimeout(t._suspendTimer),t._suspendTimer=null)):"suspending"===t.state&&(t._resumeAfterSuspend=!0),t}};var e=new t,i=function(t){t.src&&0!==t.src.length?this.init(t):console.error("An array of source files must be passed with any new Howl.")};i.prototype={init:function(t){var i=this;return e.ctx||l(),i._autoplay=t.autoplay||!1,i._format="string"!=typeof t.format?t.format:[t.format],i._html5=t.html5||!1,i._muted=t.mute||!1,i._loop=t.loop||!1,i._pool=t.pool||5,i._preload="boolean"!=typeof t.preload&&"metadata"!==t.preload||t.preload,i._rate=t.rate||1,i._sprite=t.sprite||{},i._src="string"!=typeof t.src?t.src:[t.src],i._volume=void 0!==t.volume?t.volume:1,i._xhr={method:t.xhr&&t.xhr.method?t.xhr.method:"GET",headers:t.xhr&&t.xhr.headers?t.xhr.headers:null,withCredentials:!(!t.xhr||!t.xhr.withCredentials)&&t.xhr.withCredentials},i._duration=0,i._state="unloaded",i._sounds=[],i._endTimers={},i._queue=[],i._playLock=!1,i._onend=t.onend?[{fn:t.onend}]:[],i._onfade=t.onfade?[{fn:t.onfade}]:[],i._onload=t.onload?[{fn:t.onload}]:[],i._onloaderror=t.onloaderror?[{fn:t.onloaderror}]:[],i._onplayerror=t.onplayerror?[{fn:t.onplayerror}]:[],i._onpause=t.onpause?[{fn:t.onpause}]:[],i._onplay=t.onplay?[{fn:t.onplay}]:[],i._onstop=t.onstop?[{fn:t.onstop}]:[],i._onmute=t.onmute?[{fn:t.onmute}]:[],i._onvolume=t.onvolume?[{fn:t.onvolume}]:[],i._onrate=t.onrate?[{fn:t.onrate}]:[],i._onseek=t.onseek?[{fn:t.onseek}]:[],i._onunlock=t.onunlock?[{fn:t.onunlock}]:[],i._onresume=[],i._webAudio=e.usingWebAudio&&!i._html5,void 0!==e.ctx&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(i),i._autoplay&&i._queue.push({event:"play",action:function(){i.play()}}),i._preload&&"none"!==i._preload&&i.load(),i},load:function(){var t=this,i=null;if(e.noAudio)t._emit("loaderror",null,"No audio support.");else{"string"==typeof t._src&&(t._src=[t._src]);for(var n=0;n<t._src.length;n++){var o,a;if(t._format&&t._format[n])o=t._format[n];else{if("string"!=typeof(a=t._src[n])){t._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(o=/^data:audio\/([^;,]+);/i.exec(a))||(o=/\.([^.]+)$/.exec(a.split("?",1)[0])),o&&(o=o[1].toLowerCase())}if(o||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),o&&e.codecs(o)){i=t._src[n];break}}if(i)return t._src=i,t._state="loading","https:"===window.location.protocol&&"http:"===i.slice(0,5)&&(t._html5=!0,t._webAudio=!1),new r(t),t._webAudio&&s(t),t;t._emit("loaderror",null,"No codec support for selected audio sources.")}},play:function(t,i){var r=this,n=null;if("number"==typeof t)n=t,t=null;else{if("string"==typeof t&&"loaded"===r._state&&!r._sprite[t])return null;if(void 0===t&&(t="__default",!r._playLock)){for(var s=0,o=0;o<r._sounds.length;o++)r._sounds[o]._paused&&!r._sounds[o]._ended&&(s++,n=r._sounds[o]._id);1===s?t=null:n=null}}var a=n?r._soundById(n):r._inactiveSound();if(!a)return null;if(n&&!t&&(t=a._sprite||"__default"),"loaded"!==r._state){a._sprite=t,a._ended=!1;var h=a._id;return r._queue.push({event:"play",action:function(){r.play(h)}}),h}if(n&&!a._paused)return i||r._loadQueue("play"),a._id;r._webAudio&&e._autoResume();var l=Math.max(0,a._seek>0?a._seek:r._sprite[t][0]/1e3),u=Math.max(0,(r._sprite[t][0]+r._sprite[t][1])/1e3-l),c=1e3*u/Math.abs(a._rate),d=r._sprite[t][0]/1e3,p=(r._sprite[t][0]+r._sprite[t][1])/1e3;a._sprite=t,a._ended=!1;var f=function(){a._paused=!1,a._seek=l,a._start=d,a._stop=p,a._loop=!(!a._loop&&!r._sprite[t][2])};if(!(l>=p)){var g=a._node;if(r._webAudio){var v=function(){r._playLock=!1,f(),r._refreshBuffer(a);var t=a._muted||r._muted?0:a._volume;g.gain.setValueAtTime(t,e.ctx.currentTime),a._playStart=e.ctx.currentTime,void 0===g.bufferSource.start?a._loop?g.bufferSource.noteGrainOn(0,l,86400):g.bufferSource.noteGrainOn(0,l,u):a._loop?g.bufferSource.start(0,l,86400):g.bufferSource.start(0,l,u),c!==1/0&&(r._endTimers[a._id]=setTimeout(r._ended.bind(r,a),c)),i||setTimeout((function(){r._emit("play",a._id),r._loadQueue()}),0)};"running"===e.state&&"interrupted"!==e.ctx.state?v():(r._playLock=!0,r.once("resume",v),r._clearTimer(a._id))}else{var m=function(){g.currentTime=l,g.muted=a._muted||r._muted||e._muted||g.muted,g.volume=a._volume*e.volume(),g.playbackRate=a._rate;try{var n=g.play();if(n&&"undefined"!=typeof Promise&&(n instanceof Promise||"function"==typeof n.then)?(r._playLock=!0,f(),n.then((function(){r._playLock=!1,g._unlocked=!0,i?r._loadQueue():r._emit("play",a._id)})).catch((function(){r._playLock=!1,r._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),a._ended=!0,a._paused=!0}))):i||(r._playLock=!1,f(),r._emit("play",a._id)),g.playbackRate=a._rate,g.paused)return void r._emit("playerror",a._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");"__default"!==t||a._loop?r._endTimers[a._id]=setTimeout(r._ended.bind(r,a),c):(r._endTimers[a._id]=function(){r._ended(a),g.removeEventListener("ended",r._endTimers[a._id],!1)},g.addEventListener("ended",r._endTimers[a._id],!1))}catch(t){r._emit("playerror",a._id,t)}};"data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"===g.src&&(g.src=r._src,g.load());var y=window&&window.ejecta||!g.readyState&&e._navigator.isCocoonJS;if(g.readyState>=3||y)m();else{r._playLock=!0,r._state="loading";var _=function(){r._state="loaded",m(),g.removeEventListener(e._canPlayEvent,_,!1)};g.addEventListener(e._canPlayEvent,_,!1),r._clearTimer(a._id)}}return a._id}r._ended(a)},pause:function(t){var e=this;if("loaded"!==e._state||e._playLock)return e._queue.push({event:"pause",action:function(){e.pause(t)}}),e;for(var i=e._getSoundIds(t),r=0;r<i.length;r++){e._clearTimer(i[r]);var n=e._soundById(i[r]);if(n&&!n._paused&&(n._seek=e.seek(i[r]),n._rateSeek=0,n._paused=!0,e._stopFade(i[r]),n._node))if(e._webAudio){if(!n._node.bufferSource)continue;void 0===n._node.bufferSource.stop?n._node.bufferSource.noteOff(0):n._node.bufferSource.stop(0),e._cleanBuffer(n._node)}else isNaN(n._node.duration)&&n._node.duration!==1/0||n._node.pause();arguments[1]||e._emit("pause",n?n._id:null)}return e},stop:function(t,e){var i=this;if("loaded"!==i._state||i._playLock)return i._queue.push({event:"stop",action:function(){i.stop(t)}}),i;for(var r=i._getSoundIds(t),n=0;n<r.length;n++){i._clearTimer(r[n]);var s=i._soundById(r[n]);s&&(s._seek=s._start||0,s._rateSeek=0,s._paused=!0,s._ended=!0,i._stopFade(r[n]),s._node&&(i._webAudio?s._node.bufferSource&&(void 0===s._node.bufferSource.stop?s._node.bufferSource.noteOff(0):s._node.bufferSource.stop(0),i._cleanBuffer(s._node)):isNaN(s._node.duration)&&s._node.duration!==1/0||(s._node.currentTime=s._start||0,s._node.pause(),s._node.duration===1/0&&i._clearSound(s._node))),e||i._emit("stop",s._id))}return i},mute:function(t,i){var r=this;if("loaded"!==r._state||r._playLock)return r._queue.push({event:"mute",action:function(){r.mute(t,i)}}),r;if(void 0===i){if("boolean"!=typeof t)return r._muted;r._muted=t}for(var n=r._getSoundIds(i),s=0;s<n.length;s++){var o=r._soundById(n[s]);o&&(o._muted=t,o._interval&&r._stopFade(o._id),r._webAudio&&o._node?o._node.gain.setValueAtTime(t?0:o._volume,e.ctx.currentTime):o._node&&(o._node.muted=!!e._muted||t),r._emit("mute",o._id))}return r},volume:function(){var t,i,r,n=this,s=arguments;if(0===s.length)return n._volume;if(1===s.length||2===s.length&&void 0===s[1]){var o=n._getSoundIds(),a=o.indexOf(s[0]);a>=0?i=parseInt(s[0],10):t=parseFloat(s[0])}else s.length>=2&&(t=parseFloat(s[0]),i=parseInt(s[1],10));if(!(void 0!==t&&t>=0&&t<=1))return(r=i?n._soundById(i):n._sounds[0])?r._volume:0;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"volume",action:function(){n.volume.apply(n,s)}}),n;void 0===i&&(n._volume=t),i=n._getSoundIds(i);for(var h=0;h<i.length;h++)(r=n._soundById(i[h]))&&(r._volume=t,s[2]||n._stopFade(i[h]),n._webAudio&&r._node&&!r._muted?r._node.gain.setValueAtTime(t,e.ctx.currentTime):r._node&&!r._muted&&(r._node.volume=t*e.volume()),n._emit("volume",r._id));return n},fade:function(t,i,r,n){var s=this;if("loaded"!==s._state||s._playLock)return s._queue.push({event:"fade",action:function(){s.fade(t,i,r,n)}}),s;t=Math.min(Math.max(0,parseFloat(t)),1),i=Math.min(Math.max(0,parseFloat(i)),1),r=parseFloat(r),s.volume(t,n);for(var o=s._getSoundIds(n),a=0;a<o.length;a++){var h=s._soundById(o[a]);if(h){if(n||s._stopFade(o[a]),s._webAudio&&!h._muted){var l=e.ctx.currentTime,u=l+r/1e3;h._volume=t,h._node.gain.setValueAtTime(t,l),h._node.gain.linearRampToValueAtTime(i,u)}s._startFadeInterval(h,t,i,r,o[a],void 0===n)}}return s},_startFadeInterval:function(t,e,i,r,n,s){var o=this,a=e,h=i-e,l=Math.abs(h/.01),u=Math.max(4,l>0?r/l:r),c=Date.now();t._fadeTo=i,t._interval=setInterval((function(){var n=(Date.now()-c)/r;c=Date.now(),a+=h*n,a=Math.round(100*a)/100,a=h<0?Math.max(i,a):Math.min(i,a),o._webAudio?t._volume=a:o.volume(a,t._id,!0),s&&(o._volume=a),(i<e&&a<=i||i>e&&a>=i)&&(clearInterval(t._interval),t._interval=null,t._fadeTo=null,o.volume(i,t._id),o._emit("fade",t._id))}),u)},_stopFade:function(t){var i=this,r=i._soundById(t);return r&&r._interval&&(i._webAudio&&r._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(r._interval),r._interval=null,i.volume(r._fadeTo,t),r._fadeTo=null,i._emit("fade",t)),i},loop:function(){var t,e,i,r=this,n=arguments;if(0===n.length)return r._loop;if(1===n.length){if("boolean"!=typeof n[0])return!!(i=r._soundById(parseInt(n[0],10)))&&i._loop;t=n[0],r._loop=t}else 2===n.length&&(t=n[0],e=parseInt(n[1],10));for(var s=r._getSoundIds(e),o=0;o<s.length;o++)(i=r._soundById(s[o]))&&(i._loop=t,r._webAudio&&i._node&&i._node.bufferSource&&(i._node.bufferSource.loop=t,t&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop,r.playing(s[o])&&(r.pause(s[o],!0),r.play(s[o],!0)))));return r},rate:function(){var t,i,r,n=this,s=arguments;if(0===s.length)i=n._sounds[0]._id;else if(1===s.length){var o=n._getSoundIds(),a=o.indexOf(s[0]);a>=0?i=parseInt(s[0],10):t=parseFloat(s[0])}else 2===s.length&&(t=parseFloat(s[0]),i=parseInt(s[1],10));if("number"!=typeof t)return(r=n._soundById(i))?r._rate:n._rate;if("loaded"!==n._state||n._playLock)return n._queue.push({event:"rate",action:function(){n.rate.apply(n,s)}}),n;void 0===i&&(n._rate=t),i=n._getSoundIds(i);for(var h=0;h<i.length;h++)if(r=n._soundById(i[h])){n.playing(i[h])&&(r._rateSeek=n.seek(i[h]),r._playStart=n._webAudio?e.ctx.currentTime:r._playStart),r._rate=t,n._webAudio&&r._node&&r._node.bufferSource?r._node.bufferSource.playbackRate.setValueAtTime(t,e.ctx.currentTime):r._node&&(r._node.playbackRate=t);var l=n.seek(i[h]),u=(n._sprite[r._sprite][0]+n._sprite[r._sprite][1])/1e3-l,c=1e3*u/Math.abs(r._rate);!n._endTimers[i[h]]&&r._paused||(n._clearTimer(i[h]),n._endTimers[i[h]]=setTimeout(n._ended.bind(n,r),c)),n._emit("rate",r._id)}return n},seek:function(){var t,i,r=this,n=arguments;if(0===n.length)r._sounds.length&&(i=r._sounds[0]._id);else if(1===n.length){var s=r._getSoundIds(),o=s.indexOf(n[0]);o>=0?i=parseInt(n[0],10):r._sounds.length&&(i=r._sounds[0]._id,t=parseFloat(n[0]))}else 2===n.length&&(t=parseFloat(n[0]),i=parseInt(n[1],10));if(void 0===i)return 0;if("number"==typeof t&&("loaded"!==r._state||r._playLock))return r._queue.push({event:"seek",action:function(){r.seek.apply(r,n)}}),r;var a=r._soundById(i);if(a){if(!("number"==typeof t&&t>=0)){if(r._webAudio){var h=r.playing(i)?e.ctx.currentTime-a._playStart:0,l=a._rateSeek?a._rateSeek-a._seek:0;return a._seek+(l+h*Math.abs(a._rate))}return a._node.currentTime}var u=r.playing(i);u&&r.pause(i,!0),a._seek=t,a._ended=!1,r._clearTimer(i),r._webAudio||!a._node||isNaN(a._node.duration)||(a._node.currentTime=t);var c=function(){u&&r.play(i,!0),r._emit("seek",i)};if(u&&!r._webAudio){var d=function(){r._playLock?setTimeout(d,0):c()};setTimeout(d,0)}else c()}return r},playing:function(t){var e=this;if("number"==typeof t){var i=e._soundById(t);return!!i&&!i._paused}for(var r=0;r<e._sounds.length;r++)if(!e._sounds[r]._paused)return!0;return!1},duration:function(t){var e=this,i=e._duration,r=e._soundById(t);return r&&(i=e._sprite[r._sprite][1]/1e3),i},state:function(){return this._state},unload:function(){for(var t=this,i=t._sounds,r=0;r<i.length;r++)i[r]._paused||t.stop(i[r]._id),t._webAudio||(t._clearSound(i[r]._node),i[r]._node.removeEventListener("error",i[r]._errorFn,!1),i[r]._node.removeEventListener(e._canPlayEvent,i[r]._loadFn,!1),i[r]._node.removeEventListener("ended",i[r]._endFn,!1),e._releaseHtml5Audio(i[r]._node)),delete i[r]._node,t._clearTimer(i[r]._id);var s=e._howls.indexOf(t);s>=0&&e._howls.splice(s,1);var o=!0;for(r=0;r<e._howls.length;r++)if(e._howls[r]._src===t._src||t._src.indexOf(e._howls[r]._src)>=0){o=!1;break}return n&&o&&delete n[t._src],e.noAudio=!1,t._state="unloaded",t._sounds=[],t=null,null},on:function(t,e,i,r){var n=this["_on"+t];return"function"==typeof e&&n.push(r?{id:i,fn:e,once:r}:{id:i,fn:e}),this},off:function(t,e,i){var r=this,n=r["_on"+t],s=0;if("number"==typeof e&&(i=e,e=null),e||i)for(s=0;s<n.length;s++){var o=i===n[s].id;if(e===n[s].fn&&o||!e&&o){n.splice(s,1);break}}else if(t)r["_on"+t]=[];else{var a=Object.keys(r);for(s=0;s<a.length;s++)0===a[s].indexOf("_on")&&Array.isArray(r[a[s]])&&(r[a[s]]=[])}return r},once:function(t,e,i){return this.on(t,e,i,1),this},_emit:function(t,e,i){for(var r=this,n=r["_on"+t],s=n.length-1;s>=0;s--)n[s].id&&n[s].id!==e&&"load"!==t||(setTimeout(function(t){t.call(this,e,i)}.bind(r,n[s].fn),0),n[s].once&&r.off(t,n[s].fn,n[s].id));return r._loadQueue(t),r},_loadQueue:function(t){var e=this;if(e._queue.length>0){var i=e._queue[0];i.event===t&&(e._queue.shift(),e._loadQueue()),t||i.action()}return e},_ended:function(t){var i=this,r=t._sprite;if(!i._webAudio&&t._node&&!t._node.paused&&!t._node.ended&&t._node.currentTime<t._stop)return setTimeout(i._ended.bind(i,t),100),i;var n=!(!t._loop&&!i._sprite[r][2]);if(i._emit("end",t._id),!i._webAudio&&n&&i.stop(t._id,!0).play(t._id),i._webAudio&&n){i._emit("play",t._id),t._seek=t._start||0,t._rateSeek=0,t._playStart=e.ctx.currentTime;var s=1e3*(t._stop-t._start)/Math.abs(t._rate);i._endTimers[t._id]=setTimeout(i._ended.bind(i,t),s)}return i._webAudio&&!n&&(t._paused=!0,t._ended=!0,t._seek=t._start||0,t._rateSeek=0,i._clearTimer(t._id),i._cleanBuffer(t._node),e._autoSuspend()),i._webAudio||n||i.stop(t._id,!0),i},_clearTimer:function(t){var e=this;if(e._endTimers[t]){if("function"!=typeof e._endTimers[t])clearTimeout(e._endTimers[t]);else{var i=e._soundById(t);i&&i._node&&i._node.removeEventListener("ended",e._endTimers[t],!1)}delete e._endTimers[t]}return e},_soundById:function(t){for(var e=this,i=0;i<e._sounds.length;i++)if(t===e._sounds[i]._id)return e._sounds[i];return null},_inactiveSound:function(){var t=this;t._drain();for(var e=0;e<t._sounds.length;e++)if(t._sounds[e]._ended)return t._sounds[e].reset();return new r(t)},_drain:function(){var t=this,e=t._pool,i=0,r=0;if(!(t._sounds.length<e)){for(r=0;r<t._sounds.length;r++)t._sounds[r]._ended&&i++;for(r=t._sounds.length-1;r>=0;r--){if(i<=e)return;t._sounds[r]._ended&&(t._webAudio&&t._sounds[r]._node&&t._sounds[r]._node.disconnect(0),t._sounds.splice(r,1),i--)}}},_getSoundIds:function(t){if(void 0===t){for(var e=[],i=0;i<this._sounds.length;i++)e.push(this._sounds[i]._id);return e}return[t]},_refreshBuffer:function(t){return t._node.bufferSource=e.ctx.createBufferSource(),t._node.bufferSource.buffer=n[this._src],t._panner?t._node.bufferSource.connect(t._panner):t._node.bufferSource.connect(t._node),t._node.bufferSource.loop=t._loop,t._loop&&(t._node.bufferSource.loopStart=t._start||0,t._node.bufferSource.loopEnd=t._stop||0),t._node.bufferSource.playbackRate.setValueAtTime(t._rate,e.ctx.currentTime),this},_cleanBuffer:function(t){var i=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&t.bufferSource&&(t.bufferSource.onended=null,t.bufferSource.disconnect(0),i))try{t.bufferSource.buffer=e._scratchBuffer}catch(t){}return t.bufferSource=null,this},_clearSound:function(t){/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent)||(t.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(t){this._parent=t,this.init()};r.prototype={init:function(){var t=this,i=t._parent;return t._muted=i._muted,t._loop=i._loop,t._volume=i._volume,t._rate=i._rate,t._seek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++e._counter,i._sounds.push(t),t.create(),t},create:function(){var t=this,i=t._parent,r=e._muted||t._muted||t._parent._muted?0:t._volume;return i._webAudio?(t._node=void 0===e.ctx.createGain?e.ctx.createGainNode():e.ctx.createGain(),t._node.gain.setValueAtTime(r,e.ctx.currentTime),t._node.paused=!0,t._node.connect(e.masterGain)):e.noAudio||(t._node=e._obtainHtml5Audio(),t._errorFn=t._errorListener.bind(t),t._node.addEventListener("error",t._errorFn,!1),t._loadFn=t._loadListener.bind(t),t._node.addEventListener(e._canPlayEvent,t._loadFn,!1),t._endFn=t._endListener.bind(t),t._node.addEventListener("ended",t._endFn,!1),t._node.src=i._src,t._node.preload=!0===i._preload?"auto":i._preload,t._node.volume=r*e.volume(),t._node.load()),t},reset:function(){var t=this,i=t._parent;return t._muted=i._muted,t._loop=i._loop,t._volume=i._volume,t._rate=i._rate,t._seek=0,t._rateSeek=0,t._paused=!0,t._ended=!0,t._sprite="__default",t._id=++e._counter,t},_errorListener:function(){var t=this;t._parent._emit("loaderror",t._id,t._node.error?t._node.error.code:0),t._node.removeEventListener("error",t._errorFn,!1)},_loadListener:function(){var t=this,i=t._parent;i._duration=Math.ceil(10*t._node.duration)/10,0===Object.keys(i._sprite).length&&(i._sprite={__default:[0,1e3*i._duration]}),"loaded"!==i._state&&(i._state="loaded",i._emit("load"),i._loadQueue()),t._node.removeEventListener(e._canPlayEvent,t._loadFn,!1)},_endListener:function(){var t=this,e=t._parent;e._duration===1/0&&(e._duration=Math.ceil(10*t._node.duration)/10,e._sprite.__default[1]===1/0&&(e._sprite.__default[1]=1e3*e._duration),e._ended(t)),t._node.removeEventListener("ended",t._endFn,!1)}};var n={},s=function(t){var e=t._src;if(n[e])return t._duration=n[e].duration,void h(t);if(/^data:[^;]+;base64,/.test(e)){for(var i=atob(e.split(",")[1]),r=new Uint8Array(i.length),s=0;s<i.length;++s)r[s]=i.charCodeAt(s);a(r.buffer,t)}else{var l=new XMLHttpRequest;l.open(t._xhr.method,e,!0),l.withCredentials=t._xhr.withCredentials,l.responseType="arraybuffer",t._xhr.headers&&Object.keys(t._xhr.headers).forEach((function(e){l.setRequestHeader(e,t._xhr.headers[e])})),l.onload=function(){var e=(l.status+"")[0];"0"===e||"2"===e||"3"===e?a(l.response,t):t._emit("loaderror",null,"Failed loading audio file with status: "+l.status+".")},l.onerror=function(){t._webAudio&&(t._html5=!0,t._webAudio=!1,t._sounds=[],delete n[e],t.load())},o(l)}},o=function(t){try{t.send()}catch(e){t.onerror()}},a=function(t,i){var r=function(){i._emit("loaderror",null,"Decoding audio data failed.")},s=function(t){t&&i._sounds.length>0?(n[i._src]=t,h(i,t)):r()};"undefined"!=typeof Promise&&1===e.ctx.decodeAudioData.length?e.ctx.decodeAudioData(t).then(s).catch(r):e.ctx.decodeAudioData(t,s,r)},h=function(t,e){e&&!t._duration&&(t._duration=e.duration),0===Object.keys(t._sprite).length&&(t._sprite={__default:[0,1e3*t._duration]}),"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue())},l=function(){if(e.usingWebAudio){try{"undefined"!=typeof AudioContext?e.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch(t){e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var t=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),i=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=i?parseInt(i[1],10):null;if(t&&r&&r<9){var n=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!n&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=void 0===e.ctx.createGain?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};exports.Howler=e,exports.Howl=i,void 0!==commonjsGlobal?(commonjsGlobal.HowlerGlobal=t,commonjsGlobal.Howler=e,commonjsGlobal.Howl=i,commonjsGlobal.Sound=r):"undefined"!=typeof window&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=i,window.Sound=r)}(),function(){var t;HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var e=this;if(!e.ctx||!e.ctx.listener)return e;for(var i=e._howls.length-1;i>=0;i--)e._howls[i].stereo(t);return e},HowlerGlobal.prototype.pos=function(t,e,i){var r=this;return r.ctx&&r.ctx.listener?(e="number"!=typeof e?r._pos[1]:e,i="number"!=typeof i?r._pos[2]:i,"number"!=typeof t?r._pos:(r._pos=[t,e,i],void 0!==r.ctx.listener.positionX?(r.ctx.listener.positionX.setTargetAtTime(r._pos[0],Howler.ctx.currentTime,.1),r.ctx.listener.positionY.setTargetAtTime(r._pos[1],Howler.ctx.currentTime,.1),r.ctx.listener.positionZ.setTargetAtTime(r._pos[2],Howler.ctx.currentTime,.1)):r.ctx.listener.setPosition(r._pos[0],r._pos[1],r._pos[2]),r)):r},HowlerGlobal.prototype.orientation=function(t,e,i,r,n,s){var o=this;if(!o.ctx||!o.ctx.listener)return o;var a=o._orientation;return e="number"!=typeof e?a[1]:e,i="number"!=typeof i?a[2]:i,r="number"!=typeof r?a[3]:r,n="number"!=typeof n?a[4]:n,s="number"!=typeof s?a[5]:s,"number"!=typeof t?a:(o._orientation=[t,e,i,r,n,s],void 0!==o.ctx.listener.forwardX?(o.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),o.ctx.listener.forwardY.setTargetAtTime(e,Howler.ctx.currentTime,.1),o.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),o.ctx.listener.upX.setTargetAtTime(r,Howler.ctx.currentTime,.1),o.ctx.listener.upY.setTargetAtTime(n,Howler.ctx.currentTime,.1),o.ctx.listener.upZ.setTargetAtTime(s,Howler.ctx.currentTime,.1)):o.ctx.listener.setOrientation(t,e,i,r,n,s),o)},Howl.prototype.init=(t=Howl.prototype.init,function(e){var i=this;return i._orientation=e.orientation||[1,0,0],i._stereo=e.stereo||null,i._pos=e.pos||null,i._pannerAttr={coneInnerAngle:void 0!==e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:void 0!==e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:void 0!==e.coneOuterGain?e.coneOuterGain:0,distanceModel:void 0!==e.distanceModel?e.distanceModel:"inverse",maxDistance:void 0!==e.maxDistance?e.maxDistance:1e4,panningModel:void 0!==e.panningModel?e.panningModel:"HRTF",refDistance:void 0!==e.refDistance?e.refDistance:1,rolloffFactor:void 0!==e.rolloffFactor?e.rolloffFactor:1},i._onstereo=e.onstereo?[{fn:e.onstereo}]:[],i._onpos=e.onpos?[{fn:e.onpos}]:[],i._onorientation=e.onorientation?[{fn:e.onorientation}]:[],t.call(this,e)}),Howl.prototype.stereo=function(t,i){var r=this;if(!r._webAudio)return r;if("loaded"!==r._state)return r._queue.push({event:"stereo",action:function(){r.stereo(t,i)}}),r;var n=void 0===Howler.ctx.createStereoPanner?"spatial":"stereo";if(void 0===i){if("number"!=typeof t)return r._stereo;r._stereo=t,r._pos=[t,0,0]}for(var s=r._getSoundIds(i),o=0;o<s.length;o++){var a=r._soundById(s[o]);if(a){if("number"!=typeof t)return a._stereo;a._stereo=t,a._pos=[t,0,0],a._node&&(a._pannerAttr.panningModel="equalpower",a._panner&&a._panner.pan||e(a,n),"spatial"===n?void 0!==a._panner.positionX?(a._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),a._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),a._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):a._panner.setPosition(t,0,0):a._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),r._emit("stereo",a._id)}}return r},Howl.prototype.pos=function(t,i,r,n){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"pos",action:function(){s.pos(t,i,r,n)}}),s;if(i="number"!=typeof i?0:i,r="number"!=typeof r?-.5:r,void 0===n){if("number"!=typeof t)return s._pos;s._pos=[t,i,r]}for(var o=s._getSoundIds(n),a=0;a<o.length;a++){var h=s._soundById(o[a]);if(h){if("number"!=typeof t)return h._pos;h._pos=[t,i,r],h._node&&(h._panner&&!h._panner.pan||e(h,"spatial"),void 0!==h._panner.positionX?(h._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):h._panner.setPosition(t,i,r)),s._emit("pos",h._id)}}return s},Howl.prototype.orientation=function(t,i,r,n){var s=this;if(!s._webAudio)return s;if("loaded"!==s._state)return s._queue.push({event:"orientation",action:function(){s.orientation(t,i,r,n)}}),s;if(i="number"!=typeof i?s._orientation[1]:i,r="number"!=typeof r?s._orientation[2]:r,void 0===n){if("number"!=typeof t)return s._orientation;s._orientation=[t,i,r]}for(var o=s._getSoundIds(n),a=0;a<o.length;a++){var h=s._soundById(o[a]);if(h){if("number"!=typeof t)return h._orientation;h._orientation=[t,i,r],h._node&&(h._panner||(h._pos||(h._pos=s._pos||[0,0,-.5]),e(h,"spatial")),void 0!==h._panner.orientationX?(h._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):h._panner.setOrientation(t,i,r)),s._emit("orientation",h._id)}}return s},Howl.prototype.pannerAttr=function(){var t,i,r,n=this,s=arguments;if(!n._webAudio)return n;if(0===s.length)return n._pannerAttr;if(1===s.length){if("object"!=typeof s[0])return(r=n._soundById(parseInt(s[0],10)))?r._pannerAttr:n._pannerAttr;t=s[0],void 0===i&&(t.pannerAttr||(t.pannerAttr={coneInnerAngle:t.coneInnerAngle,coneOuterAngle:t.coneOuterAngle,coneOuterGain:t.coneOuterGain,distanceModel:t.distanceModel,maxDistance:t.maxDistance,refDistance:t.refDistance,rolloffFactor:t.rolloffFactor,panningModel:t.panningModel}),n._pannerAttr={coneInnerAngle:void 0!==t.pannerAttr.coneInnerAngle?t.pannerAttr.coneInnerAngle:n._coneInnerAngle,coneOuterAngle:void 0!==t.pannerAttr.coneOuterAngle?t.pannerAttr.coneOuterAngle:n._coneOuterAngle,coneOuterGain:void 0!==t.pannerAttr.coneOuterGain?t.pannerAttr.coneOuterGain:n._coneOuterGain,distanceModel:void 0!==t.pannerAttr.distanceModel?t.pannerAttr.distanceModel:n._distanceModel,maxDistance:void 0!==t.pannerAttr.maxDistance?t.pannerAttr.maxDistance:n._maxDistance,refDistance:void 0!==t.pannerAttr.refDistance?t.pannerAttr.refDistance:n._refDistance,rolloffFactor:void 0!==t.pannerAttr.rolloffFactor?t.pannerAttr.rolloffFactor:n._rolloffFactor,panningModel:void 0!==t.pannerAttr.panningModel?t.pannerAttr.panningModel:n._panningModel})}else 2===s.length&&(t=s[0],i=parseInt(s[1],10));for(var o=n._getSoundIds(i),a=0;a<o.length;a++)if(r=n._soundById(o[a])){var h=r._pannerAttr;h={coneInnerAngle:void 0!==t.coneInnerAngle?t.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:void 0!==t.coneOuterAngle?t.coneOuterAngle:h.coneOuterAngle,coneOuterGain:void 0!==t.coneOuterGain?t.coneOuterGain:h.coneOuterGain,distanceModel:void 0!==t.distanceModel?t.distanceModel:h.distanceModel,maxDistance:void 0!==t.maxDistance?t.maxDistance:h.maxDistance,refDistance:void 0!==t.refDistance?t.refDistance:h.refDistance,rolloffFactor:void 0!==t.rolloffFactor?t.rolloffFactor:h.rolloffFactor,panningModel:void 0!==t.panningModel?t.panningModel:h.panningModel};var l=r._panner;l?(l.coneInnerAngle=h.coneInnerAngle,l.coneOuterAngle=h.coneOuterAngle,l.coneOuterGain=h.coneOuterGain,l.distanceModel=h.distanceModel,l.maxDistance=h.maxDistance,l.refDistance=h.refDistance,l.rolloffFactor=h.rolloffFactor,l.panningModel=h.panningModel):(r._pos||(r._pos=n._pos||[0,0,-.5]),e(r,"spatial"))}return n},Sound.prototype.init=function(t){return function(){var e=this,i=e._parent;e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,t.call(this),e._stereo?i.stereo(e._stereo):e._pos&&i.pos(e._pos[0],e._pos[1],e._pos[2],e._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var e=this,i=e._parent;return e._orientation=i._orientation,e._stereo=i._stereo,e._pos=i._pos,e._pannerAttr=i._pannerAttr,e._stereo?i.stereo(e._stereo):e._pos?i.pos(e._pos[0],e._pos[1],e._pos[2],e._id):e._panner&&(e._panner.disconnect(0),e._panner=void 0,i._refreshBuffer(e)),t.call(this)}}(Sound.prototype.reset);var e=function(t,e){"spatial"===(e=e||"spatial")?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,void 0!==t._panner.positionX?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),void 0!==t._panner.orientationX?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}}();class ObservableVector2d extends Vector2d{constructor(t=0,e=0,i){if(super(t,e),void 0===i)throw new Error("undefined `onUpdate` callback");this.setCallback(i.onUpdate,i.scope)}onResetEvent(t=0,e=0,i){return this.setMuted(t,e),void 0!==i&&this.setCallback(i.onUpdate,i.scope),this}get x(){return this._x}set x(t){var e=this.onUpdate.call(this.scope,t,this._y,this._x,this._y);this._x=e&&"x"in e?e.x:t}get y(){return this._y}set y(t){var e=this.onUpdate.call(this.scope,this._x,t,this._x,this._y);this._y=e&&"y"in e?e.y:t}_set(t,e){var i=this.onUpdate.call(this.scope,t,e,this._x,this._y);return i&&"x"in i&&"y"in i?(this._x=i.x,this._y=i.y):(this._x=t,this._y=e),this}setMuted(t,e){return this._x=t,this._y=e,this}setCallback(t,e=null){if("function"!=typeof t)throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y)}sub(t){return this._set(this._x-t.x,this._y-t.y)}scale(t,e){return this._set(this._x*t,this._y*(void 0!==e?e:t))}scaleV(t){return this._set(this._x*t.x,this._y*t.y)}div(t){return this._set(this._x/t,this._y/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y)}clamp(t,e){return new ObservableVector2d(clamp(this.x,t,e),clamp(this.y,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(clamp(this._x,t,e),clamp(this._y,t,e))}minV(t){return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y)}maxV(t){return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y)}floor(){return new ObservableVector2d(Math.floor(this._x),Math.floor(this._y),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y))}ceil(){return new ObservableVector2d(Math.ceil(this._x),Math.ceil(this._y),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y))}negate(){return new ObservableVector2d(-this._x,-this._y,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y)}copy(t){return this._set(t.x,t.y)}equals(t){return this._x===t.x&&this._y===t.y}perp(){return this._set(this._y,-this._x)}rotate(t,e){var i=0,r=0;"object"==typeof e&&(i=e.x,r=e.y);var n=this._x-i,s=this._y-r,o=Math.cos(t),a=Math.sin(t);return this._set(n*o-s*a+i,n*a+s*o+r)}dotProduct(t){return this._x*t.x+this._y*t.y}lerp(t,e){return this._x+=(t.x-this._x)*e,this._y+=(t.y-this._y)*e,this}distance(t){return Math.sqrt((this._x-t.x)*(this._x-t.x)+(this._y-t.y)*(this._y-t.y))}clone(){return pool.pull("ObservableVector2d",this._x,this._y,{onUpdate:this.onUpdate,scope:this.scope})}toVector2d(){return pool.pull("Vector2d",this._x,this._y)}toString(){return"x:"+this._x+",y:"+this._y}}class Vector3d{constructor(...t){this.onResetEvent(...t)}onResetEvent(t=0,e=0,i=0){return this.x=t,this.y=e,this.z=i,this}_set(t,e,i=0){return this.x=t,this.y=e,this.z=i,this}set(t,e,i){if(t!==+t||e!==+e||void 0!==i&&i!==+i)throw new Error("invalid x, y, z parameters (not a number)");return this._set(t,e,i)}setZero(){return this.set(0,0,0)}setV(t){return this._set(t.x,t.y,t.z)}add(t){return this._set(this.x+t.x,this.y+t.y,this.z+(t.z||0))}sub(t){return this._set(this.x-t.x,this.y-t.y,this.z-(t.z||0))}scale(t,e,i){return e=void 0!==e?e:t,this._set(this.x*t,this.y*e,this.z*(i||1))}scaleV(t){return this.scale(t.x,t.y,t.z)}toIso(){return this._set(this.x-this.y,.5*(this.x+this.y),this.z)}to2d(){return this._set(this.y+this.x/2,this.y-this.x/2,this.z)}div(t){return this._set(this.x/t,this.y/t,this.z/t)}abs(){return this._set(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)}clamp(t,e){return new Vector3d(clamp(this.x,t,e),clamp(this.y,t,e),clamp(this.z,t,e))}clampSelf(t,e){return this._set(clamp(this.x,t,e),clamp(this.y,t,e),clamp(this.z,t,e))}minV(t){var e=t.z||0;return this._set(this.x<t.x?this.x:t.x,this.y<t.y?this.y:t.y,this.z<e?this.z:e)}maxV(t){var e=t.z||0;return this._set(this.x>t.x?this.x:t.x,this.y>t.y?this.y:t.y,this.z>e?this.z:e)}floor(){return new Vector3d(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}floorSelf(){return this._set(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}ceil(){return new Vector3d(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}ceilSelf(){return this._set(Math.ceil(this.x),Math.ceil(this.y),Math.ceil(this.z))}negate(){return new Vector3d(-this.x,-this.y,-this.z)}negateSelf(){return this._set(-this.x,-this.y,-this.z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(){var t,e,i;return arguments.length>=2?(t=arguments[0],e=arguments[1],i=arguments[2]):(t=arguments[0].x,e=arguments[0].y,i=arguments[0].z),void 0===i&&(i=this.z),this.x===t&&this.y===e&&this.z===i}normalize(){return this.div(this.length()||1)}perp(){return this._set(this.y,-this.x,this.z)}rotate(t,e){var i=0,r=0;"object"==typeof e&&(i=e.x,r=e.y);var n=this.x-i,s=this.y-r,o=Math.cos(t),a=Math.sin(t);return this._set(n*o-s*a+i,n*a+s*o+r,this.z)}dotProduct(t){return this.x*t.x+this.y*t.y+this.z*(void 0!==t.z?t.z:this.z)}length2(){return this.dotProduct(this)}length(){return Math.sqrt(this.length2())}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}distance(t){var e=this.x-t.x,i=this.y-t.y,r=this.z-(t.z||0);return Math.sqrt(e*e+i*i+r*r)}angle(t){return Math.acos(clamp(this.dotProduct(t)/(this.length()*t.length()),-1,1))}project(t){var e=this.dotProduct(t)/t.length2();return this.scale(e,e,e)}projectN(t){var e=this.dotProduct(t)/t.length2();return this.scale(e,e,e)}clone(){return pool.pull("Vector3d",this.x,this.y,this.z)}toString(){return"x:"+this.x+",y:"+this.y+",z:"+this.z}}class ObservableVector3d extends Vector3d{constructor(t=0,e=0,i=0,r){if(super(t,e,i),void 0===r)throw new Error("undefined `onUpdate` callback");this.setCallback(r.onUpdate,r.scope)}onResetEvent(t=0,e=0,i=0,r){return this.setMuted(t,e,i),void 0!==r&&this.setCallback(r.onUpdate,r.scope),this}get x(){return this._x}set x(t){var e=this.onUpdate.call(this.scope,t,this._y,this._z,this._x,this._y,this._z);this._x=e&&"x"in e?e.x:t}get y(){return this._y}set y(t){var e=this.onUpdate.call(this.scope,this._x,t,this._z,this._x,this._y,this._z);this._y=e&&"y"in e?e.y:t}get z(){return this._z}set z(t){var e=this.onUpdate.call(this.scope,this._x,this._y,t,this._x,this._y,this._z);this._z=e&&"z"in e?e.z:t}_set(t,e,i){var r=this.onUpdate.call(this.scope,t,e,i,this._x,this._y,this._z);return r&&"x"in r&&"y"in r&&"z"in r?(this._x=r.x,this._y=r.y,this._z=r.z):(this._x=t,this._y=e,this._z=i||0),this}setMuted(t,e,i){return this._x=t,this._y=e,this._z=i||0,this}setCallback(t,e=null){if("function"!=typeof t)throw new Error("invalid `onUpdate` callback");return this.onUpdate=t,this.scope=e,this}add(t){return this._set(this._x+t.x,this._y+t.y,this._z+(t.z||0))}sub(t){return this._set(this._x-t.x,this._y-t.y,this._z-(t.z||0))}scale(t,e,i){return e=void 0!==e?e:t,this._set(this._x*t,this._y*e,this._z*(i||1))}scaleV(t){return this._set(this._x*t.x,this._y*t.y,this._z*(t.z||1))}div(t){return this._set(this._x/t,this._y/t,this._z/t)}abs(){return this._set(this._x<0?-this._x:this._x,this._y<0?-this._y:this._y,this._Z<0?-this._z:this._z)}clamp(t,e){return new ObservableVector3d(clamp(this._x,t,e),clamp(this._y,t,e),clamp(this._z,t,e),{onUpdate:this.onUpdate,scope:this.scope})}clampSelf(t,e){return this._set(clamp(this._x,t,e),clamp(this._y,t,e),clamp(this._z,t,e))}minV(t){var e=t.z||0;return this._set(this._x<t.x?this._x:t.x,this._y<t.y?this._y:t.y,this._z<e?this._z:e)}maxV(t){var e=t.z||0;return this._set(this._x>t.x?this._x:t.x,this._y>t.y?this._y:t.y,this._z>e?this._z:e)}floor(){return new ObservableVector3d(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),{onUpdate:this.onUpdate,scope:this.scope})}floorSelf(){return this._set(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}ceil(){return new ObservableVector3d(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z),{onUpdate:this.onUpdate,scope:this.scope})}ceilSelf(){return this._set(Math.ceil(this._x),Math.ceil(this._y),Math.ceil(this._z))}negate(){return new ObservableVector3d(-this._x,-this._y,-this._z,{onUpdate:this.onUpdate,scope:this.scope})}negateSelf(){return this._set(-this._x,-this._y,-this._z)}copy(t){return this._set(t.x,t.y,t.z||0)}equals(t){return this._x===t.x&&this._y===t.y&&this._z===(t.z||this._z)}perp(){return this._set(this._y,-this._x,this._z)}rotate(t,e){var i=0,r=0;"object"==typeof e&&(i=e.x,r=e.y);var n=this.x-i,s=this.y-r,o=Math.cos(t),a=Math.sin(t);return this._set(n*o-s*a+i,n*a+s*o+r,this.z)}dotProduct(t){return this._x*t.x+this._y*t.y+this._z*(t.z||1)}lerp(t,e){return this._x+=(t.x-this._x)*e,this._y+=(t.y-this._y)*e,this._z+=(t.z-this._z)*e,this}distance(t){var e=this._x-t.x,i=this._y-t.y,r=this._z-(t.z||0);return Math.sqrt(e*e+i*i+r*r)}clone(){return pool.pull("ObservableVector3d",this._x,this._y,this._z,{onUpdate:this.onUpdate})}toVector3d(){return pool.pull("Vector3d",this._x,this._y,this._z)}toString(){return"x:"+this._x+",y:"+this._y+",z:"+this._z}}var earcut$2={exports:{}};function earcut(t,e,i){i=i||2;var r,n,s,o,a,h,l,u=e&&e.length,c=u?e[0]*i:t.length,d=linkedList(t,0,c,i,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=eliminateHoles(t,e,d,i)),t.length>80*i){r=s=t[0],n=o=t[1];for(var f=i;f<c;f+=i)(a=t[f])<r&&(r=a),(h=t[f+1])<n&&(n=h),a>s&&(s=a),h>o&&(o=h);l=0!==(l=Math.max(s-r,o-n))?1/l:0}return earcutLinked(d,p,i,r,n,l),p}function linkedList(t,e,i,r,n){var s,o;if(n===signedArea(t,e,i,r)>0)for(s=e;s<i;s+=r)o=insertNode(s,t[s],t[s+1],o);else for(s=i-r;s>=e;s-=r)o=insertNode(s,t[s],t[s+1],o);return o&&equals(o,o.next)&&(removeNode(o),o=o.next),o}function filterPoints(t,e){if(!t)return t;e||(e=t);var i,r=t;do{if(i=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=e=r.prev)===r.next)break;i=!0}}while(i||r!==e);return e}function earcutLinked(t,e,i,r,n,s,o){if(t){!o&&s&&indexCurve(t,r,n,s);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,s?isEarHashed(t,r,n,s):isEar(t))e.push(a.i/i),e.push(t.i/i),e.push(h.i/i),removeNode(t),t=h.next,l=h.next;else if((t=h)===l){o?1===o?earcutLinked(t=cureLocalIntersections(filterPoints(t),e,i),e,i,r,n,s,2):2===o&&splitEarcut(t,e,i,r,n,s):earcutLinked(filterPoints(t),e,i,r,n,s,1);break}}}function isEar(t){var e=t.prev,i=t,r=t.next;if(area(e,i,r)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(pointInTriangle(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function isEarHashed(t,e,i,r){var n=t.prev,s=t,o=t.next;if(area(n,s,o)>=0)return!1;for(var a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,h=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,l=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,u=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,c=zOrder(a,h,e,i,r),d=zOrder(l,u,e,i,r),p=t.prevZ,f=t.nextZ;p&&p.z>=c&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&pointInTriangle(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==t.prev&&f!==t.next&&pointInTriangle(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=c;){if(p!==t.prev&&p!==t.next&&pointInTriangle(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&pointInTriangle(n.x,n.y,s.x,s.y,o.x,o.y,f.x,f.y)&&area(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function cureLocalIntersections(t,e,i){var r=t;do{var n=r.prev,s=r.next.next;!equals(n,s)&&intersects(n,r,r.next,s)&&locallyInside(n,s)&&locallyInside(s,n)&&(e.push(n.i/i),e.push(r.i/i),e.push(s.i/i),removeNode(r),removeNode(r.next),r=t=s),r=r.next}while(r!==t);return filterPoints(r)}function splitEarcut(t,e,i,r,n,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&isValidDiagonal(o,a)){var h=splitPolygon(o,a);return o=filterPoints(o,o.next),h=filterPoints(h,h.next),earcutLinked(o,e,i,r,n,s),void earcutLinked(h,e,i,r,n,s)}a=a.next}o=o.next}while(o!==t)}function eliminateHoles(t,e,i,r){var n,s,o,a=[];for(n=0,s=e.length;n<s;n++)(o=linkedList(t,e[n]*r,n<s-1?e[n+1]*r:t.length,r,!1))===o.next&&(o.steiner=!0),a.push(getLeftmost(o));for(a.sort(compareX),n=0;n<a.length;n++)i=filterPoints(i=eliminateHole(a[n],i),i.next);return i}function compareX(t,e){return t.x-e.x}function eliminateHole(t,e){var i=findHoleBridge(t,e);if(!i)return e;var r=splitPolygon(i,t),n=filterPoints(i,i.next);return filterPoints(r,r.next),e===i?n:e}function findHoleBridge(t,e){var i,r=e,n=t.x,s=t.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>o){if(o=a,a===n){if(s===r.y)return r;if(s===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!i)return null;if(n===o)return i;var h,l=i,u=i.x,c=i.y,d=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&pointInTriangle(s<c?n:o,s,u,c,s<c?o:n,s,r.x,r.y)&&(h=Math.abs(s-r.y)/(n-r.x),locallyInside(r,t)&&(h<d||h===d&&(r.x>i.x||r.x===i.x&&sectorContainsSector(i,r)))&&(i=r,d=h)),r=r.next}while(r!==l);return i}function sectorContainsSector(t,e){return area(t.prev,t,e.prev)<0&&area(e.next,t,t.next)<0}function indexCurve(t,e,i,r){var n=t;do{null===n.z&&(n.z=zOrder(n.x,n.y,e,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,sortLinked(n)}function sortLinked(t){var e,i,r,n,s,o,a,h,l=1;do{for(i=t,t=null,s=null,o=0;i;){for(o++,r=i,a=0,e=0;e<l&&(a++,r=r.nextZ);e++);for(h=l;a>0||h>0&&r;)0!==a&&(0===h||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,h--),s?s.nextZ=n:t=n,n.prevZ=s,s=n;i=r}s.nextZ=null,l*=2}while(o>1);return t}function zOrder(t,e,i,r,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function getLeftmost(t){var e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function pointInTriangle(t,e,i,r,n,s,o,a){return(n-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(r-a)-(i-o)*(e-a)>=0&&(i-o)*(s-a)-(n-o)*(r-a)>=0}function isValidDiagonal(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!intersectsPolygon(t,e)&&(locallyInside(t,e)&&locallyInside(e,t)&&middleInside(t,e)&&(area(t.prev,t,e.prev)||area(t,e.prev,e))||equals(t,e)&&area(t.prev,t,t.next)>0&&area(e.prev,e,e.next)>0)}function area(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function equals(t,e){return t.x===e.x&&t.y===e.y}function intersects(t,e,i,r){var n=sign(area(t,e,i)),s=sign(area(t,e,r)),o=sign(area(i,r,t)),a=sign(area(i,r,e));return n!==s&&o!==a||!(0!==n||!onSegment(t,i,e))||!(0!==s||!onSegment(t,r,e))||!(0!==o||!onSegment(i,t,r))||!(0!==a||!onSegment(i,e,r))}function onSegment(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function sign(t){return t>0?1:t<0?-1:0}function intersectsPolygon(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&intersects(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function locallyInside(t,e){return area(t.prev,t,t.next)<0?area(t,e,t.next)>=0&&area(t,t.prev,e)>=0:area(t,e,t.prev)<0||area(t,t.next,e)<0}function middleInside(t,e){var i=t,r=!1,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==t);return r}function splitPolygon(t,e){var i=new Node$1(t.i,t.x,t.y),r=new Node$1(e.i,e.x,e.y),n=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function insertNode(t,e,i,r){var n=new Node$1(t,e,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function removeNode(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Node$1(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(t,e,i,r){for(var n=0,s=e,o=i-r;s<i;s+=r)n+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return n}earcut$2.exports=earcut,earcut$2.exports.default=earcut,earcut.deviation=function(t,e,i,r){var n=e&&e.length,s=n?e[0]*i:t.length,o=Math.abs(signedArea(t,0,s,i));if(n)for(var a=0,h=e.length;a<h;a++){var l=e[a]*i,u=a<h-1?e[a+1]*i:t.length;o-=Math.abs(signedArea(t,l,u,i))}var c=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,p=r[a+1]*i,f=r[a+2]*i;c+=Math.abs((t[d]-t[f])*(t[p+1]-t[d+1])-(t[d]-t[p])*(t[f+1]-t[d+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},earcut.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},r=0,n=0;n<t.length;n++){for(var s=0;s<t[n].length;s++)for(var o=0;o<e;o++)i.vertices.push(t[n][s][o]);n>0&&(r+=t[n-1].length,i.holes.push(r))}return i};var earcut$1=earcut$2.exports;!function(){function t(t,e,i){Object.keys(i).forEach((function(r){if(e[r]=i[r],"function"!=typeof i[r])throw new TypeError("extend: Method `"+r+"` is not a function");Object.defineProperty(t.prototype,r,{configurable:!0,value:i[r]})}))}function e(t,e,i){return t.prototype[e].apply(this,i)}var i=function(){Object.apply(this,arguments)};(i.prototype=Object.create(Object.prototype)).constructor=i,Object.defineProperty(i,"extend",{value:function i(){for(var r={},n=new Array(arguments.length),s=0;s<arguments.length;s++)n.push(arguments[s]);function o(){return this.init.apply(this,arguments),this}if(o.prototype=Object.create(this.prototype),n.forEach((function(e){t(o,r,e.__methods__||e)})),!("init"in o.prototype))throw new TypeError("extend: Class is missing a constructor named `init`");return Object.defineProperty(o.prototype,"_super",{value:e}),Object.defineProperty(o,"__methods__",{value:r}),o.extend=i,o}}),"undefined"!=typeof window&&(window.Jay=i)}();var Polygon=window.Jay.extend({init:function(t,e,i){this.pos=new Vector2d,this._bounds,this.points=null,this.edges=[],this.indices=[],this.normals=[],this.shapeType="Polygon",this.setShape(t,e,i)},onResetEvent:function(t,e,i){this.setShape(t,e,i)},setShape:function(t,e,i){return this.pos.set(t,e),this.setVertices(i),this},setVertices:function(t){if(!Array.isArray(t))return this;if(t[0]instanceof Vector2d)this.points=t;else{var e=this.points=[];if("object"==typeof t[0])t.forEach((function(t){e.push(new Vector2d(t.x,t.y))}));else for(var i=0;i<t.length;i+=2)e.push(new Vector2d(t[i],t[i+1]))}return this.recalc(),this.updateBounds(),this},transform:function(t){for(var e=this.points,i=e.length,r=0;r<i;r++)t.apply(e[r]);return this.recalc(),this.updateBounds(),this},toIso:function(){return this.rotate(Math.PI/4).scale(Math.SQRT2,Math.SQRT1_2)},to2d:function(){return this.scale(Math.SQRT1_2,Math.SQRT2).rotate(-Math.PI/4)},rotate:function(t,e){if(0!==t){for(var i=this.points,r=i.length,n=0;n<r;n++)i[n].rotate(t,e);this.recalc(),this.updateBounds()}return this},scale:function(t,e){e=void 0!==e?e:t;for(var i=this.points,r=i.length,n=0;n<r;n++)i[n].scale(t,e);return this.recalc(),this.updateBounds(),this},scaleV:function(t){return this.scale(t.x,t.y)},recalc:function(){var t,e=this.edges,i=this.normals,r=this.indices,n=this.points,s=n.length;if(s<3)throw new Error("Requires at least 3 points");for(t=0;t<s;t++)void 0===e[t]&&(e[t]=new Vector2d),e[t].copy(n[(t+1)%s]).sub(n[t]),void 0===i[t]&&(i[t]=new Vector2d),i[t].copy(e[t]).perp().normalize();return e.length=s,i.length=s,r.length=0,this},getIndices:function(t,e){return 0===this.indices.length&&(this.indices=earcut$1(this.points.flatMap((t=>[t.x,t.y])))),this.indices},translate:function(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this},contains:function(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);for(var i=!1,r=this.pos.x,n=this.pos.y,s=this.points,o=s.length,a=0,h=o-1;a<o;h=a++){var l=s[a].y+n,u=s[a].x+r,c=s[h].y+n,d=s[h].x+r;l>e!=c>e&&t<(d-u)*(e-l)/(c-l)+u&&(i=!i)}return i},getBounds:function(){return void 0===this._bounds&&(this._bounds=pool.pull("Bounds")),this._bounds},updateBounds:function(){var t=this.getBounds();return t.update(this.points),t.translate(this.pos),t},clone:function(){var t=[];return this.points.forEach((function(e){t.push(e.clone())})),new Polygon(this.pos.x,this.pos.y,t)}}),Rect=Polygon.extend({init:function(t,e,i,r){this._super(Polygon,"init",[t,e,[new Vector2d(0,0),new Vector2d(i,0),new Vector2d(i,r),new Vector2d(0,r)]]),this.shapeType="Rectangle"},onResetEvent:function(t,e,i,r){this.setShape(t,e,i,r)},setShape:function(t,e,i,r){var n=i;return this.pos.set(t,e),4===arguments.length&&((n=this.points)[0].set(0,0),n[1].set(i,0),n[2].set(i,r),n[3].set(0,r)),this.setVertices(n),this},resize:function(t,e){return this.width=t,this.height=e,this},scale:function(t,e=t){return this.width*=t,this.height*=e,this},clone:function(){return new Rect(this.pos.x,this.pos.y,this.width,this.height)},copy:function(t){return this.setShape(t.pos.x,t.pos.y,t.width,t.height)},translate:function(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this},shift:function(){2===arguments.length?this.pos.set(arguments[0],arguments[1]):this.pos.setV(arguments[0])},union:function(t){var e=Math.min(this.left,t.left),i=Math.min(this.top,t.top);return this.resize(Math.max(this.right,t.right)-e,Math.max(this.bottom,t.bottom)-i),this.pos.set(e,i),this},overlaps:function(t){return this.left<t.right&&t.left<this.right&&this.top<t.bottom&&t.top<this.bottom},contains:function(){var t,e,i,r,n=arguments[0];return 2===arguments.length?(t=e=n,i=r=arguments[1]):n instanceof Rect?(t=n.left,e=n.right,i=n.top,r=n.bottom):(t=e=n.x,i=r=n.y),t>=this.left&&e<=this.right&&i>=this.top&&r<=this.bottom},equals:function(t){return t.left===this.left&&t.right===this.right&&t.top===this.top&&t.bottom===this.bottom},isFinite:function(){return isFinite(this.pos.x)&&isFinite(this.pos.y)&&isFinite(this.width)&&isFinite(this.height)},toPolygon:function(){return new Polygon(this.pos.x,this.pos.y,this.points)}});Object.defineProperty(Rect.prototype,"left",{get:function(){return this.pos.x},configurable:!0}),Object.defineProperty(Rect.prototype,"right",{get:function(){var t=this.width;return this.pos.x+t||t},configurable:!0}),Object.defineProperty(Rect.prototype,"top",{get:function(){return this.pos.y},configurable:!0}),Object.defineProperty(Rect.prototype,"bottom",{get:function(){var t=this.height;return this.pos.y+t||t},configurable:!0}),Object.defineProperty(Rect.prototype,"width",{get:function(){return this.points[2].x},set:function(t){this.points[1].x=this.points[2].x=t,this.recalc(),this.updateBounds()},configurable:!0}),Object.defineProperty(Rect.prototype,"height",{get:function(){return this.points[2].y},set:function(t){this.points[2].y=this.points[3].y=t,this.recalc(),this.updateBounds()},configurable:!0}),Object.defineProperty(Rect.prototype,"centerX",{get:function(){return isFinite(this.width)?this.pos.x+this.width/2:this.width},set:function(t){this.pos.x=t-this.width/2},configurable:!0}),Object.defineProperty(Rect.prototype,"centerY",{get:function(){return isFinite(this.height)?this.pos.y+this.height/2:this.height},set:function(t){this.pos.y=t-this.height/2},configurable:!0});var _keyStatus={},_keyLock={},_keyLocked={},_keyRefs={},_preventDefaultForKeys={},_keyBindings={},keyDownEvent=function(t,e,i){e=e||t.keyCode||t.button;var r=_keyBindings[e];if(event.publish(event.KEYDOWN,[r,e,!r||!_keyLocked[r]]),r){if(!_keyLocked[r]){var n=void 0!==i?i:e;_keyRefs[r][n]||(_keyStatus[r]++,_keyRefs[r][n]=!0)}return!_preventDefaultForKeys[e]||"function"!=typeof t.preventDefault||t.preventDefault()}return!0},keyUpEvent=function(t,e,i){e=e||t.keyCode||t.button;var r=_keyBindings[e];if(event.publish(event.KEYUP,[r,e]),r){var n=void 0!==i?i:e;return _keyRefs[r][n]=void 0,_keyStatus[r]>0&&_keyStatus[r]--,_keyLocked[r]=!1,!_preventDefaultForKeys[e]||"function"!=typeof t.preventDefault||t.preventDefault()}return!0},keyBoardEventTarget=null,KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:42,INSERT:45,DELETE:46,NUM0:48,NUM1:49,NUM2:50,NUM3:51,NUM4:52,NUM5:53,NUM6:54,NUM7:55,NUM8:56,NUM9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOW_KEY:91,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBSTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,TILDE:126,NUM_LOCK:144,SCROLL_LOCK:145,SEMICOLON:186,PLUS:187,COMMA:188,MINUS:189,PERIOD:190,FORWAND_SLASH:191,GRAVE_ACCENT:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRACKET:221,SINGLE_QUOTE:222};function initKeyboardEvent(){null===keyBoardEventTarget&&!1===device$1.isMobile&&((keyBoardEventTarget=window).addEventListener("keydown",keyDownEvent,!1),keyBoardEventTarget.addEventListener("keyup",keyUpEvent,!1))}function isKeyPressed(t){return!(!_keyStatus[t]||_keyLocked[t]||(_keyLock[t]&&(_keyLocked[t]=!0),0))}function keyStatus(t){return _keyStatus[t]>0}function triggerKeyEvent(t,e,i){!0===e?keyDownEvent({},t,i):keyUpEvent({},t,i)}function bindKey(t,e,i,r=preventDefault){_keyBindings[t]=e,_preventDefaultForKeys[t]=r,_keyStatus[e]=0,_keyLock[e]=i||!1,_keyLocked[e]=!1,_keyRefs[e]={}}function getBindingKey(t){return _keyBindings[t]}function unlockKey(t){_keyLocked[t]=!1}function unbindKey(t){var e=_keyBindings[t];_keyStatus[e]=0,_keyLock[e]=!1,_keyRefs[e]={},_keyBindings[t]=null,_preventDefaultForKeys[t]=null}var viewportOffset=new Vector2d,Pointer=Rect.extend({init:function(t=0,e=0,i=1,r=1){this.LEFT=0,this.MIDDLE=1,this.RIGHT=2,this.event=void 0,this.type=void 0,this.button=0,this.isPrimary=!1,this.pageX=0,this.pageY=0,this.clientX=0,this.clientY=0,this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0,this.gameX=0,this.gameY=0,this.gameScreenX=0,this.gameScreenY=0,this.gameWorldX=0,this.gameWorldY=0,this.gameLocalX=0,this.gameLocalY=0,this.pointerId=void 0,this.bind=[0,0,0],this._super(Rect,"init",[t,e,i,r])},setEvent:function(t,e=0,i=0,r=0,n=0,s=1){var o=1,a=1;this.event=t,this.pageX=e,this.pageY=i,this.clientX=r,this.clientY=n,globalToLocal(this.pageX,this.pageY,this.pos),this.isNormalized=!device$1.PointerEvent||device$1.PointerEvent&&!(t instanceof window.PointerEvent),"wheel"===t.type?(this.deltaMode=t.deltaMode||0,this.deltaX=t.deltaX||0,this.deltaY=t.deltaY||0,this.deltaZ=t.deltaZ||0):(this.deltaMode=0,this.deltaX=0,this.deltaY=0,this.deltaZ=0),this.pointerId=s,this.isPrimary=void 0===t.isPrimary||t.isPrimary,this.button=t.button||0,this.type=t.type,this.gameScreenX=this.pos.x,this.gameScreenY=this.pos.y,void 0!==game$1.viewport&&game$1.viewport.localToWorld(this.gameScreenX,this.gameScreenY,viewportOffset),this.gameWorldX=viewportOffset.x,this.gameWorldY=viewportOffset.y,!1===this.isNormalized?(o=t.width||1,a=t.height||1):"number"==typeof t.radiusX&&(o=2*t.radiusX||1,a=2*t.radiusY||1),this.resize(o,a)}}),T_POINTERS=[],eventHandlers=new Map,currentPointer,pointerInitialized=!1,lastTimeStamp=0,activeEventList=[],WHEEL=["wheel"],POINTER_MOVE=["pointermove","mousemove","touchmove"],POINTER_DOWN=["pointerdown","mousedown","touchstart"],POINTER_UP=["pointerup","mouseup","touchend"],POINTER_CANCEL=["pointercancel","mousecancel","touchcancel"],POINTER_ENTER=["pointerenter","mouseenter","touchenter"],POINTER_OVER=["pointerover","mouseover","touchover"],POINTER_LEAVE=["pointerleave","mouseleave","touchleave"],pointerEventList=[WHEEL[0],POINTER_MOVE[0],POINTER_DOWN[0],POINTER_UP[0],POINTER_CANCEL[0],POINTER_ENTER[0],POINTER_OVER[0],POINTER_LEAVE[0]],mouseEventList=[WHEEL[0],POINTER_MOVE[1],POINTER_DOWN[1],POINTER_UP[1],POINTER_CANCEL[1],POINTER_ENTER[1],POINTER_OVER[1],POINTER_LEAVE[1]],touchEventList=[POINTER_MOVE[2],POINTER_DOWN[2],POINTER_UP[2],POINTER_CANCEL[2],POINTER_ENTER[2],POINTER_OVER[2],POINTER_LEAVE[2]],pointerEventMap={wheel:WHEEL,pointermove:POINTER_MOVE,pointerdown:POINTER_DOWN,pointerup:POINTER_UP,pointercancel:POINTER_CANCEL,pointerenter:POINTER_ENTER,pointerover:POINTER_OVER,pointerleave:POINTER_LEAVE},normalizedEvents=[];function registerEventListener(t,e){for(var i=0;i<t.length;i++)-1===POINTER_MOVE.indexOf(t[i])&&pointerEventTarget.addEventListener(t[i],e,{passive:!1===preventDefault})}function enablePointerEvent(){if(!pointerInitialized){currentPointer=new Rect(0,0,1,1),pointer=new Pointer(0,0,1,1);for(var t=0;t<device$1.maxTouchPoints;t++)T_POINTERS.push(new Pointer);var e;null===pointerEventTarget&&(pointerEventTarget=video$1.renderer.getScreenCanvas()),activeEventList=device$1.PointerEvent?pointerEventList:mouseEventList,device$1.touch&&!device$1.PointerEvent&&(activeEventList=activeEventList.concat(touchEventList)),registerEventListener(activeEventList,onPointerEvent),void 0===throttlingInterval&&(throttlingInterval=~~(1e3/timer$1.maxfps)),!0===device$1.autoFocus&&(device$1.focus(),pointerEventTarget.addEventListener(activeEventList[2],(function(){device$1.focus()}),{passive:!1===preventDefault}));var i=findAllActiveEvents(activeEventList,POINTER_MOVE);if(throttlingInterval<17)for(e=0;e<i.length;e++)-1!==activeEventList.indexOf(i[e])&&pointerEventTarget.addEventListener(i[e],onMoveEvent,{passive:!0});else for(e=0;e<i.length;e++)-1!==activeEventList.indexOf(i[e])&&pointerEventTarget.addEventListener(i[e],utils$1.function.throttle(onMoveEvent,throttlingInterval,!1),{passive:!0});setTouchAction(pointerEventTarget),pointerInitialized=!0}}function findActiveEvent(t,e){for(var i=0;i<e.length;i++)if(-1!==t.indexOf(e[i]))return e[i]}function findAllActiveEvents(t,e){for(var i=[],r=0;r<e.length;r++)-1!==t.indexOf(e[r])&&i.push(e[r]);return i}function triggerEvent(t,e,i,r){var n;if(t.callbacks[e]){t.pointerId=r;for(var s=t.callbacks[e].length-1;s>=0&&(n=t.callbacks[e][s]);s--)if(!1===n(i))return!0}return!1}function dispatchEvent(t){for(var e=!1;t.length>0;){var i=t.pop();if(T_POINTERS.push(i),void 0!==i.event.timeStamp){if(i.event.timeStamp<lastTimeStamp)continue;lastTimeStamp=i.event.timeStamp}currentPointer.setShape(i.gameWorldX,i.gameWorldY,i.width,i.height),POINTER_MOVE.includes(i.type)&&(i.gameX=i.gameLocalX=i.gameScreenX,i.gameY=i.gameLocalY=i.gameScreenY,event.publish(event.POINTERMOVE,[i]));for(var r,n=game$1.world.broadphase.retrieve(currentPointer,Container$1.prototype._sortReverseZ),s=(n=n.concat([game$1.viewport])).length;r=n[--s];){if(eventHandlers.has(r)&&!0!==r.isKinematic){var o=eventHandlers.get(r),a=o.region,h=a.ancestor,l=a.getBounds(),u=!1;if(!0===a.floating?(i.gameX=i.gameLocalX=i.gameScreenX,i.gameY=i.gameLocalY=i.gameScreenY):(i.gameX=i.gameLocalX=i.gameWorldX,i.gameY=i.gameLocalY=i.gameWorldY),void 0!==h){var c=h.getBounds();i.gameLocalX=i.gameX-c.x,i.gameLocalY=i.gameY-c.y}if(a instanceof Renderable){var d=i.gameX,p=i.gameY;if(!a.currentTransform.isIdentity()){var f=a.currentTransform.applyInverse(pool.pull("Vector2d",d,p));d=f.x,p=f.y,pool.push(f)}u=l.contains(d,p)}else u=l.contains(i.gameX,i.gameY)&&(l===a||a.contains(i.gameLocalX,i.gameLocalY));switch(i.type){case POINTER_MOVE[0]:case POINTER_MOVE[1]:case POINTER_MOVE[2]:case POINTER_MOVE[3]:if(o.pointerId!==i.pointerId||u){if(null===o.pointerId&&u&&triggerEvent(o,findActiveEvent(activeEventList,POINTER_ENTER),i,i.pointerId)){e=!0;break}}else if(triggerEvent(o,findActiveEvent(activeEventList,POINTER_LEAVE),i,null)){e=!0;break}if(u&&triggerEvent(o,i.type,i,i.pointerId)){e=!0;break}break;case POINTER_UP[0]:case POINTER_UP[1]:case POINTER_UP[2]:case POINTER_UP[3]:if(o.pointerId===i.pointerId&&u&&triggerEvent(o,i.type,i,null)){e=!0;break}break;case POINTER_CANCEL[0]:case POINTER_CANCEL[1]:case POINTER_CANCEL[2]:case POINTER_CANCEL[3]:if(o.pointerId===i.pointerId&&triggerEvent(o,i.type,i,null)){e=!0;break}break;default:if(u&&triggerEvent(o,i.type,i,i.pointerId)){e=!0;break}}}if(!0===e)break}}return e}function normalizeEvent(t){var e;if(device$1.TouchEvent&&t.changedTouches)for(var i=0,r=t.changedTouches.length;i<r;i++){var n=t.changedTouches[i];(e=T_POINTERS.pop()).setEvent(t,n.pageX,n.pageY,n.clientX,n.clientY,n.identifier),normalizedEvents.push(e)}else(e=T_POINTERS.pop()).setEvent(t,t.pageX,t.pageY,t.clientX,t.clientY,t.pointerId),normalizedEvents.push(e);return!1===t.isPrimary||(normalizedEvents[0].isPrimary=!0,Object.assign(e,normalizedEvents[0])),normalizedEvents}function onMoveEvent(t){dispatchEvent(normalizeEvent(t))}function onPointerEvent(t){normalizeEvent(t);var e=normalizedEvents[0].button;(dispatchEvent(normalizedEvents)||"wheel"===t.type)&&t.preventDefault();var i=pointer.bind[e];i&&triggerKeyEvent(i,POINTER_DOWN.includes(t.type),e+1)}var pointerEventTarget=null,pointer,throttlingInterval;function globalToLocal(t,e,i){i=i||new Vector2d;var r=device$1.getElementBounds(video$1.renderer.getScreenCanvas()),n=device$1.devicePixelRatio;t-=r.left+(window.pageXOffset||0),e-=r.top+(window.pageYOffset||0);var s=video$1.scaleRatio;return 1===s.x&&1===s.y||(t/=s.x,e/=s.y),i.set(t*n,e*n)}function setTouchAction(t,e){t.style["touch-action"]=e||"none"}function bindPointer(){var t=arguments.length<2?pointer.LEFT:arguments[0],e=arguments.length<2?arguments[0]:arguments[1];if(enablePointerEvent(),!getBindingKey(e))throw new Error("no action defined for keycode "+e);pointer.bind[t]=e}function unbindPointer(t){pointer.bind[void 0===t?pointer.LEFT:t]=null}function registerPointerEvent(t,e,i){if(enablePointerEvent(),-1===pointerEventList.indexOf(t))throw new Error("invalid event type : "+t);if(void 0===e)throw new Error("registerPointerEvent: region for "+toString(e)+" event is undefined ");var r=findAllActiveEvents(activeEventList,pointerEventMap[t]);eventHandlers.has(e)||eventHandlers.set(e,{region:e,callbacks:{},pointerId:null});for(var n=eventHandlers.get(e),s=0;s<r.length;s++)t=r[s],n.callbacks[t]?n.callbacks[t].push(i):n.callbacks[t]=[i]}function releasePointerEvent(t,e,i){if(-1===pointerEventList.indexOf(t))throw new Error("invalid event type : "+t);var r=findAllActiveEvents(activeEventList,pointerEventMap[t]),n=eventHandlers.get(e);if(void 0!==n){for(var s=0;s<r.length;s++)if(t=r[s],n.callbacks[t]){if(void 0!==i)utils$1.array.remove(n.callbacks[t],i);else for(;n.callbacks[t].length>0;)n.callbacks[t].pop();0===n.callbacks[t].length&&delete n.callbacks[t]}0===Object.keys(n.callbacks).length&&eventHandlers.delete(e)}}function releaseAllPointerEvents(t){if(eventHandlers.has(t))for(var e=0;e<pointerEventList.length;e++)this.releasePointerEvent(pointerEventList[e],t)}var deadzone=.1;function defaultNormalizeFn(t){return t}function wiredXbox360NormalizeFn(t,e,i){return i===this.GAMEPAD.BUTTONS.L2||i===this.GAMEPAD.BUTTONS.R2?(t+1)/2:t}function ouyaNormalizeFn(t,e,i){return t>0?i===this.GAMEPAD.BUTTONS.L2?Math.max(0,t-2e4)/111070:(t-1)/131070:(65536+t)/131070+.5}var vendorProductRE=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-/i,leadingZeroRE=/^0+/;function addMapping(t,e){var i=t.replace(vendorProductRE,(function(t,e,i){return"000".substr(e.length-1)+e+"-"+"000".substr(i.length-1)+i+"-"})),r=t.replace(vendorProductRE,(function(t,e,i){return e.replace(leadingZeroRE,"")+"-"+i.replace(leadingZeroRE,"")+"-"}));e.analog=e.analog||e.buttons.map((function(){return-1})),e.normalize_fn=e.normalize_fn||defaultNormalizeFn,remap.set(i,e),remap.set(r,e)}var bindings={},remap=new Map,updateEventHandler;[["45e-28e-Xbox 360 Wired Controller",{axes:[0,1,3,4],buttons:[11,12,13,14,8,9,-1,-1,5,4,6,7,0,1,2,3,10],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:wiredXbox360NormalizeFn}],["54c-268-PLAYSTATION(R)3 Controller",{axes:[0,1,2,3],buttons:[14,13,15,12,10,11,8,9,0,3,1,2,4,6,7,5,16]}],["54c-5c4-Wireless Controller",{axes:[0,1,2,3],buttons:[1,0,2,3,4,5,6,7,8,9,10,11,14,15,16,17,12,13]}],["2836-1-OUYA Game Controller",{axes:[0,3,7,9],buttons:[3,6,4,5,7,8,15,16,-1,-1,9,10,11,12,13,14,-1],analog:[-1,-1,-1,-1,-1,-1,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:ouyaNormalizeFn}],["OUYA Game Controller (Vendor: 2836 Product: 0001)",{axes:[0,1,3,4],buttons:[0,3,1,2,4,5,12,13,-1,-1,6,7,8,9,10,11,-1],analog:[-1,-1,-1,-1,-1,-1,2,5,-1,-1,-1,-1,-1,-1,-1,-1,-1],normalize_fn:ouyaNormalizeFn}]].forEach((function(t){addMapping(t[0],t[1])}));var updateGamepads=function(){var t=navigator.getGamepads();Object.keys(bindings).forEach((function(e){var i=t[e];if(i){var r=null;"standard"!==i.mapping&&(r=remap.get(i.id));var n=bindings[e];Object.keys(n.buttons).forEach((function(t){var s=n.buttons[t],o=t,a=-1;if(!(r&&(o=r.buttons[t],a=r.analog[t],o<0&&a<0))){var h=i.buttons[o]||{};if(r&&a>=0){var l=r.normalize_fn(i.axes[a],-1,+t);h={value:l,pressed:h.pressed||Math.abs(l)>=deadzone}}event.publish(event.GAMEPAD_UPDATE,[e,"buttons",+t,h]),!s.pressed&&h.pressed?triggerKeyEvent(s.keyCode,!0,o+256):s.pressed&&!h.pressed&&triggerKeyEvent(s.keyCode,!1,o+256),s.value=h.value,s.pressed=h.pressed}})),Object.keys(n.axes).forEach((function(t){var s=n.axes[t],o=t;if(!(r&&(o=r.axes[t])<0)){var a=i.axes[o];if(void 0!==a){r&&(a=r.normalize_fn(a,+t,-1));var h=Math.sign(a)||1;if(0!==s[h].keyCode){var l=Math.abs(a)>=deadzone+Math.abs(s[h].threshold);event.publish(event.GAMEPAD_UPDATE,[e,"axes",+t,a]),!s[h].pressed&&l?(s[-h].pressed&&(triggerKeyEvent(s[-h].keyCode,!1,o+256),s[-h].value=0,s[-h].pressed=!1),triggerKeyEvent(s[h].keyCode,!0,o+256)):!s[h].pressed&&!s[-h].pressed||l||triggerKeyEvent(s[h=s[h].pressed?h:-h].keyCode,!1,o+256),s[h].value=a,s[h].pressed=l}}}}))}}))};window.addEventListener("gamepadconnected",(function(t){event.publish(event.GAMEPAD_CONNECTED,[t.gamepad])}),!1),window.addEventListener("gamepaddisconnected",(function(t){event.publish(event.GAMEPAD_DISCONNECTED,[t.gamepad])}),!1);var GAMEPAD={AXES:{LX:0,LY:1,RX:2,RY:3,EXTRA_1:4,EXTRA_2:5,EXTRA_3:6,EXTRA_4:7},BUTTONS:{FACE_1:0,FACE_2:1,FACE_3:2,FACE_4:3,L1:4,R1:5,L2:6,R2:7,SELECT:8,BACK:8,START:9,FORWARD:9,L3:10,R3:11,UP:12,DOWN:13,LEFT:14,RIGHT:15,HOME:16,EXTRA_1:17,EXTRA_2:18,EXTRA_3:19,EXTRA_4:20}};function bindGamepad(t,e,i){if(!getBindingKey(i))throw new Error("no action defined for keycode "+i);void 0===updateEventHandler&&"function"==typeof navigator.getGamepads&&(updateEventHandler=event.subscribe(event.GAME_UPDATE,updateGamepads)),bindings[t]||(bindings[t]={axes:{},buttons:{}});var r={keyCode:i,value:0,pressed:!1,threshold:e.threshold},n=bindings[t][e.type];if("buttons"===e.type)n[e.code]=r;else if("axes"===e.type){var s=Math.sign(e.threshold)||1;n[e.code]||(n[e.code]={});var o=n[e.code];o[s]=r,o[-s]||(o[-s]={keyCode:0,value:0,pressed:!1,threshold:-s})}}function unbindGamepad(t,e){if(!bindings[t])throw new Error("no bindings for gamepad "+t);bindings[t].buttons[e]={}}function setGamepadDeadzone(t){deadzone=t}var setGamepadMapping=addMapping,preventDefault=!0,input=Object.freeze({__proto__:null,preventDefault,get pointerEventTarget(){return pointerEventTarget},get pointer(){return pointer},get throttlingInterval(){return throttlingInterval},globalToLocal,setTouchAction,bindPointer,unbindPointer,registerPointerEvent,releasePointerEvent,releaseAllPointerEvents,get keyBoardEventTarget(){return keyBoardEventTarget},KEY,initKeyboardEvent,isKeyPressed,keyStatus,triggerKeyEvent,bindKey,getBindingKey,unlockKey,unbindKey,GAMEPAD,bindGamepad,unbindGamepad,setGamepadDeadzone,setGamepadMapping}),Renderable=Rect.extend({init:function(t,e,i,r){this._super(Rect,"init",[t,e,i,r]),this.isRenderable=!0,this.isKinematic=!0,this.body=void 0,void 0===this.currentTransform&&(this.currentTransform=pool.pull("Matrix2d")),this.currentTransform.identity(),this.GUID=void 0,this.onVisibilityChange=void 0,this.alwaysUpdate=!1,this.updateWhenPaused=!1,this.isPersistent=!1,this.floating=!1,this.anchorPoint instanceof ObservableVector2d?this.anchorPoint.setMuted(.5,.5).setCallback(this.onAnchorUpdate,this):this.anchorPoint=pool.pull("ObservableVector2d",.5,.5,{onUpdate:this.onAnchorUpdate,scope:this}),this.autoTransform=!0,this.alpha=1,this.ancestor=void 0,this.mask=void 0,this.tint=pool.pull("Color",255,255,255,1),this.name="",this.pos instanceof ObservableVector3d?this.pos.setMuted(t,e,0).setCallback(this.updateBoundsPos,this):this.pos=pool.pull("ObservableVector3d",t,e,0,{onUpdate:this.updateBoundsPos,scope:this}),this.isDirty=!1,this._flip={x:!1,y:!1},this._inViewport=!1,this.setOpacity(1)},onResetEvent:function(){this.init.apply(this,arguments)},getBounds:function(){return void 0===this._bounds&&(this._super(Rect,"getBounds"),this.isFinite()?this._bounds.setMinMax(this.pos.x,this.pos.y,this.pos.x+this.width,this.pos.y+this.height):this._bounds.setMinMax(this.pos.x,this.pos.y,this.width,this.height)),this._bounds},getOpacity:function(){return this.alpha},setOpacity:function(t){"number"==typeof t&&(this.alpha=clamp(t,0,1),isNaN(this.alpha)&&(this.alpha=1))},flipX:function(t){return this._flip.x=!!t,this.isDirty=!0,this},flipY:function(t){return this._flip.y=!!t,this.isDirty=!0,this},transform:function(t){return this.currentTransform.multiply(t),this.updateBoundsPos(this.pos.x,this.pos.y),this.isDirty=!0,this},angleTo:function(t){var e,i,r=this.getBounds();if(t instanceof Renderable){var n=t.getBounds();e=n.centerX-r.centerX,i=n.centerY-r.centerY}else e=t.x-r.centerX,i=t.y-r.centerY;return Math.atan2(i,e)},distanceTo:function(t){var e,i,r=this.getBounds();if(t instanceof Renderable){var n=t.getBounds();e=r.centerX-n.centerX,i=r.centerY-n.centerY}else e=r.centerX-t.x,i=r.centerY-t.y;return Math.sqrt(e*e+i*i)},lookAt:function(t){var e;e=t instanceof Renderable?t.pos:t;var i=this.angleTo(e);return this.rotate(i),this},rotate:function(t){return isNaN(t)||(this.currentTransform.rotate(t),this.isDirty=!0),this},scale:function(t,e){return this.currentTransform.scale(t,e),this._super(Rect,"scale",[t,e]),this.isDirty=!0,this},scaleV:function(t){return this.scale(t.x,t.y),this},update:function(){return this.isDirty},updateBounds:function(){return this._super(Rect,"updateBounds"),this.updateBoundsPos(this.pos.x,this.pos.y),this.getBounds()},updateBoundsPos:function(t,e){var i=this.getBounds();i.shift(t,e),void 0!==this.anchorPoint&&i.isFinite()&&i.translate(-this.anchorPoint.x*i.width,-this.anchorPoint.y*i.height),this.ancestor instanceof Container$1&&!0!==this.floating&&i.translate(this.ancestor.getAbsolutePosition())},getAbsolutePosition:function(){return void 0===this._absPos&&(this._absPos=pool.pull("Vector2d")),this._absPos.set(this.pos.x,this.pos.y),this.ancestor instanceof Container$1&&!0!==this.floating&&this._absPos.add(this.ancestor.getAbsolutePosition()),this._absPos},onAnchorUpdate:function(t,e){this.anchorPoint.setMuted(t,e),this.updateBoundsPos(this.pos.x,this.pos.y)},preDraw:function(t){var e=this.getBounds(),i=e.width*this.anchorPoint.x,r=e.height*this.anchorPoint.y;if(t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),this._flip.x||this._flip.y){var n=this._flip.x?this.centerX-i:0,s=this._flip.y?this.centerY-r:0;t.translate(n,s),t.scale(this._flip.x?-1:1,this._flip.y?-1:1),t.translate(-n,-s)}!0!==this.autoTransform||this.currentTransform.isIdentity()||(t.translate(this.pos.x,this.pos.y),t.transform(this.currentTransform),t.translate(-this.pos.x,-this.pos.y)),t.translate(-i,-r),void 0!==this.mask&&t.setMask(this.mask),t.setTint(this.tint)},draw:function(){},postDraw:function(t){void 0!==this.mask&&t.clearMask(),t.clearTint(),this.isDirty=!1,t.restore()},destroy:function(){pool.push(this.currentTransform),this.currentTransform=void 0,pool.push(this.anchorPoint),this.anchorPoint=void 0,pool.push(this.pos),this.pos=void 0,void 0!==this._absPos&&(pool.push(this._absPos),this._absPos=void 0),pool.push(this._bounds),this._bounds=void 0,this.onVisibilityChange=void 0,void 0!==this.mask&&(pool.push(this.mask),this.mask=void 0),void 0!==this.tint&&(pool.push(this.tint),this.tint=void 0),this.ancestor=void 0,void 0!==this.body&&(this.body.destroy.apply(this.body,arguments),this.body=void 0),releaseAllPointerEvents(this),this.onDestroyEvent.apply(this,arguments)},onDestroyEvent:function(){}});Object.defineProperty(Renderable.prototype,"inViewport",{get:function(){return this._inViewport},set:function(t){this._inViewport!==t&&(this._inViewport=t,"function"==typeof this.onVisibilityChange&&this.onVisibilityChange.call(this,t))},configurable:!0}),Object.defineProperty(Renderable.prototype,"isFlippedX",{get:function(){return!0===this._flip.x},configurable:!0}),Object.defineProperty(Renderable.prototype,"isFlippedY",{get:function(){return!0===this._flip.y},configurable:!0});var deferredRemove=function(t,e){this.removeChildNow(t,e)},globalFloatingCounter=0,Container=Renderable.extend({init:function(t=0,e=0,i=game$1.viewport.width,r=game$1.viewport.height,n=!1){this.pendingSort=null,this._super(Renderable,"init",[t,e,i,r]),this.root=n,this.children=void 0,this.sortOn=game$1.sortOn,this.autoSort=!0,this.autoDepth=!0,this.clipping=!1,this.onChildChange=function(){},this.enableChildBoundsUpdate=!1,this.drawCount=0,this.autoTransform=!0,this.isKinematic=!1,this.anchorPoint.set(0,0),!0===this.root&&event.subscribe(event.CANVAS_ONRESIZE,this.updateBounds.bind(this,!0))},reset:function(){this.pendingSort&&(clearTimeout(this.pendingSort),this.pendingSort=null);for(var t,e=this.getChildren(),i=e.length;i>=0;t=e[--i])t&&!0!==t.isPersistent&&this.removeChildNow(t);void 0!==this.currentTransform&&this.currentTransform.identity()},addChild:function(t,e){return t.ancestor instanceof Container?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=utils$1.createGUID(t.id)),t.ancestor=this,this.getChildren().push(t),void 0!==t.pos&&("number"==typeof e?t.pos.z=e:!0===this.autoDepth&&(t.pos.z=this.getChildren().length)),!0===this.autoSort&&this.sort(),"function"==typeof t.onActivateEvent&&this.isAttachedToRoot()&&t.onActivateEvent(),!0===this.isAttachedToRoot()&&game$1.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),this.onChildChange.call(this,this.getChildren().length-1),t},addChildAt:function(t,e){if(e>=0&&e<this.getChildren().length)return t.ancestor instanceof Container?t.ancestor.removeChildNow(t):t.isRenderable&&(t.GUID=utils$1.createGUID()),t.ancestor=this,this.getChildren().splice(e,0,t),"function"==typeof t.onActivateEvent&&this.isAttachedToRoot()&&t.onActivateEvent(),!0===this.isAttachedToRoot()&&game$1.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),this.onChildChange.call(this,e),t;throw new Error("Index ("+e+") Out Of Bounds for addChildAt()")},forEach:function(t,e){var i=this,r=0,n=this.getChildren(),s=n.length;if("function"!=typeof t)throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);r<s;)t.call(i,n[r],r,n),r++},swapChildren:function(t,e){var i=this.getChildIndex(t),r=this.getChildIndex(e);if(-1===i||-1===r)throw new Error(t+" Both the supplied childs must be a child of the caller "+this);var n=t.pos.z;t.pos.z=e.pos.z,e.pos.z=n,this.getChildren()[i]=e,this.getChildren()[r]=t},getChildAt:function(t){if(t>=0&&t<this.getChildren().length)return this.getChildren()[t];throw new Error("Index ("+t+") Out Of Bounds for getChildAt()")},getChildIndex:function(t){return this.getChildren().indexOf(t)},getNextChild:function(t){var e=this.getChildren().indexOf(t)-1;if(e>=0&&e<this.getChildren().length)return this.getChildAt(e)},hasChild:function(t){return this===t.ancestor},getChildByProp:function(t,e){var i=[];return this.forEach((r=>{!function(t,r){var n=t[r];e instanceof RegExp&&"string"==typeof n?e.test(n)&&i.push(t):n===e&&i.push(t)}(r,t),r instanceof Container&&(i=i.concat(r.getChildByProp(t,e)))})),i},getChildByType:function(t){var e=[];return this.forEach((i=>{i instanceof t&&e.push(i),i instanceof Container&&(e=e.concat(i.getChildByType(t)))})),e},getChildByName:function(t){return this.getChildByProp("name",t)},getChildByGUID:function(t){var e=this.getChildByProp("GUID",t);return e.length>0?e[0]:null},getChildren:function(){return void 0===this.children&&(this.children=[]),this.children},updateBounds:function(t=!1){this._super(Renderable,"updateBounds");var e=this.getBounds();return!0!==t&&!0!==this.enableChildBoundsUpdate||this.forEach((t=>{t.isRenderable&&t.getBounds().isFinite()&&e.addBounds(t.getBounds())})),e},isAttachedToRoot:function(){if(!0===this.root)return!0;for(var t=this.ancestor;t;){if(!0===t.root)return!0;t=t.ancestor}return!1},updateBoundsPos:function(t,e){return this._super(Renderable,"updateBoundsPos",[t,e]),this.forEach((i=>{i.isRenderable&&i.updateBoundsPos(i.pos.x+t-this.pos.x,i.pos.y+e-this.pos.y)})),this.getBounds()},onActivateEvent:function(){this.forEach((t=>{"function"==typeof t.onActivateEvent&&t.onActivateEvent()}))},removeChild:function(t,e){if(!this.hasChild(t))throw new Error("Child is not mine.");utils$1.function.defer(deferredRemove,this,t,e)},removeChildNow:function(t,e){if(this.hasChild(t)&&this.getChildIndex(t)>=0){"function"==typeof t.onDeactivateEvent&&t.onDeactivateEvent(),e||("function"==typeof t.destroy&&t.destroy(),pool.push(t));var i=this.getChildIndex(t);i>=0&&(this.getChildren().splice(i,1),t.ancestor=void 0),!0===this.isAttachedToRoot()&&game$1.repaint(),this.enableChildBoundsUpdate&&this.updateBounds(!0),this.onChildChange.call(this,i)}},setChildsProperty:function(t,e,i){this.forEach((r=>{!0===i&&r instanceof Container&&r.setChildsProperty(t,e,i),r[t]=e}))},moveUp:function(t){var e=this.getChildIndex(t);e-1>=0&&this.swapChildren(t,this.getChildAt(e-1))},moveDown:function(t){var e=this.getChildIndex(t);e>=0&&e+1<this.getChildren().length&&this.swapChildren(t,this.getChildAt(e+1))},moveToTop:function(t){var e=this.getChildIndex(t);if(e>0){var i=this.getChildren();i.splice(0,0,i.splice(e,1)[0]),t.pos.z=i[1].pos.z+1}},moveToBottom:function(t){var e=this.getChildIndex(t),i=this.getChildren();e>=0&&e<i.length-1&&(i.splice(i.length-1,0,i.splice(e,1)[0]),t.pos.z=i[i.length-2].pos.z-1)},sort:function(t){this.pendingSort||(!0===t&&this.forEach((e=>{e instanceof Container&&e.sort(t)})),this.pendingSort=utils$1.function.defer((function(t){t.getChildren().sort(t["_sort"+t.sortOn.toUpperCase()]),t.pendingSort=null,game$1.repaint()}),this,this))},onDeactivateEvent:function(){this.forEach((t=>{"function"==typeof t.onDeactivateEvent&&t.onDeactivateEvent()}))},_sortZ:function(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z:t.pos?-1/0:1/0},_sortReverseZ:function(t,e){return t.pos&&e.pos?t.pos.z-e.pos.z:t.pos?1/0:-1/0},_sortX:function(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z||e.pos.x-t.pos.x:t.pos?-1/0:1/0},_sortY:function(t,e){return e.pos&&t.pos?e.pos.z-t.pos.z||e.pos.y-t.pos.y:t.pos?-1/0:1/0},destroy:function(){this.reset(),this._super(Renderable,"destroy",arguments)},update:function(t){this._super(Renderable,"update",[t]);for(var e,i=!1,r=!1,n=state$1.isPaused(),s=this.getChildren(),o=s.length;o--,e=s[o];)n&&!e.updateWhenPaused||(e.isRenderable?((r=globalFloatingCounter>0||e.floating)&&globalFloatingCounter++,e.inViewport=!1,state$1.current().cameras.forEach((function(t){t.isVisible(e,r)&&(e.inViewport=!0)})),i=(e.inViewport||e.alwaysUpdate)&&e.update(t)||i,globalFloatingCounter>0&&globalFloatingCounter--):i=e.update(t)||i);return i},draw:function(t,e){var i=!1,r=this.getBounds();this.drawCount=0,!1===this.root&&!0===this.clipping&&!0===r.isFinite()&&t.clipRect(r.left,r.top,r.width,r.height),t.translate(this.pos.x,this.pos.y);for(var n,s=this.getChildren(),o=s.length;n=s[--o];)n.isRenderable&&(i=!0===n.floating,(n.inViewport||i)&&(i&&(t.save(),t.resetTransform()),n.preDraw(t),n.draw(t,e),n.postDraw(t),i&&t.restore(),this.drawCount++))}}),Container$1=Container,QT_ARRAY=[];function QT_ARRAY_POP(t,e,i,r){if(QT_ARRAY.length>0){var n=QT_ARRAY.pop();return n.bounds=t,n.max_objects=e||4,n.max_levels=i||4,n.level=r||0,n}return new QuadTree(t,e,i,r)}function QT_ARRAY_PUSH(t){QT_ARRAY.push(t)}var QT_VECTOR=new Vector2d;class QuadTree{constructor(t,e,i,r){this.max_objects=e||4,this.max_levels=i||4,this.level=r||0,this.bounds=t,this.objects=[],this.nodes=[]}split(){var t=this.level+1,e=this.bounds.width/2,i=this.bounds.height/2,r=this.bounds.left,n=this.bounds.top;this.nodes[0]=QT_ARRAY_POP({left:r+e,top:n,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[1]=QT_ARRAY_POP({left:r,top:n,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[2]=QT_ARRAY_POP({left:r,top:n+i,width:e,height:i},this.max_objects,this.max_levels,t),this.nodes[3]=QT_ARRAY_POP({left:r+e,top:n+i,width:e,height:i},this.max_objects,this.max_levels,t)}getIndex(t){var e,i=-1,r=(e=t.floating||t.ancestor&&t.ancestor.floating?game$1.viewport.localToWorld(t.left,t.top,QT_VECTOR):QT_VECTOR.set(t.left,t.top)).x,n=e.y,s=t.width,o=t.height,a=this.bounds.left+this.bounds.width/2,h=this.bounds.top+this.bounds.height/2,l=n<h&&n+o<h,u=n>h;return r<a&&r+s<a?l?i=1:u&&(i=2):r>a&&(l?i=0:u&&(i=3)),i}insertContainer(t){for(var e,i=t.children.length;i--,e=t.children[i];)!0!==e.isKinematic&&(e instanceof Container$1?("rootContainer"!==e.name&&this.insert(e),this.insertContainer(e)):"function"==typeof e.getBounds&&this.insert(e))}insert(t){var e=-1;if(this.nodes.length>0&&-1!==(e=this.getIndex(t)))this.nodes[e].insert(t);else if(this.objects.push(t),this.objects.length>this.max_objects&&this.level<this.max_levels){0===this.nodes.length&&this.split();for(var i=0;i<this.objects.length;)-1!==(e=this.getIndex(this.objects[i]))?this.nodes[e].insert(this.objects.splice(i,1)[0]):i+=1}}retrieve(t,e){var i=this.objects;if(this.nodes.length>0){var r=this.getIndex(t);if(-1!==r)i=i.concat(this.nodes[r].retrieve(t));else for(var n=0;n<this.nodes.length;n+=1)i=i.concat(this.nodes[n].retrieve(t))}return"function"==typeof e&&i.sort(e),i}remove(t){var e=!1;if(void 0===t.getBounds)return!1;if(this.nodes.length>0){var i=this.getIndex(t);-1!==i&&(e=utils$1.array.remove(this.nodes[i],t))&&this.nodes[i].isPrunable()&&this.nodes.splice(i,1)}return!1===e&&-1!==this.objects.indexOf(t)&&(utils$1.array.remove(this.objects,t),e=!0),e}isPrunable(){return!(this.hasChildren()||this.objects.length>0)}hasChildren(){for(var t=0;t<this.nodes.length;t+=1){var e=this.nodes[t];if(e.length>0||e.objects.length>0)return!0}return!1}clear(t){this.objects.length=0;for(var e=0;e<this.nodes.length;e++)this.nodes[e].clear(),QT_ARRAY_PUSH(this.nodes[e]);this.nodes.length=0,void 0!==t&&this.bounds.setMinMax(t.min.x,t.min.y,t.max.x,t.max.y)}}for(var LEFT_VORNOI_REGION=-1,MIDDLE_VORNOI_REGION=0,RIGHT_VORNOI_REGION=1,T_VECTORS=[],v=0;v<10;v++)T_VECTORS.push(new Vector2d);for(var T_ARRAYS=[],a=0;a<5;a++)T_ARRAYS.push([]);function flattenPointsOn(t,e,i){for(var r=Number.MAX_VALUE,n=-Number.MAX_VALUE,s=t.length,o=0;o<s;o++){var a=t[o].dotProduct(e);a<r&&(r=a),a>n&&(n=a)}i[0]=r,i[1]=n}function isSeparatingAxis(t,e,i,r,n,s){var o=T_ARRAYS.pop(),a=T_ARRAYS.pop(),h=T_VECTORS.pop().copy(e).sub(t),l=h.dotProduct(n);if(flattenPointsOn(i,n,o),flattenPointsOn(r,n,a),a[0]+=l,a[1]+=l,o[0]>a[1]||a[0]>o[1])return T_VECTORS.push(h),T_ARRAYS.push(o),T_ARRAYS.push(a),!0;if(s){var u=0;if(o[0]<a[0])if(s.aInB=!1,o[1]<a[1])u=o[1]-a[0],s.bInA=!1;else{var c=o[1]-a[0],d=a[1]-o[0];u=c<d?c:-d}else if(s.bInA=!1,o[1]>a[1])u=o[0]-a[1],s.aInB=!1;else{var p=o[1]-a[0],f=a[1]-o[0];u=p<f?p:-f}var g=Math.abs(u);g<s.overlap&&(s.overlap=g,s.overlapN.copy(n),u<0&&s.overlapN.negateSelf())}return T_VECTORS.push(h),T_ARRAYS.push(o),T_ARRAYS.push(a),!1}function vornoiRegion(t,e){var i=t.length2(),r=e.dotProduct(t);return r<0?LEFT_VORNOI_REGION:r>i?RIGHT_VORNOI_REGION:MIDDLE_VORNOI_REGION}function testPolygonPolygon(t,e,i,r,n){var s,o=e.points,a=e.normals,h=a.length,l=r.points,u=r.normals,c=u.length,d=T_VECTORS.pop().copy(t.pos).add(t.ancestor.getAbsolutePosition()).add(e.pos),p=T_VECTORS.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(r.pos);for(s=0;s<h;s++)if(isSeparatingAxis(d,p,o,l,a[s],n))return T_VECTORS.push(d),T_VECTORS.push(p),!1;for(s=0;s<c;s++)if(isSeparatingAxis(d,p,o,l,u[s],n))return T_VECTORS.push(d),T_VECTORS.push(p),!1;return n&&(n.a=t,n.b=i,n.overlapV.copy(n.overlapN).scale(n.overlap)),T_VECTORS.push(d),T_VECTORS.push(p),!0}function testEllipseEllipse(t,e,i,r,n){var s=T_VECTORS.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(r.pos).sub(t.pos).add(t.ancestor.getAbsolutePosition()).sub(e.pos),o=e.radius,a=r.radius,h=o+a,l=h*h,u=s.length2();if(u>l)return T_VECTORS.push(s),!1;if(n){var c=Math.sqrt(u);n.a=t,n.b=i,n.overlap=h-c,n.overlapN.copy(s.normalize()),n.overlapV.copy(s).scale(n.overlap),n.aInB=o<=a&&c<=a-o,n.bInA=a<=o&&c<=o-a}return T_VECTORS.push(s),!0}function testPolygonEllipse(t,e,i,r,n){for(var s=T_VECTORS.pop().copy(i.pos).add(i.ancestor.getAbsolutePosition()).add(r.pos).sub(t.pos).add(t.ancestor.getAbsolutePosition()).sub(e.pos),o=r.radius,a=o*o,h=e.points,l=e.edges,u=l.length,c=T_VECTORS.pop(),d=T_VECTORS.pop(),p=T_VECTORS.pop(),f=0,g=0;g<u;g++){var v=g===u-1?0:g+1,m=0===g?u-1:g-1,y=0,_=null;c.copy(l[g]),p.copy(s).sub(h[g]),n&&p.length2()>a&&(n.aInB=!1);var x=vornoiRegion(c,p),w=!0;if(x===LEFT_VORNOI_REGION){var b=null;if(u>1&&(c.copy(l[m]),(x=vornoiRegion(c,b=T_VECTORS.pop().copy(s).sub(h[m])))!==RIGHT_VORNOI_REGION&&(w=!1)),w){if((f=p.length())>o)return T_VECTORS.push(s),T_VECTORS.push(c),T_VECTORS.push(d),T_VECTORS.push(p),b&&T_VECTORS.push(b),!1;n&&(n.bInA=!1,_=p.normalize(),y=o-f)}b&&T_VECTORS.push(b)}else if(x===RIGHT_VORNOI_REGION){if(u>1&&(c.copy(l[v]),p.copy(s).sub(h[v]),(x=vornoiRegion(c,p))!==LEFT_VORNOI_REGION&&(w=!1)),w){if((f=p.length())>o)return T_VECTORS.push(s),T_VECTORS.push(c),T_VECTORS.push(d),T_VECTORS.push(p),!1;n&&(n.bInA=!1,_=p.normalize(),y=o-f)}}else{d.copy(e.normals[g]),f=p.dotProduct(d);var E=Math.abs(f);if((1===u||f>0)&&E>o)return T_VECTORS.push(s),T_VECTORS.push(c),T_VECTORS.push(d),T_VECTORS.push(p),!1;n&&(_=d,y=o-f,(f>=0||y<2*o)&&(n.bInA=!1))}_&&n&&Math.abs(y)<Math.abs(n.overlap)&&(n.overlap=y,n.overlapN.copy(_))}return n&&(n.a=t,n.b=i,n.overlapV.copy(n.overlapN).scale(n.overlap)),T_VECTORS.push(s),T_VECTORS.push(c),T_VECTORS.push(d),T_VECTORS.push(p),!0}function testEllipsePolygon(t,e,i,r,n){var s=this.testPolygonEllipse(i,r,t,e,n);if(s&&n){var o=n.a,a=n.aInB;n.overlapN.negateSelf(),n.overlapV.negateSelf(),n.a=n.b,n.b=o,n.aInB=n.bInA,n.bInA=a}return s}var SAT=Object.freeze({__proto__:null,testPolygonPolygon,testEllipseEllipse,testPolygonEllipse,testEllipsePolygon}),dummyObj={pos:new Vector2d(0,0),ancestor:{_absPos:new Vector2d(0,0),getAbsolutePosition:function(){return this._absPos}}};class ResponseObject{constructor(){return this.a=null,this.b=null,this.overlapN=new Vector2d,this.overlapV=new Vector2d,this.aInB=!0,this.bInA=!0,this.indexShapeA=-1,this.indexShapeB=-1,this.overlap=Number.MAX_VALUE,this}clear(){return this.aInB=!0,this.bInA=!0,this.overlap=Number.MAX_VALUE,this.indexShapeA=-1,this.indexShapeB=-1,this}}var collision={maxChildren:8,maxDepth:4,types:{NO_OBJECT:0,PLAYER_OBJECT:1,NPC_OBJECT:2,ENEMY_OBJECT:4,COLLECTABLE_OBJECT:8,ACTION_OBJECT:16,PROJECTILE_OBJECT:32,WORLD_SHAPE:64,USER:128,ALL_OBJECT:4294967295},response:new ResponseObject,shouldCollide:(t,e)=>!0!==t.isKinematic&&!0!==e.isKinematic&&t.body&&e.body&&0!=(t.body.collisionMask&e.body.collisionType)&&0!=(t.body.collisionType&e.body.collisionMask),check(t,e){for(var i,r=0,n=e||this.response,s=game$1.world.broadphase.retrieve(t),o=s.length;i=s[--o];)if(i!==t&&this.shouldCollide(t,i)&&t.body.getBounds().overlaps(i.body.getBounds())){var a=t.body.shapes.length,h=i.body.shapes.length;if(0===a||0===h)continue;var l=0;do{var u=t.body.getShape(l),c=0;do{var d=i.body.getShape(c);!0===SAT["test"+u.shapeType+d.shapeType].call(this,t,u,i,d,n.clear())&&(r++,n.indexShapeA=l,n.indexShapeB=c,t.onCollision&&!1!==t.onCollision(n,i)&&t.body.respondToCollision.call(t.body,n),i.onCollision&&!1!==i.onCollision(n,t)&&i.body.respondToCollision.call(i.body,n)),c++}while(c<h);l++}while(l<a)}return r>0},rayCast(t,e){for(var i,r=0,n=e||[],s=game$1.world.broadphase.retrieve(t),o=s.length;i=s[--o];)if(i.body&&t.getBounds().overlaps(i.getBounds())){var a=i.body.shapes.length;if(0===i.body.shapes.length)continue;var h=t,l=0;do{var u=i.body.getShape(l);SAT["test"+h.shapeType+u.shapeType].call(this,dummyObj,h,i,u)&&(n[r]=i,r++),l++}while(l<a)}return n.length=r,n}},World=Container$1.extend({init:function(t=0,e=0,i=1/0,r=1/0){this._super(Container$1,"init",[t,e,i,r,!0]),this.name="rootContainer",this.anchorPoint.set(0,0),this.fps=60,this.gravity=new Vector2d(0,.98),this.preRender=!1,this.broadphase=new QuadTree(this.getBounds().clone(),collision.maxChildren,collision.maxDepth),event.subscribe(event.GAME_RESET,this.reset.bind(this)),event.subscribe(event.LEVEL_LOADED,(function(){game$1.world.broadphase.clear(game$1.world.getBounds())}))},reset:function(){this.broadphase.clear(),this.anchorPoint.set(0,0),this._super(Container$1,"reset")},update:function(t){return this.broadphase.clear(),this.broadphase.insertContainer(this),this._super(Container$1,"update",[t])}}),isDirty=!0,isAlwaysDirty=!1,frameCounter=0,frameRate=1,accumulator=0,accumulatorMax=0,accumulatorUpdateDelta=0,stepSize=1e3/60,updateDelta=0,lastUpdateStart=null,updateAverageDelta=0,game={viewport:void 0,world:null,mergeGroup:!0,sortOn:"z",onLevelLoaded:function(){},init:function(){this.world=new World,event.publish(event.GAME_INIT),isDirty=!0},reset:function(){void 0!==state$1.current()&&(this.viewport=state$1.current().cameras.get("default")),event.publish(event.GAME_RESET),this.updateFrameRate()},updateFrameRate:function(){frameCounter=0,frameRate=~~(.5+60/timer$1.maxfps),stepSize=1e3/this.world.fps,accumulator=0,accumulatorMax=10*stepSize,isAlwaysDirty=timer$1.maxfps>this.world.fps},getParentContainer:function(t){return t.ancestor},repaint:function(){isDirty=!0},update:function(t,e){if(++frameCounter%frameRate==0)for(frameCounter=0,event.publish(event.GAME_UPDATE,[t]),accumulator+=timer$1.getDelta(),accumulator=Math.min(accumulator,accumulatorMax),updateDelta=timer$1.interpolation?timer$1.getDelta():stepSize,accumulatorUpdateDelta=timer$1.interpolation?updateDelta:Math.max(updateDelta,updateAverageDelta);accumulator>=accumulatorUpdateDelta||timer$1.interpolation;)if(lastUpdateStart=window.performance.now(),isDirty=e.update(updateDelta)||isDirty,timer$1.lastUpdate=window.performance.now(),updateAverageDelta=timer$1.lastUpdate-lastUpdateStart,accumulator-=accumulatorUpdateDelta,timer$1.interpolation){accumulator=0;break}},draw:function(t){var e=video$1.renderer;!0===e.isContextValid&&(isDirty||isAlwaysDirty)&&(e.clear(),t.draw(e),isDirty=!1,e.flush())}},game$1=game,MIN=Math.min,MAX=Math.max,targetV=new Vector2d,Camera2d=Renderable.extend({init:function(t,e,i,r){this._super(Renderable,"init",[t,e,i-t,r-e]),this.AXIS={NONE:0,HORIZONTAL:1,VERTICAL:2,BOTH:3},this.bounds=pool.pull("Bounds"),this.smoothFollow=!0,this.damping=1,this.near=-1e3,this.far=1e3,this.projectionMatrix=new Matrix3d,this.invCurrentTransform=new Matrix2d,this.offset=new Vector2d,this.target=null,this.follow_axis=this.AXIS.NONE,this._shake={intensity:0,duration:0,axis:this.AXIS.BOTH,onComplete:null},this._fadeOut={color:null,tween:null},this._fadeIn={color:null,tween:null},this.name="default",this.setDeadzone(this.width/6,this.height/6),this.anchorPoint.set(0,0),this.isKinematic=!1,this.bounds.setMinMax(t,e,i,r),this._updateProjectionMatrix(),event.subscribe(event.GAME_RESET,this.reset.bind(this)),event.subscribe(event.CANVAS_ONRESIZE,this.resize.bind(this))},_updateProjectionMatrix:function(){this.projectionMatrix.ortho(0,this.width,this.height,0,this.near,this.far)},_followH:function(t){var e=this.pos.x;return t.x-this.pos.x>this.deadzone.right?e=MIN(t.x-this.deadzone.right,this.bounds.width-this.width):t.x-this.pos.x<this.deadzone.pos.x&&(e=MAX(t.x-this.deadzone.pos.x,this.bounds.left)),e},_followV:function(t){var e=this.pos.y;return t.y-this.pos.y>this.deadzone.bottom?e=MIN(t.y-this.deadzone.bottom,this.bounds.height-this.height):t.y-this.pos.y<this.deadzone.pos.y&&(e=MAX(t.y-this.deadzone.pos.y,this.bounds.top)),e},reset:function(t,e){this.pos.x=t||0,this.pos.y=e||0,this.unfollow(),this.smoothFollow=!0,this.damping=1,this.currentTransform.identity(),this.invCurrentTransform.identity().invert(),this._updateProjectionMatrix()},setDeadzone:function(t,e){void 0===this.deadzone&&(this.deadzone=new Rect(0,0,0,0)),this.deadzone.pos.set(~~((this.width-t)/2),~~((this.height-e)/2-.25*e)),this.deadzone.resize(t,e),this.smoothFollow=!1,this.updateTarget(),this.smoothFollow=!0},resize:function(t,e){return this._super(Renderable,"resize",[t,e]),this.smoothFollow=!1,this.setBounds(0,0,t,e),this.setDeadzone(t/6,e/6),this.update(),this.smoothFollow=!0,this._updateProjectionMatrix(),event.publish(event.VIEWPORT_ONRESIZE,[this.width,this.height]),this},setBounds:function(t,e,i,r){this.smoothFollow=!1,this.bounds.setMinMax(t,e,i+t,r+e),this.moveTo(this.pos.x,this.pos.y),this.update(),this.smoothFollow=!0},follow:function(t,e,i){if(t instanceof Renderable)this.target=t.pos;else{if(!(t instanceof Vector2d||t instanceof Vector3d||t instanceof ObservableVector2d||t instanceof ObservableVector3d))throw new Error("invalid target for me.Camera2d.follow");this.target=t}this.follow_axis=void 0===e?this.AXIS.BOTH:e,this.smoothFollow=!1,this.damping="number"!=typeof i?1:clamp(i,0,1),this.updateTarget(),this.smoothFollow=!0},unfollow:function(){this.target=null,this.follow_axis=this.AXIS.NONE},move:function(t,e){this.moveTo(this.pos.x+t,this.pos.y+e)},moveTo:function(t,e){var i=this.pos.x,r=this.pos.y;this.pos.x=clamp(t,this.bounds.left,this.bounds.width),this.pos.y=clamp(e,this.bounds.top,this.bounds.height),i===this.pos.x&&r===this.pos.y||event.publish(event.VIEWPORT_ONCHANGE,[this.pos])},updateTarget:function(){if(this.target){switch(targetV.setV(this.pos),this.follow_axis){case this.AXIS.NONE:break;case this.AXIS.HORIZONTAL:targetV.x=this._followH(this.target);break;case this.AXIS.VERTICAL:targetV.y=this._followV(this.target);break;case this.AXIS.BOTH:targetV.x=this._followH(this.target),targetV.y=this._followV(this.target)}if(!this.pos.equals(targetV)){if(!0===this.smoothFollow&&this.damping<1){if(toBeCloseTo(targetV.x,this.pos.x,2)&&toBeCloseTo(targetV.y,this.pos.y,2))return this.pos.setV(targetV),!1;this.pos.lerp(targetV,this.damping)}else this.pos.setV(targetV);return!0}}return!1},update:function(t){var e=this.updateTarget(t);return this._shake.duration>0&&(this._shake.duration-=t,this._shake.duration<=0?(this._shake.duration=0,this.offset.setZero(),"function"==typeof this._shake.onComplete&&this._shake.onComplete()):(this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.HORIZONTAL||(this.offset.x=(Math.random()-.5)*this._shake.intensity),this._shake.axis!==this.AXIS.BOTH&&this._shake.axis!==this.AXIS.VERTICAL||(this.offset.y=(Math.random()-.5)*this._shake.intensity)),e=!0),!0===e&&event.publish(event.VIEWPORT_ONCHANGE,[this.pos]),null==this._fadeIn.tween&&null==this._fadeOut.tween||(e=!0),this.currentTransform.isIdentity()?this.invCurrentTransform.identity():this.invCurrentTransform.copy(this.currentTransform).invert(),e},shake:function(t,e,i,r,n){0!==this._shake.duration&&!0!==n||(this._shake.intensity=t,this._shake.duration=e,this._shake.axis=i||this.AXIS.BOTH,this._shake.onComplete="function"==typeof r?r:void 0)},fadeOut:function(t,e=1e3,i){this._fadeOut.color=pool.pull("Color").copy(t),this._fadeOut.tween=pool.pull("Tween",this._fadeOut.color).to({alpha:0},e).onComplete(i||null),this._fadeOut.tween.isPersistent=!0,this._fadeOut.tween.start()},fadeIn:function(t,e=1e3,i){this._fadeIn.color=pool.pull("Color").copy(t);var r=this._fadeIn.color.alpha;this._fadeIn.color.alpha=0,this._fadeIn.tween=pool.pull("Tween",this._fadeIn.color).to({alpha:r},e).onComplete(i||null),this._fadeIn.tween.isPersistent=!0,this._fadeIn.tween.start()},getWidth:function(){return this.width},getHeight:function(){return this.height},focusOn:function(t){var e=t.getBounds();this.moveTo(t.pos.x+e.left+e.width/2,t.pos.y+e.top+e.height/2)},isVisible:function(t,e=t.floating){return!0===e||!0===t.floating?video$1.renderer.overlaps(t.getBounds()):t.getBounds().overlaps(this)},localToWorld:function(t,e,i){return(i=i||new Vector2d).set(t,e).add(this.pos).sub(game$1.world.pos),this.currentTransform.isIdentity()||this.invCurrentTransform.apply(i),i},worldToLocal:function(t,e,i){return(i=i||new Vector2d).set(t,e),this.currentTransform.isIdentity()||this.currentTransform.apply(i),i.sub(this.pos).add(game$1.world.pos)},drawFX:function(t){this._fadeIn.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeIn.color),t.fillRect(0,0,this.width,this.height),t.restore(),1===this._fadeIn.color.alpha&&(this._fadeIn.tween=null,pool.push(this._fadeIn.color),this._fadeIn.color=null)),this._fadeOut.tween&&(t.save(),t.resetTransform(),t.setColor(this._fadeOut.color),t.fillRect(0,0,this.width,this.height),t.restore(),0===this._fadeOut.color.alpha&&(this._fadeOut.tween=null,pool.push(this._fadeOut.color),this._fadeOut.color=null))},draw:function(t,e){var i=this.pos.x+this.offset.x,r=this.pos.y+this.offset.y;e.currentTransform.translate(-i,-r),t.setProjection(this.projectionMatrix),t.clipRect(0,0,this.width,this.height),this.preDraw(t),e.preDraw(t),e.draw(t,this),this.drawFX(t),e.postDraw(t),this.postDraw(t),e.currentTransform.translate(i,r)}}),default_camera,default_settings={cameras:[]},Stage=window.Jay.extend({init:function(t){this.cameras=new Map,this.settings=Object.assign(default_settings,t||{})},reset:function(){var t=this;if(this.settings.cameras.forEach((function(e){t.cameras.set(e.name,e)})),!1===this.cameras.has("default")){if(void 0===default_camera){var e=video$1.renderer.getWidth(),i=video$1.renderer.getHeight();default_camera=new Camera2d(0,0,e,i)}this.cameras.set("default",default_camera)}game$1.reset(),this.onResetEvent.apply(this,arguments)},update:function(t){var e=game$1.world.update(t);return this.cameras.forEach((function(i){i.update(t)&&(e=!0)})),e},draw:function(t){this.cameras.forEach((function(e){e.draw(t,game$1.world)}))},destroy:function(){this.cameras.clear(),this.onDestroyEvent.apply(this,arguments)},onResetEvent:function(){"function"==typeof this.settings.onResetEvent&&this.settings.onResetEvent.apply(this,arguments)},onDestroyEvent:function(){"function"==typeof this.settings.onDestroyEvent&&this.settings.onDestroyEvent.apply(this,arguments)}}),ProgressBar=Renderable.extend({init:function(t,e,i,r){var n=this;this.barHeight=r,this._super(Renderable,"init",[t,e,i,r]),this.anchorPoint.set(0,0),this.loaderHdlr=event.subscribe(event.LOADER_PROGRESS,n.onProgressUpdate.bind(n)),this.resizeHdlr=event.subscribe(event.VIEWPORT_ONRESIZE,n.resize.bind(n)),this.anchorPoint.set(0,0),this.progress=0},onProgressUpdate:function(t){this.progress=~~(t*this.width),this.isDirty=!0},draw:function(t){t.clearColor("#202020"),t.setColor("black"),t.fillRect(this.pos.x,game$1.viewport.centerY,t.getWidth(),this.barHeight/2),t.setColor("#55aa00"),t.fillRect(this.pos.x,game$1.viewport.centerY,this.progress,this.barHeight/2)},onDestroyEvent:function(){event.unsubscribe(this.loaderHdlr),event.unsubscribe(this.resizeHdlr),this.loaderHdlr=this.resizeHdlr=null}}),IconLogo=Renderable.extend({init:function(t,e){this._super(Renderable,"init",[t,e,100,85]),this.iconCanvas=video$1.createCanvas(nextPowerOfTwo(this.width),nextPowerOfTwo(this.height),!1);var i=video$1.renderer.getContext2d(this.iconCanvas);i.beginPath(),i.moveTo(.7,48.9),i.bezierCurveTo(10.8,68.9,38.4,75.8,62.2,64.5),i.bezierCurveTo(86.1,53.1,97.2,27.7,87,7.7),i.lineTo(87,7.7),i.bezierCurveTo(89.9,15.4,73.9,30.2,50.5,41.4),i.bezierCurveTo(27.1,52.5,5.2,55.8,.7,48.9),i.lineTo(.7,48.9),i.closePath(),i.fillStyle="rgb(255, 255, 255)",i.fill(),i.beginPath(),i.moveTo(84,7),i.bezierCurveTo(87.6,14.7,72.5,30.2,50.2,41.6),i.bezierCurveTo(27.9,53,6.9,55.9,3.2,48.2),i.bezierCurveTo(-.5,40.4,14.6,24.9,36.9,13.5),i.bezierCurveTo(59.2,2.2,80.3,-.8,84,7),i.lineTo(84,7),i.closePath(),i.lineWidth=5.3,i.strokeStyle="rgb(255, 255, 255)",i.lineJoin="miter",i.miterLimit=4,i.stroke(),this.anchorPoint.set(.5,.5)},draw:function(t){t.drawImage(this.iconCanvas,t.getWidth()/2,this.pos.y)}}),TextLogo=Renderable.extend({init:function(t,e){this._super(Renderable,"init",[0,0,t,e]),this.textWidth=0,this.fontCanvas=video$1.createCanvas(256,64,!0),this.drawFont(video$1.renderer.getContext2d(this.fontCanvas)),this.anchorPoint.set(0,.5)},drawFont:function(t){var e=pool.pull("Text",0,0,{font:"century gothic",size:32,fillStyle:"white",textAlign:"middle",textBaseline:"top",text:"melon"}),i=pool.pull("Text",0,0,{font:"century gothic",size:32,fillStyle:"#55aa00",textAlign:"middle",textBaseline:"top",bold:!0,text:"JS"}),r=e.measureText(t).width,n=i.measureText(t).width;this.textWidth=r+n,this.pos.x=Math.round(this.width-this.textWidth/2),this.pos.y=Math.round(this.height+16),e._drawFont(t,["melon"],0,0),i._drawFont(t,["JS"],r,0),pool.push(e),pool.push(i)},draw:function(t){t.drawImage(this.fontCanvas,Math.round((t.getWidth()-this.textWidth)/2),this.pos.y)}}),defaultLoadingScreen=new Stage({onResetEvent:function(){game$1.world.addChild(new ProgressBar(0,video$1.renderer.getHeight()/2,video$1.renderer.getWidth(),8),1),game$1.world.addChild(new IconLogo(video$1.renderer.getWidth()/2,video$1.renderer.getHeight()/2-16-35),2),game$1.world.addChild(new TextLogo(video$1.renderer.getWidth(),video$1.renderer.getHeight()),2)}}),_state=-1,_animFrameId=-1,_isPaused=!1,_stages={},_fade={color:"",duration:0},_onSwitchComplete=null,_extraArgs=null,_pauseTime=0;function _startRunLoop(){-1===_animFrameId&&-1!==_state&&(timer$1.reset(),_animFrameId=window.requestAnimationFrame(_renderFrame))}function _resumeRunLoop(){_isPaused&&-1!==_state&&(timer$1.reset(),_isPaused=!1)}function _pauseRunLoop(){_isPaused=!0}function _renderFrame(t){var e=_stages[_state].stage;game$1.update(t,e),game$1.draw(e),-1!==_animFrameId&&(_animFrameId=window.requestAnimationFrame(_renderFrame))}function _stopRunLoop(){window.cancelAnimationFrame(_animFrameId),_animFrameId=-1}function _switchState(t){_stopRunLoop(),_stages[_state]&&_stages[_state].stage.destroy(),_stages[t]&&(_stages[_state=t].stage.reset.apply(_stages[_state].stage,_extraArgs),_startRunLoop(),_onSwitchComplete&&_onSwitchComplete(),game$1.repaint())}var state={LOADING:0,MENU:1,READY:2,PLAY:3,GAMEOVER:4,GAME_END:5,SCORE:6,CREDITS:7,SETTINGS:8,DEFAULT:9,USER:100,onPause:null,onResume:null,onStop:null,onRestart:null,init(){this.set(this.LOADING,defaultLoadingScreen),this.set(this.DEFAULT,new Stage);var t=this;event.subscribe(event.VIDEO_INIT,(function(){t.change(t.DEFAULT,!0)}))},stop(t){_state!==this.LOADING&&this.isRunning()&&(_stopRunLoop(),!0===t&&audio$1.pauseTrack(),_pauseTime=window.performance.now(),event.publish(event.STATE_STOP),"function"==typeof this.onStop&&this.onStop())},pause(t){_state===this.LOADING||this.isPaused()||(_pauseRunLoop(),!0===t&&audio$1.pauseTrack(),_pauseTime=window.performance.now(),event.publish(event.STATE_PAUSE),"function"==typeof this.onPause&&this.onPause())},restart(t){this.isRunning()||(_startRunLoop(),!0===t&&audio$1.resumeTrack(),_pauseTime=window.performance.now()-_pauseTime,game$1.repaint(),event.publish(event.STATE_RESTART,[_pauseTime]),"function"==typeof this.onRestart&&this.onRestart())},resume(t){this.isPaused()&&(_resumeRunLoop(),!0===t&&audio$1.resumeTrack(),_pauseTime=window.performance.now()-_pauseTime,event.publish(event.STATE_RESUME,[_pauseTime]),"function"==typeof this.onResume&&this.onResume())},isRunning:()=>-1!==_animFrameId,isPaused:()=>_isPaused,set(t,e,i){if(!(e instanceof Stage))throw new Error(e+" is not an instance of me.Stage");_stages[t]={},_stages[t].stage=e,_stages[t].transition=!0,!0===i&&this.change(t)},current(){if(void 0!==_stages[_state])return _stages[_state].stage},transition(t,e,i){"fade"===t&&(_fade.color=e,_fade.duration=i)},setTransition(t,e){_stages[t].transition=e},change(t,e){if(void 0===_stages[t])throw new Error("Undefined Stage for state '"+t+"'");this.isCurrent(t)||(_extraArgs=null,arguments.length>1&&(_extraArgs=Array.prototype.slice.call(arguments,1)),_fade.duration&&_stages[t].transition?(_onSwitchComplete=function(){game$1.viewport.fadeOut(_fade.color,_fade.duration)},game$1.viewport.fadeIn(_fade.color,_fade.duration,(function(){utils$1.function.defer(_switchState,this,t)}))):!0===e?_switchState(t):utils$1.function.defer(_switchState,this,t))},isCurrent:t=>_state===t},state$1=state,Ellipse=window.Jay.extend({init:function(t,e,i,r){this.pos=new Vector2d,this._bounds=void 0,this.radius=NaN,this.radiusV=new Vector2d,this.radiusSq=new Vector2d,this.ratio=new Vector2d,this.shapeType="Ellipse",this.setShape(t,e,i,r)},onResetEvent:function(t,e,i,r){this.setShape(t,e,i,r)},setShape:function(t,e,i,r){var n=i/2,s=r/2;this.pos.set(t,e),this.radius=Math.max(n,s),this.ratio.set(n/this.radius,s/this.radius),this.radiusV.set(this.radius,this.radius).scaleV(this.ratio);var o=this.radius*this.radius;return this.radiusSq.set(o,o).scaleV(this.ratio),this.getBounds().setMinMax(t,e,t+i,t+r),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this},rotate:function(t,e){return this.pos.rotate(t,e),this.getBounds().shift(this.pos),this.getBounds().translate(-this.radiusV.x,-this.radiusV.y),this},scale:function(t,e){return e=void 0!==e?e:t,this.setShape(this.pos.x,this.pos.y,2*this.radiusV.x*t,2*this.radiusV.y*e)},scaleV:function(t){return this.scale(t.x,t.y)},transform:function(){return this},translate:function(){var t,e;return 2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.pos.x+=t,this.pos.y+=e,this.getBounds().translate(t,e),this},contains:function(t,e){var i,r;return 2===arguments.length?(i=arguments[0],r=arguments[1]):(i=arguments[0].x,r=arguments[0].y),i-=this.pos.x,r-=this.pos.y,i*i/this.radiusSq.x+r*r/this.radiusSq.y<=1},getBounds:function(){return void 0===this._bounds&&(this._bounds=pool.pull("Bounds")),this._bounds},clone:function(){return new Ellipse(this.pos.x,this.pos.y,2*this.radiusV.x,2*this.radiusV.y)}});class Bounds$1{constructor(t){this.onResetEvent(t)}onResetEvent(t){void 0===this.min?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),void 0!==t&&this.update(t),this._center=new Vector2d}clear(){this.setMinMax(1/0,1/0,-1/0,-1/0)}setMinMax(t,e,i,r){this.min.x=t,this.min.y=e,this.max.x=i,this.max.y=r}get x(){return this.min.x}set x(t){var e=this.max.x-this.min.x;this.min.x=t,this.max.x=t+e}get y(){return this.min.y}set y(t){var e=this.max.y-this.min.y;this.min.y=t,this.max.y=t+e}get width(){return this.max.x-this.min.x}set width(t){this.max.x=this.min.x+t}get height(){return this.max.y-this.min.y}set height(t){this.max.y=this.min.y+t}get left(){return this.min.x}get right(){return this.max.x}get top(){return this.min.y}get bottom(){return this.max.y}get centerX(){return this.min.x+this.width/2}get centerY(){return this.min.y+this.height/2}get center(){return this._center.set(this.centerX,this.centerY)}update(t){this.add(t,!0)}add(t,e=!1){!0===e&&this.clear();for(var i=0;i<t.length;i++){var r=t[i];r.x>this.max.x&&(this.max.x=r.x),r.x<this.min.x&&(this.min.x=r.x),r.y>this.max.y&&(this.max.y=r.y),r.y<this.min.y&&(this.min.y=r.y)}}addBounds(t,e=!1){!0===e&&this.clear(),t.max.x>this.max.x&&(this.max.x=t.max.x),t.min.x<this.min.x&&(this.min.x=t.min.x),t.max.y>this.max.y&&(this.max.y=t.max.y),t.min.y<this.min.y&&(this.min.y=t.min.y)}addPoint(t,e){void 0!==e&&(t=e.apply(t)),this.min.x=Math.min(this.min.x,t.x),this.max.x=Math.max(this.max.x,t.x),this.min.y=Math.min(this.min.y,t.y),this.max.y=Math.max(this.max.y,t.y)}addFrame(t,e,i,r,n){var s=me.pool.pull("Vector2d");this.addPoint(s.set(t,e),n),this.addPoint(s.set(i,e),n),this.addPoint(s.set(t,r),n),this.addPoint(s.set(i,r),n),me.pool.push(s)}contains(){var t,e,i,r,n=arguments[0];return 2===arguments.length?(t=e=n,i=r=arguments[1]):n instanceof Bounds$1?(t=n.min.x,e=n.max.x,i=n.min.y,r=n.max.y):(t=e=n.x,i=r=n.y),t>=this.min.x&&e<=this.max.x&&i>=this.min.y&&r<=this.max.y}overlaps(t){return this.left<=t.right&&this.right>=t.left&&this.bottom>=t.top&&this.top<=t.bottom}isFinite(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}translate(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.min.x+=t,this.max.x+=t,this.min.y+=e,this.max.y+=e}shift(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);var i=this.max.x-this.min.x,r=this.max.y-this.min.y;this.min.x=t,this.max.x=t+i,this.min.y=e,this.max.y=e+r}clone(){var t=new Bounds$1;return t.addBounds(this),t}toPolygon(){return new Polygon(this.x,this.y,[new Vector2d(0,0),new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)])}}class Body{constructor(t,e,i){if(this.ancestor=t,void 0===this.bounds&&(this.bounds=new Bounds$1),void 0===this.shapes&&(this.shapes=[]),this.collisionMask=collision.types.ALL_OBJECT,this.collisionType=collision.types.ENEMY_OBJECT,void 0===this.vel&&(this.vel=new Vector2d),this.vel.set(0,0),void 0===this.accel&&(this.accel=new Vector2d),this.accel.set(0,0),void 0===this.force&&(this.force=new Vector2d),this.force.set(0,0),void 0===this.friction&&(this.friction=new Vector2d),this.friction.set(0,0),this.bounce=0,this.mass=1,void 0===this.maxVel&&(this.maxVel=new Vector2d),this.maxVel.set(490,490),void 0===this.gravity){var r=this;this.gravity=new ObservableVector2d(0,0,{onUpdate:function(t,e){"number"==typeof e&&(r.gravityScale=e/game$1.world.gravity.y),console.log("me.Body.gravity is deprecated, please see me.Body.gravityScale to modify gravity for a specific body")}})}if(this.gravityScale=1,this.ignoreGravity=!1,this.falling=!1,this.jumping=!1,"function"==typeof i&&(this.onBodyUpdate=i),this.bounds.clear(),void 0!==e)if(Array.isArray(e))for(var n=0;n<e.length;n++)this.addShape(e[n]);else this.addShape(e);this.ancestor.isKinematic=!1}addShape(t){if(t instanceof Rect||t instanceof Bounds$1){var e=t.toPolygon();this.shapes.push(e),this.bounds.add(e.points),this.bounds.translate(e.pos)}else t instanceof Ellipse?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.addBounds(t.getBounds()),this.bounds.translate(t.getBounds().x,t.getBounds().y)):t instanceof Polygon?(this.shapes.includes(t)||this.shapes.push(t),this.bounds.add(t.points),this.bounds.translate(t.pos)):this.fromJSON(t);return"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this),this.shapes.length}setVertices(t,e=0,i=!0){var r=this.getShape(e);r instanceof Polygon?r.setShape(0,0,t):this.shapes[e]=new Polygon(0,0,t),this.bounds.add(this.shapes[e].points,i),"function"==typeof this.onBodyUpdate&&this.onBodyUpdate(this)}addVertices(t,e=0){this.setVertices(t,e,!1)}fromJSON(t,e){var i=t;if(void 0!==e&&(i=t[e]),void 0===i)throw new Error("Identifier ("+e+") undefined for the given JSON object)");if(i.length){for(var r=0;r<i.length;r++)this.addVertices(i[r].shape,r);this.mass=i[0].density||0,this.friction.set(i[0].friction||0,i[0].friction||0),this.bounce=i[0].bounce||0}return i.length}getShape(t){return this.shapes[t||0]}getBounds(){return this.bounds}removeShape(t){this.bounds.clear(),utils$1.array.remove(this.shapes,t);for(var e=0;e<this.shapes.length;e++)this.addShape(this.shapes[e]);return this.shapes.length}removeShapeAt(t){return this.removeShape(this.getShape(t))}setCollisionMask(t=collision.types.ALL_OBJECT){this.collisionMask=t}setCollisionType(t){if(void 0!==t){if(void 0===collision.types[t])throw new Error("Invalid value for the collisionType property");this.collisionType=collision.types[t]}}respondToCollision(t){var e=t.overlapV;if(this.ancestor.pos.sub(e),0!==e.x&&(this.vel.x=~~(.5+this.vel.x-e.x)||0,this.bounce>0&&(this.vel.x*=-this.bounce)),0!==e.y){this.vel.y=~~(.5+this.vel.y-e.y)||0,this.bounce>0&&(this.vel.y*=-this.bounce);var i=Math.sign(game$1.world.gravity.y*this.gravityScale)||1;this.falling=e.y>=i,this.jumping=e.y<=-i}}forEach(t,e){var i=this,r=0,n=this.shapes,s=n.length;if("function"!=typeof t)throw new Error(t+" is not a function");for(arguments.length>1&&(i=e);r<s;)t.call(i,n[r],r,n),r++}contains(){var t,e;if(2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.getBounds().contains(t,e))for(var i,r=this.shapes.length;r--,i=this.shapes[r];)if(i.contains(t,e))return!0;return!1}rotate(t,e=this.getBounds().center){return this.bounds.clear(),this.forEach((i=>{i.rotate(t,e),this.bounds.addBounds(i.getBounds()),i instanceof Ellipse?this.bounds.translate(i.getBounds().x,i.getBounds().y):this.bounds.translate(i.pos)})),this}setVelocity(t,e){this.accel.x=0!==t?t:this.accel.x,this.accel.y=0!==e?e:this.accel.y,this.setMaxVelocity(t,e)}setMaxVelocity(t,e){this.maxVel.x=t,this.maxVel.y=e}setFriction(t,e){this.friction.x=t||0,this.friction.y=e||0}applyFriction(t){var e=this.friction.x*timer$1.tick,i=t.x+e,r=t.x-e,n=this.friction.y*timer$1.tick,s=t.y+n,o=t.y-n;t.x=i<0?i:r>0?r:0,t.y=s<0?s:o>0?o:0}computeVelocity(t){if(this.force.x&&(t.x+=this.force.x*timer$1.tick),this.force.y&&(t.y+=this.force.y*timer$1.tick),(this.friction.x||this.friction.y)&&this.applyFriction(t),!this.ignoreGravity){var e=game$1.world.gravity;t.x+=e.x*this.gravityScale*this.mass*timer$1.tick,t.y+=e.y*this.gravityScale*this.mass*timer$1.tick,this.falling=t.y*Math.sign(e.y*this.gravityScale)>0,this.jumping=!this.falling&&this.jumping}0!==t.y&&(t.y=clamp(t.y,-this.maxVel.y,this.maxVel.y)),0!==t.x&&(t.x=clamp(t.x,-this.maxVel.x,this.maxVel.x))}update(){return this.computeVelocity(this.vel),this.ancestor.pos.add(this.vel),0!==this.vel.x||0!==this.vel.y}destroy(){this.onBodyUpdate=void 0,this.ancestor=void 0,this.shapes.length=0}}function setTMXValue(name,type,value){var match;if("string"!=typeof value)return value;switch(type){case"int":case"float":value=Number(value);break;case"bool":value="true"===value;break;default:if(!value||utils$1.string.isBoolean(value))value=!value||"true"===value;else if(utils$1.string.isNumeric(value))value=Number(value);else if(0===value.search(/^json:/i)){match=value.split(/^json:/i)[1];try{value=JSON.parse(match)}catch(t){throw new Error("Unable to parse JSON: "+match)}}else if(0===value.search(/^eval:/i)){match=value.split(/^eval:/i)[1];try{value=eval(match)}catch(t){throw new Error("Unable to evaluate: "+match)}}else((match=value.match(/^#([\da-fA-F])([\da-fA-F]{3})$/))||(match=value.match(/^#([\da-fA-F]{2})([\da-fA-F]{6})$/)))&&(value="#"+match[2]+match[1]);0===name.search(/^(ratio|anchorPoint)$/)&&"number"==typeof value&&(value={x:value,y:value})}return value}function parseAttributes(t,e){if(e.attributes&&e.attributes.length>0)for(var i=0;i<e.attributes.length;i++){var r=e.attributes.item(i);void 0!==r.name?t[r.name]=r.value:t[r.nodeName]=r.nodeValue}}function decompress(){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")}function decodeCSV(t){for(var e=t.replace("\n","").trim().split(","),i=[],r=0;r<e.length;r++)i.push(+e[r]);return i}function decodeBase64AsArray(t,e){var i,r,n;e=e||1;var s=window.atob(t.replace(/[^A-Za-z0-9\+\/\=]/g,"")),o=new Uint32Array(s.length/e);for(i=0,n=s.length/e;i<n;i++)for(o[i]=0,r=e-1;r>=0;--r)o[i]+=s.charCodeAt(i*e+r)<<(r<<3);return o}function decode(t,e,i){switch(i=i||"none",e=e||"none"){case"csv":return decodeCSV(t);case"base64":var r=decodeBase64AsArray(t,4);return"none"===i?r:decompress();case"none":return t;case"xml":throw new Error("XML encoding is deprecated, use base64 instead");default:throw new Error("Unknown layer encoding: "+e)}}function normalize(t,e){var i=e.nodeName;switch(i){case"data":var r=parse(e);r.text=r.text||r.chunk.text,r.encoding=r.encoding||"xml",t.data=decode(r.text,r.encoding,r.compression),t.encoding="none";break;case"imagelayer":case"layer":case"objectgroup":case"group":var n=parse(e);n.type="layer"===i?"tilelayer":i,n.image&&(n.image=n.image.source),t.layers=t.layers||[],t.layers.push(n);break;case"animation":t.animation=parse(e).frames;break;case"frame":case"object":var s=i+"s";t[s]=t[s]||[],t[s].push(parse(e));break;case"tile":var o=parse(e);o.image&&(o.imagewidth=o.image.width,o.imageheight=o.image.height,o.image=o.image.source),t.tiles=t.tiles||{},t.tiles[o.id]=o;break;case"tileset":var a=parse(e);a.image&&(a.imagewidth=a.image.width,a.imageheight=a.image.height,a.image=a.image.source),t.tilesets=t.tilesets||[],t.tilesets.push(a);break;case"polygon":case"polyline":t[i]=[];for(var h,l=parse(e).points.split(" "),u=0;u<l.length;u++)h=l[u].split(","),t[i].push({x:+h[0],y:+h[1]});break;case"properties":t.properties=parse(e);break;case"property":var c=parse(e),d=void 0!==c.value?c.value:c.text;t[c.name]=setTMXValue(c.name,c.type||"string",d);break;default:t[i]=parse(e)}}function parse(t){var e={},i="";if(1===t.nodeType&&parseAttributes(e,t),t.hasChildNodes())for(var r=0;r<t.childNodes.length;r++){var n=t.childNodes.item(r);switch(n.nodeType){case 1:normalize(e,n);break;case 3:i+=n.nodeValue.trim()}}return i&&(e.text=i),e}function applyTMXProperties(t,e){var i=e.properties,r=e.propertytypes;if(void 0!==i)for(var n in i)if(i.hasOwnProperty(n)){var s="string",o=n,a=i[n];void 0!==i[n].name&&(o=i[n].name),void 0!==r?s=r[n]:void 0!==i[n].type&&(s=i[n].type),void 0!==i[n].value&&(a=i[n].value),t[o]=setTMXValue(o,s,a)}}class TextureCache{constructor(t){this.cache=new Map,this.tinted=new Map,this.units=new Map,this.max_size=t||1/0,this.clear()}clear(){this.cache.clear(),this.tinted.clear(),this.units.clear(),this.length=0}validate(){if(this.length>=this.max_size)throw new Error("Texture cache overflow: "+this.max_size+" texture units available for this GPU.")}get(t,e){return this.cache.has(t)||(e||(e=createAtlas(t.width,t.height,t.src?utils$1.file.getBasename(t.src):void 0)),this.set(t,new Texture(e,t,!1))),this.cache.get(t)}tint(t,e){var i=this.tinted.get(t);return void 0===i&&(i=this.tinted.set(t,new Map)),i.has(e)||i.set(e,video$1.renderer.tint(t,e,"multiply")),i.get(e)}set(t,e){var i=t.width,r=t.height;if(!(1!==video$1.renderer.WebGLVersion||isPowerOfTwo(i)&&isPowerOfTwo(r))){var n=void 0!==t.src?t.src:t;console.warn("[Texture] "+n+" is not a POT texture ("+i+"x"+r+")")}this.cache.set(t,e)}getUnit(t){return this.units.has(t)||(this.validate(),this.units.set(t,this.length++)),this.units.get(t)}}function createAtlas(t,e,i="default",r="no-repeat"){return{meta:{app:"melonJS",size:{w:t,h:e},repeat:r,image:"default"},frames:[{filename:i,frame:{x:0,y:0,w:t,h:e}}]}}class Texture{constructor(t,e,i){if(this.format=null,this.sources=new Map,this.atlases=new Map,void 0!==t)for(var r in t=Array.isArray(t)?t:[t]){var n=t[r];if(void 0!==n.meta){if(n.meta.app.includes("texturepacker")||n.meta.app.includes("free-tex-packer")){if(this.format="texturepacker",void 0===e){var s=loader$1.getImage(n.meta.image);if(!s)throw new Error("Atlas texture '"+s+"' not found");this.sources.set(n.meta.image,s)}else this.sources.set(n.meta.image||"default","string"==typeof e?loader$1.getImage(e):e);this.repeat="no-repeat"}else if(n.meta.app.includes("ShoeBox")){if(!n.meta.exporter||!n.meta.exporter.includes("melonJS"))throw new Error("ShoeBox requires the JSON exporter : https://github.com/melonjs/melonJS/tree/master/media/shoebox_JSON_export.sbx");this.format="ShoeBox",this.repeat="no-repeat",this.sources.set("default","string"==typeof e?loader$1.getImage(e):e)}else n.meta.app.includes("melonJS")&&(this.format="melonJS",this.repeat=n.meta.repeat||"no-repeat",this.sources.set("default","string"==typeof e?loader$1.getImage(e):e));this.atlases.set(n.meta.image||"default",this.parse(n))}else void 0!==n.framewidth&&void 0!==n.frameheight&&(this.format="Spritesheet (fixed cell size)",this.repeat="no-repeat",void 0!==e&&(n.image="string"==typeof e?loader$1.getImage(e):e),this.atlases.set("default",this.parseFromSpriteSheet(n)),this.sources.set("default",n.image))}if(0===this.atlases.length)throw new Error("texture atlas format not supported");!1!==i&&this.sources.forEach((function(t){i instanceof TextureCache?i.set(t,this):video$1.renderer.cache.set(t,this)}))}parse(t){var e={},i=this;return t.frames.forEach((function(r){if(r.hasOwnProperty("filename")){var n,s,o=r.frame,a=r.spriteSourceSize&&r.sourceSize&&r.pivot;a&&(n=r.sourceSize.w*r.pivot.x-(r.trimmed?r.spriteSourceSize.x:0),s=r.sourceSize.h*r.pivot.y-(r.trimmed?r.spriteSourceSize.y:0)),e[r.filename]={name:r.filename,texture:t.meta.image||"default",offset:new Vector2d(o.x,o.y),anchorPoint:a?new Vector2d(n/o.w,s/o.h):null,trimmed:!!r.trimmed,width:o.w,height:o.h,angle:!0===r.rotated?-ETA:0},i.addUvsMap(e,r.filename,t.meta.size.w,t.meta.size.h)}})),e}parseFromSpriteSheet(t){var e={},i=t.image,r=t.spacing||0,n=t.margin||0,s=i.width,o=i.height,a=pool.pull("Vector2d",~~((s-n+r)/(t.framewidth+r)),~~((o-n+r)/(t.frameheight+r)));if(s%(t.framewidth+r)!=0||o%(t.frameheight+r)!=0){var h=a.x*(t.framewidth+r),l=a.y*(t.frameheight+r);h-s!==r&&l-o!==r&&(s=h,o=l,console.warn("Spritesheet Texture for image: "+i.src+" is not divisible by "+(t.framewidth+r)+"x"+(t.frameheight+r)+", truncating effective size to "+s+"x"+o))}for(var u=0,c=a.x*a.y;u<c;u++){var d=""+u;e[d]={name:d,texture:"default",offset:new Vector2d(n+(r+t.framewidth)*(u%a.x),n+(r+t.frameheight)*~~(u/a.x)),anchorPoint:t.anchorPoint||null,trimmed:!1,width:t.framewidth,height:t.frameheight,angle:0},this.addUvsMap(e,d,s,o)}return pool.push(a),e}addUvsMap(t,e,i,r){if(video$1.renderer instanceof WebGLRenderer){var n=t[e].offset,s=t[e].width,o=t[e].height;t[e].uvs=new Float32Array([n.x/i,n.y/r,(n.x+s)/i,(n.y+o)/r]),t[n.x+","+n.y+","+i+","+r]=t[e]}return t[e]}addQuadRegion(t,e,i,r,n){!0===video$1.renderer.settings.verbose&&console.warn("Adding texture region",t,"for texture",this);var s=this.getTexture(),o=this.getAtlas(),a=s.width,h=s.height;return o[t]={name:t,offset:new Vector2d(e,i),width:r,height:n,angle:0},this.addUvsMap(o,t,a,h),o[t]}getAtlas(t){return"string"==typeof t?this.atlases.get(t):this.atlases.values().next().value}getFormat(){return this.format}getTexture(t){return"object"==typeof t&&"string"==typeof t.texture?this.sources.get(t.texture):this.sources.values().next().value}getRegion(t,e){var i;return"string"==typeof e?i=this.getAtlas(e)[t]:this.atlases.forEach((function(e){void 0!==e[t]&&(i=e[t])})),i}getUVs(t){var e=this.getRegion(t);if(void 0===e){var i=t.split(","),r=+i[0],n=+i[1],s=+i[2],o=+i[3];e=this.addQuadRegion(t,r,n,s,o)}return e.uvs}createSpriteFromName(t,e){return pool.pull("me.Sprite",0,0,Object.assign({image:this,region:t},e||{}))}createAnimationFromName(t,e){for(var i,r=[],n={},s=0,o=0,a=0;a<t.length;++a){if(null==(i=this.getRegion(t[a])))throw new Error("Texture - region for "+t[a]+" not found");r[a]=i,n[t[a]]=a,s=Math.max(i.width,s),o=Math.max(i.height,o)}return new Sprite(0,0,Object.assign({image:this,framewidth:s,frameheight:o,margin:0,spacing:0,atlas:r,atlasIndices:n},e||{}))}}var Sprite=Renderable.extend({init:function(t,e,i){if(this.animationpause=!1,this.animationspeed=100,this.offset=pool.pull("Vector2d",0,0),this.source=null,this.anim={},this.resetAnim=void 0,this.current={name:"default",length:0,offset:new Vector2d,width:0,height:0,angle:0,idx:0},this.dt=0,this._flicker={isFlickering:!1,duration:0,callback:null,state:!1},this._super(Renderable,"init",[t,e,0,0]),i.image instanceof Texture){if(this.source=i.image,this.image=this.source.getTexture(),this.textureAtlas=i.image,void 0!==i.region){var r=this.source.getRegion(i.region);if(!r)throw new Error("Texture - region for "+i.region+" not found");this.setRegion(r),this.current.width=i.framewidth||r.width,this.current.height=i.frameheight||r.height}}else{if(this.image="object"==typeof i.image?i.image:loader$1.getImage(i.image),!this.image)throw new Error("me.Sprite: '"+i.image+"' image/texture not found!");this.current.width=i.framewidth=i.framewidth||this.image.width,this.current.height=i.frameheight=i.frameheight||this.image.height,this.source=video$1.renderer.cache.get(this.image,i),this.textureAtlas=this.source.getAtlas()}void 0!==i.atlas&&(this.textureAtlas=i.atlas,this.atlasIndices=i.atlasIndices),this.width=this.current.width,this.height=this.current.height,void 0!==i.flipX&&this.flipX(!!i.flipX),void 0!==i.flipY&&this.flipY(!!i.flipY),void 0!==i.rotation&&this.currentTransform.rotate(i.rotation),i.anchorPoint&&this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y),void 0!==i.tint&&this.tint.setColor(i.tint),"string"==typeof i.name&&(this.name=i.name),void 0!==i.z&&(this.pos.z=i.z),0!==this.addAnimation("default",null)&&this.setCurrentAnimation("default"),this.autoTransform=!0},isFlickering:function(){return this._flicker.isFlickering},flicker:function(t,e){return this._flicker.duration=t,this._flicker.duration<=0?(this._flicker.isFlickering=!1,this._flicker.callback=null):this._flicker.isFlickering||(this._flicker.callback=e,this._flicker.isFlickering=!0),this},addAnimation:function(t,e,i){this.anim[t]={name:t,frames:[],idx:0,length:0};var r=0;if("object"!=typeof this.textureAtlas)return 0;null==e&&(e=[],Object.keys(this.textureAtlas).forEach((function(t,i){e[i]=i})));for(var n=0,s=e.length;n<s;n++){var o,a=e[n],h=(o="number"==typeof a||"string"==typeof a?{name:a,delay:i||this.animationspeed}:a).name;if("number"==typeof h)void 0!==this.textureAtlas[h]&&(this.anim[t].frames[n]=Object.assign({},this.textureAtlas[h],o),r++);else{if(this.source.getFormat().includes("Spritesheet"))throw new Error("string parameters for addAnimation are not allowed for standard spritesheet based Texture");this.anim[t].frames[n]=Object.assign({},this.textureAtlas[this.atlasIndices[h]],o),r++}}return this.anim[t].length=r,r},setCurrentAnimation:function(t,e,i){if(!this.anim[t])throw new Error("animation id '"+t+"' not defined");return this.current.name=t,this.current.length=this.anim[this.current.name].length,this.resetAnim="string"==typeof e?this.setCurrentAnimation.bind(this,e,null,!0):"function"==typeof e?e:void 0,this.setAnimationFrame(this.current.idx),i||(this.dt=0),this.isDirty=!0,this},reverseAnimation:function(t){return void 0!==t&&void 0!==this.anim[t]?this.anim[t].frames.reverse():this.anim[this.current.name].frames.reverse(),this.isDirty=!0,this},isCurrentAnimation:function(t){return this.current.name===t},setRegion:function(t){return this.image=this.source.getTexture(t),this.current.offset.setV(t.offset),this.current.angle=t.angle,this.width=this.current.width=t.width,this.height=this.current.height=t.height,t.anchorPoint&&this.anchorPoint.set(this._flip.x&&!0===t.trimmed?1-t.anchorPoint.x:t.anchorPoint.x,this._flip.y&&!0===t.trimmed?1-t.anchorPoint.y:t.anchorPoint.y),this.isDirty=!0,this},setAnimationFrame:function(t){return this.current.idx=(t||0)%this.current.length,this.setRegion(this.getAnimationFrameObjectByIndex(this.current.idx))},getCurrentAnimationFrame:function(){return this.current.idx},getAnimationFrameObjectByIndex:function(t){return this.anim[this.current.name].frames[t]},update:function(t){if(!this.animationpause&&this.current&&this.current.length>0){var e=this.getAnimationFrameObjectByIndex(this.current.idx).delay;for(this.dt+=t;this.dt>=e;){this.isDirty=!0,this.dt-=e;var i=this.current.length>1?this.current.idx+1:this.current.idx;if(this.setAnimationFrame(i),0===this.current.idx&&"function"==typeof this.resetAnim&&!1===this.resetAnim()){this.setAnimationFrame(this.current.length-1),this.dt%=e;break}e=this.getAnimationFrameObjectByIndex(this.current.idx).delay}}return this._flicker.isFlickering&&(this._flicker.duration-=t,this._flicker.duration<0&&("function"==typeof this._flicker.callback&&this._flicker.callback(),this.flicker(-1)),this.isDirty=!0),this.isDirty},destroy:function(){pool.push(this.offset),this.offset=void 0,this._super(Renderable,"destroy")},draw:function(t){if(!this._flicker.isFlickering||(this._flicker.state=!this._flicker.state,this._flicker.state)){var e=this.current,i=this.pos.x,r=this.pos.y,n=e.width,s=e.height,o=e.offset,a=this.offset;0!==e.angle&&(t.translate(-i,-r),t.rotate(e.angle),i-=s,n=e.height,s=e.width),t.drawImage(this.image,a.x+o.x,a.y+o.y,n,s,i,r,n,s)}}}),TMX_FLIP_H=2147483648,TMX_FLIP_V=1073741824,TMX_FLIP_AD=536870912,TMX_CLEAR_BIT_MASK$1=536870911;class Tile extends Bounds$1{constructor(t,e,i,r){var n,s;if(super(),r.isCollection){var o=r.getTileImage(i&TMX_CLEAR_BIT_MASK$1);n=o.width,s=o.height}else n=r.tilewidth,s=r.tileheight;this.setMinMax(0,0,n,s),this.tileset=r,this.currentTransform=null,this.col=t,this.row=e,this.tileId=i,this.flippedX=0!=(this.tileId&TMX_FLIP_H),this.flippedY=0!=(this.tileId&TMX_FLIP_V),this.flippedAD=0!=(this.tileId&TMX_FLIP_AD),this.flipped=this.flippedX||this.flippedY||this.flippedAD,!0===this.flipped&&(null===this.currentTransform&&(this.currentTransform=new Matrix2d),this.setTileTransform(this.currentTransform.identity())),this.tileId&=TMX_CLEAR_BIT_MASK$1}setTileTransform(t){t.translate(this.width/2,this.height/2),this.flippedAD&&(t.rotate(-90*Math.PI/180),t.scale(-1,1)),this.flippedX&&t.scale(this.flippedAD?1:-1,this.flippedAD?-1:1),this.flippedY&&t.scale(this.flippedAD?-1:1,this.flippedAD?1:-1),t.translate(-this.width/2,-this.height/2)}getRenderable(t){var e,i=this.tileset;if(i.animations.has(this.tileId)){var r=[],n=[];i.animations.get(this.tileId).frames.forEach((function(t){n.push(t.tileid),r.push({name:""+t.tileid,delay:t.duration})})),(e=i.texture.createAnimationFromName(n,t)).addAnimation(this.tileId-i.firstgid,r),e.setCurrentAnimation(this.tileId-i.firstgid)}else if(!0===i.isCollection){var s=i.getTileImage(this.tileId);(e=new Sprite(0,0,Object.assign({image:s}))).anchorPoint.set(0,0),e.scale(t.width/this.width,t.height/this.height),void 0!==t.rotation&&(e.anchorPoint.set(.5,.5),e.currentTransform.rotate(t.rotation),e.currentTransform.translate(t.width/2,t.height/2),t.rotation=void 0)}else(e=i.texture.createSpriteFromName(this.tileId-i.firstgid,t)).anchorPoint.set(0,0);return this.setTileTransform(e.currentTransform),e}}var Line=Polygon.extend({contains:function(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),t-=this.pos.x,e-=this.pos.y;var i=this.points[0],r=this.points[1];return(e-i.y)*(r.x-i.x)==(r.y-i.y)*(t-i.x)},recalc:function(){var t=this.edges,e=this.normals,i=this.indices,r=this.points;if(2!==r.length)throw new Error("Requires exactly 2 points");return void 0===t[0]&&(t[0]=new Vector2d),t[0].copy(r[1]).sub(r[0]),void 0===e[0]&&(e[0]=new Vector2d),e[0].copy(t[0]).perp().normalize(),i.length=0,this},clone:function(){var t=[];return this.points.forEach((function(e){t.push(e.clone())})),new Line(this.pos.x,this.pos.y,t)}});class Renderer{constructor(t){return this.settings=t,this.isContextValid=!0,this.currentScissor=new Int32Array([0,0,this.settings.width,this.settings.height]),this.currentBlendMode="normal",!0===device$1.ejecta?this.canvas=document.getElementById("canvas"):void 0!==window.canvas?this.canvas=window.canvas:void 0!==this.settings.canvas?this.canvas=this.settings.canvas:this.canvas=video$1.createCanvas(this.settings.zoomX,this.settings.zoomY),this.backBufferCanvas=this.canvas,this.context=null,this.currentColor=new Color(0,0,0,1),this.currentTint=new Color(255,255,255,1),this.projectionMatrix=new Matrix3d,this.uvOffset=0,this.Texture=Texture,event.subscribe(event.GAME_RESET,(function(){video$1.renderer.reset()})),this}clear(){}reset(){this.resetTransform(),this.setBlendMode(this.settings.blendMode),this.setColor("#000000"),this.clearTint(),this.cache.clear(),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height}getCanvas(){return this.backBufferCanvas}getScreenCanvas(){return this.canvas}getScreenContext(){return this.context}getBlendMode(){return this.currentBlendMode}getContext2d(t,e){if(null==t)throw new Error("You must pass a canvas element in order to create a 2d context");if(void 0===t.getContext)throw new Error("Your browser does not support HTML5 canvas.");"boolean"!=typeof e&&(e=!0);var i=t.getContext("2d",{alpha:e});return i.canvas||(i.canvas=t),this.setAntiAlias(i,this.settings.antiAlias),i}getWidth(){return this.backBufferCanvas.width}getHeight(){return this.backBufferCanvas.height}getColor(){return this.currentColor}globalAlpha(){return this.currentColor.glArray[3]}overlaps(t){return t.left<=this.getWidth()&&t.right>=0&&t.top<=this.getHeight()&&t.bottom>=0}resize(t,e){t===this.backBufferCanvas.width&&e===this.backBufferCanvas.height||(this.canvas.width=this.backBufferCanvas.width=t,this.canvas.height=this.backBufferCanvas.height=e,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=t,this.currentScissor[3]=e,event.publish(event.CANVAS_ONRESIZE,[t,e]))}setAntiAlias(t,e){var i=t.canvas;setPrefixed("imageSmoothingEnabled",!0===e,t),!0!==e?(i.style["image-rendering"]="optimizeSpeed",i.style["image-rendering"]="-moz-crisp-edges",i.style["image-rendering"]="-o-crisp-edges",i.style["image-rendering"]="-webkit-optimize-contrast",i.style["image-rendering"]="optimize-contrast",i.style["image-rendering"]="crisp-edges",i.style["image-rendering"]="pixelated",i.style.msInterpolationMode="nearest-neighbor"):i.style["image-rendering"]="auto"}setProjection(t){this.projectionMatrix.copy(t)}stroke(t,e){t instanceof Rect||t instanceof Bounds$1?this.strokeRect(t.left,t.top,t.width,t.height,e):t instanceof Line||t instanceof Polygon?this.strokePolygon(t,e):t instanceof Ellipse&&this.strokeEllipse(t.pos.x,t.pos.y,t.radiusV.x,t.radiusV.y,e)}tint(t,e,i){var r=video$1.createCanvas(t.width,t.height,!0),n=this.getContext2d(r);return n.save(),n.fillStyle=e instanceof Color?e.toRGB():e,n.fillRect(0,0,t.width,t.height),n.globalCompositeOperation=i||"multiply",n.drawImage(t,0,0),n.globalCompositeOperation="destination-atop",n.drawImage(t,0,0),n.restore(),r}fill(t){this.stroke(t,!0)}setMask(t){}clearMask(){}setTint(t){this.currentTint.copy(t)}clearTint(){this.currentTint.setColor(255,255,255,1)}drawFont(){}}class CanvasRenderer extends Renderer{constructor(t){return super(t),this.context=this.getContext2d(this.getScreenCanvas(),this.settings.transparent),this.settings.doubleBuffering?(this.backBufferCanvas=video$1.createCanvas(this.settings.width,this.settings.height,!0),this.backBufferContext2D=this.getContext2d(this.backBufferCanvas)):(this.backBufferCanvas=this.getScreenCanvas(),this.backBufferContext2D=this.context),this.setBlendMode(this.settings.blendMode),this.setColor(this.currentColor),this.cache=new TextureCache,!1===this.settings.textureSeamFix||this.settings.antiAlias||(this.uvOffset=1),this}reset(){super.reset(),this.clearColor(this.currentColor,!0!==this.settings.transparent)}resetTransform(){this.backBufferContext2D.setTransform(1,0,0,1,0,0)}setBlendMode(t,e){e=e||this.getContext(),this.currentBlendMode=t,"multiply"===t?e.globalCompositeOperation="multiply":(e.globalCompositeOperation="source-over",this.currentBlendMode="normal"),this.settings.doubleBuffering&&this.settings.transparent&&(this.context.globalCompositeOperation="copy")}clear(){this.settings.transparent&&this.clearColor("rgba(0,0,0,0)",!0)}flush(){this.settings.doubleBuffering&&this.context.drawImage(this.backBufferCanvas,0,0)}clearColor(t,e){this.save(),this.resetTransform(),this.backBufferContext2D.globalCompositeOperation=e?"copy":"source-over",this.backBufferContext2D.fillStyle=t instanceof Color?t.toRGBA():t,this.fillRect(0,0,this.backBufferCanvas.width,this.backBufferCanvas.height),this.restore()}clearRect(t,e,i,r){this.backBufferContext2D.clearRect(t,e,i,r)}createPattern(t,e){return this.backBufferContext2D.createPattern(t,e)}drawImage(t,e,i,r,n,s,o,a,h){if(!(this.backBufferContext2D.globalAlpha<1/255)){void 0===r?(r=a=t.width,n=h=t.height,s=e,o=i,e=0,i=0):void 0===s&&(s=e,o=i,a=r,h=n,r=t.width,n=t.height,e=0,i=0),!1===this.settings.subPixel&&(s=~~s,o=~~o);var l=t,u=this.currentTint.toArray();1===u[0]&&1===u[1]&&1===u[2]||(l=this.cache.tint(t,this.currentTint.toRGB())),this.backBufferContext2D.drawImage(l,e,i,r,n,s,o,a,h)}}drawPattern(t,e,i,r,n){if(!(this.backBufferContext2D.globalAlpha<1/255)){var s=this.backBufferContext2D.fillStyle;this.backBufferContext2D.fillStyle=t,this.backBufferContext2D.fillRect(e,i,r,n),this.backBufferContext2D.fillStyle=s}}strokeArc(t,e,i,r,n,s,o){var a=this.backBufferContext2D;a.globalAlpha<1/255||(a.translate(t,e),a.beginPath(),a.arc(0,0,i,r,n,s||!1),a[!0===o?"fill":"stroke"](),a.translate(-t,-e))}fillArc(t,e,i,r,n,s){this.strokeArc(t,e,i,r,n,s||!1,!0)}strokeEllipse(t,e,i,r,n){var s=this.backBufferContext2D;if(!(s.globalAlpha<1/255)){var o=t-i,a=t+i,h=e-r,l=e+r,u=.551784*i,c=.551784*r,d=t-u,p=t+u,f=e-c,g=e+c;s.beginPath(),s.moveTo(t,h),s.bezierCurveTo(p,h,a,f,a,e),s.bezierCurveTo(a,g,p,l,t,l),s.bezierCurveTo(d,l,o,g,o,e),s.bezierCurveTo(o,f,d,h,t,h),s[!0===n?"fill":"stroke"](),s.closePath()}}fillEllipse(t,e,i,r){this.strokeEllipse(t,e,i,r,!0)}strokeLine(t,e,i,r){var n=this.backBufferContext2D;n<1/255||(n.beginPath(),n.moveTo(t,e),n.lineTo(i,r),n.stroke())}fillLine(t,e,i,r){this.strokeLine(t,e,i,r)}strokePolygon(t,e){var i=this.backBufferContext2D;if(!(i.globalAlpha<1/255)){var r;this.translate(t.pos.x,t.pos.y),i.beginPath(),i.moveTo(t.points[0].x,t.points[0].y);for(var n=1;n<t.points.length;n++)r=t.points[n],i.lineTo(r.x,r.y);i.lineTo(t.points[0].x,t.points[0].y),i[!0===e?"fill":"stroke"](),i.closePath(),this.translate(-t.pos.x,-t.pos.y)}}fillPolygon(t){this.strokePolygon(t,!0)}strokeRect(t,e,i,r,n){if(!0===n)this.fillRect(t,e,i,r);else{if(this.backBufferContext2D.globalAlpha<1/255)return;this.backBufferContext2D.strokeRect(t,e,i,r)}}fillRect(t,e,i,r){this.backBufferContext2D.globalAlpha<1/255||this.backBufferContext2D.fillRect(t,e,i,r)}getContext(){return this.backBufferContext2D}getFontContext(){return this.getContext()}save(){this.backBufferContext2D.save()}restore(){this.backBufferContext2D.restore(),this.currentColor.glArray[3]=this.backBufferContext2D.globalAlpha,this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height}rotate(t){this.backBufferContext2D.rotate(t)}scale(t,e){this.backBufferContext2D.scale(t,e)}setColor(t){this.backBufferContext2D.strokeStyle=this.backBufferContext2D.fillStyle=t instanceof Color?t.toRGBA():t}setGlobalAlpha(t){this.backBufferContext2D.globalAlpha=this.currentColor.glArray[3]=t}setLineWidth(t){this.backBufferContext2D.lineWidth=t}setTransform(t){this.resetTransform(),this.transform(t)}transform(t){var e=t.toArray(),i=e[0],r=e[1],n=e[3],s=e[4],o=e[6],a=e[7];!1===this.settings.subPixel&&(o|=0,a|=0),this.backBufferContext2D.transform(i,r,n,s,o,a)}translate(t,e){!1===this.settings.subPixel?this.backBufferContext2D.translate(~~t,~~e):this.backBufferContext2D.translate(t,e)}clipRect(t,e,i,r){var n=this.backBufferCanvas;if(0!==t||0!==e||i!==n.width||r!==n.height){var s=this.currentScissor;if(s[0]!==t||s[1]!==e||s[2]!==i||s[3]!==r){var o=this.backBufferContext2D;o.beginPath(),o.rect(t,e,i,r),o.clip(),s[0]=t,s[1]=e,s[2]=i,s[3]=r}}}setMask(t){var e=this.backBufferContext2D,i=t.pos.x,r=t.pos.y;if(t instanceof Ellipse){var n=t.radiusV.x,s=t.radiusV.y,o=i-n,a=i+n,h=r-s,l=r+s,u=.551784*n,c=.551784*s,d=i-u,p=i+u,f=r-c,g=r+c;e.beginPath(),e.moveTo(i,h),e.bezierCurveTo(p,h,a,f,a,r),e.bezierCurveTo(a,g,p,l,i,l),e.bezierCurveTo(d,l,o,g,o,r),e.bezierCurveTo(o,f,d,h,i,h)}else{var v;e.save(),e.beginPath(),e.moveTo(i+t.points[0].x,r+t.points[0].y);for(var m=1;m<t.points.length;m++)v=t.points[m],e.lineTo(i+v.x,r+v.y);e.closePath()}e.clip()}clearMask(){this.backBufferContext2D.restore()}}function initArray(t){t.layerData=new Array(t.cols);for(var e=0;e<t.cols;e++){t.layerData[e]=new Array(t.rows);for(var i=0;i<t.rows;i++)t.layerData[e][i]=null}}function setLayerData(t,e){var i=0;initArray(t);for(var r=0;r<t.rows;r++)for(var n=0;n<t.cols;n++){var s=e[i++];0!==s&&(t.layerData[n][r]=t.getTileById(s,n,r))}}function preRenderLayer(t,e){for(var i=0;i<t.rows;i++)for(var r=0;r<t.cols;r++){var n=t.layerData[r][i];n instanceof Tile&&t.getRenderer().drawTile(e,r,i,n)}}var TMXLayer=Renderable.extend({init:function(t,e,i,r,n,s,o){this._super(Renderable,"init",[0,0,0,0]),this.tilewidth=e.tilewidth||i,this.tileheight=e.tileheight||r,this.orientation=n,this.tilesets=s,this.tileset=this.tilesets?this.tilesets.getTilesetByIndex(0):null,this.maxTileSize={width:0,height:0};for(var a=0;a<this.tilesets.length;a++){var h=this.tilesets.getTilesetByIndex(a);this.maxTileSize.width=Math.max(this.maxTileSize.width,h.tilewidth),this.maxTileSize.height=Math.max(this.maxTileSize.height,h.tileheight)}this.animatedTilesets=[],this.isAnimated=!1,this.renderorder=e.renderorder||"right-down",this.pos.z=o,this.anchorPoint.set(0,0),this.name=e.name,this.cols=+e.width,this.rows=+e.height;var l=void 0!==e.visible?+e.visible:1;this.setOpacity(l?+e.opacity:0),"string"==typeof e.tintcolor&&this.tint.parseHex(e.tintcolor,!0),"isometric"===this.orientation?(this.width=(this.cols+this.rows)*(this.tilewidth/2),this.height=(this.cols+this.rows)*(this.tileheight/2)):(this.width=this.cols*this.tilewidth,this.height=this.rows*this.tileheight),applyTMXProperties(this,e),void 0===this.preRender&&(this.preRender=game$1.world.preRender),this.setRenderer(t.getRenderer()),setLayerData(this,decode(e.data,e.encoding,e.compression))},onActivateEvent:function(){if(void 0===this.animatedTilesets&&(this.animatedTilesets=[]),this.tilesets)for(var t=this.tilesets.tilesets,e=0;e<t.length;e++)t[e].isAnimated&&this.animatedTilesets.push(t[e]);this.isAnimated=this.animatedTilesets.length>0,this.isAnimated&&(this.preRender=!1),this.getBounds().addBounds(this.getRenderer().getBounds(),!0),this.getBounds().shift(this.pos),!0!==this.preRender||this.canvasRenderer||(this.canvasRenderer=new CanvasRenderer({canvas:video$1.createCanvas(this.width,this.height),widht:this.width,heigth:this.height,transparent:!0}),preRenderLayer(this,this.canvasRenderer))},onDeactivateEvent:function(){this.animatedTilesets=void 0},setRenderer:function(t){this.renderer=t},getRenderer:function(){return this.renderer},getTileId:function(t,e){var i=this.getTile(t,e);return i?i.tileId:null},getTile:function(t,e){var i=null;if(this.contains(t,e)){var r=this.getRenderer().pixelToTileCoords(t,e,pool.pull("Vector2d"));i=this.cellAt(r.x,r.y),pool.push(r)}return i},setTile:function(t,e,i){return this.layerData[e][i]=t,t},getTileById:function(t,e,i){return this.tileset.contains(t)||(this.tileset=this.tilesets.getTilesetByGid(t)),new Tile(e,i,t,this.tileset)},cellAt:function(t,e,i){var r=~~t,n=~~e,s=this.getRenderer();return!1===i||r>=0&&r<s.cols&&n>=0&&n<s.rows?this.layerData[r][n]:null},clearTile:function(t,e){this.layerData[t][e]=null,this.preRender&&this.canvasRenderer.clearRect(t*this.tilewidth,e*this.tileheight,this.tilewidth,this.tileheight)},update:function(t){if(this.isAnimated){for(var e=!1,i=0;i<this.animatedTilesets.length;i++)e=this.animatedTilesets[i].update(t)||e;return e}return!1},draw:function(t,e){if(this.preRender){var i=Math.min(e.width,this.width),r=Math.min(e.height,this.height);t.drawImage(this.canvasRenderer.getCanvas(),e.pos.x,e.pos.y,i,r,e.pos.x,e.pos.y,i,r)}else this.getRenderer().drawTileLayer(t,this,e)}});class Bounds{constructor(t){this.onResetEvent(t)}onResetEvent(t){void 0===this.min?(this.min={x:1/0,y:1/0},this.max={x:-1/0,y:-1/0}):this.clear(),void 0!==t&&this.update(t),this._center=new Vector2d}clear(){this.setMinMax(1/0,1/0,-1/0,-1/0)}setMinMax(t,e,i,r){this.min.x=t,this.min.y=e,this.max.x=i,this.max.y=r}get x(){return this.min.x}set x(t){var e=this.max.x-this.min.x;this.min.x=t,this.max.x=t+e}get y(){return this.min.y}set y(t){var e=this.max.y-this.min.y;this.min.y=t,this.max.y=t+e}get width(){return this.max.x-this.min.x}set width(t){this.max.x=this.min.x+t}get height(){return this.max.y-this.min.y}set height(t){this.max.y=this.min.y+t}get left(){return this.min.x}get right(){return this.max.x}get top(){return this.min.y}get bottom(){return this.max.y}get centerX(){return this.min.x+this.width/2}get centerY(){return this.min.y+this.height/2}get center(){return this._center.set(this.centerX,this.centerY)}update(t){this.add(t,!0)}add(t,e=!1){!0===e&&this.clear();for(var i=0;i<t.length;i++){var r=t[i];r.x>this.max.x&&(this.max.x=r.x),r.x<this.min.x&&(this.min.x=r.x),r.y>this.max.y&&(this.max.y=r.y),r.y<this.min.y&&(this.min.y=r.y)}}addBounds(t,e=!1){!0===e&&this.clear(),t.max.x>this.max.x&&(this.max.x=t.max.x),t.min.x<this.min.x&&(this.min.x=t.min.x),t.max.y>this.max.y&&(this.max.y=t.max.y),t.min.y<this.min.y&&(this.min.y=t.min.y)}addPoint(t,e){void 0!==e&&(t=e.apply(t)),this.min.x=Math.min(this.min.x,t.x),this.max.x=Math.max(this.max.x,t.x),this.min.y=Math.min(this.min.y,t.y),this.max.y=Math.max(this.max.y,t.y)}addFrame(t,e,i,r,n){var s=me.pool.pull("Vector2d");this.addPoint(s.set(t,e),n),this.addPoint(s.set(i,e),n),this.addPoint(s.set(t,r),n),this.addPoint(s.set(i,r),n),me.pool.push(s)}contains(){var t,e,i,r,n=arguments[0];return 2===arguments.length?(t=e=n,i=r=arguments[1]):n instanceof Bounds?(t=n.min.x,e=n.max.x,i=n.min.y,r=n.max.y):(t=e=n.x,i=r=n.y),t>=this.min.x&&e<=this.max.x&&i>=this.min.y&&r<=this.max.y}overlaps(t){return this.left<=t.right&&this.right>=t.left&&this.bottom>=t.top&&this.top<=t.bottom}isFinite(){return isFinite(this.min.x)&&isFinite(this.max.x)&&isFinite(this.min.y)&&isFinite(this.max.y)}translate(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y),this.min.x+=t,this.max.x+=t,this.min.y+=e,this.max.y+=e}shift(){var t,e;2===arguments.length?(t=arguments[0],e=arguments[1]):(t=arguments[0].x,e=arguments[0].y);var i=this.max.x-this.min.x,r=this.max.y-this.min.y;this.min.x=t,this.max.x=t+i,this.min.y=e,this.max.y=e+r}clone(){var t=new Bounds;return t.addBounds(this),t}toPolygon(){return new Polygon(this.x,this.y,[new Vector2d(0,0),new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)])}}class TMXRenderer{constructor(t,e,i,r){this.cols=t,this.rows=e,this.tilewidth=i,this.tileheight=r,this.bounds=new Bounds}canRender(t){return this.tilewidth===t.tilewidth&&this.tileheight===t.tileheight}getBounds(t){var e=t instanceof TMXLayer?pool.pull("Bounds"):this.bounds;return e.setMinMax(0,0,this.cols*this.tilewidth,this.rows*this.tileheight),e}pixelToTileCoords(t,e,i){return i}tileToPixelCoords(t,e,i){return i}drawTile(t,e,i,r){}drawTileLayer(t,e,i){}}class TMXOrthogonalRenderer extends TMXRenderer{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight)}canRender(t){return"orthogonal"===t.orientation&&super.canRender(t)}pixelToTileCoords(t,e,i){return(i||new Vector2d).set(t/this.tilewidth,e/this.tileheight)}tileToPixelCoords(t,e,i){return(i||new Vector2d).set(t*this.tilewidth,e*this.tileheight)}adjustPosition(t){"number"==typeof t.gid&&(t.y-=t.height)}drawTile(t,e,i,r){var n=r.tileset;n.drawTile(t,n.tileoffset.x+e*this.tilewidth,n.tileoffset.y+(i+1)*this.tileheight-n.tileheight,r)}drawTileLayer(t,e,i){var r=1,n=1,s=this.pixelToTileCoords(Math.max(i.pos.x-(e.maxTileSize.width-e.tilewidth),0),Math.max(i.pos.y-(e.maxTileSize.height-e.tileheight),0),pool.pull("Vector2d")).floorSelf(),o=this.pixelToTileCoords(i.pos.x+i.width+this.tilewidth,i.pos.y+i.height+this.tileheight,pool.pull("Vector2d")).ceilSelf();switch(o.x=o.x>this.cols?this.cols:o.x,o.y=o.y>this.rows?this.rows:o.y,e.renderorder){case"right-up":o.y=s.y+(s.y=o.y)-o.y,n=-1;break;case"left-down":o.x=s.x+(s.x=o.x)-o.x,r=-1;break;case"left-up":o.x=s.x+(s.x=o.x)-o.x,o.y=s.y+(s.y=o.y)-o.y,r=-1,n=-1}for(var a=s.y;a!==o.y;a+=n)for(var h=s.x;h!==o.x;h+=r){var l=e.cellAt(h,a,!1);l&&this.drawTile(t,h,a,l)}pool.push(s),pool.push(o)}}class TMXIsometricRenderer extends TMXRenderer{constructor(t){super(t.cols,t.rows,t.tilewidth,t.tileheight),this.hTilewidth=this.tilewidth/2,this.hTileheight=this.tileheight/2,this.originX=this.rows*this.hTilewidth}canRender(t){return"isometric"===t.orientation&&super.canRender(t)}getBounds(t){var e=t instanceof TMXLayer?pool.pull("Bounds"):this.bounds;return e.setMinMax(0,0,(this.cols+this.rows)*(this.tilewidth/2),(this.cols+this.rows)*(this.tileheight/2)),e}pixelToTileCoords(t,e,i){return(i||new Vector2d).set(e/this.tileheight+(t-this.originX)/this.tilewidth,e/this.tileheight-(t-this.originX)/this.tilewidth)}tileToPixelCoords(t,e,i){return(i||new Vector2d).set((t-e)*this.hTilewidth+this.originX,(t+e)*this.hTileheight)}adjustPosition(t){var e=t.x/this.hTilewidth,i=t.y/this.tileheight,r=pool.pull("Vector2d");this.tileToPixelCoords(e,i,r),t.x=r.x,t.y=r.y,pool.push(r)}drawTile(t,e,i,r){var n=r.tileset;n.drawTile(t,(this.cols-1)*n.tilewidth+(e-i)*n.tilewidth>>1,-n.tilewidth+(e+i)*n.tileheight>>2,r)}drawTileLayer(t,e,i){var r=e.tileset,n=this.pixelToTileCoords(i.pos.x-r.tilewidth,i.pos.y-r.tileheight,pool.pull("Vector2d")).floorSelf(),s=this.pixelToTileCoords(i.pos.x+i.width+r.tilewidth,i.pos.y+i.height+r.tileheight,pool.pull("Vector2d")).ceilSelf(),o=this.tileToPixelCoords(s.x,s.y,pool.pull("Vector2d")),a=this.tileToPixelCoords(n.x,n.y,pool.pull("Vector2d"));a.x-=this.hTilewidth,a.y+=this.tileheight;var h=a.y-i.pos.y>this.hTileheight,l=i.pos.x-a.x<this.hTilewidth;h&&(l?(n.x--,a.x-=this.hTilewidth):(n.y--,a.x+=this.hTilewidth),a.y-=this.hTileheight);for(var u=h^l,c=n.clone(),d=2*a.y;d-2*this.tileheight<2*o.y;d+=this.tileheight){c.setV(n);for(var p=a.x;p<o.x;p+=this.tilewidth){var f=e.cellAt(c.x,c.y);if(f){var g=(r=f.tileset).tileoffset;r.drawTile(t,g.x+p,g.y+d/2-r.tileheight,f)}c.x++,c.y--}u?(n.y++,a.x-=this.hTilewidth,u=!1):(n.x++,a.x+=this.hTilewidth,u=!0)}pool.push(c),pool.push(n),pool.push(s),pool.push(o),pool.push(a)}}var offsetsStaggerX=[{x:0,y:0},{x:1,y:-1},{x:1,y:0},{x:2,y:0}],offsetsStaggerY=[{x:0,y:0},{x:-1,y:1},{x:0,y:1},{x:0,y:2}];class TMXHexagonalRenderer extends TMXRenderer{constructor(t){super(t.cols,t.rows,-2&t.tilewidth,-2&t.tileheight),this.hexsidelength=t.hexsidelength||0,this.staggerX="x"===t.staggeraxis,this.staggerEven="even"===t.staggerindex,this.sidelengthx=0,this.sidelengthy=0,"hexagonal"===t.orientation&&(this.staggerX?this.sidelengthx=this.hexsidelength:this.sidelengthy=this.hexsidelength),this.sideoffsetx=(this.tilewidth-this.sidelengthx)/2,this.sideoffsety=(this.tileheight-this.sidelengthy)/2,this.columnwidth=this.sideoffsetx+this.sidelengthx,this.rowheight=this.sideoffsety+this.sidelengthy,this.centers=[new Vector2d,new Vector2d,new Vector2d,new Vector2d]}canRender(t){return"hexagonal"===t.orientation&&super.canRender(t)}getBounds(t){var e=t instanceof TMXLayer?pool.pull("Bounds"):this.bounds;return this.staggerX?(e.setMinMax(0,0,this.cols*this.columnwidth+this.sideoffsetx,this.rows*(this.tileheight+this.sidelengthy)),e.width>1&&(e.height+=this.rowheight)):(e.setMinMax(0,0,this.cols*(this.tilewidth+this.sidelengthx),this.rows*this.rowheight+this.sideoffsety),e.height>1&&(e.width+=this.columnwidth)),e}doStaggerX(t){return this.staggerX&&1&t^this.staggerEven}doStaggerY(t){return!this.staggerX&&1&t^this.staggerEven}topLeft(t,e,i){var r=i||new Vector2d;return this.staggerX?1&t^this.staggerEven?r.set(t-1,e):r.set(t-1,e-1):1&e^this.staggerEven?r.set(t,e-1):r.set(t-1,e-1),r}topRight(t,e,i){var r=i||new Vector2d;return this.staggerX?1&t^this.staggerEven?r.set(t+1,e):r.set(t+1,e-1):1&e^this.staggerEven?r.set(t+1,e-1):r.set(t,e-1),r}bottomLeft(t,e,i){var r=i||new Vector2d;return this.staggerX?1&t^this.staggerEven?r.set(t-1,e+1):r.set(t-1,e):1&e^this.staggerEven?r.set(t,e+1):r.set(t-1,e+1),r}bottomRight(t,e,i){var r=i||new Vector2d;return this.staggerX?1&t^this.staggerEven?r.set(t+1,e+1):r.set(t+1,e):1&e^this.staggerEven?r.set(t+1,e+1):r.set(t,e+1),r}pixelToTileCoords(t,e,i){var r=i||new Vector2d;this.staggerX?t-=this.staggerEven?this.tilewidth:this.sideoffsetx:e-=this.staggerEven?this.tileheight:this.sideoffsety;var n,s,o,a,h=pool.pull("Vector2d",Math.floor(t/(2*this.columnwidth)),Math.floor(e/(2*this.rowheight))),l=pool.pull("Vector2d",t-h.x*(2*this.columnwidth),e-h.y*(2*this.rowheight));this.staggerX?(h.x=2*h.x,this.staggerEven&&++h.x):(h.y=2*h.y,this.staggerEven&&++h.y),this.staggerX?(o=(n=this.sidelengthx/2)+this.columnwidth,a=this.tileheight/2,this.centers[0].set(n,a),this.centers[1].set(o,a-this.rowheight),this.centers[2].set(o,a+this.rowheight),this.centers[3].set(o+this.columnwidth,a)):(s=this.sidelengthy/2,o=this.tilewidth/2,a=s+this.rowheight,this.centers[0].set(o,s),this.centers[1].set(o-this.columnwidth,a),this.centers[2].set(o+this.columnwidth,a),this.centers[3].set(o,a+this.rowheight));for(var u=0,c=Number.MAX_VALUE,d=0;d<4;++d){var p=this.centers[d].sub(l).length2();p<c&&(c=p,u=d)}var f=this.staggerX?offsetsStaggerX:offsetsStaggerY;return r.set(h.x+f[u].x,h.y+f[u].y),pool.push(h),pool.push(l),r}tileToPixelCoords(t,e,i){var r=Math.floor(t),n=Math.floor(e),s=i||new Vector2d;return this.staggerX?(s.y=n*(this.tileheight+this.sidelengthy),this.doStaggerX(r)&&(s.y+=this.rowheight),s.x=r*this.columnwidth):(s.x=r*(this.tilewidth+this.sidelengthx),this.doStaggerY(n)&&(s.x+=this.columnwidth),s.y=n*this.rowheight),s}adjustPosition(t){"number"==typeof t.gid&&(t.y-=t.height)}drawTile(t,e,i,r){var n=r.tileset,s=this.tileToPixelCoords(e,i,pool.pull("Vector2d"));n.drawTile(t,n.tileoffset.x+s.x,n.tileoffset.y+s.y+(this.tileheight-n.tileheight),r),pool.push(s)}drawTileLayer(t,e,i){var r,n=this.pixelToTileCoords(i.pos.x,i.pos.y,pool.pull("Vector2d"));n.sub(e.pos);var s=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y,pool.pull("Vector2d")),o=n.clone(),a=s.clone(),h=i.pos.y-s.y<this.sideoffsety,l=i.pos.x-s.x<this.sideoffsetx;h&&n.y--,l&&n.x--;var u=e.cols,c=e.rows;if(this.staggerX){n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),s=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y);for(var d=this.doStaggerX(n.x+e.pos.x);s.y<i.bottom&&n.y<c;){for(o.setV(n),a.setV(s);a.x<i.right&&o.x<u;o.x+=2)(r=e.cellAt(o.x,o.y,!1))&&r.tileset.drawTile(t,a.x,a.y,r),a.x+=this.tilewidth+this.sidelengthx;d?(n.x-=1,n.y+=1,s.x-=this.columnwidth,d=!1):(n.x+=1,s.x+=this.columnwidth,d=!0),s.y+=this.rowheight}pool.push(o),pool.push(a)}else{for(n.x=Math.max(0,n.x),n.y=Math.max(0,n.y),s=this.tileToPixelCoords(n.x+e.pos.x,n.y+e.pos.y),this.doStaggerY(n.y)&&(s.x-=this.columnwidth);s.y<i.bottom&&n.y<c;n.y++){for(o.setV(n),a.setV(s),this.doStaggerY(n.y)&&(a.x+=this.columnwidth);a.x<i.right&&o.x<u;o.x++)(r=e.cellAt(o.x,o.y,!1))&&r.tileset.drawTile(t,a.x,a.y,r),a.x+=this.tilewidth+this.sidelengthx;s.y+=this.rowheight}pool.push(o),pool.push(a)}pool.push(n),pool.push(s)}}class TMXStaggeredRenderer extends TMXHexagonalRenderer{canRender(t){return"staggered"===t.orientation&&super.canRender(t)}pixelToTileCoords(t,e,i){var r=i||new Vector2d,n=t,s=e;this.staggerX?n-=this.staggerEven?this.sideoffsetx:0:s-=this.staggerEven?this.sideoffsety:0;var o=pool.pull("Vector2d",Math.floor(n/this.tilewidth),Math.floor(s/this.tileheight));this.staggerX?(o.x=2*o.x,this.staggerEven&&++o.x):(o.y=2*o.y,this.staggerEven&&++o.y);var a=pool.pull("Vector2d",n-o.x*this.tilewidth,s-o.y*this.tileheight),h=a.x*(this.tileheight/this.tilewidth);return this.sideoffsety-h>a.y&&(o=this.topLeft(o.x,o.y,o)),-this.sideoffsety+h>a.y&&(o=this.topRight(o.x,o.y,o)),this.sideoffsety+h<a.y&&(o=this.bottomLeft(o.x,o.y,o)),3*this.sideoffsety-h<a.y&&(o=this.bottomRight(o.x,o.y,o)),(r=this.tileToPixelCoords(o.x,o.y,r)).set(t-r.x,e-r.y),r.set(r.x-this.tilewidth/2,r.y*(this.tilewidth/this.tileheight)),r.div(this.tilewidth/Math.sqrt(2)).rotate(degToRad(-45)).add(o),pool.push(o),pool.push(a),r}}class TMXTileset{constructor(t){var e=0;if(this.TileProperties=[],this.imageCollection=[],this.firstgid=this.lastgid=+t.firstgid,void 0!==t.source){var i=t.source,r=utils$1.file.getExtension(i);if(("tsx"===r||"json"===r)&&!(t=loader$1.getTMX(utils$1.file.getBasename(i))))throw new Error(i+" external TSX/JSON tileset not found")}this.name=t.name,this.tilewidth=+t.tilewidth,this.tileheight=+t.tileheight,this.spacing=+t.spacing||0,this.margin=+t.margin||0,this.tileoffset=new Vector2d,this.isAnimated=!1,this.isCollection=!1,this.animations=new Map,this._lastUpdate=0;var n=t.tiles;for(e in n)if(n.hasOwnProperty(e)){if("animation"in n[e]&&(this.isAnimated=!0,this.animations.set(n[+e].animation[0].tileid,{dt:0,idx:0,frames:n[+e].animation,cur:n[+e].animation[0]})),"properties"in n[e])if(Array.isArray(n[e].properties)){var s={};for(var o in n[e].properties)s[n[e].properties[o].name]=n[e].properties[o].value;this.setTileProperty(+n[e].id+this.firstgid,s)}else this.setTileProperty(+e+this.firstgid,n[e].properties);if("image"in n[e]){var a=loader$1.getImage(n[e].image);if(!a)throw new Error("melonJS: '"+n[e].image+"' file for tile '"+(+e+this.firstgid)+"' not found!");this.imageCollection[+e+this.firstgid]=a}}this.isCollection=this.imageCollection.length>0;var h=t.tileoffset;h&&(this.tileoffset.x=+h.x,this.tileoffset.y=+h.y);var l=t.tileproperties;if(l)for(e in l)l.hasOwnProperty(e)&&this.setTileProperty(+e+this.firstgid,l[e]);if(!1===this.isCollection){if(this.image=loader$1.getImage(t.image),!this.image)throw new Error("melonJS: '"+t.image+"' file for tileset '"+this.name+"' not found!");this.texture=video$1.renderer.cache.get(this.image,{framewidth:this.tilewidth,frameheight:this.tileheight,margin:this.margin,spacing:this.spacing}),this.atlas=this.texture.getAtlas();var u=+t.columns||Math.round(this.image.width/(this.tilewidth+this.spacing)),c=Math.round(this.image.height/(this.tileheight+this.spacing));t.tilecount%u>0&&++c,this.lastgid=this.firstgid+(u*c-1||0),t.tilecount&&this.lastgid-this.firstgid+1!=+t.tilecount&&console.warn("Computed tilecount ("+(this.lastgid-this.firstgid+1)+") does not match expected tilecount ("+t.tilecount+")")}}getTileImage(t){return this.imageCollection[t]}setTileProperty(t,e){this.TileProperties[t]=e}contains(t){return t>=this.firstgid&&t<=this.lastgid}getViewTileId(t){var e=t-this.firstgid;return this.animations.has(e)?this.animations.get(e).cur.tileid:e}getTileProperties(t){return this.TileProperties[t]}update(t){var e=0,i=timer$1.getTime(),r=!1;return this._lastUpdate!==i&&(this._lastUpdate=i,this.animations.forEach((function(i){for(i.dt+=t,e=i.cur.duration;i.dt>=e;)i.dt-=e,i.idx=(i.idx+1)%i.frames.length,i.cur=i.frames[i.idx],e=i.cur.duration,r=!0}))),r}drawTile(t,e,i,r){if(r.flipped&&(t.save(),t.translate(e,i),t.transform(r.currentTransform),e=i=0),!0===this.isCollection)t.drawImage(this.imageCollection[r.tileId],0,0,r.width,r.height,e,i,r.width,r.height);else{var n=this.atlas[this.getViewTileId(r.tileId)].offset;t.drawImage(this.image,n.x,n.y,this.tilewidth,this.tileheight,e,i,this.tilewidth+t.uvOffset,this.tileheight+t.uvOffset)}r.flipped&&t.restore()}}var TMX_CLEAR_BIT_MASK=536870911;class TMXTilesetGroup{constructor(){this.tilesets=[],this.length=0}add(t){this.tilesets.push(t),this.length++}getTilesetByIndex(t){return this.tilesets[t]}getTilesetByGid(t){var e=-1;t&=TMX_CLEAR_BIT_MASK;for(var i=0,r=this.tilesets.length;i<r;i++){if(this.tilesets[i].contains(t))return this.tilesets[i];this.tilesets[i].firstgid===this.tilesets[i].lastgid&&t>=this.tilesets[i].firstgid&&(e=i)}if(-1!==e)return this.tilesets[e];throw new Error("no matching tileset found for gid "+t)}}class TMXObject{constructor(t,e,i){this.points=void 0,this.name=e.name,this.x=+e.x,this.y=+e.y,this.z=+i,this.width=+e.width||0,this.height=+e.height||0,this.gid=+e.gid||null,this.tintcolor=e.tintcolor,this.type=e.type,this.type=e.type,this.rotation=degToRad(+e.rotation||0),this.id=+e.id||void 0,this.orientation=t.orientation,this.shapes=void 0,this.isEllipse=!1,this.isPolygon=!1,this.isPolyLine=!1,"number"==typeof this.gid?this.setTile(t.tilesets):void 0!==e.ellipse?this.isEllipse=!0:void 0!==e.polygon?(this.points=e.polygon,this.isPolygon=!0):void 0!==e.polyline&&(this.points=e.polyline,this.isPolyLine=!0),void 0!==e.text?(this.text=e.text,this.text.font=e.text.fontfamily||"sans-serif",this.text.size=e.text.pixelsize||16,this.text.fillStyle=e.text.color||"#000000",this.text.textAlign=e.text.halign||"left",this.text.textBaseline=e.text.valign||"top",this.text.width=this.width,this.text.height=this.height,applyTMXProperties(this.text,e)):(applyTMXProperties(this,e),this.shapes||(this.shapes=this.parseTMXShapes())),t.isEditor||t.getRenderer().adjustPosition(this)}setTile(t){var e=t.getTilesetByGid(this.gid);!1===e.isCollection&&(this.width=this.framewidth=e.tilewidth,this.height=this.frameheight=e.tileheight),this.tile=new Tile(this.x,this.y,this.gid,e)}parseTMXShapes(){var t=0,e=[];if(!0===this.isEllipse)e.push(new Ellipse(this.width/2,this.height/2,this.width,this.height).rotate(this.rotation));else if(!0===this.isPolygon)e.push(new Polygon(0,0,this.points).rotate(this.rotation));else if(!0===this.isPolyLine){var i,r,n=this.points,s=n.length-1;for(t=0;t<s;t++)i=new Vector2d(n[t].x,n[t].y),r=new Vector2d(n[t+1].x,n[t+1].y),0!==this.rotation&&(i=i.rotate(this.rotation),r=r.rotate(this.rotation)),e.push(new Line(0,0,[i,r]))}else e.push(new Polygon(0,0,[new Vector2d,new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)]).rotate(this.rotation));if("isometric"===this.orientation)for(t=0;t<e.length;t++)e[t].toIso();return e}getObjectPropertyByName(t){return this[t]}}class TMXGroup{constructor(t,e,i){this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.tintcolor=e.tintcolor,this.z=i,this.objects=[];var r=void 0===e.visible||e.visible;this.opacity=!0===r?clamp(+e.opacity||1,0,1):0,applyTMXProperties(this,e);var n=this;e.objects&&e.objects.forEach((function(e){e.tintcolor=n.tintcolor,n.objects.push(new TMXObject(t,e,i))})),e.layers&&e.layers.forEach((function(e){var r=new TMXLayer(t,e,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i++);r.setRenderer(t.getRenderer()),n.width=Math.max(n.width,r.width),n.height=Math.max(n.height,r.height),n.objects.push(r)}))}destroy(){this.objects=null}getObjectCount(){return this.objects.length}getObjectByIndex(t){return this.objects[t]}}var COLLISION_GROUP="collision",onresize_handler=null;function getNewDefaultRenderer(t){switch(t.orientation){case"orthogonal":return new TMXOrthogonalRenderer(t);case"isometric":return new TMXIsometricRenderer(t);case"hexagonal":return new TMXHexagonalRenderer(t);case"staggered":return new TMXStaggeredRenderer(t);default:throw new Error(t.orientation+" type TMX Tile Map not supported!")}}function readLayer(t,e,i){return new TMXLayer(t,e,t.tilewidth,t.tileheight,t.orientation,t.tilesets,i)}function readImageLayer(t,e,i){applyTMXProperties(e.properties,e);var r=pool.pull("ImageLayer",+e.offsetx||+e.x||0,+e.offsety||+e.y||0,Object.assign({name:e.name,image:e.image,ratio:pool.pull("Vector2d",+e.parallaxx||1,+e.parallaxy||1),tint:void 0!==e.tintcolor?pool.pull("Color").parseHex(e.tintcolor,!0):void 0,z:i},e.properties)),n=void 0===e.visible||e.visible;return r.setOpacity(n?+e.opacity:0),r}function readTileset(t){return new TMXTileset(t)}function readObjectGroup(t,e,i){return new TMXGroup(t,e,i)}class TMXTileMap{constructor(t,e){if(this.data=e,this.name=t,this.cols=+e.width,this.rows=+e.height,this.tilewidth=+e.tilewidth,this.tileheight=+e.tileheight,this.infinite=+e.infinite,this.orientation=e.orientation,this.renderorder=e.renderorder||"right-down",this.version=e.version,this.tiledversion=e.tiledversion,this.tilesets=null,void 0===this.layers&&(this.layers=[]),void 0===this.objectGroups&&(this.objectGroups=[]),this.isEditor="melon-editor"===e.editor,this.nextobjectid=+e.nextobjectid||void 0,this.hexsidelength=+e.hexsidelength,this.staggeraxis=e.staggeraxis,this.staggerindex=e.staggerindex,this.bounds=this.getRenderer().getBounds().clone(),this.width=this.bounds.width,this.height=this.bounds.height,this.backgroundcolor=e.backgroundcolor,applyTMXProperties(this,e),this.initialized=!1,1===this.infinite)throw new Error("Tiled Infinite Map not supported!")}getRenderer(){return void 0!==this.renderer&&this.renderer.canRender(this)||(this.renderer=getNewDefaultRenderer(this)),this.renderer}getBounds(){return this.bounds}readMapObjects(t){if(!0!==this.initialized){var e=0,i=this;this.tilesets||(this.tilesets=new TMXTilesetGroup),void 0!==t.tilesets&&t.tilesets.forEach((function(t){i.tilesets.add(readTileset(t))})),this.backgroundcolor&&this.layers.push(pool.pull("ColorLayer","background_color",this.backgroundcolor,e++)),this.background_image&&this.layers.push(pool.pull("ImageLayer",0,0,{name:"background_image",image:this.background_image,z:e++})),t.layers.forEach((function(t){switch(t.type){case"imagelayer":i.layers.push(readImageLayer(i,t,e++));break;case"tilelayer":i.layers.push(readLayer(i,t,e++));break;case"objectgroup":case"group":i.objectGroups.push(readObjectGroup(i,t,e++))}})),this.initialized=!0}}addTo(t,e,i){var r=t.autoSort,n=t.autoDepth,s=this.getBounds();function o(e,i){game$1.viewport.setBounds(0,0,Math.max(s.width,e),Math.max(s.height,i)),t.pos.set(Math.max(0,~~((e-s.width)/2)),Math.max(0,~~((i-s.height)/2)),t.pos.z)}t.autoSort=!1,t.autoDepth=!1,this.getLayers().forEach((function(e){t.addChild(e)})),this.getObjects(e).forEach((function(e){t.addChild(e)})),t.resize(this.bounds.width,this.bounds.height),t.sort(!0),!0===i&&(o(game$1.viewport.width,game$1.viewport.height),onresize_handler&&event.unsubscribe(onresize_handler),onresize_handler=event.subscribe(event.VIEWPORT_ONRESIZE,o)),t.autoSort=r,t.autoDepth=n}getObjects(t){var e,i=[],r=!1;this.readMapObjects(this.data);for(var n=0;n<this.objectGroups.length;n++){var s=this.objectGroups[n];r=s.name.toLowerCase().includes(COLLISION_GROUP),!1===t&&((e=new Container$1(0,0,this.width,this.height)).anchorPoint.set(0,0),e.name=s.name,e.pos.z=s.z,e.setOpacity(s.opacity),e.autoSort=!1,e.autoDepth=!1);for(var o=0;o<s.objects.length;o++){var a,h=s.objects[o];void 0===h.anchorPoint&&(h.anchorPoint={x:0,y:0}),void 0!==h.tintcolor&&(h.tint=pool.pull("Color"),h.tint.parseHex(h.tintcolor,!0)),h instanceof TMXLayer?a=h:"object"==typeof h.text?(void 0===h.text.anchorPoint&&(h.text.anchorPoint=h.anchorPoint),(a=!0===h.text.bitmap?pool.pull("BitmapText",h.x,h.y,h.text):pool.pull("Text",h.x,h.y,h.text)).pos.z=h.z):"object"==typeof h.tile?((a=h.tile.getRenderable(h)).body=new Body(a,h.shapes||new Rect(0,0,this.width,this.height)),a.pos.setMuted(h.x,h.y,h.z)):(void 0!==h.name&&""!==h.name?a=pool.pull(h.name,h.x,h.y,h):((a=pool.pull("Renderable",h.x,h.y,h.width,h.height)).anchorPoint.set(0,0),a.name=h.name,a.type=h.type,a.id=h.id,a.body=new Body(a,h.shapes||new Rect(0,0,a.width,a.height)),a.resize(a.body.getBounds().width,a.body.getBounds().height)),a.pos.z=h.z),r&&!h.name&&a.body&&(a.body.collisionType=collision.types.WORLD_SHAPE),!1!==t?(!0===a.isRenderable&&(a.setOpacity(a.getOpacity()*s.opacity),a.renderable instanceof Renderable&&a.renderable.setOpacity(a.renderable.getOpacity()*s.opacity)),i.push(a)):e.addChild(a)}!1===t&&e.children.length>0&&(e.autoSort=!0,e.autoDepth=!0,i.push(e))}return i}getLayers(){return this.readMapObjects(this.data),this.layers}destroy(){this.tilesets=void 0,this.layers.length=0,this.objectGroups.length=0,this.initialized=!1}}var levels={},levelIdx=[],currentLevelIdx=0;function safeLoadLevel(t,e,i){e.container.reset(),game$1.reset(),levels[level.getCurrentLevelId()]&&levels[level.getCurrentLevelId()].destroy(),currentLevelIdx=levelIdx.indexOf(t),loadTMXLevel(t,e.container,e.flatten,e.setViewportBounds),event.publish(event.LEVEL_LOADED,[t]),e.onLoaded(t),i&&state$1.restart()}function loadTMXLevel(t,e,i,r){var n=levels[t];utils$1.resetGUID(t,n.nextobjectid),e.anchorPoint.set(0,0),n.addTo(e,i,r)}var level={add(t,e,i){if("tmx"===t)return null==levels[e]&&(levels[e]=new TMXTileMap(e,loader$1.getTMX(e)),levelIdx.push(e),i&&i(),!0);throw new Error("no level loader defined for format "+t)},load(t,e){if(e=Object.assign({container:game$1.world,onLoaded:game$1.onLevelLoaded,flatten:game$1.mergeGroup,setViewportBounds:!0},e||{}),void 0===levels[t])throw new Error("level "+t+" not found");if(!(levels[t]instanceof TMXTileMap))throw new Error("no level loader defined");return state$1.isRunning()?(state$1.stop(),utils$1.function.defer(safeLoadLevel,this,t,e,!0)):safeLoadLevel(t,e),!0},getCurrentLevelId:()=>levelIdx[currentLevelIdx],getCurrentLevel(){return levels[this.getCurrentLevelId()]},reload(t){return this.load(this.getCurrentLevelId(),t)},next(t){return currentLevelIdx+1<levelIdx.length&&this.load(levelIdx[currentLevelIdx+1],t)},previous(t){return currentLevelIdx-1>=0&&this.load(levelIdx[currentLevelIdx-1],t)},levelCount:()=>levelIdx.length},imgList={},tmxList={},binList={},jsonList={},baseURL={},resourceCount=0,loadCount=0,timerId$1=0;function checkLoadStatus(t){if(loadCount===resourceCount){if(!t&&!loader.onload)throw new Error("no load callback defined");clearTimeout(timerId$1);var e=t||loader.onload;setTimeout((function(){e(),event.publish(event.LOADER_COMPLETE)}),300)}else timerId$1=setTimeout((function(){checkLoadStatus(t)}),100)}function preloadImage(t,e,i){imgList[t.name]=new Image,imgList[t.name].onload=e,imgList[t.name].onerror=i,"string"==typeof loader.crossOrigin&&(imgList[t.name].crossOrigin=loader.crossOrigin),imgList[t.name].src=t.src+loader.nocache}function preloadFontFace(t,e,i){var r=new FontFace(t.name,t.src);r.load().then((function(){document.fonts.add(r),document.body.style.fontFamily=t.name,e()}),(function(e){i(t.name)}))}function preloadTMX(t,e,i){function r(e){tmxList[t.name]=e,"tmx"===t.type&&level.add(t.type,t.name)}if(t.data)return r(t.data),void e();var n=new XMLHttpRequest,s=utils$1.file.getExtension(t.src);n.overrideMimeType&&("json"===s?n.overrideMimeType("application/json"):n.overrideMimeType("text/xml")),n.open("GET",t.src+loader.nocache,!0),n.withCredentials=loader.withCredentials,n.ontimeout=i,n.onreadystatechange=function(){if(4===n.readyState)if(200===n.status||0===n.status&&n.responseText){var o=null;switch(s){case"xml":case"tmx":case"tsx":if(device$1.ua.match(/msie/i)||!n.responseXML){if(!window.DOMParser)throw new Error("XML file format loading not supported, use the JSON file format instead");o=(new DOMParser).parseFromString(n.responseText,"text/xml")}else o=n.responseXML;var a=parse(o);switch(s){case"tmx":o=a.map;break;case"tsx":o=a.tilesets[0]}break;case"json":o=JSON.parse(n.responseText);break;default:throw new Error("TMX file format "+s+"not supported !")}r(o),e()}else i(t.name)},n.send()}function preloadJSON(t,e,i){var r=new XMLHttpRequest;r.overrideMimeType&&r.overrideMimeType("application/json"),r.open("GET",t.src+loader.nocache,!0),r.withCredentials=loader.withCredentials,r.ontimeout=i,r.onreadystatechange=function(){4===r.readyState&&(200===r.status||0===r.status&&r.responseText?(jsonList[t.name]=JSON.parse(r.responseText),e()):i(t.name))},r.send()}function preloadBinary(t,e,i){var r=new XMLHttpRequest;r.open("GET",t.src+loader.nocache,!0),r.withCredentials=loader.withCredentials,r.responseType="arraybuffer",r.onerror=i,r.onload=function(){var i=r.response;if(i){for(var n=new Uint8Array(i),s=[],o=0;o<n.byteLength;o++)s[o]=String.fromCharCode(n[o]);binList[t.name]=s.join(""),e()}},r.send()}function preloadJavascript(t,e,i){var r=document.createElement("script");r.src=t.src,r.type="text/javascript","string"==typeof loader.crossOrigin&&(r.crossOrigin=loader.crossOrigin),r.defer=!0,r.onload=function(){e()},r.onerror=function(){i(t.name)},document.getElementsByTagName("body")[0].appendChild(r)}var loader={nocache:"",onload:void 0,onProgress:void 0,crossOrigin:void 0,withCredentials:!1,onResourceLoaded(t){var e=++loadCount/resourceCount;this.onProgress&&this.onProgress(e,t),event.publish(event.LOADER_PROGRESS,[e,t])},onLoadingError(t){throw new Error("Failed loading resource "+t.src)},setNocache(t){this.nocache=t?"?"+~~(1e7*Math.random()):""},setBaseURL(t,e){"*"!==t?baseURL[t]=e:(baseURL.audio=e,baseURL.binary=e,baseURL.image=e,baseURL.json=e,baseURL.js=e,baseURL.tmx=e,baseURL.tsx=e)},preload(t,e,i){for(var r=0;r<t.length;r++)resourceCount+=this.load(t[r],this.onResourceLoaded.bind(this,t[r]),this.onLoadingError.bind(this,t[r]));void 0!==e&&(this.onload=e),!1!==i&&state$1.change(state$1.LOADING),checkLoadStatus(e)},load(t,e,i){switch(void 0!==baseURL[t.type]&&(t.src=baseURL[t.type]+t.src),t.type){case"binary":return preloadBinary.call(this,t,e,i),1;case"image":return preloadImage.call(this,t,e,i),1;case"json":return preloadJSON.call(this,t,e,i),1;case"js":return preloadJavascript.call(this,t,e,i),1;case"tmx":case"tsx":return preloadTMX.call(this,t,e,i),1;case"audio":return audio$1.load(t,!!t.stream,e,i),1;case"fontface":return preloadFontFace.call(this,t,e,i),1;default:throw new Error("load : unknown or invalid resource type : "+t.type)}},unload(t){switch(t.type){case"binary":return t.name in binList&&(delete binList[t.name],!0);case"image":return t.name in imgList&&(delete imgList[t.name],!0);case"json":return t.name in jsonList&&(delete jsonList[t.name],!0);case"js":case"fontface":return!0;case"tmx":case"tsx":return t.name in tmxList&&(delete tmxList[t.name],!0);case"audio":return audio$1.unload(t.name);default:throw new Error("unload : unknown or invalid resource type : "+t.type)}},unloadAll(){var t;for(t in binList)binList.hasOwnProperty(t)&&this.unload({name:t,type:"binary"});for(t in imgList)imgList.hasOwnProperty(t)&&this.unload({name:t,type:"image"});for(t in tmxList)tmxList.hasOwnProperty(t)&&this.unload({name:t,type:"tmx"});for(t in jsonList)jsonList.hasOwnProperty(t)&&this.unload({name:t,type:"json"});audio$1.unloadAll()},getTMX:t=>(t=""+t)in tmxList?tmxList[t]:null,getBinary:t=>(t=""+t)in binList?binList[t]:null,getImage:t=>(t=utils$1.file.getBasename(""+t))in imgList?imgList[t]:null,getJSON:t=>(t=""+t)in jsonList?jsonList[t]:null,getLoadProgress:()=>loadCount/resourceCount},loader$1=loader,audioTracks={},current_track_id=null,retry_counter=0,soundLoadError=function(t,e){if(retry_counter++>3){var i="melonJS: failed loading "+t;if(!1!==audio.stopOnAudioError)throw new Error(i);audio.disable(),e&&e(),console.log(i+", disabling audio")}else audioTracks[t].load()},audio={stopOnAudioError:!0,init:function(t){if(!initialized)throw new Error("me.audio.init() called before engine initialization.");return t="string"==typeof t?t:"mp3",this.audioFormats=t.split(","),!howler.Howler.noAudio},hasFormat:function(t){return this.hasAudio&&howler.Howler.codecs(t)},hasAudio:function(){return!howler.Howler.noAudio},enable:function(){this.unmuteAll()},disable:function(){this.muteAll()},load:function(t,e,i,r){var n=[];if(void 0===this.audioFormats||0===this.audioFormats.length)throw new Error("target audio extension(s) should be set through me.audio.init() before calling the preloader.");for(var s=0;s<this.audioFormats.length;s++)n.push(t.src+t.name+"."+this.audioFormats[s]+loader$1.nocache);return audioTracks[t.name]=new howler.Howl({src:n,volume:howler.Howler.volume(),html5:!0===e,xhrWithCredentials:loader$1.withCredentials,onloaderror:function(){soundLoadError.call(this,t.name,r)},onload:function(){retry_counter=0,i&&i()}}),1},play:function(t,e=!1,i,r){var n=audioTracks[t];if(n&&void 0!==n){var s=n.play();return"boolean"==typeof e&&n.loop(e,s),n.volume("number"==typeof r?clamp(r,0,1):howler.Howler.volume(),s),"function"==typeof i&&(!0===e?n.on("end",i,s):n.once("end",i,s)),s}throw new Error("audio clip "+t+" does not exist")},fade:function(t,e,i,r,n){var s=audioTracks[t];if(!s||void 0===s)throw new Error("audio clip "+t+" does not exist");s.fade(e,i,r,n)},seek:function(t,e,i){var r=audioTracks[t];if(r&&void 0!==r)return r.seek.apply(r,Array.prototype.slice.call(arguments,1));throw new Error("audio clip "+t+" does not exist")},rate:function(t,e,i){var r=audioTracks[t];if(r&&void 0!==r)return r.rate.apply(r,Array.prototype.slice.call(arguments,1));throw new Error("audio clip "+t+" does not exist")},stop:function(t,e){if(void 0!==t){var i=audioTracks[t];if(!i||void 0===i)throw new Error("audio clip "+t+" does not exist");i.stop(e),i.off("end",void 0,e)}else howler.Howler.stop()},pause:function(t,e){var i=audioTracks[t];if(!i||void 0===i)throw new Error("audio clip "+t+" does not exist");i.pause(e)},resume:function(t,e){var i=audioTracks[t];if(!i||void 0===i)throw new Error("audio clip "+t+" does not exist");i.play(e)},playTrack:function(t,e){return current_track_id=t,this.play(current_track_id,!0,null,e)},stopTrack:function(){null!==current_track_id&&(audioTracks[current_track_id].stop(),current_track_id=null)},pauseTrack:function(){null!==current_track_id&&audioTracks[current_track_id].pause()},resumeTrack:function(){null!==current_track_id&&audioTracks[current_track_id].play()},getCurrentTrack:function(){return current_track_id},setVolume:function(t){howler.Howler.volume(t)},getVolume:function(){return howler.Howler.volume()},mute:function(t,e,i){i=void 0===i||!!i;var r=audioTracks[t];if(!r||void 0===r)throw new Error("audio clip "+t+" does not exist");r.mute(i,e)},unmute:function(t,e){this.mute(t,e,!1)},muteAll:function(){howler.Howler.mute(!0)},unmuteAll:function(){howler.Howler.mute(!1)},muted:function(){return howler.Howler._muted},unload:function(t){return t in audioTracks&&(audioTracks[t].unload(),delete audioTracks[t],!0)},unloadAll:function(){for(var t in audioTracks)audioTracks.hasOwnProperty(t)&&this.unload(t)}},audio$1=audio,data={};function isReserved(t){return"add"===t||"remove"===t}var save={init(){if(!0===device$1.localStorage){var t=localStorage.getItem("me.save");"string"==typeof t&&t.length>0&&(JSON.parse(t)||[]).forEach((function(t){data[t]=JSON.parse(localStorage.getItem("me.save."+t))}))}},add(t){var e=save;Object.keys(t).forEach((function(i){var r;isReserved(i)||(r=i,Object.defineProperty(e,r,{configurable:!0,enumerable:!0,get:()=>data[r],set(t){data[r]=t,!0===device$1.localStorage&&localStorage.setItem("me.save."+r,JSON.stringify(t))}}),i in data||(e[i]=t[i]))})),!0===device$1.localStorage&&localStorage.setItem("me.save",JSON.stringify(Object.keys(data)))},remove(t){isReserved(t)||void 0!==data[t]&&(delete data[t],!0===device$1.localStorage&&(localStorage.removeItem("me.save."+t),localStorage.setItem("me.save",JSON.stringify(Object.keys(data)))))}};let accelInitialized=!1,deviceOrientationInitialized=!1,swipeEnabled=!0;function disableSwipeFn(t){return t.preventDefault(),"function"==typeof window.scroll&&window.scroll(0,0),!1}let readyBound=!1,isReady=!1,readyList=[],_domRect={left:0,top:0,x:0,y:0,width:0,height:0,right:0,bottom:0},device={_domReady(t){if(!isReady){if(!document.body)return setTimeout(this._domReady,13);for(document.removeEventListener&&document.removeEventListener("DOMContentLoaded",this._domReady,!1),window.removeEventListener("load",this._domReady,!1);readyList.length;)readyList.shift().call(window,[]);isReady=!0}},_check(){this._detectDevice(),this.isMobile&&this.enableSwipe(!1),this.TouchEvent=!!("ontouchstart"in window),this.PointerEvent=!!window.PointerEvent,window.gesture=prefixed("gesture"),this.touch=this.TouchEvent||this.PointerEvent,this.maxTouchPoints=this.touch?this.PointerEvent?navigator.maxTouchPoints||1:10:1,this.wheel="onwheel"in document.createElement("div"),this.hasPointerLockSupport=prefixed("pointerLockElement",document),this.hasPointerLockSupport&&(document.exitPointerLock=prefixed("exitPointerLock",document)),this.hasDeviceOrientation=!!window.DeviceOrientationEvent,this.hasAccelerometer=!!window.DeviceMotionEvent,this.hasFullscreenSupport=prefixed("fullscreenEnabled",document)||document.mozFullScreenEnabled,document.exitFullscreen=prefixed("cancelFullScreen",document)||prefixed("exitFullscreen",document),navigator.vibrate=prefixed("vibrate",navigator),this.hasWebAudio=!(!window.AudioContext&&!window.webkitAudioContext);try{this.localStorage=!!window.localStorage}catch(t){this.localStorage=!1}try{this.OffscreenCanvas=void 0!==window.OffscreenCanvas&&null!==new OffscreenCanvas(0,0).getContext("2d")}catch(t){this.OffscreenCanvas=!1}var t,e;window.addEventListener("blur",(function(){this.stopOnBlur&&state$1.stop(!0),this.pauseOnBlur&&state$1.pause(!0)}),!1),window.addEventListener("focus",(function(){this.stopOnBlur&&state$1.restart(!0),this.resumeOnFocus&&state$1.resume(!0),this.autoFocus&&this.focus()}),!1),void 0!==document.hidden?(t="hidden",e="visibilitychange"):void 0!==document.mozHidden?(t="mozHidden",e="mozvisibilitychange"):void 0!==document.msHidden?(t="msHidden",e="msvisibilitychange"):void 0!==document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange"),"string"==typeof e&&document.addEventListener(e,(function(){document[t]?(this.stopOnBlur&&state$1.stop(!0),this.pauseOnBlur&&state$1.pause(!0)):(this.stopOnBlur&&state$1.restart(!0),this.resumeOnFocus&&state$1.resume(!0))}),!1)},_detectDevice(){this.iOS=/iPhone|iPad|iPod/i.test(this.ua),this.android=/Android/i.test(this.ua),this.android2=/Android 2/i.test(this.ua),this.linux=/Linux/i.test(this.ua),this.chromeOS=/CrOS/.test(this.ua),this.wp=/Windows Phone/i.test(this.ua),this.BlackBerry=/BlackBerry/i.test(this.ua),this.Kindle=/Kindle|Silk.*Mobile Safari/i.test(this.ua),this.isMobile=/Mobi/i.test(this.ua)||this.iOS||this.android||this.wp||this.BlackBerry||this.Kindle||!1,this.ejecta=void 0!==window.ejecta,this.isWeixin=/MicroMessenger/i.test(this.ua)},ua:navigator.userAgent,localStorage:!1,hasAccelerometer:!1,hasDeviceOrientation:!1,hasFullscreenSupport:!1,hasPointerLockSupport:!1,hasWebAudio:!1,nativeBase64:"function"==typeof window.atob,maxTouchPoints:1,touch:!1,wheel:!1,isMobile:!1,iOS:!1,android:!1,android2:!1,linux:!1,ejecta:!1,isWeixin:!1,chromeOS:!1,wp:!1,BlackBerry:!1,Kindle:!1,accelerationX:0,accelerationY:0,accelerationZ:0,gamma:0,beta:0,alpha:0,language:navigator.language||navigator.browserLanguage||navigator.userLanguage||"en",pauseOnBlur:!0,resumeOnFocus:!0,autoFocus:!0,stopOnBlur:!1,OffscreenCanvas:!1,onReady(t){isReady?t.call(window,[]):(readyList.push(t),readyBound||("complete"===document.readyState?window.setTimeout(this._domReady,0):(document.addEventListener&&document.addEventListener("DOMContentLoaded",this._domReady,!1),window.addEventListener("load",this._domReady,!1)),readyBound=!0))},enableSwipe(t){!1!==t?!1===swipeEnabled&&(window.document.removeEventListener("touchmove",disableSwipeFn,!1),swipeEnabled=!0):!0===swipeEnabled&&(window.document.addEventListener("touchmove",disableSwipeFn,!1),swipeEnabled=!1)},requestFullscreen(t){this.hasFullscreenSupport&&((t=t||video$1.getParent()).requestFullscreen=prefixed("requestFullscreen",t)||t.mozRequestFullScreen,t.requestFullscreen())},exitFullscreen(){this.hasFullscreenSupport&&document.exitFullscreen()},getScreenOrientation(){var t="portrait",e="landscape",i=window.screen;if(void 0!==i){var r=prefixed("orientation",i);if(void 0!==r&&"string"==typeof r.type)return r.type;if("string"==typeof r)return r}return"number"==typeof window.orientation?90===Math.abs(window.orientation)?e:t:window.outerWidth>window.outerHeight?e:t},lockOrientation(t){var e=window.screen;if(void 0!==e){var i=prefixed("lockOrientation",e);if(void 0!==i)return i(t)}return!1},unlockOrientation(t){var e=window.screen;if(void 0!==e){var i=prefixed("unlockOrientation",e);if(void 0!==i)return i(t)}return!1},isPortrait(){return this.getScreenOrientation().includes("portrait")},isLandscape(){return this.getScreenOrientation().includes("landscape")},getStorage(t="local"){if("local"===t)return save;throw new Error("storage type "+t+" not supported")},getParentElement(t){var e=this.getElement(t);return null!==e.parentNode&&(e=e.parentNode),e},getElement(t){var e=null;return"undefined"!==t&&("string"==typeof t?e=document.getElementById(t):"object"==typeof t&&t.nodeType===Node.ELEMENT_NODE&&(e=t)),e||(e=document.body),e},getElementBounds:t=>"object"==typeof t&&t!==document.body&&void 0!==t.getBoundingClientRect?t.getBoundingClientRect():(_domRect.width=_domRect.right=window.innerWidth,_domRect.height=_domRect.bottom=window.innerHeight,_domRect),getParentBounds(t){return this.getElementBounds(this.getParentElement(t))},isWebGLSupported(t){var e=!1;try{var i=document.createElement("canvas"),r={stencil:!0,failIfMajorPerformanceCaveat:t.failIfMajorPerformanceCaveat};e=!(!window.WebGLRenderingContext||!i.getContext("webgl",r)&&!i.getContext("experimental-webgl",r))}catch(t){e=!1}return e},getMaxShaderPrecision:t=>t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0?"highp":t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp",focus(){"function"==typeof window.focus&&window.focus()},onDeviceMotion(t){this.accelerationX=t.accelerationIncludingGravity.x,this.accelerationY=t.accelerationIncludingGravity.y,this.accelerationZ=t.accelerationIncludingGravity.z},onDeviceRotate(t){this.gamma=t.gamma,this.beta=t.beta,this.alpha=t.alpha},turnOnPointerLock(){if(this.hasPointerLockSupport){var t=video$1.getParent();if(this.ua.match(/Firefox/i)){var e=function(){(prefixed("fullscreenElement",document)||document.mozFullScreenElement)===t&&(document.removeEventListener("fullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),t.requestPointerLock=prefixed("requestPointerLock",t),t.requestPointerLock())};document.addEventListener("fullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),this.requestFullscreen()}else t.requestPointerLock()}},turnOffPointerLock(){this.hasPointerLockSupport&&document.exitPointerLock()},watchAccelerometer(){return this.hasAccelerometer&&!accelInitialized&&(DeviceOrientationEvent&&"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&(window.addEventListener("devicemotion",this.onDeviceMotion,!1),accelInitialized=!0)})).catch(console.error):(window.addEventListener("devicemotion",this.onDeviceMotion,!1),accelInitialized=!0)),accelInitialized},unwatchAccelerometer(){accelInitialized&&(window.removeEventListener("devicemotion",this.onDeviceMotion,!1),accelInitialized=!1)},watchDeviceOrientation(){return this.hasDeviceOrientation&&!deviceOrientationInitialized&&("function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then((t=>{"granted"===t&&(window.addEventListener("deviceorientation",this.onDeviceRotate,!1),deviceOrientationInitialized=!0)})).catch(console.error):(window.addEventListener("deviceorientation",this.onDeviceRotate,!1),deviceOrientationInitialized=!0)),deviceOrientationInitialized},unwatchDeviceOrientation(){deviceOrientationInitialized&&(window.removeEventListener("deviceorientation",this.onDeviceRotate,!1),deviceOrientationInitialized=!1)},vibrate(t){navigator.vibrate&&navigator.vibrate(t)}};Object.defineProperty(device,"devicePixelRatio",{get:function(){return window.devicePixelRatio||1}}),Object.defineProperty(device,"isFullscreen",{get:function(){return!(!this.hasFullscreenSupport||!prefixed("fullscreenElement",document)&&!document.mozFullScreenElement)}}),Object.defineProperty(device,"sound",{get:function(){return audio$1.hasAudio()}});var device$1=device;function extractUniforms(t,e){var i,r={},n=/uniform\s+(\w+)\s+(\w+)/g,s={},o={},a={};return[e.vertex,e.fragment].forEach((function(t){for(;i=n.exec(t);)s[i[2]]=i[1]})),Object.keys(s).forEach((function(i){var r=s[i];a[i]=t.getUniformLocation(e.program,i),o[i]={get:function(t){return function(){return a[t]}}(i),set:function(e,i,r){return 0===i.indexOf("mat")?function(i){t[r](a[e],!1,i)}:function(i){var n=r;i.length&&"v"!==r.substr(-1)&&(n+="v"),t[n](a[e],i)}}(i,r,"uniform"+fnHash[r])}})),Object.defineProperties(r,o),r}function extractAttributes(t,e){for(var i,r={},n=/attribute\s+\w+\s+(\w+)/g,s=0;i=n.exec(e.vertex);)r[i[1]]=s++;return r}function compileShader(t,e,i){var r=t.createShader(e);if(t.shaderSource(r,i),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r));return r}function compileProgram(t,e,i,r){var n=compileShader(t,t.VERTEX_SHADER,e),s=compileShader(t,t.FRAGMENT_SHADER,i),o=t.createProgram();for(var a in t.attachShader(o,n),t.attachShader(o,s),r)t.bindAttribLocation(o,r[a],a);if(t.linkProgram(o),!t.getProgramParameter(o,t.LINK_STATUS)){var h="Error initializing Shader "+this+"\ngl.VALIDATE_STATUS: "+t.getProgramParameter(o,t.VALIDATE_STATUS)+"\ngl.getError()"+t.getError()+"\ngl.getProgramInfoLog()"+t.getProgramInfoLog(o);throw t.deleteProgram(o),o=null,new Error(h)}return t.useProgram(o),t.deleteShader(n),t.deleteShader(s),o}var fnHash={bool:"1i",int:"1i",float:"1f",vec2:"2fv",vec3:"3fv",vec4:"4fv",bvec2:"2iv",bvec3:"3iv",bvec4:"4iv",ivec2:"2iv",ivec3:"3iv",ivec4:"4iv",mat2:"Matrix2fv",mat3:"Matrix3fv",mat4:"Matrix4fv",sampler2D:"1i"};function setPrecision(t,e){return"precision"!==t.substring(0,9)?"precision "+e+" float;"+t:t}function minify(t){return(t=(t=(t=t.replace(/\/\*[\s\S]*?\*\/|([^\\:]|^)\/\/.*$/gm,"$1")).replace(/(\\n\s+)|(\s+\\n)/g,"")).replace(/(\\r|\\n)+/g,"")).replace(/\s*([;,[\](){}\\\/\-+*|^&!=<>?~%])\s*/g,"$1")}class GLShader{constructor(t,e,i,r){return this.gl=t,this.vertex=setPrecision(minify(e),r||device$1.getMaxShaderPrecision(this.gl)),this.fragment=setPrecision(minify(i),r||device$1.getMaxShaderPrecision(this.gl)),this.attributes=extractAttributes(this.gl,this),this.program=compileProgram(this.gl,this.vertex,this.fragment,this.attributes),this.uniforms=extractUniforms(this.gl,this),event.subscribe(event.WEBGL_ONCONTEXT_LOST,this.destroy.bind(this)),this}bind(){this.gl.useProgram(this.program)}getAttribLocation(t){var e=this.attributes[t];return void 0!==e?e:-1}setUniform(t,e){var i=this.uniforms;if(void 0===i[t])throw new Error("undefined ("+t+") uniform for shader "+this);"object"==typeof e&&"function"==typeof e.toArray?i[t]=e.toArray():i[t]=e}destroy(){this.uniforms=null,this.attributes=null,this.gl.deleteProgram(this.program),this.vertex=null,this.fragment=null}}var primitiveVertex="// Current vertex point\nattribute vec2 aVertex;\n\n// Projection matrix\nuniform mat4 uProjectionMatrix;\n\n// Vertex color\nuniform vec4 uColor;\n\n// Fragment color\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n    gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(uColor.rgb * uColor.a, uColor.a);\n}\n",primitiveFragment="varying vec4 vColor;\n\nvoid main(void) {\n    gl_FragColor = vColor;\n}\n",quadVertex="attribute vec2 aVertex;\nattribute vec2 aRegion;\nattribute vec4 aColor;\n\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vRegion;\nvarying vec4 vColor;\n\nvoid main(void) {\n    // Transform the vertex position by the projection matrix\n     gl_Position = uProjectionMatrix * vec4(aVertex, 0.0, 1.0);\n    // Pass the remaining attributes to the fragment shader\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n    vRegion = aRegion;\n}\n",quadFragment="uniform sampler2D uSampler;\nvarying vec4 vColor;\nvarying vec2 vRegion;\n\nvoid main(void) {\n    gl_FragColor = texture2D(uSampler, vRegion) * vColor;\n}\n",VERTEX_SIZE=2,REGION_SIZE=2,COLOR_SIZE=4,ELEMENT_SIZE=VERTEX_SIZE+REGION_SIZE+COLOR_SIZE,ELEMENT_OFFSET=ELEMENT_SIZE*Float32Array.BYTES_PER_ELEMENT,VERTEX_ELEMENT=0,REGION_ELEMENT=VERTEX_ELEMENT+VERTEX_SIZE,COLOR_ELEMENT=REGION_ELEMENT+REGION_SIZE,ELEMENTS_PER_QUAD=4,INDICES_PER_QUAD=6,MAX_LENGTH=16e3;class WebGLCompositor{constructor(t){var e=t.gl;this.length=0,this.currentTextureUnit=-1,this.boundTextures=[],this.v=[new Vector2d,new Vector2d,new Vector2d,new Vector2d],this.renderer=t,this.gl=t.gl,this.color=t.currentColor,this.tint=t.currentTint,this.viewMatrix=t.currentTransform,this.activeShader=null,this.mode=e.TRIANGLES,this.attributes=[],this.primitiveShader=new GLShader(this.gl,primitiveVertex,primitiveFragment),this.quadShader=new GLShader(this.gl,quadVertex,quadFragment),this.addAttribute("aVertex",2,e.FLOAT,!1,0*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aRegion",2,e.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT),this.addAttribute("aColor",4,e.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT),e.bindBuffer(e.ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ARRAY_BUFFER,MAX_LENGTH*ELEMENT_OFFSET*ELEMENTS_PER_QUAD,e.STREAM_DRAW),this.sbSize=256,this.sbIndex=0,this.stream=new Float32Array(this.sbSize*ELEMENT_SIZE*ELEMENTS_PER_QUAD),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,e.createBuffer()),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.createIB(),e.STATIC_DRAW),event.subscribe(event.CANVAS_ONRESIZE,function(t,e){this.flush(),this.setViewport(0,0,t,e)}.bind(this)),this.reset()}reset(){this.sbIndex=0,this.length=0,this.gl=this.renderer.gl,this.flush(),this.setViewport(0,0,this.renderer.getScreenCanvas().width,this.renderer.getScreenCanvas().height),this.clearColor(0,0,0,0);for(var t=0;t<this.renderer.maxTextures;t++){var e=this.boundTextures[t];null!==e&&this.gl.deleteTexture(e),this.boundTextures[t]=null}this.currentTextureUnit=-1,this.useShader(this.quadShader)}addAttribute(t,e,i,r,n){this.attributes.push({name:t,size:e,type:i,normalized:r,offset:n})}setViewport(t,e,i,r){this.gl.viewport(t,e,i,r)}createTexture2D(t,e,i,r="no-repeat",n,s,o,a=!0,h=!0){var l=this.gl,u=isPowerOfTwo(n||e.width)&&isPowerOfTwo(s||e.height),c=l.createTexture(),d=0!==r.search(/^repeat(-x)?$/)||!u&&2!==this.renderer.WebGLVersion?l.CLAMP_TO_EDGE:l.REPEAT,p=0!==r.search(/^repeat(-y)?$/)||!u&&2!==this.renderer.WebGLVersion?l.CLAMP_TO_EDGE:l.REPEAT;return this.setTexture2D(c,t),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,d),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,p),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,i),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),n||s||o?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,n,s,o,l.RGBA,l.UNSIGNED_BYTE,e):l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,e),u&&!1!==h&&l.generateMipmap(l.TEXTURE_2D),c}setTexture2D(t,e){var i=this.gl;t!==this.boundTextures[e]?(this.flush(),this.currentTextureUnit!==e&&(this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e)),i.bindTexture(i.TEXTURE_2D,t),this.boundTextures[e]=t):this.currentTextureUnit!==e&&(this.flush(),this.currentTextureUnit=e,i.activeTexture(i.TEXTURE0+e))}uploadTexture(t,e,i,r,n){var s=this.renderer.cache.getUnit(t),o=this.boundTextures[s];return null===o||n?this.createTexture2D(s,t.getTexture(),this.renderer.settings.antiAlias?this.gl.LINEAR:this.gl.NEAREST,t.repeat,e,i,r,t.premultipliedAlpha):this.setTexture2D(o,s),this.currentTextureUnit}createIB(){for(var t=[0,1,2,2,1,3],e=new Array(MAX_LENGTH*INDICES_PER_QUAD),i=0;i<e.length;i++)e[i]=t[i%INDICES_PER_QUAD]+~~(i/INDICES_PER_QUAD)*ELEMENTS_PER_QUAD;return new Uint16Array(e)}resizeSB(){this.sbSize<<=1;var t=new Float32Array(this.sbSize*ELEMENT_SIZE*ELEMENTS_PER_QUAD);t.set(this.stream),this.stream=t}useShader(t){if(this.activeShader!==t){this.flush(),this.activeShader=t,this.activeShader.bind(),this.activeShader.setUniform("uProjectionMatrix",this.renderer.projectionMatrix);for(var e=0;e<this.attributes.length;++e){var i=this.gl,r=this.attributes[e],n=this.activeShader.getAttribLocation(r.name);-1!==n?(i.enableVertexAttribArray(n),i.vertexAttribPointer(n,r.size,r.type,r.normalized,ELEMENT_OFFSET,r.offset)):i.disableVertexAttribArray(e)}}}addQuad(t,e,i,r,n,s){var o=this.color.toArray(),a=this.tint.toArray();if(!(o[3]<1/255)){a[3]=o[3],this.length>=MAX_LENGTH&&this.flush(),this.length>=this.sbSize&&this.resizeSB(),this.useShader(this.quadShader);var h=this.uploadTexture(t);this.quadShader.setUniform("uSampler",h);var l=this.viewMatrix,u=this.v[0].set(i,r),c=this.v[1].set(i+n,r),d=this.v[2].set(i,r+s),p=this.v[3].set(i+n,r+s);l.isIdentity()||(l.apply(u),l.apply(c),l.apply(d),l.apply(p));var f=this.sbIndex,g=f+ELEMENT_SIZE,v=g+ELEMENT_SIZE,m=v+ELEMENT_SIZE;this.stream[f+VERTEX_ELEMENT+0]=u.x,this.stream[f+VERTEX_ELEMENT+1]=u.y,this.stream[g+VERTEX_ELEMENT+0]=c.x,this.stream[g+VERTEX_ELEMENT+1]=c.y,this.stream[v+VERTEX_ELEMENT+0]=d.x,this.stream[v+VERTEX_ELEMENT+1]=d.y,this.stream[m+VERTEX_ELEMENT+0]=p.x,this.stream[m+VERTEX_ELEMENT+1]=p.y;var y=t.getUVs(e);this.stream[f+REGION_ELEMENT+0]=y[0],this.stream[f+REGION_ELEMENT+1]=y[1],this.stream[g+REGION_ELEMENT+0]=y[2],this.stream[g+REGION_ELEMENT+1]=y[1],this.stream[v+REGION_ELEMENT+0]=y[0],this.stream[v+REGION_ELEMENT+1]=y[3],this.stream[m+REGION_ELEMENT+0]=y[2],this.stream[m+REGION_ELEMENT+1]=y[3],this.stream.set(a,f+COLOR_ELEMENT),this.stream.set(a,g+COLOR_ELEMENT),this.stream.set(a,v+COLOR_ELEMENT),this.stream.set(a,m+COLOR_ELEMENT),this.sbIndex+=ELEMENT_SIZE*ELEMENTS_PER_QUAD,this.length++}}flush(){if(this.length){var t=this.gl,e=this.length*ELEMENT_SIZE*ELEMENTS_PER_QUAD;t.bufferData(t.ARRAY_BUFFER,this.stream.subarray(0,e),t.STREAM_DRAW),t.drawElements(this.mode,this.length*INDICES_PER_QUAD,t.UNSIGNED_SHORT,0),this.sbIndex=0,this.length=0}}drawVertices(t,e,i){var r=this.gl;i=i||e.length,this.useShader(this.primitiveShader),this.primitiveShader.setUniform("uColor",this.color);for(var n=0,s=this.viewMatrix,o=s.isIdentity(),a=0;a<i;a++)o||s.apply(e[a]),this.stream[n+0]=e[a].x,this.stream[n+1]=e[a].y,n+=ELEMENT_SIZE;r.bufferData(r.ARRAY_BUFFER,this.stream.subarray(0,i*ELEMENT_SIZE),r.STREAM_DRAW),r.drawArrays(t,0,i)}clearColor(t,e,i,r){this.gl.clearColor(t,e,i,r)}clear(){this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}class WebGLRenderer extends Renderer{constructor(t){super(t),this.context=this.gl=this.getContextGL(this.getScreenCanvas(),t.transparent),this.webGLVersion=1,this.GPUVendor=null,this.GPURenderer=null,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this._colorStack=[],this._matrixStack=[],this._scissorStack=[],this._glPoints=[new Vector2d,new Vector2d,new Vector2d,new Vector2d],this.currentTransform=new Matrix2d,this.currentCompositor=null;var e=this.settings.compositor||WebGLCompositor;this.setCompositor(new e(this)),this.gl.disable(this.gl.DEPTH_TEST),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.enable(this.gl.BLEND),this.setBlendMode(this.settings.blendMode);var i=this.gl.getExtension("WEBGL_debug_renderer_info");null!==i&&(this.GPUVendor=this.gl.getParameter(i.UNMASKED_VENDOR_WEBGL),this.GPURenderer=this.gl.getParameter(i.UNMASKED_RENDERER_WEBGL)),this.cache=new TextureCache(this.maxTextures);var r=this;return this.getScreenCanvas().addEventListener("webglcontextlost",(function(t){event.preventDefault(),r.isContextValid=!1,event.publish(event.WEBGL_ONCONTEXT_LOST,[r])}),!1),this.getScreenCanvas().addEventListener("webglcontextrestored",(function(t){r.reset(),r.isContextValid=!0,event.publish(event.WEBGL_ONCONTEXT_RESTORED,[r])}),!1),this}reset(){super.reset(),!1===this.isContextValid?this.currentCompositor.init(this):this.currentCompositor.reset(),this.gl.disable(this.gl.SCISSOR_TEST),void 0!==this.fontContext2D&&this.createFontTexture(this.cache)}setCompositor(t){null!==this.currentCompositor&&this.currentCompositor!==t&&this.currentCompositor.flush(),this.currentCompositor=t}resetTransform(){this.currentTransform.identity()}createFontTexture(t){if(void 0===this.fontTexture){var e=this.backBufferCanvas,i=e.width,r=e.height;1===this.WebGLVersion&&(isPowerOfTwo(i)||(i=nextPowerOfTwo(e.width)),isPowerOfTwo(r)||(r=nextPowerOfTwo(e.height)));var n=video$1.createCanvas(i,r,!0);this.fontContext2D=this.getContext2d(n),this.fontTexture=new Texture(createAtlas(e.width,e.height,"fontTexture"),n,t),this.currentCompositor.uploadTexture(this.fontTexture,0,0,0)}else t.set(this.fontContext2D.canvas,this.fontTexture)}createPattern(t,e){if(!(1!==video$1.renderer.WebGLVersion||isPowerOfTwo(t.width)&&isPowerOfTwo(t.height))){var i=void 0!==t.src?t.src:t;throw new Error("[WebGL Renderer] "+i+" is not a POT texture ("+t.width+"x"+t.height+")")}var r=new Texture(createAtlas(t.width,t.height,"pattern",e),t);return this.currentCompositor.uploadTexture(r),r}flush(){this.currentCompositor.flush()}clearColor(t,e){var i;this.save(),i=t instanceof Color?t.toArray():this.getColor().parseCSS(t).toArray(),this.currentCompositor.clearColor(i[0],i[1],i[2],!0===e?1:i[3]),this.currentCompositor.clear(),this.currentCompositor.clearColor(0,0,0,0),this.restore()}clearRect(t,e,i,r){var n=this.currentColor.clone();this.currentColor.copy("#000000"),this.fillRect(t,e,i,r),this.currentColor.copy(n),pool.push(n)}drawFont(t){var e=this.getFontContext();this.currentCompositor.uploadTexture(this.fontTexture,0,0,0,!0);var i=t.left+","+t.top+","+t.width+","+t.height;this.currentCompositor.addQuad(this.fontTexture,i,t.left,t.top,t.width,t.height),e.clearRect(t.left,t.top,t.width,t.height)}drawImage(t,e,i,r,n,s,o,a,h){void 0===r?(r=a=t.width,n=h=t.height,s=e,o=i,e=0,i=0):void 0===s&&(s=e,o=i,a=r,h=n,r=t.width,n=t.height,e=0,i=0),!1===this.settings.subPixel&&(s|=0,o|=0);var l=e+","+i+","+r+","+n;this.currentCompositor.addQuad(this.cache.get(t),l,s,o,a,h)}drawPattern(t,e,i,r,n){var s="0,0,"+r+","+n;this.currentCompositor.addQuad(t,s,e,i,r,n)}getScreenContext(){return this.gl}getContextGL(t,e){if(null==t)throw new Error("You must pass a canvas element in order to create a GL context");"boolean"!=typeof e&&(e=!0);var i,r={alpha:e,antialias:this.settings.antiAlias,depth:!1,stencil:!0,preserveDrawingBuffer:!1,premultipliedAlpha:e,powerPreference:this.settings.powerPreference,failIfMajorPerformanceCaveat:this.settings.failIfMajorPerformanceCaveat};if(!1===this.settings.preferWebGL1&&(i=t.getContext("webgl2",r))&&(this.WebGLVersion=2),i||(this.WebGLVersion=1,i=t.getContext("webgl",r)||t.getContext("experimental-webgl",r)),!i)throw new Error("A WebGL context could not be created.");return i}getContext(){return this.gl}setBlendMode(t,e){(e=e||this.gl).enable(e.BLEND),"multiply"===t?(e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.currentBlendMode=t):(e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),this.currentBlendMode="normal")}getFontContext(){return void 0===this.fontContext2D&&(console.warn("[WebGL Renderer] WARNING : Using Standard me.Text with WebGL will severly impact performances !"),this.createFontTexture(this.cache)),this.fontContext2D}restore(){if(0!==this._matrixStack.length){var t=this._colorStack.pop(),e=this._matrixStack.pop();this.currentColor.copy(t),this.currentTransform.copy(e),pool.push(t),pool.push(e)}0!==this._scissorStack.length?this.currentScissor.set(this._scissorStack.pop()):(this.gl.disable(this.gl.SCISSOR_TEST),this.currentScissor[0]=0,this.currentScissor[1]=0,this.currentScissor[2]=this.backBufferCanvas.width,this.currentScissor[3]=this.backBufferCanvas.height)}save(){this._colorStack.push(this.currentColor.clone()),this._matrixStack.push(this.currentTransform.clone()),this.gl.isEnabled(this.gl.SCISSOR_TEST)&&this._scissorStack.push(this.currentScissor.slice())}rotate(t){this.currentTransform.rotate(t)}scale(t,e){this.currentTransform.scale(t,e)}setAntiAlias(t,e){super.setAntiAlias(t,e)}setGlobalAlpha(t){this.currentColor.glArray[3]=t}setColor(t){var e=this.currentColor.glArray[3];this.currentColor.copy(t),this.currentColor.glArray[3]*=e}setLineWidth(t){this.getScreenContext().lineWidth(t)}strokeArc(t,e,i,r,n,s,o){if(!0===o)this.fillArc(t,e,i,r,n,s);else{var a,h=this._glPoints,l=Math.floor(24*Math.sqrt(2*i)),u=(n-r)/(2*l),c=2*u,d=Math.cos(u),p=Math.sin(u);for(a=h.length;a<l+1;a++)h.push(new Vector2d);for(a=0;a<l;a++){var f=u+r+c*a,g=Math.cos(f),v=-Math.sin(f);h[a].x=t+(d*g+p*v)*i,h[a].y=e+(d*-v+p*g)*i}this.currentCompositor.drawVertices(this.gl.LINE_STRIP,h,l)}}fillArc(t,e,i,r,n,s){var o,a=this._glPoints,h=0,l=Math.floor(24*Math.sqrt(2*i)),u=(n-r)/(2*l),c=2*u,d=Math.cos(u),p=Math.sin(u);for(o=a.length;o<2*l;o++)a.push(new Vector2d);for(o=0;o<l-1;o++){var f=u+r+c*o,g=Math.cos(f),v=-Math.sin(f);a[h++].set(t,e),a[h++].set(t-(d*g+p*v)*i,e-(d*-v+p*g)*i)}this.currentCompositor.drawVertices(this.gl.TRIANGLE_STRIP,a,h)}strokeEllipse(t,e,i,r,n){if(!0===n)this.fillEllipse(t,e,i,r);else{var s,o=Math.floor(24*Math.sqrt(i))||Math.floor(12*Math.sqrt(i+r)),a=TAU/o,h=this._glPoints;for(s=h.length;s<o;s++)h.push(new Vector2d);for(s=0;s<o;s++)h[s].x=t+Math.sin(a*-s)*i,h[s].y=e+Math.cos(a*-s)*r;this.currentCompositor.drawVertices(this.gl.LINE_LOOP,h,o)}}fillEllipse(t,e,i,r){var n,s=Math.floor(24*Math.sqrt(i))||Math.floor(12*Math.sqrt(i+r)),o=TAU/s,a=this._glPoints,h=0;for(n=a.length;n<2*(s+1);n++)a.push(new Vector2d);for(n=0;n<s+1;n++)a[h++].set(t,e),a[h++].set(t+Math.sin(o*n)*i,e+Math.cos(o*n)*r);this.currentCompositor.drawVertices(this.gl.TRIANGLE_STRIP,a,h)}strokeLine(t,e,i,r){var n=this._glPoints;n[0].x=t,n[0].y=e,n[1].x=i,n[1].y=r,this.currentCompositor.drawVertices(this.gl.LINE_STRIP,n,2)}fillLine(t,e,i,r){this.strokeLine(t,e,i,r)}strokePolygon(t,e){if(!0===e)this.fillPolygon(t);else{var i,r=t.points.length,n=this._glPoints;for(i=n.length;i<r;i++)n.push(new Vector2d);for(i=0;i<r;i++)n[i].x=t.pos.x+t.points[i].x,n[i].y=t.pos.y+t.points[i].y;this.currentCompositor.drawVertices(this.gl.LINE_LOOP,n,r)}}fillPolygon(t){var e,i=t.points,r=this._glPoints,n=t.getIndices(),s=t.pos.x,o=t.pos.y;for(e=r.length;e<n.length;e++)r.push(new Vector2d);for(e=0;e<n.length;e++)r[e].set(s+i[n[e]].x,o+i[n[e]].y);this.currentCompositor.drawVertices(this.gl.TRIANGLES,r,n.length)}strokeRect(t,e,i,r,n){if(!0===n)this.fillRect(t,e,i,r);else{var s=this._glPoints;s[0].x=t,s[0].y=e,s[1].x=t+i,s[1].y=e,s[2].x=t+i,s[2].y=e+r,s[3].x=t,s[3].y=e+r,this.currentCompositor.drawVertices(this.gl.LINE_LOOP,s,4)}}fillRect(t,e,i,r){var n=this._glPoints;n[0].x=t+i,n[0].y=e,n[1].x=t,n[1].y=e,n[2].x=t+i,n[2].y=e+r,n[3].x=t,n[3].y=e+r,this.currentCompositor.drawVertices(this.gl.TRIANGLE_STRIP,n,4)}setTransform(t){this.resetTransform(),this.transform(t)}transform(t){var e=this.currentTransform;if(e.multiply(t),!1===this.settings.subPixel){var i=e.toArray();i[6]|=0,i[7]|=0}}translate(t,e){var i=this.currentTransform;if(i.translate(t,e),!1===this.settings.subPixel){var r=i.toArray();r[6]|=0,r[7]|=0}}clipRect(t,e,i,r){var n=this.backBufferCanvas,s=this.gl;if(0!==t||0!==e||i!==n.width||r!==n.height){var o=this.currentScissor;if(s.isEnabled(s.SCISSOR_TEST)&&o[0]===t&&o[1]===e&&o[2]===i&&o[3]===r)return;this.flush(),s.enable(this.gl.SCISSOR_TEST),s.scissor(t+this.currentTransform.tx,n.height-r-e-this.currentTransform.ty,i,r),o[0]=t,o[1]=e,o[2]=i,o[3]=r}else s.disable(s.SCISSOR_TEST)}setMask(t){var e=this.gl;this.flush(),e.enable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.colorMask(!1,!1,!1,!1),e.stencilFunc(e.NOTEQUAL,1,1),e.stencilOp(e.REPLACE,e.REPLACE,e.REPLACE),this.fill(t),this.flush(),e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,1,1),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}clearMask(){this.flush(),this.gl.disable(this.gl.STENCIL_TEST)}}var designRatio=1,designWidth=0,designHeight=0,settings={parent:document.body,renderer:2,doubleBuffering:!1,autoScale:!1,scale:1,scaleMethod:"fit",transparent:!1,blendMode:"normal",antiAlias:!1,failIfMajorPerformanceCaveat:!0,subPixel:!1,preferWebGL1:!1,powerPreference:"default",verbose:!1,consoleHeader:!0};function autoDetectRenderer(t){try{if(device$1.isWebGLSupported(t))return new WebGLRenderer(t)}catch(t){console.log("Error creating WebGL renderer :"+t.message)}return new CanvasRenderer(t)}var video={CANVAS:0,WEBGL:1,AUTO:2,parent:null,scaleRatio:new Vector2d(1,1),init:function(t,e,i){if(!initialized)throw new Error("me.video.init() called before engine initialization.");(settings=Object.assign(settings,i||{})).width=t,settings.height=e,settings.doubleBuffering=!!settings.doubleBuffering,settings.transparent=!!settings.transparent,settings.antiAlias=!!settings.antiAlias,settings.failIfMajorPerformanceCaveat=!!settings.failIfMajorPerformanceCaveat,settings.subPixel=!!settings.subPixel,settings.verbose=!!settings.verbose,-1!==settings.scaleMethod.search(/^(fill-(min|max)|fit|flex(-(width|height))?|stretch)$/)?settings.autoScale="auto"===settings.scale||!0:(settings.scaleMethod="fit",settings.autoScale="auto"===settings.scale||!1),void 0!==settings.wrapper&&(warning("settings.wrapper","settings.parent","8.0.0"),settings.parent=settings.wrapper),!1!==settings.consoleHeader&&console.log("melonJS v"+version+" | http://melonjs.org");var r=utils$1.getUriFragment();!0!==r.webgl&&!0!==r.webgl1&&!0!==r.webgl2||(settings.renderer=this.WEBGL,!0===r.webgl1&&(settings.preferWebGL1=!0)),settings.scale=settings.autoScale?1:+settings.scale||1,this.scaleRatio.set(settings.scale,settings.scale),(settings.autoScale||1!==settings.scale)&&(settings.doubleBuffering=!0),designRatio=t/e,designWidth=t,designHeight=e,settings.zoomX=t*this.scaleRatio.x,settings.zoomY=e*this.scaleRatio.y,window.addEventListener("resize",utils$1.function.throttle((function(t){event.publish(event.WINDOW_ONRESIZE,[t])}),100),!1),window.addEventListener("orientationchange",(function(t){event.publish(event.WINDOW_ONORIENTATION_CHANGE,[t])}),!1),window.addEventListener("onmozorientationchange",(function(t){event.publish(event.WINDOW_ONORIENTATION_CHANGE,[t])}),!1),void 0!==window.screen&&(window.screen.onorientationchange=function(t){event.publish(event.WINDOW_ONORIENTATION_CHANGE,[t])}),window.addEventListener("scroll",utils$1.function.throttle((function(t){event.publish(event.WINDOW_ONSCROLL,[t])}),100),!1),event.subscribe(event.WINDOW_ONRESIZE,this.onresize.bind(this)),event.subscribe(event.WINDOW_ONORIENTATION_CHANGE,this.onresize.bind(this));try{switch(settings.renderer){case this.AUTO:case this.WEBGL:this.renderer=autoDetectRenderer(settings);break;default:this.renderer=new CanvasRenderer(settings)}}catch(t){return console(t.message),!1}if(this.parent=device$1.getElement(settings.parent),this.parent.appendChild(this.renderer.getScreenCanvas()),this.onresize(),"MutationObserver"in window&&new MutationObserver(this.onresize.bind(this)).observe(this.parent,{attributes:!1,childList:!0,subtree:!0}),!1!==settings.consoleHeader){var n=this.renderer instanceof CanvasRenderer?"CANVAS":"WebGL"+this.renderer.WebGLVersion,s=device$1.hasWebAudio?"Web Audio":"HTML5 Audio",o="string"==typeof this.renderer.GPURenderer?" ("+this.renderer.GPURenderer+")":"";console.log(n+" renderer"+o+" | "+s+" | pixel ratio "+device$1.devicePixelRatio+" | "+(device$1.isMobile?"mobile":"desktop")+" | "+device$1.getScreenOrientation()+" | "+device$1.language),console.log("resolution: requested "+t+"x"+e+", got "+this.renderer.getWidth()+"x"+this.renderer.getHeight())}return event.publish(event.VIDEO_INIT),!0},createCanvas:function(t,e,i){var r;if(0===t||0===e)throw new Error("width or height was zero, Canvas could not be initialized !");return!0===device$1.OffscreenCanvas&&!0===i?void 0===(r=new OffscreenCanvas(0,0)).style&&(r.style={}):r=document.createElement("canvas"),r.width=t,r.height=e,r},getParent:function(){return this.parent},onresize:function(){var t=this.renderer,e=t.settings,i=1,r=1;if(e.autoScale){var n=1/0,s=1/0;if(window.getComputedStyle){var o=window.getComputedStyle(t.getScreenCanvas(),null);n=parseInt(o.maxWidth,10)||1/0,s=parseInt(o.maxHeight,10)||1/0}var a=device$1.getParentBounds(this.getParent()),h=Math.min(n,a.width),l=Math.min(s,a.height),u=h/l;if("fill-min"===e.scaleMethod&&u>designRatio||"fill-max"===e.scaleMethod&&u<designRatio||"flex-width"===e.scaleMethod){var c=Math.min(n,designHeight*u);i=r=h/c,t.resize(Math.floor(c),designHeight)}else if("fill-min"===e.scaleMethod&&u<designRatio||"fill-max"===e.scaleMethod&&u>designRatio||"flex-height"===e.scaleMethod){var d=Math.min(s,designWidth*(l/h));i=r=l/d,t.resize(designWidth,Math.floor(d))}else"flex"===e.scaleMethod?t.resize(Math.floor(h),Math.floor(l)):"stretch"===e.scaleMethod?(i=h/designWidth,r=l/designHeight):i=r=u<designRatio?h/designWidth:l/designHeight;this.scale(i,r)}},scale:function(t,e){var i=this.renderer,r=i.getScreenCanvas(),n=i.getScreenContext(),s=i.settings,o=device$1.devicePixelRatio,a=s.zoomX=r.width*t*o,h=s.zoomY=r.height*e*o;this.scaleRatio.set(t*o,e*o),r.style.width=a/o+"px",r.style.height=h/o+"px",i.setAntiAlias(n,s.antiAlias),i.setBlendMode(s.blendMode,n),game$1.repaint()}},video$1=video,GUID_base="",GUID_index=0,utils={agent:agentUtils,array:arrayUtils,file:fileUtils,string:stringUtils,function:fnUtils,getPixels:function(t){if(t instanceof HTMLImageElement){var e=CanvasRenderer.getContext2d(video$1.createCanvas(t.width,t.height));return e.drawImage(t,0,0),e.getImageData(0,0,t.width,t.height)}return t.getContext("2d").getImageData(0,0,t.width,t.height)},checkVersion:function(t,e=version){for(var i=t.split("."),r=e.split("."),n=Math.min(i.length,r.length),s=0,o=0;o<n&&!(s=+i[o]-+r[o]);o++);return s||i.length-r.length},getUriFragment:(UriFragments={},parsed=!1,function(t){var e;if(void 0===t){if(e=UriFragments,!0===parsed)return e;t=document.location,parsed=!0}else e={};return t&&t.hash&&t.hash.substr(1).split("&").filter((function(t){return""!==t})).forEach((function(t){var i=t.split("="),r=i.shift(),n=i.join("=");e[r]=n||!0})),e}),resetGUID:function(t,e=0){GUID_base=toHex$1(t.toString().toUpperCase()),GUID_index=e},createGUID:function(t=1){return GUID_index+=t,GUID_base+"-"+(t||GUID_index)}},UriFragments,parsed,utils$1=utils,framecount=0,framedelta=0,last=0,now=0,delta=0,step=0,minstep=0,timers=[],timerId=0;function clearTimer(t){for(var e=0,i=timers.length;e<i;e++)if(timers[e].timerId===t){timers.splice(e,1);break}}function updateTimers(t){last=now,(delta=(now=t)-last)<0&&(delta=0),timer.tick=delta>minstep&&timer.interpolation?delta/step:1;for(var e=0,i=timers.length;e<i;e++){var r=timers[e];r.pauseable&&state$1.isPaused()||(r.elapsed+=delta),r.elapsed>=r.delay&&(r.fn.apply(null,r.args),!0===r.repeat?r.elapsed-=r.delay:timer.clearTimeout(r.timerId))}}var timer={tick:1,fps:0,maxfps:60,interpolation:!1,lastUpdate:window.performance.now(),init(){this.reset(),now=last=0,event.subscribe(event.GAME_UPDATE,updateTimers)},reset(){last=now=window.performance.now(),delta=0,framedelta=0,framecount=0,step=Math.ceil(1e3/this.maxfps),minstep=1e3/this.maxfps*1.25},setTimeout(t,e,i){return timers.push({fn:t,delay:e,elapsed:0,repeat:!1,timerId:++timerId,pauseable:!0===i||!0,args:arguments.length>3?Array.prototype.slice.call(arguments,3):void 0}),timerId},setInterval(t,e,i){return timers.push({fn:t,delay:e,elapsed:0,repeat:!0,timerId:++timerId,pauseable:!0===i||!0,args:arguments.length>3?Array.prototype.slice.call(arguments,3):void 0}),timerId},clearTimeout(t){utils$1.function.defer(clearTimer,this,t)},clearInterval(t){utils$1.function.defer(clearTimer,this,t)},getTime:()=>now,getDelta:()=>delta,countFPS(){framecount++,framedelta+=delta,framecount%10==0&&(this.fps=clamp(Math.round(1e3*framecount/framedelta),0,this.maxfps),framedelta=0,framecount=0)}},timer$1=timer,lastTime=0,vendors=["ms","moz","webkit","o"],x,requestAnimationFrame=window.requestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame;for(x=0;x<vendors.length&&!requestAnimationFrame;++x)requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];for(x=0;x<vendors.length&&!cancelAnimationFrame;++x)cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];requestAnimationFrame&&cancelAnimationFrame||(requestAnimationFrame=function(t){var e=window.performance.now(),i=Math.max(0,1e3/timer$1.maxfps-(e-lastTime)),r=window.setTimeout((function(){t(e+i)}),i);return lastTime=e+i,r},cancelAnimationFrame=function(t){window.clearTimeout(t)},window.requestAnimationFrame=requestAnimationFrame,window.cancelAnimationFrame=cancelAnimationFrame);var plugins={},plugin={Base:window.Jay.extend({init:function(){this.version="9.1.1"}}),patch:function(t,e,i){if(void 0!==t.prototype&&(t=t.prototype),"function"!=typeof t[e])throw new Error(e+" is not an existing function");var r=t[e];Object.defineProperty(t,e,{configurable:!0,value:function(t,e){return function(){this._patched=r;var t=e.apply(this,arguments);return this._patched=null,t}}(0,i)})},register:function(t,e){if(plugins[e])throw new Error("plugin "+e+" already registered");var i=[];arguments.length>2&&(i=Array.prototype.slice.call(arguments,1)),i[0]=t;var r=new(t.bind.apply(t,i));if(void 0===r||!(r instanceof plugin.Base))throw new Error("Plugin should extend the me.plugin.Base Class !");if(utils$1.checkVersion(r.version)>0)throw new Error("Plugin version mismatch, expected: "+r.version+", got: "+version);plugins[e]=r}};let Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-Easing.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*Easing.Bounce.In(2*t):.5*Easing.Bounce.Out(2*t-1)+.5}}},Interpolation={Linear:function(t,e){var i=t.length-1,r=i*e,n=Math.floor(r),s=Interpolation.Utils.Linear;return e<0?s(t[0],t[1],r):e>1?s(t[i],t[i-1],i-r):s(t[n],t[n+1>i?i:n+1],r-n)},Bezier:function(t,e){var i,r=0,n=t.length-1,s=Math.pow,o=Interpolation.Utils.Bernstein;for(i=0;i<=n;i++)r+=s(1-e,n-i)*s(e,i)*t[i]*o(n,i);return r},CatmullRom:function(t,e){var i=t.length-1,r=i*e,n=Math.floor(r),s=Interpolation.Utils.CatmullRom;return t[0]===t[i]?(e<0&&(n=Math.floor(r=i*(1+e))),s(t[(n-1+i)%i],t[n],t[(n+1)%i],t[(n+2)%i],r-n)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-r)-t[0]):e>1?t[i]-(s(t[i],t[i],t[i-1],t[i-1],r-i)-t[i]):s(t[n?n-1:0],t[n],t[i<n+1?i:n+1],t[i<n+2?i:n+2],r-n)},Utils:{Linear:function(t,e,i){return(e-t)*i+t},Bernstein:function(t,e){var i=Interpolation.Utils.Factorial;return i(t)/i(e)/i(t-e)},Factorial:function(){var t=[1];return function(e){var i,r=1;if(t[e])return t[e];for(i=e;i>1;i--)r*=i;return t[e]=r}}(),CatmullRom:function(t,e,i,r,n){var s=.5*(i-t),o=.5*(r-e),a=n*n;return(2*e-2*i+s+o)*(n*a)+(-3*e+3*i-2*s-o)*a+s*n+e}}};class Tween{constructor(t){var e=null,i=null,r=null,n=null,s=null,o=null,a=null,h=null,l=null,u=null,c=null,d=null,p=null,f=null,g=null,v=null,m=null;this.isRenderable=!1,this._resumeCallback=function(t){l&&(l+=t)},this.setProperties=function(t){for(var y in e=t,i={},r={},n={},s=1e3,o=0,a=!1,h=0,l=null,u=Easing.Linear.None,c=Interpolation.Linear,d=[],p=null,f=!1,g=null,v=null,m=timer$1.lastUpdate,this.isPersistent=!1,this.updateWhenPaused=!1,t)"object"!=typeof t&&(i[y]=parseFloat(t[y]))},this.setProperties(t),this.onResetEvent=function(t){this.setProperties(t)},this.onActivateEvent=function(){event.subscribe(event.STATE_RESUME,this._resumeCallback)},this.onDeactivateEvent=function(){event.unsubscribe(event.STATE_RESUME,this._resumeCallback)},this.to=function(t,e){return r=t,void 0!==e&&("number"==typeof e?s=e:"object"==typeof e&&(e.duration&&(s=e.duration),e.yoyo&&this.yoyo(e.yoyo),e.easing&&this.easing(e.easing),e.repeat&&this.repeat(e.repeat),e.delay&&this.delay(e.delay),e.interpolation&&this.interpolation(e.interpolation),e.autoStart&&this.start())),this},this.start=function(t){for(var s in f=!1,game$1.world.addChild(this),l=(void 0===t?timer$1.getTime():t)+h,r){if(r[s]instanceof Array){if(0===r[s].length)continue;r[s]=[e[s]].concat(r[s])}i[s]=e[s],i[s]instanceof Array==0&&(i[s]*=1),n[s]=i[s]||0}return this},this.stop=function(){return game$1.world.removeChildNow(this),this},this.delay=function(t){return h=t,this},this.repeat=function(t){return o=t,this},this.yoyo=function(t){return a=t,this},this.easing=function(t){if("function"!=typeof t)throw new Error("invalid easing function for me.Tween.easing()");return u=t,this},this.interpolation=function(t){return c=t,this},this.chain=function(){return d=arguments,this},this.onStart=function(t){return p=t,this},this.onUpdate=function(t){return g=t,this},this.onComplete=function(t){return v=t,this},this.update=function(t){var y,_=m=timer$1.lastUpdate>m?timer$1.lastUpdate:m+t;if(_<l)return!0;!1===f&&(null!==p&&p.call(e),f=!0);var x=(_-l)/s,w=u(x=x>1?1:x);for(y in r){var b=i[y]||0,E=r[y];E instanceof Array?e[y]=c(E,w):("string"==typeof E&&(E=b+parseFloat(E)),"number"==typeof E&&(e[y]=b+(E-b)*w))}if(null!==g&&g.call(e,w),1===x){if(o>0){for(y in isFinite(o)&&o--,n){if("string"==typeof r[y]&&(n[y]=n[y]+parseFloat(r[y])),a){var T=n[y];n[y]=r[y],r[y]=T}i[y]=n[y]}return l=_+h,!0}game$1.world.removeChildNow(this),null!==v&&v.call(e);for(var S=0,A=d.length;S<A;S++)d[S].start(_);return!1}return!0}}static get Easing(){return Easing}static get Interpolation(){return Interpolation}}var runits=["ex","em","pt","px"],toPX=[12,24,.75,1],setContextStyle=function(t,e,i){t.font=e.font,t.fillStyle=e.fillStyle.toRGBA(),!0===i&&(t.strokeStyle=e.strokeStyle.toRGBA(),t.lineWidth=e.lineWidth),t.textAlign=e.textAlign,t.textBaseline=e.textBaseline},Text=Renderable.extend({init:function(t,e,i){this._super(Renderable,"init",[t,e,i.width||0,i.height||0]),void 0!==i.fillStyle?i.fillStyle instanceof Color?this.fillStyle=i.fillStyle:this.fillStyle=pool.pull("Color").parseCSS(i.fillStyle):this.fillStyle=pool.pull("Color",0,0,0),void 0!==i.strokeStyle?i.strokeStyle instanceof Color?this.strokeStyle=i.strokeStyle:this.strokeStyle=pool.pull("Color").parseCSS(i.strokeStyle):this.strokeStyle=pool.pull("Color",0,0,0),this.lineWidth=i.lineWidth||1,this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this._text=[],this.fontSize=10,void 0!==i.anchorPoint?this.anchorPoint.setV(i.anchorPoint):this.anchorPoint.set(0,0),void 0!==i.floating&&(this.floating=!!i.floating),this.setFont(i.font,i.size),!0===i.bold&&this.bold(),!0===i.italic&&this.italic(),this.setText(i.text)},bold:function(){return this.font="bold "+this.font,this.isDirty=!0,this},italic:function(){return this.font="italic "+this.font,this.isDirty=!0,this},setFont:function(t,e){var i=t.split(",").map((function(t){return t=t.trim(),/(^".*"$)|(^'.*'$)/.test(t)?t:'"'+t+'"'}));if("number"==typeof e)this.fontSize=e,e+="px";else{var r=e.match(/([-+]?[\d.]*)(.*)/);this.fontSize=parseFloat(r[1]),r[2]?this.fontSize*=toPX[runits.indexOf(r[2])]:e+="px"}return this.height=this.fontSize,this.font=e+" "+i.join(","),this.isDirty=!0,this},setText:function(t){return void 0===t&&(t=""),this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split("\n"),this.isDirty=!0),this},measureText:function(t,e,i){var r;r=void 0===t?video$1.renderer.getFontContext():t instanceof Renderer?t.getFontContext():t;var n=i||this.getBounds(),s=this.fontSize*this.lineHeight,o=void 0!==e?(""+e).split("\n"):this._text;r.save(),setContextStyle(r,this),this.height=this.width=0;for(var a=0;a<o.length;a++)this.width=Math.max(r.measureText(utils$1.string.trimRight(""+o[a])).width,this.width),this.height+=s;return n.width=Math.ceil(this.width),n.height=Math.ceil(this.height),n.x=Math.floor("right"===this.textAlign?this.pos.x-this.width:"center"===this.textAlign?this.pos.x-this.width/2:this.pos.x),n.y=Math.floor(0===this.textBaseline.search(/^(top|hanging)$/)?this.pos.y:"middle"===this.textBaseline?this.pos.y-n.height/2:this.pos.y-n.height),r.restore(),n},update:function(){return!0===this.isDirty&&this.measureText(),this.isDirty},draw:function(t,e,i,r,n){void 0===this.ancestor?(this.setText(e),this.pos.x===i&&this.pos.y===r||(this.pos.x=i,this.pos.y=r,this.isDirty=!0),this.update(0),t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity())):(i=this.pos.x,r=this.pos.y),!1===t.settings.subPixel&&(i=~~i,r=~~r),t.drawFont(this._drawFont(t.getFontContext(),this._text,i,r,n||!1)),void 0===this.ancestor&&t.restore(),this.isDirty=!1},drawStroke:function(t,e,i,r){this.draw.call(this,t,e,i,r,!0)},_drawFont:function(t,e,i,r,n){setContextStyle(t,this,n);for(var s=this.fontSize*this.lineHeight,o=0;o<e.length;o++){var a=utils$1.string.trimRight(""+e[o]);t[n?"strokeText":"fillText"](a,i,r),r+=s}return this.getBounds()},destroy:function(){pool.push(this.fillStyle),pool.push(this.strokeStyle),this.fillStyle=this.strokeStyle=void 0,this._text.length=0,this._super(Renderable,"destroy")}}),measureTextWidth=function(t,e){for(var i=e.split(""),r=0,n=null,s=0;s<i.length;s++){var o=i[s].charCodeAt(0),a=t.fontData.glyphs[o],h=n&&n.kerning?n.getKerning(o):0;r+=(a.xadvance+h)*t.fontScale.x,n=a}return r},measureTextHeight=function(t){return t.fontData.capHeight*t.lineHeight*t.fontScale.y},BitmapText=Renderable.extend({init:function(t,e,i){this._super(Renderable,"init",[t,e,i.width||0,i.height||0]),this.textAlign=i.textAlign||"left",this.textBaseline=i.textBaseline||"top",this.lineHeight=i.lineHeight||1,this._text=[],this.fontScale=pool.pull("Vector2d",1,1),this.fontImage="object"==typeof i.font?i.font:loader$1.getImage(i.font),"string"!=typeof i.fontData?this.fontData=pool.pull("BitmapTextData",loader$1.getBinary(i.font)):this.fontData=pool.pull("BitmapTextData",i.fontData.includes("info face")?i.fontData:loader$1.getBinary(i.fontData)),void 0!==i.floating&&(this.floating=!!i.floating),"number"==typeof i.size&&1!==i.size&&this.resize(i.size),void 0!==i.fillStyle&&(i.fillStyle instanceof Color?this.fillStyle.setColor(i.fillStyle):this.fillStyle.parseCSS(i.fillStyle)),void 0!==i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),this.setText(i.text)},set:function(t,e){return this.textAlign=t,e&&this.resize(e),this.isDirty=!0,this},setText:function(t){return void 0===t&&(t=""),this._text.toString()!==t.toString()&&(Array.isArray(t)?this._text=t:this._text=(""+t).split("\n"),this.isDirty=!0),this},resize:function(t){return this.fontScale.set(t,t),this.isDirty=!0,this},measureText:function(t,e){t=t||this._text;var i=measureTextHeight(this),r=e||this.getBounds(),n="string"==typeof t?(""+t).split("\n"):t;r.height=r.width=0;for(var s=0;s<n.length;s++)r.width=Math.max(measureTextWidth(this,n[s]),r.width),r.height+=i;return r},update:function(){return!0===this.isDirty&&this.measureText(),this.isDirty},draw:function(t,e,i,r){var n=t.globalAlpha();void 0===this.ancestor?(this.setText(e),this.update(0),t.setGlobalAlpha(n*this.getOpacity())):(i=this.pos.x,r=this.pos.y);for(var s=i,o=measureTextHeight(this),a=0,h=0;h<this._text.length;h++){i=s;var l=utils$1.string.trimRight(this._text[h]),u=measureTextWidth(this,l);switch(this.textAlign){case"right":i-=u;break;case"center":i-=.5*u}switch(this.textBaseline){case"middle":r-=.5*o;break;case"ideographic":case"alphabetic":case"bottom":r-=o}!0===this.isDirty&&void 0===this.ancestor&&(0===h&&(this.pos.y=r),a<u&&(a=u,this.pos.x=i));for(var c=null,d=0,p=l.length;d<p;d++){var f=l.charCodeAt(d),g=this.fontData.glyphs[f],v=g.width,m=g.height,y=c&&c.kerning?c.getKerning(f):0;0!==v&&0!==m&&t.drawImage(this.fontImage,g.x,g.y,v,m,i+g.xoffset,r+g.yoffset*this.fontScale.y,v*this.fontScale.x,m*this.fontScale.y),i+=(g.xadvance+y)*this.fontScale.x,c=g}r+=o}void 0===this.ancestor&&t.setGlobalAlpha(n),this.isDirty=!1},destroy:function(){pool.push(this.fontScale),this.fontScale=void 0,pool.push(this.fontData),this.fontData=void 0,this._text.length=0,this._super(Renderable,"destroy")}});Object.defineProperty(BitmapText.prototype,"fillStyle",{get:function(){return this.tint},set:function(t){this.tint=t},configurable:!0});var LOG2_PAGE_SIZE=9,PAGE_SIZE=1<<LOG2_PAGE_SIZE;class Glyph{constructor(){this.id=0,this.x=0,this.y=0,this.width=0,this.height=0,this.u=0,this.v=0,this.u2=0,this.v2=0,this.xoffset=0,this.yoffset=0,this.xadvance=0,this.fixedWidth=!1}getKerning(t){if(this.kerning){var e=this.kerning[t>>>LOG2_PAGE_SIZE];if(e)return e[t&PAGE_SIZE-1]||0}return 0}setKerning(t,e){this.kerning||(this.kerning={});var i=this.kerning[t>>>LOG2_PAGE_SIZE];void 0===i&&(this.kerning[t>>>LOG2_PAGE_SIZE]={},i=this.kerning[t>>>LOG2_PAGE_SIZE]),i[t&PAGE_SIZE-1]=e}}var capChars=["M","N","B","D","C","E","F","K","A","G","H","I","J","L","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function getValueFromPair(t,e){var i=t.match(e);if(!i)throw new Error("Could not find pattern "+e+" in string: "+t);return i[0].split("=")[1]}function getFirstGlyph(t){for(var e=Object.keys(t),i=0;i<e.length;i++)if(e[i]>32)return t[e[i]];return null}function createSpaceGlyph(t){var e=" ".charCodeAt(0),i=t[e];i||((i=new Glyph).id=e,i.xadvance=getFirstGlyph(t).xadvance,t[e]=i)}class BitmapTextData{constructor(...t){this.onResetEvent(...t)}onResetEvent(t){this.padTop=0,this.padRight=0,this.padBottom=0,this.padLeft=0,this.lineHeight=0,this.capHeight=1,this.descent=0,this.glyphs={},this.parse(t)}parse(t){if(!t)throw new Error("File containing font data was empty, cannot load the bitmap font.");var e=t.split(/\r\n|\n/),i=t.match(/padding\=\d+,\d+,\d+,\d+/g);if(!i)throw new Error("Padding not found in first line");var r=i[0].split("=")[1].split(",");this.padTop=parseFloat(r[0]),this.padLeft=parseFloat(r[1]),this.padBottom=parseFloat(r[2]),this.padRight=parseFloat(r[3]),this.lineHeight=parseFloat(getValueFromPair(e[1],/lineHeight\=\d+/g));var n,s=parseFloat(getValueFromPair(e[1],/base\=\d+/g)),o=this.padTop+this.padBottom,a=null;for(n=4;n<e.length;n++){var h=e[n],l=h.split(/=|\s+/);if(h&&!/^kernings/.test(h))if(/^kerning\s/.test(h)){var u=parseFloat(l[2]),c=parseFloat(l[4]),d=parseFloat(l[6]);null!=(a=this.glyphs[u])&&a.setKerning(c,d)}else{a=new Glyph;var p=parseFloat(l[2]);a.id=p,a.x=parseFloat(l[4]),a.y=parseFloat(l[6]),a.width=parseFloat(l[8]),a.height=parseFloat(l[10]),a.xoffset=parseFloat(l[12]),a.yoffset=parseFloat(l[14]),a.xadvance=parseFloat(l[16]),a.width>0&&a.height>0&&(this.descent=Math.min(s+a.yoffset,this.descent)),this.glyphs[p]=a}}this.descent+=this.padBottom,createSpaceGlyph(this.glyphs);var f=null;for(n=0;n<capChars.length;n++){var g=capChars[n];if(f=this.glyphs[g.charCodeAt(0)])break}if(f)this.capHeight=f.height;else for(var v in this.glyphs)if(this.glyphs.hasOwnProperty(v)){if(0===(a=this.glyphs[v]).height||0===a.width)continue;this.capHeight=Math.max(this.capHeight,a.height)}this.capHeight-=o}}var ColorLayer=Renderable.extend({init:function(t,e,i){this._super(Renderable,"init",[0,0,1/0,1/0]),this.name=t,this.pos.z=i,this.floating=!0,this.color=e instanceof Color?e:pool.pull("Color").parseCSS(e),this.anchorPoint.set(0,0)},draw:function(t,e){var i=t.getColor(),r=game$1.viewport.pos;t.setColor(this.color),t.fillRect(e.left-r.x,e.top-r.y,e.width,e.height),t.setColor(i)},destroy:function(){pool.push(this.color),this.color=void 0,this._super(Renderable,"destroy")}}),ImageLayer=Sprite.extend({init:function(t,e,i){this._super(Sprite,"init",[t,e,i]),this.floating=!0,this.offset.set(t,e),this.ratio=pool.pull("Vector2d",1,1),void 0!==i.ratio&&(utils$1.string.isNumeric(i.ratio)?this.ratio.set(i.ratio,+i.ratio):this.ratio.setV(i.ratio)),void 0===i.anchorPoint?this.anchorPoint.set(0,0):"number"==typeof i.anchorPoint?this.anchorPoint.set(i.anchorPoint,i.anchorPoint):this.anchorPoint.setV(i.anchorPoint),Object.defineProperty(this,"repeat",{get:function(){return this._repeat},set:function(t){switch(this._repeat=t,this._repeat){case"no-repeat":this.repeatX=!1,this.repeatY=!1;break;case"repeat-x":this.repeatX=!0,this.repeatY=!1;break;case"repeat-y":this.repeatX=!1,this.repeatY=!0;break;default:this.repeatX=!0,this.repeatY=!0}this.resize(game$1.viewport.width,game$1.viewport.height),this.createPattern()},configurable:!0}),this.repeat=i.repeat||"repeat",event.subscribe(event.WEBGL_ONCONTEXT_RESTORED,this.createPattern.bind(this))},onActivateEvent:function(){var t=this.updateLayer.bind(this);this.vpChangeHdlr=event.subscribe(event.VIEWPORT_ONCHANGE,t),this.vpResizeHdlr=event.subscribe(event.VIEWPORT_ONRESIZE,this.resize.bind(this)),this.vpLoadedHdlr=event.subscribe(event.LEVEL_LOADED,(function(){t(game$1.viewport.pos)})),!0!==this.ancestor.root&&this.updateLayer(game$1.viewport.pos)},resize:function(t,e){this._super(Sprite,"resize",[this.repeatX?1/0:t,this.repeatY?1/0:e])},createPattern:function(){this._pattern=video$1.renderer.createPattern(this.image,this._repeat)},updateLayer:function(t){var e=this.ratio.x,i=this.ratio.y;if(0!==e||0!==i){var r=game$1.viewport,n=this.width,s=this.height,o=r.bounds.width,a=r.bounds.height,h=this.anchorPoint.x,l=this.anchorPoint.y,u=h*(e-1)*(o-r.width)+this.offset.x-e*t.x,c=l*(i-1)*(a-r.height)+this.offset.y-i*t.y;this.repeatX?this.pos.x=u%n:this.pos.x=u,this.repeatY?this.pos.y=c%s:this.pos.y=c}},preDraw:function(t){t.save(),t.setGlobalAlpha(t.globalAlpha()*this.getOpacity()),t.setTint(this.tint)},draw:function(t){var e=game$1.viewport,i=this.width,r=this.height,n=e.bounds.width,s=e.bounds.height,o=this.anchorPoint.x,a=this.anchorPoint.y,h=this.pos.x,l=this.pos.y;0===this.ratio.x&&0===this.ratio.y&&(h+=o*(n-i),l+=a*(s-r)),t.translate(h,l),t.drawPattern(this._pattern,0,0,2*e.width,2*e.height)},onDeactivateEvent:function(){event.unsubscribe(this.vpChangeHdlr),event.unsubscribe(this.vpResizeHdlr),event.unsubscribe(this.vpLoadedHdlr)},destroy:function(){pool.push(this.ratio),this.ratio=void 0,this._super(Sprite,"destroy")}}),GUI_Object=Sprite.extend({init:function(t,e,i){this.isClickable=!0,this.holdThreshold=250,this.isHoldable=!1,this.hover=!1,this.holdTimeout=null,this.updated=!1,this.released=!0,this._super(Sprite,"init",[t,e,i]),this.floating=!0,this.isKinematic=!1},update:function(t){var e=this._super(Sprite,"update",[t]);return this.updated?(this.released||(this.updated=!1),!0):e},clicked:function(t){if(0===t.button&&this.isClickable)return this.updated=!0,this.released=!1,this.isHoldable&&(null!==this.holdTimeout&&timer$1.clearTimeout(this.holdTimeout),this.holdTimeout=timer$1.setTimeout(this.hold.bind(this),this.holdThreshold,!1),this.released=!1),this.onClick.call(this,t)},onClick:function(){return!1},enter:function(t){return this.hover=!0,this.onOver.call(this,t)},onOver:function(){},leave:function(t){return this.hover=!1,this.release.call(this,t),this.onOut.call(this,t)},onOut:function(){},release:function(t){if(!1===this.released)return this.released=!0,timer$1.clearTimeout(this.holdTimeout),this.onRelease.call(this,t)},onRelease:function(){return!1},hold:function(){timer$1.clearTimeout(this.holdTimeout),this.released||this.onHold.call(this)},onHold:function(){},onActivateEvent:function(){registerPointerEvent("pointerdown",this,this.clicked.bind(this)),registerPointerEvent("pointerup",this,this.release.bind(this)),registerPointerEvent("pointercancel",this,this.release.bind(this)),registerPointerEvent("pointerenter",this,this.enter.bind(this)),registerPointerEvent("pointerleave",this,this.leave.bind(this))},onDeactivateEvent:function(){releasePointerEvent("pointerdown",this),releasePointerEvent("pointerup",this),releasePointerEvent("pointercancel",this),releasePointerEvent("pointerenter",this),releasePointerEvent("pointerleave",this),timer$1.clearTimeout(this.holdTimeout)}}),Collectable=Sprite.extend({init:function(t,e,i){this._super(Sprite,"init",[t,e,i]),this.name=i.name,this.type=i.type,this.id=i.id,this.body=new Body(this,i.shapes||new Rect(0,0,this.width,this.height)),this.body.collisionType=collision.types.COLLECTABLE_OBJECT,i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0)}}),Trigger=Renderable.extend({init:function(t,e,i){this._super(Renderable,"init",[t,e,i.width||0,i.height||0]),this.anchorPoint.set(0,0),this.fade=i.fade,this.duration=i.duration,this.fading=!1,this.name="Trigger",this.type=i.type,this.id=i.id,this.gotolevel=i.to,this.triggerSettings={event:"level"},["type","container","onLoaded","flatten","setViewportBounds","to"].forEach(function(t){void 0!==i[t]&&(this.triggerSettings[t]=i[t])}.bind(this)),this.body=new Body(this,i.shapes||new Rect(0,0,this.width,this.height)),this.body.collisionType=collision.types.ACTION_OBJECT,this.resize(this.body.getBounds().width,this.body.getBounds().height)},getTriggerSettings:function(){return"string"==typeof this.triggerSettings.container&&(this.triggerSettings.container=game$1.world.getChildByName(this.triggerSettings.container)[0]),this.triggerSettings},onFadeComplete:function(){level.load(this.gotolevel,this.getTriggerSettings()),game$1.viewport.fadeOut(this.fade,this.duration)},triggerEvent:function(){var t=this.getTriggerSettings();if("level"!==t.event)throw new Error("Trigger invalid type");this.gotolevel=t.to,this.fade&&this.duration?this.fading||(this.fading=!0,game$1.viewport.fadeIn(this.fade,this.duration,this.onFadeComplete.bind(this))):level.load(this.gotolevel,t)},onCollision:function(){return"Trigger"===this.name&&this.triggerEvent.apply(this),!1}}),ParticleContainer=Container$1.extend({init:function(t){this._super(Container$1,"init",[game$1.viewport.pos.x,game$1.viewport.pos.y,game$1.viewport.width,game$1.viewport.height]),this.autoSort=!1,this._updateCount=0,this._dt=0,this._emitter=t,this.autoTransform=!1,this.anchorPoint.set(0,0),this.isKinematic=!0},update:function(t){if(++this._updateCount>this._emitter.framesToSkip&&(this._updateCount=0),this._updateCount>0)return this._dt+=t,!1;t+=this._dt,this._dt=0;for(var e=game$1.viewport,i=this.children.length-1;i>=0;--i){var r=this.children[i];r.inViewport=e.isVisible(r,this.floating),r.update(t)||this.removeChildNow(r)}return!0},draw:function(t,e){if(this.children.length>0){var i,r=t.getContext();this._emitter.textureAdditive&&(i=r.globalCompositeOperation,r.globalCompositeOperation="lighter"),this._super(Container$1,"draw",[t,e]),this._emitter.textureAdditive&&(r.globalCompositeOperation=i)}}}),pixel=(canvas=video$1.createCanvas(1,1),context=canvas.getContext("2d"),context.fillStyle="#fff",context.fillRect(0,0,1,1),canvas),canvas,context,ParticleEmitterSettings={width:0,height:0,image:pixel,totalParticles:50,angle:Math.PI/2,angleVariation:0,minLife:1e3,maxLife:3e3,speed:2,speedVariation:1,minRotation:0,maxRotation:0,minStartScale:1,maxStartScale:1,minEndScale:0,maxEndScale:0,gravity:0,wind:0,followTrajectory:!1,textureAdditive:!1,onlyInViewport:!0,floating:!1,maxParticles:10,frequency:100,duration:1/0,framesToSkip:0},ParticleEmitter=Renderable.extend({init:function(t,e,i){this._stream=!1,this._frequencyTimer=0,this._durationTimer=0,this._enabled=!1,this._super(Renderable,"init",[t,e,1/0,1/0]),this.alwaysUpdate=!0,this.autoSort=!1,this.container=new ParticleContainer(this),Object.defineProperty(this.pos,"z",{get:function(){return this.container.pos.z}.bind(this),set:function(t){this.container.pos.z=t}.bind(this),enumerable:!0,configurable:!0}),Object.defineProperty(this,"floating",{get:function(){return this.container.floating},set:function(t){this.container.floating=t},enumerable:!0,configurable:!0}),this.reset(i)},onActivateEvent:function(){this.ancestor.addChild(this.container),this.container.pos.z=this.pos.z,this.ancestor.autoSort||this.ancestor.sort()},onDeactivateEvent:function(){this.ancestor.hasChild(this.container)&&this.ancestor.removeChildNow(this.container)},destroy:function(){this.reset()},getRandomPointX:function(){return this.pos.x+randomFloat(0,this.width)},getRandomPointY:function(){return this.pos.y+randomFloat(0,this.height)},reset:function(t){var e=ParticleEmitterSettings,i="number"==typeof(t=t||{}).width?t.width:e.width,r="number"==typeof t.height?t.height:e.height;this.resize(i,r),Object.assign(this,e,t),this.container.reset()},addParticles:function(t){for(var e=0;e<~~t;e++){var i=pool.pull("Particle",this);this.container.addChild(i)}},isRunning:function(){return this._enabled&&this._stream},streamParticles:function(t){this._enabled=!0,this._stream=!0,this.frequency=Math.max(this.frequency,1),this._durationTimer="number"==typeof t?t:this.duration},stopStream:function(){this._enabled=!1},burstParticles:function(t){this._enabled=!0,this._stream=!1,this.addParticles("number"==typeof t?t:this.totalParticles),this._enabled=!1},update:function(t){if(this._enabled&&this._stream){if(this._durationTimer!==1/0&&(this._durationTimer-=t,this._durationTimer<=0))return this.stopStream(),!1;this._frequencyTimer+=t;var e=this.container.children.length;e<this.totalParticles&&this._frequencyTimer>=this.frequency&&(e+this.maxParticles<=this.totalParticles?this.addParticles(this.maxParticles):this.addParticles(this.totalParticles-e),this._frequencyTimer=0)}return!0}}),Particle=Renderable.extend({init:function(t){this._super(Renderable,"init",[t.getRandomPointX(),t.getRandomPointY(),t.image.width,t.image.height]),this.alwaysUpdate=!0,this.image=t.image;var e=t.angle+(t.angleVariation>0?(randomFloat(0,2)-1)*t.angleVariation:0),i=t.speed+(t.speedVariation>0?(randomFloat(0,2)-1)*t.speedVariation:0);this.vel=new Vector2d(i*Math.cos(e),-i*Math.sin(e)),this.life=randomFloat(t.minLife,t.maxLife),this.startLife=this.life,this.startScale=clamp(randomFloat(t.minStartScale,t.maxStartScale),t.minStartScale,t.maxStartScale),this.endScale=clamp(randomFloat(t.minEndScale,t.maxEndScale),t.minEndScale,t.maxEndScale),this.gravity=t.gravity,this.wind=t.wind,this.followTrajectory=t.followTrajectory,this.onlyInViewport=t.onlyInViewport,this.pos.z=t.z,this._deltaInv=timer$1.maxfps/1e3,t.followTrajectory||(this.angle=randomFloat(t.minRotation,t.maxRotation))},update:function(t){var e=t*this._deltaInv;this.life=this.life>t?this.life-t:0;var i=this.life/this.startLife,r=this.startScale;this.startScale>this.endScale?r=(r*=i)<this.endScale?this.endScale:r:this.startScale<this.endScale&&(r=(r/=i)>this.endScale?this.endScale:r),this.alpha=i,this.vel.x+=this.wind*e,this.vel.y+=this.gravity*e;var n=this.followTrajectory?Math.atan2(this.vel.y,this.vel.x):this.angle;return this.pos.x+=this.vel.x*e,this.pos.y+=this.vel.y*e,this.currentTransform.setTransform(r,0,0,0,r,0,this.pos.x,this.pos.y,1).rotate(n),(this.inViewport||!this.onlyInViewport)&&this.life>0},preDraw:function(t){t.save(),t.setGlobalAlpha(t.globalAlpha()*this.alpha),t.transform(this.currentTransform)},draw:function(t){var e=this.width,i=this.height;t.drawImage(this.image,0,0,e,i,-e/2,-i/2,e,i)}}),Entity=Renderable.extend({init:function(t,e,i){if(this.children=[],"number"!=typeof i.width||"number"!=typeof i.height)throw new Error("height and width properties are mandatory when passing settings parameters to an object entity");this._super(Renderable,"init",[t,e,i.width,i.height]),i.image&&(i.framewidth=i.framewidth||i.width,i.frameheight=i.frameheight||i.height,this.renderable=new Sprite(0,0,i)),i.anchorPoint?this.anchorPoint.set(i.anchorPoint.x,i.anchorPoint.y):this.anchorPoint.set(0,0),"string"==typeof i.name&&(this.name=i.name),this.type=i.type||"",this.id=i.id||"",this.alive=!0,void 0===i.shapes&&(i.shapes=new Polygon(0,0,[new Vector2d(0,0),new Vector2d(this.width,0),new Vector2d(this.width,this.height),new Vector2d(0,this.height)])),void 0!==this.body?this.body.init(this,i.shapes,this.onBodyUpdate.bind(this)):this.body=new Body(this,i.shapes,this.onBodyUpdate.bind(this)),0===this.width&&0===this.height&&this.resize(this.body.getBounds().width,this.body.getBounds().height),this.body.setCollisionMask(i.collisionMask),this.body.setCollisionType(i.collisionType),this.autoTransform=!1},update:function(t){return this.renderable?this.renderable.update(t):this._super(Renderable,"update",[t])},onBodyUpdate:function(t){this.getBounds().addBounds(t.getBounds(),!0),this.updateBoundsPos(this.pos.x,this.pos.y)},preDraw:function(t){t.save(),t.translate(this.pos.x+this.body.getBounds().x,this.pos.y+this.body.getBounds().y),this.renderable instanceof Renderable&&t.translate(this.anchorPoint.x*this.body.getBounds().width,this.anchorPoint.y*this.body.getBounds().height)},draw:function(t,e){var i=this.renderable;i instanceof Renderable&&(i.preDraw(t),i.draw(t,e),i.postDraw(t))},destroy:function(){this.renderable&&(this.renderable.destroy.apply(this.renderable,arguments),this.children.splice(0,1)),this._super(Renderable,"destroy",arguments)},onDeactivateEvent:function(){this.renderable&&this.renderable.onDeactivateEvent&&this.renderable.onDeactivateEvent()},onCollision:function(){return!1}});Object.defineProperty(Entity.prototype,"renderable",{get:function(){return this.children[0]},set:function(t){if(!(t instanceof Renderable))throw new Error(t+"should extend me.Renderable");this.children[0]=t,this.children[0].ancestor=this},configurable:!0});var DraggableEntity=Entity.extend({init:function(t,e,i){this._super(Entity,"init",[t,e,i]),this.dragging=!1,this.dragId=null,this.grabOffset=new Vector2d(0,0),this.onPointerEvent=registerPointerEvent,this.removePointerEvent=releasePointerEvent,this.initEvents()},initEvents:function(){var t=this;this.mouseDown=function(t){this.translatePointerEvent(t,event.DRAGSTART)},this.mouseUp=function(t){this.translatePointerEvent(t,event.DRAGEND)},this.onPointerEvent("pointerdown",this,this.mouseDown.bind(this)),this.onPointerEvent("pointerup",this,this.mouseUp.bind(this)),this.onPointerEvent("pointercancel",this,this.mouseUp.bind(this)),event.subscribe(event.POINTERMOVE,this.dragMove.bind(this)),event.subscribe(event.DRAGSTART,(function(e,i){i===t&&t.dragStart(e)})),event.subscribe(event.DRAGEND,(function(e,i){i===t&&t.dragEnd(e)}))},translatePointerEvent:function(t,e){event.publish(e,[t,this])},dragStart:function(t){if(!1===this.dragging)return this.dragging=!0,this.grabOffset.set(t.gameX,t.gameY),this.grabOffset.sub(this.pos),!1},dragMove:function(t){!0===this.dragging&&(this.pos.set(t.gameX,t.gameY,this.pos.z),this.pos.sub(this.grabOffset))},dragEnd:function(){if(!0===this.dragging)return this.dragging=!1,!1},destroy:function(){event.unsubscribe(event.POINTERMOVE,this.dragMove),event.unsubscribe(event.DRAGSTART,this.dragStart),event.unsubscribe(event.DRAGEND,this.dragEnd),this.removePointerEvent("pointerdown",this),this.removePointerEvent("pointerup",this)}}),DroptargetEntity=Entity.extend({init:function(t,e,i){this.CHECKMETHOD_OVERLAP="overlaps",this.CHECKMETHOD_CONTAINS="contains",this.checkMethod=null,this._super(Entity,"init",[t,e,i]),event.subscribe(event.DRAGEND,this.checkOnMe.bind(this)),this.checkMethod=this[this.CHECKMETHOD_OVERLAP]},setCheckMethod:function(t){void 0!==this[t]&&(this.checkMethod=this[t])},checkOnMe:function(t,e){e&&this.checkMethod(e.getBounds())&&this.drop(e)},drop:function(){},destroy:function(){event.unsubscribe(event.DRAGEND,this.checkOnMe)}}),Jay=window.Jay;const version="9.1.1";var initialized=!1,skipAutoInit=!1;function boot(){!0!==initialized&&(device$1._check(),pool.register("me.Entity",Entity),pool.register("me.Collectable",Collectable),pool.register("me.Trigger",Trigger),pool.register("me.Tween",Tween,!0),pool.register("me.Color",Color,!0),pool.register("me.Particle",Particle,!0),pool.register("me.Sprite",Sprite),pool.register("me.Renderable",Renderable),pool.register("me.Text",Text,!0),pool.register("me.BitmapText",BitmapText,!0),pool.register("me.BitmapTextData",BitmapTextData,!0),pool.register("me.ImageLayer",ImageLayer,!0),pool.register("me.ColorLayer",ColorLayer,!0),pool.register("me.Vector2d",Vector2d,!0),pool.register("me.Vector3d",Vector3d,!0),pool.register("me.ObservableVector2d",ObservableVector2d,!0),pool.register("me.ObservableVector3d",ObservableVector3d,!0),pool.register("me.Matrix2d",Matrix2d,!0),pool.register("me.Matrix3d",Matrix3d,!0),pool.register("me.Rect",Rect,!0),pool.register("me.Polygon",Polygon,!0),pool.register("me.Line",Line,!0),pool.register("me.Ellipse",Ellipse,!0),pool.register("me.Bounds",Bounds$1,!0),pool.register("Entity",Entity),pool.register("Collectable",Collectable),pool.register("Trigger",Trigger),pool.register("Tween",Tween,!0),pool.register("Color",Color,!0),pool.register("Particle",Particle,!0),pool.register("Sprite",Sprite),pool.register("Renderable",Renderable),pool.register("Text",Text,!0),pool.register("BitmapText",BitmapText,!0),pool.register("BitmapTextData",BitmapTextData,!0),pool.register("ImageLayer",ImageLayer,!0),pool.register("ColorLayer",ColorLayer,!0),pool.register("Vector2d",Vector2d,!0),pool.register("Vector3d",Vector3d,!0),pool.register("ObservableVector2d",ObservableVector2d,!0),pool.register("ObservableVector3d",ObservableVector3d,!0),pool.register("Matrix2d",Matrix2d,!0),pool.register("Matrix3d",Matrix3d,!0),pool.register("Rect",Rect,!0),pool.register("Polygon",Polygon,!0),pool.register("Line",Line,!0),pool.register("Ellipse",Ellipse,!0),pool.register("Bounds",Bounds$1,!0),save.init(),timer$1.init(),loader$1.setNocache(utils$1.getUriFragment().nocache||!1),state$1.init(),initKeyboardEvent(),game$1.init(),initialized=!0)}device$1.onReady((function(){boot()}))},5666:t=>{var e=function(t){"use strict";var e,i=Object.prototype,r=i.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function h(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,i){return t[e]=i}}function l(t,e,i,r){var n=e&&e.prototype instanceof v?e:v,s=Object.create(n.prototype),o=new O(r||[]);return s._invoke=function(t,e,i){var r=c;return function(n,s){if(r===p)throw new Error("Generator is already running");if(r===f){if("throw"===n)throw s;return C()}for(i.method=n,i.arg=s;;){var o=i.delegate;if(o){var a=S(o,i);if(a){if(a===g)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(r===c)throw r=f,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);r=p;var h=u(t,e,i);if("normal"===h.type){if(r=i.done?f:d,h.arg===g)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(r=f,i.method="throw",i.arg=h.arg)}}}(t,i,o),s}function u(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var c="suspendedStart",d="suspendedYield",p="executing",f="completed",g={};function v(){}function m(){}function y(){}var _={};h(_,s,(function(){return this}));var x=Object.getPrototypeOf,w=x&&x(x(R([])));w&&w!==i&&r.call(w,s)&&(_=w);var b=y.prototype=v.prototype=Object.create(_);function E(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function i(n,s,o,a){var h=u(t[n],t,s);if("throw"!==h.type){var l=h.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?e.resolve(c.__await).then((function(t){i("next",t,o,a)}),(function(t){i("throw",t,o,a)})):e.resolve(c).then((function(t){l.value=t,o(l)}),(function(t){return i("throw",t,o,a)}))}a(h.arg)}var n;this._invoke=function(t,r){function s(){return new e((function(e,n){i(t,r,e,n)}))}return n=n?n.then(s,s):s()}}function S(t,i){var r=t.iterator[i.method];if(r===e){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=e,S(t,i),"throw"===i.method))return g;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var n=u(r,t.iterator,i.arg);if("throw"===n.type)return i.method="throw",i.arg=n.arg,i.delegate=null,g;var s=n.arg;return s?s.done?(i[t.resultName]=s.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=e),i.delegate=null,g):s:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,g)}function A(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function O(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(A,this),this.reset(!0)}function R(t){if(t){var i=t[s];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function i(){for(;++n<t.length;)if(r.call(t,n))return i.value=t[n],i.done=!1,i;return i.value=e,i.done=!0,i};return o.next=o}}return{next:C}}function C(){return{value:e,done:!0}}return m.prototype=y,h(b,"constructor",y),h(y,"constructor",m),m.displayName=h(y,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,h(t,a,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},E(T.prototype),h(T.prototype,o,(function(){return this})),t.AsyncIterator=T,t.async=function(e,i,r,n,s){void 0===s&&(s=Promise);var o=new T(l(e,i,r,n),s);return t.isGeneratorFunction(i)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},E(b),h(b,a,"Generator"),h(b,s,(function(){return this})),h(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var r=e.pop();if(r in t)return i.value=r,i.done=!1,i}return i.done=!0,i}},t.values=R,O.prototype={constructor:O,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var i=this;function n(r,n){return a.type="throw",a.arg=t,i.next=r,n&&(i.method="next",i.arg=e),!!n}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var h=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(h&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(h){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var s=n;break}}s&&("break"===t||"continue"===t)&&s.tryLoc<=e&&e<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=t,o.arg=e,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),P(i),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var r=i.completion;if("throw"===r.type){var n=r.arg;P(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,i,r){return this.delegate={iterator:R(t),resultName:i,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}},3379:t=>{"use strict";var e=[];function i(t){for(var i=-1,r=0;r<e.length;r++)if(e[r].identifier===t){i=r;break}return i}function r(t,r){for(var s={},o=[],a=0;a<t.length;a++){var h=t[a],l=r.base?h[0]+r.base:h[0],u=s[l]||0,c="".concat(l," ").concat(u);s[l]=u+1;var d=i(c),p={css:h[1],media:h[2],sourceMap:h[3],supports:h[4],layer:h[5]};if(-1!==d)e[d].references++,e[d].updater(p);else{var f=n(p,r);r.byIndex=a,e.splice(a,0,{identifier:c,updater:f,references:1})}o.push(c)}return o}function n(t,e){var i=e.domAPI(e);return i.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;i.update(t=e)}else i.remove()}}t.exports=function(t,n){var s=r(t=t||[],n=n||{});return function(t){t=t||[];for(var o=0;o<s.length;o++){var a=i(s[o]);e[a].references--}for(var h=r(t,n),l=0;l<s.length;l++){var u=i(s[l]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}s=h}}},569:t=>{"use strict";var e={};t.exports=function(t,i){var r=function(t){if(void 0===e[t]){var i=document.querySelector(t);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(i)}},609:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},3565:(t,e,i)=>{"use strict";t.exports=function(t){var e=i.nc;e&&t.setAttribute("nonce",e)}},3380:t=>{"use strict";t.exports=function(t){var e=t.insertStyleElement(t);return{update:function(i){!function(t,e,i){var r="";i.supports&&(r+="@supports (".concat(i.supports,") {")),i.media&&(r+="@media ".concat(i.media," {"));var n=void 0!==i.layer;n&&(r+="@layer".concat(i.layer.length>0?" ".concat(i.layer):""," {")),r+=i.css,n&&(r+="}"),i.media&&(r+="}"),i.supports&&(r+="}");var s=i.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,i)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},4589:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={id:t,exports:{}};return __webpack_modules__[t](i,i.exports,__webpack_require__),i.exports}__webpack_require__.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(e,{a:e}),e},__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var __webpack_exports__={};(()=>{"use strict";__webpack_require__(1983);var t,e=(t=__webpack_require__(115))&&t.__esModule?t:{default:t};e.default._babelPolyfill&&"undefined"!=typeof console&&console.warn&&console.warn("@babel/polyfill is loaded more than once on this page. This is probably not desirable/intended and may have consequences if different versions of the polyfills are applied sequentially. If you do need to load the polyfill more than once, use @babel/polyfill/noConflict instead to bypass the warning."),e.default._babelPolyfill=!0})(),(()=>{"use strict";var t=__webpack_require__(8402),e=__webpack_require__(3379),n=__webpack_require__.n(e),s=__webpack_require__(3380),o=__webpack_require__.n(s),a=__webpack_require__(569),h=__webpack_require__.n(a),l=__webpack_require__(3565),u=__webpack_require__.n(l),d=__webpack_require__(609),p=__webpack_require__.n(d),f=__webpack_require__(4589),g=__webpack_require__.n(f),v=__webpack_require__(1424),y={};y.styleTagTransform=g(),y.setAttributes=u(),y.insert=h().bind(null,"head"),y.domAPI=o(),y.insertStyleElement=p(),n()(v.Z,y),v.Z&&v.Z.locals&&v.Z.locals;const _=t.Hf.extend({onResetEvent:function(){t.H6.world.addChild(new t.Tg("background","#000000"),-1),t.H6.world.addChild(t.d_.pull("board"),0),t.qH.bindKey(t.qH.KEY.LEFT,"left"),t.qH.bindKey(t.qH.KEY.RIGHT,"right"),t.qH.bindKey(t.qH.KEY.A,"left"),t.qH.bindKey(t.qH.KEY.D,"right")},onDestroyEvent:function(){t.qH.unbindKey(t.qH.KEY.LEFT),t.qH.unbindKey(t.qH.KEY.RIGHT),t.qH.unbindKey(t.qH.KEY.A),t.qH.unbindKey(t.qH.KEY.D)}});var x={DEFAULT:0,MOVE:1,CAPTURE:2,CASTLE:3};const w=t.JH.extend({init:function(e,i,r,n,s,o,a){this._super(t.JH,"init",[e,i,r,n]),this.color=s,this.row=o,this.column=a,this.piece=null,this.borderPaddingX=2,this.borderPaddingY=2},update:function(){return!1},draw:function(t){t.setColor("#444"),t.fillRect(this.pos.x,this.pos.y,this.width,this.height),t.setColor(this.color),t.fillRect(this.pos.x+this.borderPaddingX,this.pos.y+this.borderPaddingY,this.width-2*this.borderPaddingX,this.height-2*this.borderPaddingY)},isOccupied:function(){return null!=this.piece},isLocatedAt:function(t,e){return this.row===e&&this.column===t},addPiece:function(e){1!=this.isOccupied()&&(e.pos.x=this.pos.x-e.width/2,e.pos.y=this.pos.y-e.height/2+e.offsetY,e.pos.z=this.row+2,e.square.piece=null,e.square=null,this.piece=e,t.H6.world.sort(!0))}}),b=t.JH.extend({init:function(e,i,n,s,o,a){var h;this.numRows=o,this.numColumns=a,this.borderPaddingX=2,this.borderPaddingY=2,this.graves=[],this.graveIndex=0,this._super(t.JH,"init",[e,i,n,s]);var l=n/this.numColumns,u=s/this.numRows,d=-n/2+l/2,p=d,f=-this.height/2+u/2;for(r=0;r<this.numRows;++r){for(c=0;c<this.numColumns;++c)h=new w(this.pos.x+p,this.pos.y+f,l,u,"#aaa",r,c),t.H6.world.addChild(h,1),this.graves.push(h),p+=l;f+=u,p=d}},update:function(e){return this._super(t.JH,"update",[e]),!0},draw:function(t){t.setColor("#444"),t.fillRect(this.pos.x+this.borderPaddingX,this.pos.y+this.borderPaddingY,this.width-2*this.borderPaddingX,this.height-2*this.borderPaddingY)},addPiece:function(t){this.graveIndex>=this.graves.length||(this.graves[this.graveIndex].addPiece(t),this.graveIndex++)},isEmpty:function(){return 0==this.graveIndex}});var E=t.JH.extend({init:function(e){this._super(t.JH,"init",[0,0,{width:0,height:0}]),this.piece=e,this.moves=[]},moveToSquare:function(t){var e=this.getMove(t);null!=e?(this.performMove(e),this.finishMove()):this.moveBack()},performMove:function(t){t.type===x.CASTLE?(m.target.behavior.positionOnSquare(m.rookTo),m.rookFrom.piece=null):null!=t.target&&t.target.setPieceState(V.DEAD),t.from.piece=null,this.positionOnSquare(t.to)},finishMove:function(){this.piece.player.endTurn()},moveBack:function(){this.positionOnSquare(this.piece.square)},positionOnSquare:function(e){null!=this.piece.square&&this.piece.square!=e&&(this.piece.moveCount++,this.piece.sinceMove=0),this.piece.pos.x=e.pos.x-this.piece.width/2,this.piece.pos.y=e.pos.y-this.piece.height/2+this.piece.offsetY,this.piece.pos.z=e.row+2,this.piece.square=e,this.piece.square.piece=this.piece,t.H6.world.sort(!0)},getMove:function(t){return this.moves.find((function(e){return e.to.equals(t)}))},calculateMoves:function(){this.moves=[]},pruneMoves:function(){var t=[];this.moves.forEach((function(e,i){null!=e.target&&e.target.color==e.piece.color||t.push(e)})),this.moves=t}});const T=E;var S=t.JH.extend({init:function(e,i,r){this._super(t.JH,"init",[0,0,{width:0,height:0}]),this.from=e,this.to=i,this.type=r,this.piece=this.from.piece,this.target=this.to.piece},equals:function(t){return this.to.equals(t.to)&&this.from.equals(t.from)}});const A=S,P=A.extend({init:function(t,e){this._super(A,"init",[t,e,x.DEFAULT]),this.to.threats.push(this.piece)}}),O=T.extend({init:function(t){this._super(T,"init",[t])},calculateMoves:function(){var t;for(this.moves=[],t=this.getDiagonalSquares(-1,-1),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]));for(t=this.getDiagonalSquares(-1,1),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]));for(t=this.getDiagonalSquares(1,-1),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]));for(t=this.getDiagonalSquares(1,1),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]))},getDiagonalSquares:function(t,e){if(1!=Math.abs(t)&&1!=Math.abs(e))return[];for(var i,r=[],n=this.piece.square.row,s=this.piece.square.column;n+=e,s+=t,null!=(i=this.piece.player.board.getSquare(n,s))&&(r.push(i),!i.isOccupied()););return r}}),R=A.extend({init:function(t,e,i,r){this._super(A,"init",[t,e,x.CASTLE]),this.rookFrom=i,this.rookTo=r,this.target=this.rookFrom.piece}});var C=T.extend({init:function(t){this._super(T,"init",[t])},calculateMoves:function(){var t,e=this.piece.player.board;this.moves=[],null!=(t=this.getAdjacentSquare(1,0))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getAdjacentSquare(-1,0))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getAdjacentSquare(0,-1))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getAdjacentSquare(0,1))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getAdjacentSquare(-1,-1))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getAdjacentSquare(-1,1))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getAdjacentSquare(1,-1))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getAdjacentSquare(1,1))&&this.moves.push(new P(this.piece.square,t)),t=e.getSquare(this.piece.square.row,this.piece.square.column-2),rookFromSquare=e.getSquare(this.piece.square.row,0),rookToSquare=e.getSquare(this.piece.square.row,this.piece.square.column-1),null!=t&&null!=rookFromSquare&&null!=rookToSquare&&this.moves.push(new R(this.piece.square,t,rookFromSquare,rookToSquare)),t=e.getSquare(this.piece.square.row,this.piece.square.column+2),rookFromSquare=e.getSquare(this.piece.square.row,7),rookToSquare=e.getSquare(this.piece.square.row,this.piece.square.column+1),null!=t&&null!=rookFromSquare&&null!=rookToSquare&&this.moves.push(new R(this.piece.square,t,rookFromSquare,rookToSquare))},pruneMoves:function(){var t=[],e=this.piece.player.board;this.moves.forEach((function(i,r){if(i.type===x.CASTLE){var n,s=!1;if((0!=i.piece.moveCount||null==i.target||i.target.color!=i.piece.color||i.target.type!=game.PieceType.ROOK||0!=i.target.moveCount||i.from.isThreatened(i.piece.color))&&(s=!0),s||(7==i.rookFrom.column?n=1:0==i.rookFrom.column?n=-1:(console.error("column is "+i.rookFrom.column+", it must be 7 or 0."),s=!0)),!s){var o,a=i.piece.square.column,h=i.piece.square.row;for(a+=n;a!=i.rookFrom.column;){if((o=e.getSquare(h,a)).isOccupied()){s=!0;break}if(o.isThreatened(i.piece.color)){s=!0;break}a+=n}}s||t.push(i)}else i.to.isThreatened(i.piece.color)||null!=i.target&&i.target.color==i.piece.color||t.push(i)})),this.moves=t},getAdjacentSquare:function(t,e){if(Math.abs(t)>1||Math.abs(e)>1)return null;var i=this.piece.square.row+e,r=this.piece.square.column+t,n=this.piece.player.board.getSquare(i,r);return null==n?null:n.isOccupied()?n.piece.color!=this.piece.color?n:null:n}});const M=C,I=T.extend({init:function(t){this._super(T,"init",[t])},calculateMoves:function(){var t;this.moves=[],null!=(t=this.getLSquare(2,-1))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getLSquare(2,1))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getLSquare(-2,-1))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getLSquare(-2,1))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getLSquare(1,-2))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getLSquare(-1,-2))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getLSquare(1,2))&&this.moves.push(new P(this.piece.square,t)),null!=(t=this.getLSquare(-1,2))&&this.moves.push(new P(this.piece.square,t))},getLSquare:function(t,e){if(!(2==Math.abs(t)&&1==Math.abs(e)||2==Math.abs(e)&&1==Math.abs(t)))return null;var i=this.piece.square.row+e,r=this.piece.square.column+t;return this.piece.player.board.getSquare(i,r)}}),L=A.extend({init:function(t,e){this._super(A,"init",[t,e,x.CAPTURE]),this.to.threats.push(this.piece)}});var k=A.extend({init:function(t,e,i){this._super(A,"init",[t,e,x.ENPASSANT]),this.enpassant=i,this.target=this.enpassant.piece}});const N=k,D=T.extend({init:function(t){this._super(T,"init",[t])},finishMove:function(){this.piece.square.isOnRank(8,this.piece.color)?this.piece.player.startPawnPromotion(this.piece):this._super(game.Behavior,"finishMove")},calculateMoves:function(){var t,e,i;switch(this.moves=[],this.piece.color){case game.PieceColor.WHITE:i=-1;break;case game.PieceColor.BLACK:i=1}t=this.piece.player.board.getSquare(this.piece.square.row+i,this.piece.square.column-1),e=this.piece.player.board.getSquare(this.piece.square.row,this.piece.square.column-1),null!=t&&(this.moves.push(new L(this.piece.square,t)),null!=e&&this.moves.push(new N(this.piece.square,t,e))),t=this.piece.player.board.getSquare(this.piece.square.row+i,this.piece.square.column+1),e=this.piece.player.board.getSquare(this.piece.square.row,this.piece.square.column+1),null!=t&&(this.moves.push(new L(this.piece.square,t)),null!=e&&this.moves.push(new N(this.piece.square,t,e))),null!=(t=this.piece.player.board.getSquare(this.piece.square.row+i,this.piece.square.column))&&this.moves.push(new game.Move(this.piece.square,t,game.MoveType.MOVE)),this.piece.hasMoved()||null!=(t=this.piece.player.board.getSquare(this.piece.square.row+2*i,this.piece.square.column))&&this.moves.push(new game.Move(this.piece.square,t,game.MoveType.MOVE))},pruneMoves:function(){var t=[];this.moves.forEach((function(e,i){switch(e.type){case game.MoveType.MOVE:null==e.target&&t.push(e);break;case game.MoveType.CAPTURE:null!=e.target&&e.target.color!=e.piece.color&&t.push(e);break;case game.MoveType.ENPASSANT:null!=e.target&&e.target.color!=e.piece.color&&1==e.target.moveCount&&0==e.target.sinceMove&&null==e.to.piece&&t.push(e)}})),this.moves=t}}),B=T.extend({init:function(t){this._super(T,"init",[t])},calculateMoves:function(){var t,e;for(this.moves=[],t=this.getStraightSquares(1,0),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]));for(t=this.getStraightSquares(-1,0),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]));for(t=this.getStraightSquares(0,-1),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]));for(t=this.getStraightSquares(0,1),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]));for(e=this.getDiagonalSquares(-1,-1),i=0;i<e.length;++i)this.moves.push(new P(this.piece.square,e[i]));for(e=this.getDiagonalSquares(-1,1),i=0;i<e.length;++i)this.moves.push(new P(this.piece.square,e[i]));for(e=this.getDiagonalSquares(1,-1),i=0;i<e.length;++i)this.moves.push(new P(this.piece.square,e[i]));for(e=this.getDiagonalSquares(1,1),i=0;i<e.length;++i)this.moves.push(new P(this.piece.square,e[i]))},getStraightSquares:function(t,e){if(!(1==Math.abs(t)&&0==e||1==Math.abs(e)&&0==t))return[];for(var i,r=[],n=this.piece.square.row,s=this.piece.square.column;n+=e,s+=t,null!=(i=this.piece.player.board.getSquare(n,s))&&(r.push(i),!i.isOccupied()););return r},getDiagonalSquares:function(t,e){if(1!=Math.abs(t)&&1!=Math.abs(e))return[];for(var i,r=[],n=this.piece.square.row,s=this.piece.square.column;n+=e,s+=t,null!=(i=this.piece.player.board.getSquare(n,s))&&(r.push(i),!i.isOccupied()););return r}}),F=T.extend({init:function(t){this._super(T,"init",[t])},calculateMoves:function(){var t;for(this.moves=[],t=this.getStraightSquares(1,0),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]));for(t=this.getStraightSquares(-1,0),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]));for(t=this.getStraightSquares(0,-1),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]));for(t=this.getStraightSquares(0,1),i=0;i<t.length;++i)this.moves.push(new P(this.piece.square,t[i]))},getStraightSquares:function(t,e){if(!(1==Math.abs(t)&&0==e||1==Math.abs(e)&&0==t))return[];for(var i,r=[],n=this.piece.square.row,s=this.piece.square.column;n+=e,s+=t,null!=(i=this.piece.player.board.getSquare(n,s))&&(r.push(i),!i.isOccupied()););return r}});var V={IDLE:0,HELD:1,DEAD:2},z=t.Z.extend({init:function(e,i,r){this._super(t.Z,"init",[0,0,{image:"pieces",width:64,height:64}]),this.player=e,this.offsetY=-20,this.moveCount=0,this.setTypeAndColor(i,r)},update:function(e){return this._super(t.Z,"update",[e]),!0},setTypeAndColor:function(t,e){this.type=t,this.color=e,this.choosePieceImage(t,e),this.setBehavior(t)},choosePieceImage:function(t,e){var i=2*t+e;this.renderable.addAnimation("idle",[i],1),this.renderable.setCurrentAnimation("idle")},setBehavior:function(t){switch(t){case 0:this.behavior=new D(this);break;case 1:this.behavior=new F(this);break;case 2:this.behavior=new I(this);break;case 3:this.behavior=new O(this);break;case 4:this.behavior=new B(this);break;case 5:this.behavior=new M(this)}},setPieceState:function(e){var i=this.state;switch(this.state=e,this.state){case V.IDLE:if(i==V.HELD){var r=this.player.board.getClosestSquare(this.pos.x-(this.square.width-this.width)/2,this.pos.y-((this.square.height-this.height)/2+this.offsetY));this.behavior.moveToSquare(r)}break;case V.HELD:this.pos.z=50,t.H6.world.sort(!0);break;case V.DEAD:this.player.graveyard.addPiece(this)}},isHeld:function(){return this.state==V.HELD},isDead:function(){return this.state==V.DEAD},isColor:function(t){return this.color==t},hasMoved:function(){return this.moveCount>0},initEvents:function(){this._super(t.Z,"initEvents"),this.removePointerEvent("pointerdown",this),this.removePointerEvent("pointerup",this),this.mouseDown=function(e){return!!this.player.isTurnOwner()&&(this.translatePointerEvent(e,t.B.DRAGSTART),!1)},this.mouseUp=function(e){return!!this.player.isTurnOwner()&&(this.translatePointerEvent(e,t.B.DRAGEND),!1)},this.onPointerEvent("pointerdown",this,this.mouseDown.bind(this)),this.onPointerEvent("pointerup",this,this.mouseUp.bind(this))},dragStart:function(e){this.isDead()||this.player.isPromotingPawn()?this.player.isPromotingPawn()&&0!=this.type&&5!=this.type&&(this.player.finishPawnPromotion(this.type),this.player.endTurn()):(this.setPieceState(V.HELD),this._super(t.Z,"dragStart",[e]))},dragEnd:function(e){this.isDead()||(this.setPieceState(V.IDLE),this._super(t.Z,"dragEnd",[e]))}});const j=z;var G=t.JH.extend({init:function(e,i){var r;this._super(t.JH,"init",[0,0,{width:0,height:0}]),this.color=e,this.board=i,this.pawnToPromote=null,1===this.color?(t.H6.viewport.height,r=t.H6.viewport.width/2+240):r=t.H6.viewport.width/2-240,this.graveyard=new b(r,t.H6.viewport.height/2,80,320,8,2),t.H6.world.addChild(this.graveyard,0),this.setPieces()},setPieces:function(){var e,r;switch(this.color){case 1:r=(e=7)-1;break;case 0:r=1+(e=0)}for(piece=new j(this,1,this.color),t.H6.world.addChild(piece),piece.behavior.positionOnSquare(this.board.getSquare(e,0)),piece=new j(this,2,this.color),t.H6.world.addChild(piece),piece.behavior.positionOnSquare(this.board.getSquare(e,1)),piece=new j(this,3,this.color),t.H6.world.addChild(piece),piece.behavior.positionOnSquare(this.board.getSquare(e,2)),piece=new j(this,4,this.color),t.H6.world.addChild(piece),piece.behavior.positionOnSquare(this.board.getSquare(e,3)),piece=new j(this,5,this.color),t.H6.world.addChild(piece),piece.behavior.positionOnSquare(this.board.getSquare(e,4)),piece=new j(this,3,this.color),t.H6.world.addChild(piece),piece.behavior.positionOnSquare(this.board.getSquare(e,5)),piece=new j(this,2,this.color),t.H6.world.addChild(piece),piece.behavior.positionOnSquare(this.board.getSquare(e,6)),piece=new j(this,1,this.color),t.H6.world.addChild(piece),piece.behavior.positionOnSquare(this.board.getSquare(e,7)),i=0;i<8;++i)piece=new j(this,0,this.color),t.H6.world.addChild(piece),piece.behavior.positionOnSquare(this.board.getSquare(r,i))},isTurnOwner:function(){return this.color==this.board.turnOwner},startTurn:function(){for(var t=0;t<this.board.squares.length;++t)for(var e=this.board.squares[t],i=0;i<e.length;i++){var r=e[i];r.isOccupied()&&r.piece.isColor(this.color)&&r.piece.sinceMove++}},endTurn:function(){this.board.switchTurnOwner()},startPawnPromotion:function(t){this.pawnToPromote=t},finishPawnPromotion:function(t){this.pawnToPromote.setTypeAndColor(t,this.color),this.pawnToPromote=null},isPromotingPawn:function(){return null!=this.pawnToPromote}});const q=G,U=t.JH.extend({init:function(e,i,r,n,s,o,a){this._super(t.JH,"init",[e,i,r,n]),this.color=s,this.row=o,this.column=a,this.piece=null,this.threats=[]},draw:function(t){t.setColor(this.color),t.fillRect(this.pos.x,this.pos.y,this.width,this.height)},update:function(){return!1},isOccupied:function(){return null!=this.piece},isLocatedAt:function(t,e){return this.row===e&&this.column===t},isOnRank:function(t,e){switch(e){case game.PieceColor.WHITE:return this.row===8-t;case game.PieceColor.BLACK:return this.row===t-1}return!1},isThreatened:function(t){return this.threats.filter((function(e){return e.color!=t})).length>0},equals:function(t){return this.row===t.row&&this.column===t.column}}),$=t.JH.extend({init:function(){var e;this.turnOwner=0,this.borderPaddingX=4,this.borderPaddingY=4,this.squares=[],this._super(t.JH,"init",[t.H6.viewport.width/2,t.H6.viewport.height/2,320,320]);var i,n=this.width/8,s=this.height/8,o=-this.width/2+n/2,a=o,h=-this.height/2+s/2;for(r=0;r<8;++r){for(this.squares.push([]),c=0;c<8;++c)i=(r+c)%2==0?"#fff":"#000",e=new U(this.pos.x+a,this.pos.y+h,n,s,i,r,c),t.H6.world.addChild(e,1),this.squares[r].push(e),a+=n;h+=s,a=o}this.player1=new q(1,this),this.player2=new q(0,this),this.switchTurnOwner()},update:function(e){return this._super(t.JH,"update",[e]),!0},draw:function(t){t.setColor("#444"),t.fillRect(this.pos.x-this.borderPaddingX,this.pos.y-this.borderPaddingY,this.width+2*this.borderPaddingX,this.height+2*this.borderPaddingY)},getSquare:function(t,e){return t<0||e<0||t>=this.squares.length||e>=this.squares[t].length?null:this.squares[t][e]},getClosestSquare:function(t,e){var r,n,s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=-1,h=-1;for(i=0;i<this.squares.length;++i)(r=Math.abs(t-this.squares[0][i].pos.x+this.squares[0][i].width/2))<s&&(s=r,h=i),(n=Math.abs(e-this.squares[i][0].pos.y+this.squares[i][0].height/2))<o&&(o=n,a=i);return this.getSquare(a,h)},switchTurnOwner:function(){switch(this.turnOwner){case 1:this.turnOwner=0,this.player2.startTurn(),this.calculateMoves();break;case 0:this.turnOwner=1,this.player1.startTurn(),this.calculateMoves()}},calculateMoves:function(){for(var t,e=[],i=0;i<this.squares.length;++i)for(var r=0;r<this.squares[i].length;++r)this.squares[i][r].threats=[],null!=(t=this.squares[i][r].piece)&&e.push(t);e.forEach((function(t,e){t.behavior.calculateMoves()})),e.forEach((function(t,e){t.behavior.pruneMoves()}))}}),H=[{name:"PressStart2P",type:"image",src:"./data/fnt/PressStart2P.png"},{name:"PressStart2P",type:"binary",src:"./data/fnt/PressStart2P.fnt"},{name:"pieces",type:"image",src:"./data/img/pieces.png"}];t.Uh.onReady((function(){t.Rk.init(1218,562,{parent:"screen",scale:"auto"})?(t.n0.init("mp3,ogg"),t._m.crossOrigin="anonymous",t._m.preload(H,(function(){t.d_.register("board",$),t.SB.set(t.SB.PLAY,new _),t.SB.change(t.SB.PLAY)}))):alert("Your browser does not support HTML5 canvas.")}))})()})();